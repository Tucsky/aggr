import{a6 as t,U as e,d as r,R as s,_ as a,n as i}from"./index.5c4cb14.js";import{A as o}from"./AlertsList.5c4cb14.js";const n=i({name:"ChartContextMenu",components:{AlertsList:o},props:{value:{type:Object,default:null},paneId:{type:String,required:!0},timeframe:{type:String,required:!0},market:{type:String,required:!0},getPrice:{type:Function,default:null},price:{type:Number,default:null},timestamp:{type:Number,default:null},alert:{type:Object,default:null}},data:()=>({alertsDropdownTrigger:null,alertsDropdownSettingsTrigger:null}),computed:{timeframeForHuman(){return this.value?t(this.timeframe):null},alertsEnabled(){return this.$store.state.settings.alerts},showAlerts(){return this.$store.state[this.paneId].showAlerts},showAlertsLabel(){return this.$store.state[this.paneId].showAlertsLabel},priceFormatted(){return+e(this.price,this.market)},alertLabel(){return this.alert?this.alert.message?`${this.alert.message} @${e(this.alert.price,this.alert.market)}`:`${this.alert.market} @${e(this.alert.price,this.alert.market)}`:null}},methods:{toggleAlertsDropdown(t){this.alertsDropdownTrigger?this.alertsDropdownTrigger=null:this.alertsDropdownTrigger=t.currentTarget.parentElement},async toggleAlertsSettingsDropdown(t){await this.ensureAlerts()&&(this.alertsDropdownSettingsTrigger?this.alertsDropdownSettingsTrigger=null:this.alertsDropdownSettingsTrigger=t.currentTarget.parentElement)},async ensureAlerts(){if(!this.$store.state.settings.alerts){if(!(await r.confirm({title:"Alerts are disabled",message:"Enable alerts ?",ok:"Yes please"})))return!1;this.$store.commit("settings/TOGGLE_ALERTS",!0)}return!0},async createAlert(){if(!(await this.ensureAlerts()))return;const t={price:this.price,market:this.market,timestamp:this.timestamp,active:!1};s.createAlert(t,this.getPrice(),!0)},removeAlert(){s.removeAlert(this.alert)},async editAlert(){const t=await r.openAsPromise((await a(()=>import("./CreateAlertDialog.5c4cb14.js"),["CreateAlertDialog.5c4cb14.js","index.5c4cb14.js","index.5c4cb14.css","CreateAlertDialog.5c4cb14.css"])).default,{price:+e(this.alert.price,this.alert.market),input:this.alert.message,edit:!0});if("string"==typeof t&&t!==this.alert.message){const e={...this.alert,price:this.alert.price,message:t};await s.moveAlert(this.alert.market,this.alert.price,e,this.getPrice())}}}},function(){var t=this,e=t._self._c;return e("dropdown",{model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},[e("button",{staticClass:"dropdown-item -arrow",on:{click:function(e){return t.$emit("cmd",["toggleTimeframeDropdown",e])}}},[t._v(" "+t._s(t.timeframeForHuman)+" ")]),e("button",{staticClass:"dropdown-item",on:{click:function(e){return t.$store.dispatch("app/showSearch")}}},[e("i",{staticClass:"icon-search"}),e("span",[t._v("Search")])]),e("button",{staticClass:"dropdown-item",on:{click:function(e){return t.$emit("cmd",["takeScreenshot",e])}}},[e("i",{staticClass:"icon-add-photo"}),e("span",[t._v("Snapshot")])]),e("button",{staticClass:"dropdown-item",on:{click:function(e){return t.$emit("cmd",["flipChart"])}}},[e("i",{staticClass:"icon-flip"}),e("span",[t._v("Flip")])]),t.price?[t.alert?[e("div",{staticClass:"dropdown-divider",attrs:{"data-label":`@${t.priceFormatted}`}}),e("button",{staticClass:"dropdown-item",on:{click:t.removeAlert}},[e("i",{staticClass:"icon-cross"}),e("span",[t._v("Remove")])]),e("button",{staticClass:"dropdown-item",on:{click:t.editAlert}},[e("i",{staticClass:"icon-edit"}),e("span",[t._v("Edit")])])]:[e("div",{staticClass:"dropdown-divider",attrs:{"data-label":"alerts"}}),e("button",{staticClass:"dropdown-item",on:{click:t.createAlert}},[e("i",{staticClass:"icon-plus"}),e("span",[t._v(t._s(t.priceFormatted))]),e("i",{staticClass:"icon-cog",on:{click:function(e){return e.stopPropagation(),t.toggleAlertsSettingsDropdown.apply(null,arguments)}}})])],e("dropdown",{on:{click:function(t){t.stopPropagation()}},model:{value:t.alertsDropdownTrigger,callback:function(e){t.alertsDropdownTrigger=e},expression:"alertsDropdownTrigger"}},[e("alerts-list",{attrs:{query:t.market,"with-options":""}})],1),e("dropdown",{on:{click:function(t){t.stopPropagation()}},model:{value:t.alertsDropdownSettingsTrigger,callback:function(e){t.alertsDropdownSettingsTrigger=e},expression:"alertsDropdownSettingsTrigger"}},[e("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(t){t.stopPropagation()}}},[e("label",{staticClass:"checkbox-control -small"},[e("input",{staticClass:"form-control",attrs:{type:"checkbox"},domProps:{checked:t.showAlerts},on:{change:function(e){return t.$store.commit(`${t.paneId}/TOGGLE_ALERTS`)}}}),e("div"),e("span",[t._v("Visible")])])]),e("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(t){t.stopPropagation()}}},[e("label",{staticClass:"checkbox-control -small"},[e("input",{staticClass:"form-control",attrs:{type:"checkbox",disabled:!t.showAlerts},domProps:{checked:t.showAlertsLabel},on:{change:function(e){return t.$store.commit(`${t.paneId}/TOGGLE_ALERTS_LABEL`)}}}),e("div"),e("span",[t._v("Label")])])]),e("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),t.toggleAlertsDropdown.apply(null,arguments)}}},[t._v(" Manage "),e("i",{staticClass:"icon-more mr0"})])])]:t._e()],2)},[],!1,null,null,null,null).exports;export{n as default};
