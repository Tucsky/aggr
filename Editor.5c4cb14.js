var t=Object.defineProperty,e=(e,o,n)=>(((e,o,n)=>{o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n})(e,"symbol"!=typeof o?o+"":o,n),n);import{W as o,C as n,V as i,u as r,_ as s,X as a,Y as u,n as d}from"./index.5c4cb14.js";import{e as l}from"./editor.5c4cb142.js";import"./options.5c4cb14.js";var c=Object.defineProperty,h=Object.getOwnPropertyDescriptor,p=(t,e,o,n)=>{for(var i,r=n>1?void 0:n?h(e,o):e,s=t.length-1;s>=0;s--)(i=t[s])&&(r=(n?i(e,o,r):i(r))||r);return n&&r&&c(e,o,r),r};let m=class extends i{constructor(){super(...arguments),e(this,"value"),e(this,"editorOptions"),e(this,"preventOverride"),e(this,"editorInstance"),e(this,"_blurTimeout"),e(this,"_beforeUnloadHandler"),e(this,"contextMenuComponent"),e(this,"currentEditorOptions",{fontSize:window.devicePixelRatio>1?12:14,wordWrap:"off"})}onEditorOptionsChange(t){this.editorInstance.updateOptions(t)}onValueChange(t){this.preventOverride||this.editorInstance.setValue(t)}async mounted(){for(const t in this.editorOptions)this.editorOptions[t]&&(this.currentEditorOptions[t]=this.editorOptions[t]);this.createEditor()}beforeDestroy(){this._blurTimeout&&this.onBlur(!0),this.editorInstance.dispose()}async resize(){this.editorInstance.layout({width:0,height:0}),await this.$nextTick(),this.editorInstance.layout()}async onBlur(t=!1){this._beforeUnloadHandler&&(window.removeEventListener("beforeunload",this._beforeUnloadHandler),this._beforeUnloadHandler=null),t||(this.preventOverride=!0,this.$emit("blur",this.editorInstance.getValue()),await this.$nextTick(),this.preventOverride=!1)}onFocus(){this._beforeUnloadHandler||(this._beforeUnloadHandler=t=>(t.preventDefault(),t.returnValue="",!1),window.addEventListener("beforeunload",this._beforeUnloadHandler))}async createEditor(){this.editorInstance=l.create(this.$el,{value:this.value,language:"javascript",tabSize:2,insertSpaces:!0,fontSize:this.currentEditorOptions.fontSize,wordWrap:this.currentEditorOptions.wordWrap,scrollbar:{vertical:"hidden"},overviewRulerLanes:0,overviewRulerBorder:!1,contextmenu:!1,theme:"aggr"}),this.editorInstance.getDomNode().addEventListener("mousedown",(()=>{this.contextMenuComponent&&this.contextMenuComponent.value&&(this.contextMenuComponent.value=null)})),this.editorInstance.onDidBlurEditorText((()=>{this._blurTimeout&&clearTimeout(this._blurTimeout),this._blurTimeout=setTimeout((()=>{this.onBlur(),this._blurTimeout=null}),100)})),this.editorInstance.onDidFocusEditorText((()=>{this._blurTimeout&&(clearTimeout(this._blurTimeout),this._blurTimeout=null),this.onFocus()}))}async onContextMenu(t){if(window.innerWidth<375)return;t.preventDefault();const{x:e,y:o}=r(t,!0),n={value:{top:o,left:e,width:2,height:2},editorOptions:this.currentEditorOptions};if(this.contextMenuComponent){this.contextMenuComponent.$off("cmd");for(const t in n)this.contextMenuComponent[t]=n[t]}else{document.body.style.cursor="progress";const t=await s((()=>import("./EditorContextMenu.5c4cb14.js")),["EditorContextMenu.5c4cb14.js","index.5c4cb14.js","index.5c4cb14.css"]);document.body.style.cursor="",this.contextMenuComponent=a(t.default,n),u(this.contextMenuComponent)}this.contextMenuComponent.$on("cmd",(t=>{if(!(this[t[0]]instanceof Function))throw new Error(`[editor] ContextMenu--\x3e${t[0]} is not a function`);this[t[0]](...t.slice(1))}))}zoom(t,e){e?this.currentEditorOptions.fontSize=t:this.currentEditorOptions.fontSize+=t,this.$emit("options",this.currentEditorOptions)}toggleWordWrap(t){this.currentEditorOptions.wordWrap=t?"off":"on",this.$emit("options",this.currentEditorOptions)}};p([o("editorOptions",{deep:!0})],m.prototype,"onEditorOptionsChange",1),p([o("value")],m.prototype,"onValueChange",1),m=p([n({name:"Editor",props:{value:{type:String,default:""},editorOptions:{type:Object,default:{}}}})],m);const f=d(m,(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"editor",on:{contextmenu:t.onContextMenu}})}),[],!1,null,null,null,null).exports;export{f as default};
