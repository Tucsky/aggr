import{l as t,r as i,as as s,at as e,au as n,af as h,E as o,K as r,v as l,av as a}from"./index.5c4cb14.js";function c(t){var i=t.width,s=t.height;if(i<0)throw new Error("Negative width is not allowed for Size");if(s<0)throw new Error("Negative height is not allowed for Size");return{width:i,height:s}}function u(t,i){return t.width===i.width&&t.height===i.height}var d=function(){function t(t){var i=this;this._resolutionListener=function(){return i._onResolutionChanged()},this._resolutionMediaQueryList=null,this._observers=[],this._window=t,this._installResolutionListener()}return t.prototype.dispose=function(){this._uninstallResolutionListener(),this._window=null},Object.defineProperty(t.prototype,"value",{get:function(){return this._window.devicePixelRatio},enumerable:!1,configurable:!0}),t.prototype.subscribe=function(t){var i=this,s={next:t};return this._observers.push(s),{unsubscribe:function(){i._observers=i._observers.filter(function(t){return t!==s})}}},t.prototype._installResolutionListener=function(){if(null!==this._resolutionMediaQueryList)throw new Error("Resolution listener is already installed");var t=this._window.devicePixelRatio;this._resolutionMediaQueryList=this._window.matchMedia("all and (resolution: ".concat(t,"dppx)")),this._resolutionMediaQueryList.addListener(this._resolutionListener)},t.prototype._uninstallResolutionListener=function(){null!==this._resolutionMediaQueryList&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},t.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},t.prototype._onResolutionChanged=function(){var t=this;this._observers.forEach(function(i){return i.next(t._window.devicePixelRatio)}),this._reinstallResolutionListener()},t}();var f=function(){function t(t,i,s){var e;this._canvasElement=null,this._bitmapSizeChangedListeners=[],this._suggestedBitmapSize=null,this._suggestedBitmapSizeChangedListeners=[],this._devicePixelRatioObservable=null,this._canvasElementResizeObserver=null,this._canvasElement=t,this._canvasElementClientSize=c({width:this._canvasElement.clientWidth,height:this._canvasElement.clientHeight}),this._transformBitmapSize=null!=i?i:function(t){return t},this._allowResizeObserver=null===(e=null==s?void 0:s.allowResizeObserver)||void 0===e||e,this._chooseAndInitObserver()}return t.prototype.dispose=function(){var t,i;if(null===this._canvasElement)throw new Error("Object is disposed");null===(t=this._canvasElementResizeObserver)||void 0===t||t.disconnect(),this._canvasElementResizeObserver=null,null===(i=this._devicePixelRatioObservable)||void 0===i||i.dispose(),this._devicePixelRatioObservable=null,this._suggestedBitmapSizeChangedListeners.length=0,this._bitmapSizeChangedListeners.length=0,this._canvasElement=null},Object.defineProperty(t.prototype,"canvasElement",{get:function(){if(null===this._canvasElement)throw new Error("Object is disposed");return this._canvasElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvasElementClientSize",{get:function(){return this._canvasElementClientSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bitmapSize",{get:function(){return c({width:this.canvasElement.width,height:this.canvasElement.height})},enumerable:!1,configurable:!0}),t.prototype.resizeCanvasElement=function(t){this._canvasElementClientSize=c(t),this.canvasElement.style.width="".concat(this._canvasElementClientSize.width,"px"),this.canvasElement.style.height="".concat(this._canvasElementClientSize.height,"px"),this._invalidateBitmapSize()},t.prototype.subscribeBitmapSizeChanged=function(t){this._bitmapSizeChangedListeners.push(t)},t.prototype.unsubscribeBitmapSizeChanged=function(t){this._bitmapSizeChangedListeners=this._bitmapSizeChangedListeners.filter(function(i){return i!==t})},Object.defineProperty(t.prototype,"suggestedBitmapSize",{get:function(){return this._suggestedBitmapSize},enumerable:!1,configurable:!0}),t.prototype.subscribeSuggestedBitmapSizeChanged=function(t){this._suggestedBitmapSizeChangedListeners.push(t)},t.prototype.unsubscribeSuggestedBitmapSizeChanged=function(t){this._suggestedBitmapSizeChangedListeners=this._suggestedBitmapSizeChangedListeners.filter(function(i){return i!==t})},t.prototype.applySuggestedBitmapSize=function(){if(null!==this._suggestedBitmapSize){var t=this._suggestedBitmapSize;this._suggestedBitmapSize=null,this._resizeBitmap(t),this._emitSuggestedBitmapSizeChanged(t,this._suggestedBitmapSize)}},t.prototype._resizeBitmap=function(t){var i=this.bitmapSize;u(i,t)||(this.canvasElement.width=t.width,this.canvasElement.height=t.height,this._emitBitmapSizeChanged(i,t))},t.prototype._emitBitmapSizeChanged=function(t,i){var s=this;this._bitmapSizeChangedListeners.forEach(function(e){return e.call(s,t,i)})},t.prototype._suggestNewBitmapSize=function(t){var i=this._suggestedBitmapSize,s=c(this._transformBitmapSize(t,this._canvasElementClientSize)),e=u(this.bitmapSize,s)?null:s;null===i&&null===e||null!==i&&null!==e&&u(i,e)||(this._suggestedBitmapSize=e,this._emitSuggestedBitmapSizeChanged(i,e))},t.prototype._emitSuggestedBitmapSizeChanged=function(t,i){var s=this;this._suggestedBitmapSizeChangedListeners.forEach(function(e){return e.call(s,t,i)})},t.prototype._chooseAndInitObserver=function(){var t=this;this._allowResizeObserver?new Promise(function(t){var i=new ResizeObserver(function(s){t(s.every(function(t){return"devicePixelContentBoxSize"in t})),i.disconnect()});i.observe(document.body,{box:"device-pixel-content-box"})}).catch(function(){return!1}).then(function(i){return i?t._initResizeObserver():t._initDevicePixelRatioObservable()}):this._initDevicePixelRatioObservable()},t.prototype._initDevicePixelRatioObservable=function(){var t=this;if(null!==this._canvasElement){var i=p(this._canvasElement);if(null===i)throw new Error("No window is associated with the canvas");this._devicePixelRatioObservable=function(t){return new d(t)}(i),this._devicePixelRatioObservable.subscribe(function(){return t._invalidateBitmapSize()}),this._invalidateBitmapSize()}},t.prototype._invalidateBitmapSize=function(){var t,i;if(null!==this._canvasElement){var s=p(this._canvasElement);if(null!==s){var e=null!==(i=null===(t=this._devicePixelRatioObservable)||void 0===t?void 0:t.value)&&void 0!==i?i:s.devicePixelRatio,n=this._canvasElement.getClientRects(),h=void 0!==n[0]?function(t,i){return c({width:Math.round(t.left*i+t.width*i)-Math.round(t.left*i),height:Math.round(t.top*i+t.height*i)-Math.round(t.top*i)})}(n[0],e):c({width:this._canvasElementClientSize.width*e,height:this._canvasElementClientSize.height*e});this._suggestNewBitmapSize(h)}}},t.prototype._initResizeObserver=function(){var t=this;null!==this._canvasElement&&(this._canvasElementResizeObserver=new ResizeObserver(function(i){var s=i.find(function(i){return i.target===t._canvasElement});if(s&&s.devicePixelContentBoxSize&&s.devicePixelContentBoxSize[0]){var e=s.devicePixelContentBoxSize[0],n=c({width:e.inlineSize,height:e.blockSize});t._suggestNewBitmapSize(n)}}),this._canvasElementResizeObserver.observe(this._canvasElement,{box:"device-pixel-content-box"}))},t}();function p(t){return t.ownerDocument.defaultView}var m,g,v,b=function(){function t(t,i,s){if(0===i.width||0===i.height)throw new TypeError("Rendering target could only be created on a media with positive width and height");if(this._mediaSize=i,0===s.width||0===s.height)throw new TypeError("Rendering target could only be created using a bitmap with positive integer width and height");this._bitmapSize=s,this._context=t}return t.prototype.useMediaCoordinateSpace=function(t){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),this._context.scale(this._horizontalPixelRatio,this._verticalPixelRatio),t({context:this._context,mediaSize:this._mediaSize})}finally{this._context.restore()}},t.prototype.useBitmapCoordinateSpace=function(t){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),t({context:this._context,mediaSize:this._mediaSize,bitmapSize:this._bitmapSize,horizontalPixelRatio:this._horizontalPixelRatio,verticalPixelRatio:this._verticalPixelRatio})}finally{this._context.restore()}},Object.defineProperty(t.prototype,"_horizontalPixelRatio",{get:function(){return this._bitmapSize.width/this._mediaSize.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_verticalPixelRatio",{get:function(){return this._bitmapSize.height/this._mediaSize.height},enumerable:!1,configurable:!0}),t}();function w(t,i){var s=t.canvasElementClientSize;if(0===s.width||0===s.height)return null;var e=t.bitmapSize;if(0===e.width||0===e.height)return null;var n=t.canvasElement.getContext("2d",i);return null===n?null:new b(n,s,e)}
/*!
 * @license
 * TradingView Lightweight Charts™ v4.1.0-dev+202402281004
 * Copyright (c) 2024 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */function x(t,i){const s={0:[],1:[t.lineWidth,t.lineWidth],2:[2*t.lineWidth,2*t.lineWidth],3:[6*t.lineWidth,6*t.lineWidth],4:[t.lineWidth,4*t.lineWidth]}[i];t.setLineDash(s)}function M(t,i,s,e){t.beginPath();const n=t.lineWidth%2?.5:0;t.moveTo(s,i+n),t.lineTo(e,i+n),t.stroke()}function S(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function y(t){if(void 0===t)throw new Error("Value is undefined");return t}function C(t){if(null===t)throw new Error("Value is null");return t}function _(t){return C(y(t))}(v=m||(m={}))[v.Simple=0]="Simple",v[v.WithSteps=1]="WithSteps",v[v.Curved=2]="Curved",function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(g||(g={}));const V={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function T(t){return t<0?0:t>255?255:Math.round(t)||0}function L(t){return t<=0||t>0?t<0?0:t>1?1:Math.round(1e4*t)/1e4:0}const k=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,E=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,z=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,P=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function W(t){(t=t.toLowerCase())in V&&(t=V[t]);{const i=P.exec(t)||z.exec(t);if(i)return[T(parseInt(i[1],10)),T(parseInt(i[2],10)),T(parseInt(i[3],10)),L(i.length<5?1:parseFloat(i[4]))]}{const i=E.exec(t);if(i)return[T(parseInt(i[1],16)),T(parseInt(i[2],16)),T(parseInt(i[3],16)),1]}{const i=k.exec(t);if(i)return[T(17*parseInt(i[1],16)),T(17*parseInt(i[2],16)),T(17*parseInt(i[3],16)),1]}throw new Error(`Cannot parse color: ${t}`)}function B(t){const i=W(t);return{t:`rgb(${i[0]}, ${i[1]}, ${i[2]})`,i:(s=i,.199*s[0]+.687*s[1]+.114*s[2]>160?"black":"white")};var s}class N{constructor(){this.h=[]}l(t,i,s){const e={o:t,_:i,u:!0===s};this.h.push(e)}p(t){const i=this.h.findIndex(i=>t===i.o);i>-1&&this.h.splice(i,1)}v(t){this.h=this.h.filter(i=>i._!==t)}m(t,i,s){const e=[...this.h];this.h=this.h.filter(t=>!t.u),e.forEach(e=>e.o(t,i,s))}M(){return this.h.length>0}S(){this.h=[]}}function R(t,...i){for(const s of i)for(const i in s)void 0!==s[i]&&("object"!=typeof s[i]||void 0===t[i]?t[i]=s[i]:R(t[i],s[i]));return t}function F(t){return"number"==typeof t&&isFinite(t)}function O(t){return"number"==typeof t&&t%1==0}function Y(t){return"string"==typeof t}function $(t){return"boolean"==typeof t}function A(t){const i=t;if(!i||"object"!=typeof i)return i;let s,e,n;for(e in s=Array.isArray(i)?[]:{},i)i.hasOwnProperty(e)&&(n=i[e],s[e]=n&&"object"==typeof n?A(n):n);return s}function U(t){return null!==t}function I(t){return null===t?void 0:t}const X="-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif";function J(t,i,s){return void 0===i&&(i=X),`${s=void 0!==s?`${s} `:""}${t}px ${i}`}class D{constructor(t){this.k={C:1,T:5,P:NaN,R:"",D:"",A:"",B:"",L:0,N:0,I:0,O:0,V:0},this.F=t}W(){const t=this.k,i=this.j(),s=this.$();return t.P===i&&t.D===s||(t.P=i,t.D=s,t.R=J(i,s),t.O=2.5/12*i,t.L=t.O,t.N=i/12*t.T,t.I=i/12*t.T,t.V=0),t.A=this.H(),t.B=this.U(),this.k}H(){return this.F.W().layout.textColor}U(){return this.F.Y()}j(){return this.F.W().layout.fontSize}$(){return this.F.W().layout.fontFamily}}class j{constructor(){this.q=[]}X(t){this.q=t}Z(t,i,s){this.q.forEach(e=>{e.Z(t,i,s)})}}class H{Z(t,i,s){t.useMediaCoordinateSpace(t=>this.K(t,i,s))}G(t,i,s){t.useMediaCoordinateSpace(t=>this.J(t,i,s))}J(t,i,s){}}class Z extends H{constructor(){super(...arguments),this.tt=null}it(t){this.tt=t}K({context:t}){if(null===this.tt||null===this.tt.nt)return;const i=this.tt.nt,s=this.tt,e=e=>{t.beginPath();for(let n=i.to-1;n>=i.from;--n){const i=s.st[n];t.moveTo(i.et,i.rt),t.arc(i.et,i.rt,e,0,2*Math.PI)}t.fill()};s.ht>0&&(t.fillStyle=s.lt,e(s.ot+s.ht)),t.fillStyle=s._t,e(s.ot)}}function G(){return{st:[{et:0,rt:0,ut:0,ct:0}],_t:"",lt:"",ot:0,ht:0,nt:null}}const q={from:0,to:1};class K{constructor(t,i){this.dt=new j,this.ft=[],this.vt=[],this.bt=!0,this.F=t,this.gt=i,this.dt.X(this.ft)}wt(t){const i=this.F.Mt();i.length!==this.ft.length&&(this.vt=i.map(G),this.ft=this.vt.map(t=>{const i=new Z;return i.it(t),i}),this.dt.X(this.ft)),this.bt=!0}xt(){return this.bt&&(this.St(),this.bt=!1),this.dt}St(){const t=this.F.Mt(),i=this.gt.yt(),s=this.F.kt();t.forEach((t,e)=>{var n;const h=this.vt[e],o=t.Ct(i);if(null===o||!t.Tt())return void(h.nt=null);const r=C(t.Pt());h._t=o.Rt,h.ot=o.ot,h.ht=o.Dt,h.st[0].ct=o.ct,h.st[0].rt=t.Bt().At(o.ct,r.Lt),h.lt=null!==(n=o.Nt)&&void 0!==n?n:this.F.It(h.st[0].rt/t.Bt().Ot()),h.st[0].ut=i,h.st[0].et=s.Et(i),h.nt=q})}}class Q{Z(t,i,s){t.useBitmapCoordinateSpace(t=>this.K(t,i,s))}}class tt extends Q{constructor(t){super(),this.Vt=t}K({context:t,bitmapSize:i,horizontalPixelRatio:s,verticalPixelRatio:e}){if(null===this.Vt)return;const n=this.Vt.zt.Tt,h=this.Vt.Ft.Tt;if(!n&&!h)return;const o=Math.round(this.Vt.et*s),r=Math.round(this.Vt.rt*e);t.lineCap="butt",n&&o>=0&&(t.lineWidth=Math.floor(this.Vt.zt.ht*s),t.strokeStyle=this.Vt.zt.A,t.fillStyle=this.Vt.zt.A,x(t,this.Vt.zt.Wt),function(t,i,s,e){t.beginPath();const n=t.lineWidth%2?.5:0;t.moveTo(i+n,0),t.lineTo(i+n,e),t.stroke()}(t,o,0,i.height)),h&&r>=0&&(t.lineWidth=Math.floor(this.Vt.Ft.ht*e),t.strokeStyle=this.Vt.Ft.A,t.fillStyle=this.Vt.Ft.A,x(t,this.Vt.Ft.Wt),M(t,r,0,i.width))}}class it{constructor(t){this.bt=!0,this.jt={zt:{ht:1,Wt:0,A:"",Tt:!1},Ft:{ht:1,Wt:0,A:"",Tt:!1},et:0,rt:0},this.$t=new tt(this.jt),this.Ht=t}wt(){this.bt=!0}xt(){return this.bt&&(this.St(),this.bt=!1),this.$t}St(){const t=this.Ht.Tt(),i=C(this.Ht.Ut()),s=i.Yt().W().crosshair,e=this.jt;e.Ft.Tt=t&&this.Ht.qt(i),e.zt.Tt=t&&this.Ht.Xt(),e.Ft.ht=s.horzLine.width,e.Ft.Wt=s.horzLine.style,e.Ft.A=s.horzLine.color,e.zt.ht=s.vertLine.width,e.zt.Wt=s.vertLine.style,e.zt.A=s.vertLine.color,e.et=this.Ht.Zt(),e.rt=this.Ht.Kt()}}function st(t,i,s,e,n,h){t.fillRect(i+h,s,e-2*h,h),t.fillRect(i+h,s+n-h,e-2*h,h),t.fillRect(i,s,h,n),t.fillRect(i+e-h,s,h,n)}function et(t,i,s,e,n,h){t.save(),t.globalCompositeOperation="copy",t.fillStyle=h,t.fillRect(i,s,e,n),t.restore()}function nt(t,i){return Array.isArray(t)?t.map(t=>0===t?t:t+i):t+i}function ht(t,i,s,e,n,h){let o,r,l,a;if(Array.isArray(h))if(2===h.length){const t=Math.max(0,h[0]),i=Math.max(0,h[1]);o=t,r=t,l=i,a=i}else{if(4!==h.length)throw new Error("Wrong border radius - it should be like css border radius");o=Math.max(0,h[0]),r=Math.max(0,h[1]),l=Math.max(0,h[2]),a=Math.max(0,h[3])}else{const t=Math.max(0,h);o=t,r=t,l=t,a=t}t.beginPath(),t.moveTo(i+o,s),t.lineTo(i+e-r,s),0!==r&&t.arcTo(i+e,s,i+e,s+r,r),t.lineTo(i+e,s+n-l),0!==l&&t.arcTo(i+e,s+n,i+e-l,s+n,l),t.lineTo(i+a,s+n),0!==a&&t.arcTo(i,s+n,i,s+n-a,a),t.lineTo(i,s+o),0!==o&&t.arcTo(i,s,i+o,s,o)}function ot(t,i,s,e,n,h,o=0,r=0,l=""){if(t.save(),!o||!l||l===h)return ht(t,i,s,e,n,r),t.fillStyle=h,t.fill(),void t.restore();const a=o/2;"transparent"!==h&&(ht(t,i+o,s+o,e-2*o,n-2*o,nt(r,-o)),t.fillStyle=h,t.fill()),"transparent"!==l&&(ht(t,i+a,s+a,e-o,n-o,nt(r,-a)),t.lineWidth=o,t.strokeStyle=l,t.closePath(),t.stroke()),t.restore()}function rt(t,i,s,e,n,h,o){t.save(),t.globalCompositeOperation="copy";const r=t.createLinearGradient(0,0,0,n);r.addColorStop(0,h),r.addColorStop(1,o),t.fillStyle=r,t.fillRect(i,s,e,n),t.restore()}class lt{constructor(t,i){this.it(t,i)}it(t,i){this.Vt=t,this.Gt=i}Ot(t,i){return this.Vt.Tt?t.P+t.O+t.L:0}Z(t,i,s,e){if(!this.Vt.Tt||0===this.Vt.Jt.length)return;const n=this.Vt.A,h=this.Gt.t,o=t.useBitmapCoordinateSpace(t=>{const o=t.context;o.font=i.R;const r=this.Qt(t,i,s,e),l=r.ti,a=(t,i)=>{r.ii?ot(o,l.ni,l.si,l.ei,l.ri,t,l.hi,[l.ot,0,0,l.ot],i):ot(o,l.li,l.si,l.ei,l.ri,t,l.hi,[0,l.ot,l.ot,0],i)};return a(h,"transparent"),this.Vt.ai&&(o.fillStyle=n,o.fillRect(l.li,l.oi,l._i-l.li,l.ui)),a("transparent",h),this.Vt.ci&&(o.fillStyle=i.B,o.fillRect(r.ii?l.di-l.hi:0,l.si,l.hi,l.fi-l.si)),r});t.useMediaCoordinateSpace(({context:t})=>{const s=o.pi;t.font=i.R,t.textAlign=o.ii?"right":"left",t.textBaseline="middle",t.fillStyle=n,t.fillText(this.Vt.Jt,s.vi,(s.si+s.fi)/2+s.mi)})}Qt(t,i,s,e){var n;const{context:h,bitmapSize:o,mediaSize:r,horizontalPixelRatio:l,verticalPixelRatio:a}=t,c=this.Vt.ai||!this.Vt.bi?i.T:0,u=this.Vt.gi?i.C:0,d=i.O+this.Gt.wi,f=i.L+this.Gt.Mi,p=i.N,m=i.I,g=this.Vt.Jt,v=i.P,b=s.xi(h,g),w=Math.ceil(s.Si(h,g)),x=v+d+f,M=i.C+p+m+w+c,S=Math.max(1,Math.floor(a));let y=Math.round(x*a);y%2!=S%2&&(y+=1);const C=u>0?Math.max(1,Math.floor(u*l)):0,_=Math.round(M*l),V=Math.round(c*l),T=null!==(n=this.Gt.yi)&&void 0!==n?n:this.Gt.ki,L=Math.round(T*a)-Math.floor(.5*a),k=Math.floor(L+S/2-y/2),E=k+y,z="right"===e,P=z?r.width-u:u,W=z?o.width-C:C;let B,N,R;return z?(B=W-_,N=W-V,R=P-c-p-u):(B=W+_,N=W+V,R=P+c+p),{ii:z,ti:{si:k,oi:L,fi:E,ei:_,ri:y,ot:2*l,hi:C,ni:B,li:W,_i:N,ui:S,di:o.width},pi:{si:k/a,fi:E/a,vi:R,mi:b}}}}class at{constructor(t){this.Ci={ki:0,t:"#000",Mi:0,wi:0},this.Ti={Jt:"",Tt:!1,ai:!0,bi:!1,Nt:"",A:"#FFF",ci:!1,gi:!1},this.Pi={Jt:"",Tt:!1,ai:!1,bi:!0,Nt:"",A:"#FFF",ci:!0,gi:!0},this.bt=!0,this.Ri=new(t||lt)(this.Ti,this.Ci),this.Di=new(t||lt)(this.Pi,this.Ci)}Jt(){return this.Ai(),this.Ti.Jt}ki(){return this.Ai(),this.Ci.ki}wt(){this.bt=!0}Ot(t,i=!1){return Math.max(this.Ri.Ot(t,i),this.Di.Ot(t,i))}Bi(){return this.Ci.yi||0}Li(t){this.Ci.yi=t}Ni(){return this.Ai(),this.Ti.Tt||this.Pi.Tt}Ii(){return this.Ai(),this.Ti.Tt}xt(t){return this.Ai(),this.Ti.ai=this.Ti.ai&&t.W().ticksVisible,this.Pi.ai=this.Pi.ai&&t.W().ticksVisible,this.Ri.it(this.Ti,this.Ci),this.Di.it(this.Pi,this.Ci),this.Ri}Oi(){return this.Ai(),this.Ri.it(this.Ti,this.Ci),this.Di.it(this.Pi,this.Ci),this.Di}Ai(){this.bt&&(this.Ti.ai=!0,this.Pi.ai=!1,this.Ei(this.Ti,this.Pi,this.Ci))}}class ct extends at{constructor(t,i,s){super(),this.Ht=t,this.Vi=i,this.zi=s}Ei(t,i,s){t.Tt=!1;const e=this.Ht.W().horzLine;if(!e.labelVisible)return;const n=this.Vi.Pt();if(!this.Ht.Tt()||this.Vi.Fi()||null===n)return;const h=B(e.labelBackgroundColor);s.t=h.t,t.A=h.i;const o=2/12*this.Vi.P();s.wi=o,s.Mi=o;const r=this.zi(this.Vi);s.ki=r.ki,t.Jt=this.Vi.Wi(r.ct,n),t.Tt=!0}}const ut=/[1-9]/g;class dt{constructor(){this.Vt=null}it(t){this.Vt=t}Z(t,i){if(null===this.Vt||!1===this.Vt.Tt||0===this.Vt.Jt.length)return;const s=t.useMediaCoordinateSpace(({context:t})=>(t.font=i.R,Math.round(i.ji.Si(t,C(this.Vt).Jt,ut))));if(s<=0)return;const e=i.$i,n=s+2*e,h=n/2,o=this.Vt.Hi;let r=this.Vt.ki,l=Math.floor(r-h)+.5;l<0?(r+=Math.abs(0-l),l=Math.floor(r-h)+.5):l+n>o&&(r-=Math.abs(o-(l+n)),l=Math.floor(r-h)+.5);const a=l+n,c=Math.ceil(0+i.C+i.T+i.O+i.P+i.L);t.useBitmapCoordinateSpace(({context:t,horizontalPixelRatio:s,verticalPixelRatio:e})=>{const n=C(this.Vt);t.fillStyle=n.t;const h=Math.round(l*s),o=Math.round(0*e),r=Math.round(a*s),u=Math.round(c*e),d=Math.round(2*s);if(t.beginPath(),t.moveTo(h,o),t.lineTo(h,u-d),t.arcTo(h,u,h+d,u,d),t.lineTo(r-d,u),t.arcTo(r,u,r,u-d,d),t.lineTo(r,o),t.fill(),n.ai){const h=Math.round(n.ki*s),r=o,l=Math.round((r+i.T)*e);t.fillStyle=n.A;const a=Math.max(1,Math.floor(s)),c=Math.floor(.5*s);t.fillRect(h-c,r,a,l-r)}}),t.useMediaCoordinateSpace(({context:t})=>{const s=C(this.Vt),n=0+i.C+i.T+i.O+i.P/2;t.font=i.R,t.textAlign="left",t.textBaseline="middle",t.fillStyle=s.A;const h=i.ji.xi(t,"Apr0");t.translate(l+e,n+h),t.fillText(s.Jt,0,0)})}}class ft{constructor(t,i,s){this.bt=!0,this.$t=new dt,this.jt={Tt:!1,t:"#4c525e",A:"white",Jt:"",Hi:0,ki:NaN,ai:!0},this.gt=t,this.Ui=i,this.zi=s}wt(){this.bt=!0}xt(){return this.bt&&(this.St(),this.bt=!1),this.$t.it(this.jt),this.$t}St(){const t=this.jt;t.Tt=!1;const i=this.gt.W().vertLine;if(!i.labelVisible)return;const s=this.Ui.kt();if(s.Fi())return;t.Hi=s.Hi();const e=this.zi();if(null===e)return;t.ki=e.ki;const n=s.Yi(this.gt.yt());t.Jt=s.qi(C(n)),t.Tt=!0;const h=B(i.labelBackgroundColor);t.t=h.t,t.A=h.i,t.ai=s.W().ticksVisible}}class pt{constructor(){this.Xi=null,this.Zi=0}Ki(){return this.Zi}Gi(t){this.Zi=t}Bt(){return this.Xi}Ji(t){this.Xi=t}Qi(t){return[]}tn(){return[]}Tt(){return!0}}var mt;!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(mt||(mt={}));class gt extends pt{constructor(t,i){super(),this.nn=null,this.sn=NaN,this.en=0,this.rn=!0,this.hn=new Map,this.ln=!1,this.an=NaN,this.on=NaN,this._n=NaN,this.un=NaN,this.Ui=t,this.cn=i,this.dn=new K(t,this),this.fn=((t,i)=>s=>{const e=i(),n=t();if(s===C(this.nn).pn())return{ct:n,ki:e};{const t=C(s.Pt());return{ct:s.vn(e,t),ki:e}}})(()=>this.sn,()=>this.on);const s=((t,i)=>()=>{const s=this.Ui.kt().mn(t()),e=i();return s&&Number.isFinite(e)?{ut:s,ki:e}:null})(()=>this.en,()=>this.Zt());this.bn=new ft(this,t,s),this.gn=new it(this)}W(){return this.cn}wn(t,i){this._n=t,this.un=i}Mn(){this._n=NaN,this.un=NaN}xn(){return this._n}Sn(){return this.un}yn(t,i,s){this.ln||(this.ln=!0),this.rn=!0,this.kn(t,i,s)}yt(){return this.en}Zt(){return this.an}Kt(){return this.on}Tt(){return this.rn}Cn(){this.rn=!1,this.Tn(),this.sn=NaN,this.an=NaN,this.on=NaN,this.nn=null,this.Mn()}Pn(t){return null!==this.nn?[this.gn,this.dn]:[]}qt(t){return t===this.nn&&this.cn.horzLine.visible}Xt(){return this.cn.vertLine.visible}Rn(t,i){this.rn&&this.nn===t||this.hn.clear();const s=[];return this.nn===t&&s.push(this.Dn(this.hn,i,this.fn)),s}tn(){return this.rn?[this.bn]:[]}Ut(){return this.nn}An(){this.gn.wt(),this.hn.forEach(t=>t.wt()),this.bn.wt(),this.dn.wt()}Bn(t){return t&&!t.pn().Fi()?t.pn():null}kn(t,i,s){this.Ln(t,i,s)&&this.An()}Ln(t,i,s){const e=this.an,n=this.on,h=this.sn,o=this.en,r=this.nn,l=this.Bn(s);this.en=t,this.an=isNaN(t)?NaN:this.Ui.kt().Et(t),this.nn=s;const a=null!==l?l.Pt():null;return null!==l&&null!==a?(this.sn=i,this.on=l.At(i,a)):(this.sn=NaN,this.on=NaN),e!==this.an||n!==this.on||o!==this.en||h!==this.sn||r!==this.nn}Tn(){const t=this.Ui.Mt().map(t=>t.In().Nn()).filter(U),i=0===t.length?null:Math.max(...t);this.en=null!==i?i:NaN}Dn(t,i,s){let e=t.get(i);return void 0===e&&(e=new ct(this,i,s),t.set(i,e)),e}}function vt(t){return"left"===t||"right"===t}class bt{constructor(t){this.On=new Map,this.En=[],this.Vn=t}zn(t,i){const s=(e=this.On.get(t),n=i,void 0===e?n:{Fn:Math.max(e.Fn,n.Fn),Wn:e.Wn||n.Wn});var e,n;this.On.set(t,s)}jn(){return this.Vn}$n(t){const i=this.On.get(t);return void 0===i?{Fn:this.Vn}:{Fn:Math.max(this.Vn,i.Fn),Wn:i.Wn}}Hn(){this.Un(),this.En=[{Yn:0}]}qn(t){this.Un(),this.En=[{Yn:1,Lt:t}]}Xn(t){this.Zn(),this.En.push({Yn:5,Lt:t})}Un(){this.Zn(),this.En.push({Yn:6})}Kn(){this.Un(),this.En=[{Yn:4}]}Gn(t){this.Un(),this.En.push({Yn:2,Lt:t})}Jn(t){this.Un(),this.En.push({Yn:3,Lt:t})}Qn(){return this.En}ts(t){for(const i of t.En)this.ns(i);this.Vn=Math.max(this.Vn,t.Vn),t.On.forEach((t,i)=>{this.zn(i,t)})}static ss(){return new bt(2)}static es(){return new bt(3)}ns(t){switch(t.Yn){case 0:this.Hn();break;case 1:this.qn(t.Lt);break;case 2:this.Gn(t.Lt);break;case 3:this.Jn(t.Lt);break;case 4:this.Kn();break;case 5:this.Xn(t.Lt);break;case 6:this.Zn()}}Zn(){const t=this.En.findIndex(t=>5===t.Yn);-1!==t&&this.En.splice(t,1)}}function wt(t,i){if(!F(t))return"n/a";if(!O(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");return 0===i?t.toString():("0000000000000000"+t.toString()).slice(-i)}class xt{constructor(t,i){if(i||(i=1),F(t)&&O(t)||(t=100),t<0)throw new TypeError("invalid base");this.Vi=t,this.rs=i,this.hs()}format(t){const i=t<0?"−":"";return t=Math.abs(t),i+this.ls(t)}hs(){if(this.os=0,this.Vi>0&&this.rs>0){let t=this.Vi;for(;t>1;)t/=10,this.os++}}ls(t){const i=this.Vi/this.rs;let s=Math.floor(t),e="";const n=void 0!==this.os?this.os:NaN;if(i>1){let h=+(Math.round(t*i)-s*i).toFixed(this.os);h>=i&&(h-=i,s+=1),e="."+wt(+h.toFixed(this.os)*this.rs,n)}else s=Math.round(s*i)/i,n>0&&(e="."+wt(0,n));return s.toFixed(0)+e}}class Mt extends xt{constructor(t=100){super(t)}format(t){return`${super.format(t)}%`}}class St{constructor(t){this._s=t}format(t){let i="";return t<0&&(i="-",t=-t),t<995?i+this.us(t):t<999995?i+this.us(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this.us(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this.us(t/1e9)+"B")}us(t){let i;const s=Math.pow(10,this._s);return i=(t=Math.round(t*s)/s)>=1e-15&&t<1?t.toFixed(this._s).replace(/\.?0+$/,""):String(t),i.replace(/(\.[1-9]*)0+$/,(t,i)=>i)}}function yt(t,i,s,e,n,h,o){if(0===i.length||e.from>=i.length||e.to<=0)return;const r=t.context,l=i[e.from];let a=h(t,l),c=l;if(e.to-e.from<2){const t=n/2;r.beginPath();const i={et:l.et-t,rt:l.rt},s={et:l.et+t,rt:l.rt};return r.moveTo(i.et,i.rt),r.lineTo(s.et,s.rt),void o(r,a,i,s)}const u=(t,i)=>{o(r,a,c,i),r.beginPath(),a=t,c=i};let d=c;r.beginPath(),r.moveTo(l.et,l.rt);for(let f=e.from+1;f<e.to;++f){d=i[f];const e=h(t,d);switch(s){case 0:r.lineTo(d.et,d.rt);break;case 1:r.lineTo(d.et,i[f-1].rt),e!==a&&(u(e,d),r.lineTo(d.et,i[f-1].rt)),r.lineTo(d.et,d.rt);break;case 2:{const[t,s]=Tt(i,f-1,f);r.bezierCurveTo(t.et,t.rt,s.et,s.rt,d.et,d.rt);break}}1!==s&&e!==a&&(u(e,d),r.moveTo(d.et,d.rt))}(c!==d||c===d&&1===s)&&o(r,a,c,d)}const Ct=6;function _t(t,i){return{et:t.et-i.et,rt:t.rt-i.rt}}function Vt(t,i){return{et:t.et/i,rt:t.rt/i}}function Tt(t,i,s){const e=Math.max(0,i-1),n=Math.min(t.length-1,s+1);var h,o;return[(h=t[i],o=Vt(_t(t[s],t[e]),Ct),{et:h.et+o.et,rt:h.rt+o.rt}),_t(t[s],Vt(_t(t[n],t[i]),Ct))]}function Lt(t,i,s,e,n){i.lineTo(n.et,t),i.lineTo(e.et,t),i.closePath(),i.fillStyle=s,i.fill()}class kt extends H{constructor(){super(...arguments),this.tt=null}it(t){this.tt=t}K(t){var i;if(null===this.tt)return;const{st:s,nt:e,cs:n,ht:h,Wt:o,ds:r}=this.tt,l=null!==(i=this.tt.fs)&&void 0!==i?i:this.tt.ps?0:t.mediaSize.height;if(null===e)return;const a=t.context;a.lineCap="butt",a.lineJoin="round",a.lineWidth=h,x(a,o),a.lineWidth=1,yt(t,s,r,e,n,this.vs.bind(this),Lt.bind(null,l))}}class Et extends kt{constructor(){super(...arguments),this.bs=null}vs(t,i){const{context:s,mediaSize:e}=t,{gs:n,ws:h}=i,o=e.height;if(null!==this.bs&&this.bs.topColor===n&&this.bs.bottomColor===h&&this.bs.bottom===o)return this.bs.fillStyle;const r=s.createLinearGradient(0,0,0,o);return r.addColorStop(0,n),r.addColorStop(1,h),this.bs={topColor:n,bottomColor:h,fillStyle:r,bottom:o},r}}function zt(t,i){t.strokeStyle=i,t.stroke()}class Pt extends H{constructor(){super(...arguments),this.tt=null}it(t){this.tt=t}K(t){if(null===this.tt)return;const{st:i,nt:s,cs:e,ds:n,ht:h,Wt:o}=this.tt;if(null===s)return;const r=t.context;r.lineCap="butt",r.lineWidth=h,x(r,o),r.lineJoin="round",yt(t,i,n,s,e,this.Ms.bind(this),zt)}}class Wt extends Pt{Ms(t,i){return i._t}}function Bt(t,i,s,e=0,n=t.length){let h=n-e;for(;0<h;){const n=h>>1,o=e+n;s(t[o],i)?(e=o+1,h-=n+1):h=n}return e}function Nt(t,i,s,e=0,n=t.length){let h=n-e;for(;0<h;){const n=h>>1,o=e+n;s(i,t[o])?h=n:(e=o+1,h-=n+1)}return e}function Rt(t,i){return t.ut<i}function Ft(t,i){return t<i.ut}function Ot(t,i,s){const e=i.xs(),n=i.di(),h=Bt(t,e,Rt),o=Nt(t,n,Ft);if(!s)return{from:h,to:o};let r=h,l=o;return h>0&&h<t.length&&t[h].ut>=e&&(r=h-1),o>0&&o<t.length&&t[o-1].ut<=n&&(l=o+1),{from:r,to:l}}class Yt{constructor(t,i,s){this.Ss=!0,this.ys=!0,this.ks=!0,this.Cs=[],this.Ts=null,this.Ps=t,this.Rs=i,this.Ds=s}wt(t){this.Ss=!0,"data"===t&&(this.ys=!0),"options"===t&&(this.ks=!0)}xt(){return this.Ps.Tt()?(this.As(),null===this.Ts?null:this.Bs):null}Ls(){this.Cs=this.Cs.map(t=>Object.assign(Object.assign({},t),this.Ps.Is().Ns(t.ut)))}Os(){this.Ts=null}Es(){const t=this.Ps.Bt(),i=this.Rs.kt();if(this.Os(),i.Fi()||t.Fi())return;const s=i.Vs();if(null===s)return;if(0===this.Ps.In().zs())return;const e=this.Ps.Pt();null!==e&&(this.Ts=Ot(this.Cs,s,this.Ds),this.Fs(t,i,e.Lt),this.Ws())}As(){this.ys&&(this.js(),this.ys=!1),this.ks&&(this.Ls(),this.ks=!1),this.Ss&&(this.Es(),this.Ss=!1)}}class $t extends Yt{constructor(t,i){super(t,i,!0)}Fs(t,i,s){i.$s(this.Cs,I(this.Ts)),t.Hs(this.Cs,s,I(this.Ts))}Us(t,i){return{ut:t,ct:i,et:NaN,rt:NaN}}js(){const t=this.Ps.Is();this.Cs=this.Ps.In().Ys().map(i=>{const s=i.Lt[3];return this.qs(i.Xs,s,t)})}}class At extends $t{constructor(t,i){super(t,i),this.Bs=new j,this.Zs=new Et,this.Ks=new Wt,this.Bs.X([this.Zs,this.Ks])}qs(t,i,s){return Object.assign(Object.assign({},this.Us(t,i)),s.Ns(t))}Ws(){const t=this.Ps.W();this.Zs.it({ds:t.lineType,st:this.Cs,Wt:t.lineStyle,ht:t.lineWidth,fs:null,ps:t.invertFilledArea,nt:this.Ts,cs:this.Rs.kt().Gs()}),this.Ks.it({ds:t.lineType,st:this.Cs,Wt:t.lineStyle,ht:t.lineWidth,nt:this.Ts,cs:this.Rs.kt().Gs()})}}class Ut extends Q{constructor(){super(...arguments),this.Vt=null,this.Js=0,this.Qs=0}it(t){this.Vt=t}K({context:t,horizontalPixelRatio:i,verticalPixelRatio:s}){if(null===this.Vt||0===this.Vt.In.length||null===this.Vt.nt)return;this.Js=this.te(i),this.Js>=2&&Math.max(1,Math.floor(i))%2!=this.Js%2&&this.Js--,this.Qs=this.Vt.ie?Math.min(this.Js,Math.floor(i)):this.Js;let e=null;const n=this.Qs<=this.Js&&this.Vt.Gs>=Math.floor(1.5*i);for(let h=this.Vt.nt.from;h<this.Vt.nt.to;++h){const o=this.Vt.In[h];e!==o.ne&&(t.fillStyle=o.ne,e=o.ne);const r=Math.floor(.5*this.Qs),l=Math.round(o.et*i),a=l-r,c=this.Qs,u=a+c-1,d=Math.min(o.se,o.ee),f=Math.max(o.se,o.ee),p=Math.round(d*s)-r,m=Math.round(f*s)+r,g=Math.max(m-p,this.Qs);t.fillRect(a,p,c,g);const v=Math.ceil(1.5*this.Js);if(n){if(this.Vt.re){const i=l-v;let e=Math.max(p,Math.round(o.he*s)-r),n=e+c-1;n>p+g-1&&(n=p+g-1,e=n-c+1),t.fillRect(i,e,a-i,n-e+1)}const i=l+v;let e=Math.max(p,Math.round(o.le*s)-r),n=e+c-1;n>p+g-1&&(n=p+g-1,e=n-c+1),t.fillRect(u+1,e,i-u,n-e+1)}}}te(t){const i=Math.floor(t);return Math.max(i,Math.floor((s=C(this.Vt).Gs,e=t,Math.floor(.3*s*e))));var s,e}}class It extends Yt{constructor(t,i){super(t,i,!1)}Fs(t,i,s){i.$s(this.Cs,I(this.Ts)),t.ae(this.Cs,s,I(this.Ts))}oe(t,i,s){return{ut:t,_e:i.Lt[0],ue:i.Lt[1],ce:i.Lt[2],de:i.Lt[3],et:NaN,he:NaN,se:NaN,ee:NaN,le:NaN}}js(){const t=this.Ps.Is();this.Cs=this.Ps.In().Ys().map(i=>this.qs(i.Xs,i,t))}}class Xt extends It{constructor(){super(...arguments),this.Bs=new Ut}qs(t,i,s){return Object.assign(Object.assign({},this.oe(t,i,s)),s.Ns(t))}Ws(){const t=this.Ps.W();this.Bs.it({In:this.Cs,Gs:this.Rs.kt().Gs(),re:t.openVisible,ie:t.thinBars,nt:this.Ts})}}function Jt(t,i,s){return Math.min(Math.max(t,i),s)}function Dt(t,i,s){return i-t<=s}function jt(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function Ht(t){const i=Math.ceil(t);return i%2==0?i-1:i}class Zt extends kt{constructor(){super(...arguments),this.bs=null}vs(t,i){var s;const{context:e,mediaSize:n}=t,h=this.tt,{fe:o,pe:r,ve:l,me:a}=i,c=null!==(s=h.fs)&&void 0!==s?s:n.height,u=n.height;if(null!==this.bs&&this.bs.topFillColor1===o&&this.bs.topFillColor2===r&&this.bs.bottomFillColor1===l&&this.bs.bottomFillColor2===a&&this.bs.baseLevelCoordinate===c&&this.bs.bottom===u)return this.bs.fillStyle;const d=e.createLinearGradient(0,0,0,u),f=Jt(c/u,0,1);return d.addColorStop(0,o),d.addColorStop(f,r),d.addColorStop(f,l),d.addColorStop(1,a),this.bs={topFillColor1:o,topFillColor2:r,bottomFillColor1:l,bottomFillColor2:a,fillStyle:d,baseLevelCoordinate:c,bottom:u},d}}class Gt extends Pt{constructor(){super(...arguments),this.be=null}Ms(t,i){const{context:s,mediaSize:e}=t,n=this.tt,{ge:h,we:o}=i,{fs:r}=n,l=e.height;if(null!==this.be&&this.be.topLineColor===h&&this.be.bottomLineColor===o&&this.be.baseLevelCoordinate===r&&this.be.bottom===l)return this.be.strokeStyle;const a=s.createLinearGradient(0,0,0,l),c=Jt(r/l,0,1);return a.addColorStop(0,h),a.addColorStop(c,h),a.addColorStop(c,o),a.addColorStop(1,o),this.be={topLineColor:h,bottomLineColor:o,strokeStyle:a,baseLevelCoordinate:r,bottom:l},a}}class qt extends $t{constructor(t,i){super(t,i),this.Bs=new j,this.Me=new Zt,this.xe=new Gt,this.Bs.X([this.Me,this.xe])}qs(t,i,s){return Object.assign(Object.assign({},this.Us(t,i)),s.Ns(t))}Ws(){const t=this.Ps.Pt();if(null===t)return;const i=this.Ps.W(),s=this.Ps.Bt().At(i.baseValue.price,t.Lt),e=this.Rs.kt().Gs();this.Me.it({st:this.Cs,ht:i.lineWidth,Wt:i.lineStyle,ds:i.lineType,fs:s,ps:!1,nt:this.Ts,cs:e}),this.xe.it({st:this.Cs,ht:i.lineWidth,Wt:i.lineStyle,ds:i.lineType,fs:s,nt:this.Ts,cs:e})}}class Kt extends H{constructor(){super(...arguments),this.Se={},this.tt=null}it(t){this.tt=t}K(t){if(null===this.tt||0===this.tt.st.length||!this.tt.nt)return;const i=t.context,s=[];let e=this.tt.nt.from;const n=this.tt.nt.to;if(e===n)s.push([e,n]);else{let t=null,i=null;for(let h=e;h<n;++h){const n=this.tt.st[h];null!==t&&(n.ut-t>1||n.A!==i)&&(s.push([e,n.ut-t>1?h-1:h]),e=h),t=n.ut,i=n.A}s.push([e,Math.max(n?n-1:0,e)])}i.strokeStyle=this.tt.ye,i.lineWidth=this.tt.ke,i.fillStyle=this.tt.A;for(let h=0;h<s.length;++h){const t=s[h][0],e=s[h][1];if(void 0!==this.tt.st[t].Ce&&(i.fillStyle=this.tt.ye,i.fillText(this.tt.st[t].Ce,this.tt.st[t].et,this.tt.st[t].Te-4),i.fillStyle=this.tt.A),i.beginPath(),i.moveTo(this.tt.st[t].et,this.tt.st[t].Te),this.tt.st[t].Pe&&this.tt.st[t].Te===this.tt.st[t].Re&&t===e)void 0!==this.tt.st[t].A&&(i.strokeStyle=this.tt.st[t].A),i.lineTo(this.tt.st[t].De,this.tt.st[t].Te),this.tt.ke&&i.stroke();else{for(let s=t;s<=e;s++)i.lineTo(this.tt.st[s].et,this.tt.st[s].Te);this.tt.st[t].Pe&&(i.lineTo(this.tt.st[e].De,this.tt.st[e].Te),i.lineTo(this.tt.st[e].De,this.tt.st[e].Re));for(let s=e;s>=t;--s)i.lineTo(this.tt.st[s].et,this.tt.st[s].Re);i.closePath(),void 0!==this.tt.st[t].A&&(i.fillStyle=this.tt.st[t].A),this.tt.A&&i.fill(),this.tt.ke&&i.stroke()}}}}class Qt extends Yt{Fs(t,i,s){i.$s(this.Cs,I(this.Ts)),t.Ae(this.Cs,s,I(this.Ts))}js(){this.Cs=this.Ps.In().Ys().map(t=>{const i=t.Lt[1],s=t.Lt[2];return{ut:t.Xs,Be:i,Le:s,et:NaN,Te:NaN,Re:NaN}})}}class ti extends Qt{constructor(t,i){super(t,i,!1),this.Bs=new j,this.Ne=new Kt,this.Bs.X([this.Ne])}Ie(t){this.Ne.Se=t}Ws(){const t=this.Ps.W(),i={st:this.Cs,A:t.color,ye:t.strokeColor,ke:t.strokeWidth,nt:this.Ts,cs:this.Rs.kt().Gs()};this.Ne.it(i)}Fs(t,i,s){const{Oe:e,Ee:n,Ve:h,ze:o,Fe:r,We:l,je:a}=t.$e(),{He:c,Ue:u,Ye:d}=i.$e(),f=r/(o-h),p=I(this.Ts),m=i.qe(),g=void 0===p?0:p.from,v=void 0===p?this.Cs.length:p.to;for(let b=g;b<v;b++){const t=this.Cs[b],i=t.Be,o=t.Le;if(isNaN(i)||isNaN(o))continue;let r=i,p=o;null!==a&&(r=a(t.Be,s),p=a(t.Le,s));let g=n+f*(r-h),v=l?g:e-1-g;t.Te=v,g=n+f*(p-h),v=l?g:e-1-g,t.Re=v;let w=m+u-t.ut;v=c-(w+.5)*d-1,t.et=Math.round(v),void 0!==t.Xe&&this.Ne.Se[t.Xe]?(w=m+u-this.Ne.Se[t.Xe],v=c-(w+.5)*d-1,t.De=Math.round(v)):t.De=c}}js(){this.Cs=this.Ps.In().Ys().map(t=>{const i=t.Lt[1],s=t.Lt[2],e={ut:t.Xs,Be:i,Le:s,et:NaN,De:NaN,Te:NaN,Re:NaN};return void 0!==t.A&&(e.A=t.A),void 0!==t.Xe&&(e.Xe=t.Xe),void 0!==t.Ce&&(e.Ce=t.Ce),void 0!==t.Pe&&(e.Pe=t.Pe),e})}Es(){const t=this.Ps.Bt(),i=this.Rs.kt();if(this.Os(),i.Fi()||t.Fi())return;const s=i.Vs();if(null===s)return;if(0===this.Ps.In().zs())return;const e=this.Ps.Pt();this.Ts=!e||this.Ps.W().infinite?{from:0,to:this.Cs.length}:Ot(this.Cs,s,!1),this.Fs(t,i,null==e?void 0:e.Lt),this.Ws()}}class ii extends Q{constructor(){super(...arguments),this.Vt=null,this.Js=0}it(t){this.Vt=t}K(t){if(null===this.Vt||0===this.Vt.In.length||null===this.Vt.nt)return;const{horizontalPixelRatio:i}=t;this.Js=function(t,i){if(t>=2.5&&t<=4)return Math.floor(3*i);const s=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),e=Math.floor(t*s*i),n=Math.floor(t*i),h=Math.min(e,n);return Math.max(Math.floor(i),h)}(this.Vt.Gs,i),this.Js>=2&&Math.floor(i)%2!=this.Js%2&&this.Js--;const s=this.Vt.In;this.Vt.Ze&&this.Ke(t,s,this.Vt.nt),this.Vt.ci&&this.Ge(t,s,this.Vt.nt);const e=this.Je(i);(!this.Vt.ci||this.Js>2*e)&&this.Qe(t,s,this.Vt.nt)}Ke(t,i,s){if(null===this.Vt)return;const{context:e,horizontalPixelRatio:n,verticalPixelRatio:h}=t;let o="",r=Math.min(Math.floor(n),Math.floor(this.Vt.Gs*n));r=Math.max(Math.floor(n),Math.min(r,this.Js));const l=Math.floor(.5*r);let a=null;for(let c=s.from;c<s.to;c++){const t=i[c];t.tr!==o&&(e.fillStyle=t.tr,o=t.tr);const s=Math.round(Math.min(t.he,t.le)*h),u=Math.round(Math.max(t.he,t.le)*h),d=Math.round(t.se*h),f=Math.round(t.ee*h);let p=Math.round(n*t.et)-l;const m=p+r-1;null!==a&&(p=Math.max(a+1,p),p=Math.min(p,m));const g=m-p+1;e.fillRect(p,d,g,s-d),e.fillRect(p,u+1,g,f-u),a=m}}Je(t){let i=Math.floor(1*t);this.Js<=2*i&&(i=Math.floor(.5*(this.Js-1)));const s=Math.max(Math.floor(t),i);return this.Js<=2*s?Math.max(Math.floor(t),Math.floor(1*t)):s}Ge(t,i,s){if(null===this.Vt)return;const{context:e,horizontalPixelRatio:n,verticalPixelRatio:h}=t;let o="";const r=this.Je(n);let l=null;for(let a=s.from;a<s.to;a++){const t=i[a];t.ir!==o&&(e.fillStyle=t.ir,o=t.ir);let s=Math.round(t.et*n)-Math.floor(.5*this.Js);const c=s+this.Js-1,u=Math.round(Math.min(t.he,t.le)*h),d=Math.round(Math.max(t.he,t.le)*h);if(null!==l&&(s=Math.max(l+1,s),s=Math.min(s,c)),this.Vt.Gs*n>2*r)st(e,s,u,c-s+1,d-u+1,r);else{const t=c-s+1;e.fillRect(s,u,t,d-u+1)}l=c}}Qe(t,i,s){if(null===this.Vt)return;const{context:e,horizontalPixelRatio:n,verticalPixelRatio:h}=t;let o="";const r=this.Je(n);for(let l=s.from;l<s.to;l++){const t=i[l];let s=Math.round(Math.min(t.he,t.le)*h),a=Math.round(Math.max(t.he,t.le)*h),c=Math.round(t.et*n)-Math.floor(.5*this.Js),u=c+this.Js-1;if(t.ne!==o){const i=t.ne;e.fillStyle=i,o=i}this.Vt.ci&&(c+=r,s+=r,u-=r,a-=r),s>a||e.fillRect(c,s,u-c+1,a-s+1)}}}class si extends It{constructor(){super(...arguments),this.Bs=new ii}qs(t,i,s){return Object.assign(Object.assign({},this.oe(t,i,s)),s.Ns(t))}Ws(){const t=this.Ps.W();this.Bs.it({In:this.Cs,Gs:this.Rs.kt().Gs(),Ze:t.wickVisible,ci:t.borderVisible,nt:this.Ts})}}class ei extends H{constructor(){super(...arguments),this.tt=null}it(t){this.tt=t}K(t){if(null===this.tt||0===this.tt.st.length||null===this.tt.nt)return;const i=t.context;let s=1;const e=[];let n=-2;for(let a=this.tt.nt.from+1;a<this.tt.nt.to;++a){const t=this.tt.st[a],i=t.Be-t.Le,h=i>0?1:-1;a===this.tt.nt.from+1&&(s=i),-2!==n&&n*h==-1&&e.push(a),n=h}e.push(this.tt.nt.to);let h,o=this.tt.nt.from,r=[0,0],l=[0,0];for(let a=0;a<e.length;++a){h=e[a],i.beginPath(),0===a?i.moveTo(this.tt.st[o].et,this.tt.st[o].Te):i.moveTo(r[0],r[1]);for(let t=o;t<h;t++)i.lineTo(this.tt.st[t].et,this.tt.st[t].Te);a!==e.length-1&&(l=this.nr(h),i.lineTo(l[0],l[1]));for(let t=h-1;t>=o;--t)i.lineTo(this.tt.st[t].et,this.tt.st[t].Re);0!==a&&i.lineTo(r[0],r[1]),i.closePath(),s*Math.pow(-1,a)>0?i.fillStyle=this.tt.sr:i.fillStyle=this.tt.er,i.fill(),o=h,r=l}}nr(t){if(null===this.tt||0===this.tt.st.length||null===this.tt.nt)throw new Error("Empty data");return ei.rr(this.tt.st[t-1].et,this.tt.st[t-1].Te,this.tt.st[t].et,this.tt.st[t].Te,this.tt.st[t-1].Re,this.tt.st[t].Re)}static rr(t,i,s,e,n,h){const o=e-i,r=t-s,l=o*t+r*i,a=h-n,c=t-s,u=a*t+c*n,d=o*c-a*r;if(0===d)throw new Error("Lines are parallel");return[(c*l-r*u)/d,(o*u-a*l)/d]}}class ni extends Qt{constructor(t,i){super(t,i,!1),this.Bs=new j,this.hr=new ei,this.lr=new Wt,this.ar=new Wt,this.Bs.X([this.hr,this.lr,this.ar])}Ws(){const t=this.Ps.W(),i={st:this.Cs,sr:t.positiveColor,er:t.negativeColor,nt:this.Ts,cs:this.Rs.kt().Gs()};this.hr.it(i);const s=[],e=[];for(let o=0;o<this.Cs.length;o++)s.push({_t:t.higherLineColor,ut:this.Cs[o].ut,ct:this.Cs[o].Be,et:this.Cs[o].et,rt:this.Cs[o].Te}),e.push({_t:t.lowerLineColor,ut:this.Cs[o].ut,ct:this.Cs[o].Le,et:this.Cs[o].et,rt:this.Cs[o].Re});const n={st:s,Wt:t.higherLineStyle,ds:t.higherLineType,ht:t.higherLineWidth,nt:this.Ts,cs:this.Rs.kt().Gs()};this.lr.it(n);const h={st:e,Wt:t.lowerLineStyle,ds:t.lowerLineType,ht:t.lowerLineWidth,nt:this.Ts,cs:this.Rs.kt().Gs()};this.ar.it(h)}}class hi extends Q{constructor(){super(...arguments),this.Vt=null,this._r=[]}it(t){this.Vt=t,this._r=[]}K({context:t,horizontalPixelRatio:i,verticalPixelRatio:s}){if(null===this.Vt||0===this.Vt.st.length||null===this.Vt.nt)return;this._r.length||this.ur(i);const e=Math.max(1,Math.floor(s)),n=Math.round(this.Vt.cr*s)-Math.floor(e/2),h=n+e;for(let o=this.Vt.nt.from;o<this.Vt.nt.to;o++){const i=this.Vt.st[o],r=this._r[o-this.Vt.nt.from],l=Math.round(i.rt*s);let a,c;t.fillStyle=i.ne,l<=n?(a=l,c=h):(a=n,c=l-Math.floor(e/2)+e),t.fillRect(r.xs,a,r.di-r.xs+1,c-a)}}ur(t){if(null===this.Vt||0===this.Vt.st.length||null===this.Vt.nt)return void(this._r=[]);const i=Math.ceil(this.Vt.Gs*t)<=1?0:Math.max(1,Math.floor(t)),s=Math.round(this.Vt.Gs*t)-i;this._r=new Array(this.Vt.nt.to-this.Vt.nt.from);for(let n=this.Vt.nt.from;n<this.Vt.nt.to;n++){const i=this.Vt.st[n],e=Math.round(i.et*t);let h,o;if(s%2){const t=(s-1)/2;h=e-t,o=e+t}else{const t=s/2;h=e-t,o=e+t-1}this._r[n-this.Vt.nt.from]={xs:h,di:o,dr:e,pr:i.et*t,ut:i.ut}}for(let n=this.Vt.nt.from+1;n<this.Vt.nt.to;n++){const t=this._r[n-this.Vt.nt.from],s=this._r[n-this.Vt.nt.from-1];t.ut===s.ut+1&&t.xs-s.di!==i+1&&(s.dr>s.pr?s.di=t.xs-i-1:t.xs=s.di+i+1)}let e=Math.ceil(this.Vt.Gs*t);for(let n=this.Vt.nt.from;n<this.Vt.nt.to;n++){const t=this._r[n-this.Vt.nt.from];t.di<t.xs&&(t.di=t.xs);const i=t.di-t.xs+1;e=Math.min(i,e)}if(i>0&&e<4)for(let n=this.Vt.nt.from;n<this.Vt.nt.to;n++){const t=this._r[n-this.Vt.nt.from];t.di-t.xs+1>e&&(t.dr>t.pr?t.di-=1:t.xs+=1)}}}class oi extends $t{constructor(){super(...arguments),this.Bs=new hi}qs(t,i,s){return Object.assign(Object.assign({},this.Us(t,i)),s.Ns(t))}Ws(){const t={st:this.Cs,Gs:this.Rs.kt().Gs(),nt:this.Ts,cr:this.Ps.Bt().At(this.Ps.W().base,C(this.Ps.Pt()).Lt)};this.Bs.it(t)}}class ri extends $t{constructor(){super(...arguments),this.Bs=new Wt}qs(t,i,s){return Object.assign(Object.assign({},this.Us(t,i)),s.Ns(t))}Ws(){const t=this.Ps.W(),i={st:this.Cs,Wt:t.lineStyle,ds:t.lineType,ht:t.lineWidth,nt:this.Ts,cs:this.Rs.kt().Gs()};this.Bs.it(i)}}const li=/[2-9]/g;class ai{constructor(t=50){this.vr=0,this.mr=1,this.br=1,this.gr={},this.wr=new Map,this.Mr=t}Sr(){this.vr=0,this.wr.clear(),this.mr=1,this.br=1,this.gr={}}Si(t,i,s){return this.yr(t,i,s).width}xi(t,i,s){const e=this.yr(t,i,s);return((e.actualBoundingBoxAscent||0)-(e.actualBoundingBoxDescent||0))/2}yr(t,i,s){const e=s||li,n=String(i).replace(e,"0");if(this.wr.has(n))return y(this.wr.get(n)).kr;if(this.vr===this.Mr){const t=this.gr[this.br];delete this.gr[this.br],this.wr.delete(t),this.br++,this.vr--}t.save(),t.textBaseline="middle";const h=t.measureText(n);return t.restore(),0===h.width&&i.length||(this.wr.set(n,{kr:h,Cr:this.mr}),this.gr[this.mr]=n,this.vr++,this.mr++),h}}class ci{constructor(t){this.Tr=null,this.k=null,this.Pr="right",this.Rr=t}Dr(t,i,s){this.Tr=t,this.k=i,this.Pr=s}Z(t){null!==this.k&&null!==this.Tr&&this.Tr.Z(t,this.k,this.Rr,this.Pr)}}class ui{constructor(t,i,s){this.Ar=t,this.Rr=new ai(50),this.Br=i,this.F=s,this.j=-1,this.$t=new ci(this.Rr)}xt(){const t=this.F.Lr(this.Br);if(null===t)return null;const i=t.Nr(this.Br)?t.Ir():this.Br.Bt();if(null===i)return null;const s=t.Or(i);if("overlay"===s)return null;const e=this.F.Er();return e.P!==this.j&&(this.j=e.P,this.Rr.Sr()),this.$t.Dr(this.Ar.Oi(),e,s),this.$t}}class di extends Q{constructor(){super(...arguments),this.Vt=null}it(t){this.Vt=t}Vr(t,i){var s;if(!(null===(s=this.Vt)||void 0===s?void 0:s.Tt))return null;const{rt:e,ht:n,zr:h}=this.Vt;return i>=e-n-7&&i<=e+n+7?{Fr:this.Vt,zr:h}:null}K({context:t,bitmapSize:i,horizontalPixelRatio:s,verticalPixelRatio:e}){if(null===this.Vt)return;if(!1===this.Vt.Tt)return;const n=Math.round(this.Vt.rt*e);if(n<0||n>i.height)return;let h=0;void 0!==this.Vt.et&&(h=Math.round(this.Vt.et*s)),t.lineCap="butt",t.strokeStyle=this.Vt.A,t.lineWidth=Math.floor(this.Vt.ht*s),x(t,this.Vt.Wt),M(t,n,h,i.width)}}class fi{constructor(t){this.Wr={rt:0,A:"rgba(0, 0, 0, 0)",ht:1,Wt:0,Tt:!1},this.jr=new di,this.bt=!0,this.Ps=t,this.Rs=t.Yt(),this.jr.it(this.Wr)}wt(){this.bt=!0}xt(){return this.Ps.Tt()?(this.bt&&(this.$r(),this.bt=!1),this.jr):null}}class pi extends fi{constructor(t){super(t)}$r(){this.Wr.Tt=!1;const t=this.Ps.Bt(),i=t.Hr().Hr;if(2!==i&&3!==i)return;const s=this.Ps.W();if(!s.baseLineVisible||!this.Ps.Tt())return;const e=this.Ps.Pt();null!==e&&(this.Wr.Tt=!0,this.Wr.rt=t.At(e.Lt,e.Lt),this.Wr.A=s.baseLineColor,this.Wr.ht=s.baseLineWidth,this.Wr.Wt=s.baseLineStyle)}}class mi extends Q{constructor(){super(...arguments),this.Vt=null}it(t){this.Vt=t}Ur(){return this.Vt}K({context:t,horizontalPixelRatio:i,verticalPixelRatio:s}){const e=this.Vt;if(null===e)return;const n=Math.max(1,Math.floor(i)),h=n%2/2,o=Math.round(e.pr.x*i)+h,r=e.pr.y*s;t.fillStyle=e.Yr,t.beginPath();const l=Math.max(2,1.5*e.qr)*i;t.arc(o,r,l,0,2*Math.PI,!1),t.fill(),t.fillStyle=e.Xr,t.beginPath(),t.arc(o,r,e.ot*i,0,2*Math.PI,!1),t.fill(),t.lineWidth=n,t.strokeStyle=e.ye,t.beginPath(),t.arc(o,r,e.ot*i+n/2,0,2*Math.PI,!1),t.stroke()}}const gi=[{Zr:0,De:.25,Kr:4,Gr:10,Jr:.25,Qr:0,th:.4,ih:.8},{Zr:.25,De:.525,Kr:10,Gr:14,Jr:0,Qr:0,th:.8,ih:0},{Zr:.525,De:1,Kr:14,Gr:14,Jr:0,Qr:0,th:0,ih:0}];function vi(t,i,s,e){return function(t,i){if("transparent"===t)return t;const s=W(t),e=s[3];return`rgba(${s[0]}, ${s[1]}, ${s[2]}, ${i*e})`}(t,s+(e-s)*i)}function bi(t,i){const s=t%2600/2600;let e;for(const l of gi)if(s>=l.Zr&&s<=l.De){e=l;break}S(void 0!==e,"Last price animation internal logic error");const n=(s-e.Zr)/(e.De-e.Zr);return{Xr:vi(i,n,e.Jr,e.Qr),ye:vi(i,n,e.th,e.ih),ot:(h=n,o=e.Kr,r=e.Gr,o+(r-o)*h)};var h,o,r}class wi{constructor(t){this.$t=new mi,this.bt=!0,this.nh=!0,this.sh=performance.now(),this.eh=this.sh-1,this.rh=t}hh(){this.eh=this.sh-1,this.wt()}lh(){if(this.wt(),2===this.rh.W().lastPriceAnimation){const t=performance.now(),i=this.eh-t;if(i>0)return void(i<650&&(this.eh+=2600));this.sh=t,this.eh=t+2600}}wt(){this.bt=!0}ah(){this.nh=!0}Tt(){return 0!==this.rh.W().lastPriceAnimation}oh(){switch(this.rh.W().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.eh}}xt(){return this.bt?(this.St(),this.bt=!1,this.nh=!1):this.nh&&(this._h(),this.nh=!1),this.$t}St(){this.$t.it(null);const t=this.rh.Yt().kt(),i=t.Vs(),s=this.rh.Pt();if(null===i||null===s)return;const e=this.rh.uh(!0);if(e.dh||!i.fh(e.Xs))return;const n={x:t.Et(e.Xs),y:this.rh.Bt().At(e.ct,s.Lt)},h=e.A,o=this.rh.W().lineWidth,r=bi(this.ph(),h);this.$t.it({Yr:h,qr:o,Xr:r.Xr,ye:r.ye,ot:r.ot,pr:n})}_h(){const t=this.$t.Ur();if(null!==t){const i=bi(this.ph(),t.Yr);t.Xr=i.Xr,t.ye=i.ye,t.ot=i.ot}}ph(){return this.oh()?performance.now()-this.sh:2599}}function xi(t,i){return Ht(Math.min(Math.max(t,12),30)*i)}function Mi(t,i){switch(t){case"arrowDown":case"arrowUp":return xi(i,1);case"circle":return xi(i,.8);case"square":return xi(i,.7)}}function Si(t){return function(t){const i=Math.ceil(t);return i%2!=0?i-1:i}(xi(t,1))}function yi(t){return Math.max(xi(t,.1),3)}function Ci(t,i,s,e,n){const h=Mi("square",s),o=(h-1)/2,r=t-o,l=i-o;return e>=r&&e<=r+h&&n>=l&&n<=l+h}function _i(t,i,s,e,n){const h=(Mi("arrowUp",n)-1)/2,o=(Ht(n/2)-1)/2;i.beginPath(),t?(i.moveTo(s-h,e),i.lineTo(s,e-h),i.lineTo(s+h,e),i.lineTo(s+o,e),i.lineTo(s+o,e+h),i.lineTo(s-o,e+h),i.lineTo(s-o,e)):(i.moveTo(s-h,e),i.lineTo(s,e+h),i.lineTo(s+h,e),i.lineTo(s+o,e),i.lineTo(s+o,e-h),i.lineTo(s-o,e-h),i.lineTo(s-o,e)),i.fill()}class Vi extends H{constructor(){super(...arguments),this.Vt=null,this.Rr=new ai,this.j=-1,this.$="",this.mh=""}it(t){this.Vt=t}Dr(t,i){this.j===t&&this.$===i||(this.j=t,this.$=i,this.mh=J(t,i),this.Rr.Sr())}Vr(t,i){if(null===this.Vt||null===this.Vt.nt)return null;for(let s=this.Vt.nt.from;s<this.Vt.nt.to;s++){const e=this.Vt.st[s];if(Li(e,t,i))return{Fr:e.bh,zr:e.zr}}return null}K({context:t},i,s){if(null!==this.Vt&&null!==this.Vt.nt){t.textBaseline="middle",t.font=this.mh;for(let i=this.Vt.nt.from;i<this.Vt.nt.to;i++){const s=this.Vt.st[i];void 0!==s.Jt&&(s.Jt.Hi=this.Rr.Si(t,s.Jt.gh),s.Jt.Ot=this.j,s.Jt.et=s.et-s.Jt.Hi/2),Ti(s,t)}}}}function Ti(t,i){var s,e,n,h;i.fillStyle=t.A,void 0!==t.Jt&&(s=i,e=t.Jt.gh,n=t.Jt.et,h=t.Jt.rt,s.fillText(e,n,h)),function(t,i){if(0!==t.zs){switch(t.wh){case"arrowDown":return void _i(!1,i,t.et,t.rt,t.zs);case"arrowUp":return void _i(!0,i,t.et,t.rt,t.zs);case"circle":return void function(t,i,s,e){const n=(Mi("circle",e)-1)/2;t.beginPath(),t.arc(i,s,n,0,2*Math.PI,!1),t.fill()}(i,t.et,t.rt,t.zs);case"square":return void function(t,i,s,e){const n=Mi("square",e),h=(n-1)/2,o=i-h,r=s-h;t.fillRect(o,r,n,n)}(i,t.et,t.rt,t.zs)}t.wh}}(t,i)}function Li(t,i,s){return!(void 0===t.Jt||!function(t,i,s,e,n,h){const o=e/2;return n>=t&&n<=t+s&&h>=i-o&&h<=i+o}(t.Jt.et,t.Jt.rt,t.Jt.Hi,t.Jt.Ot,i,s))||function(t,i,s){if(0===t.zs)return!1;switch(t.wh){case"arrowDown":case"arrowUp":return function(t,i,s,e,n,h){return Ci(i,s,e,n,h)}(0,t.et,t.rt,t.zs,i,s);case"circle":return function(t,i,s,e,n){const h=2+Mi("circle",s)/2,o=t-e,r=i-n;return Math.sqrt(o*o+r*r)<=h}(t.et,t.rt,t.zs,i,s);case"square":return Ci(t.et,t.rt,t.zs,i,s)}}(t,i,s)}function ki(t,i,s,e,n,h,o,r,l){const a=F(s)?s:s.de,c=F(s)?s:s.ue,u=F(s)?s:s.ce,d=F(i.size)?Math.max(i.size,0):1,f=Si(r.Gs())*d,p=f/2;switch(t.zs=f,i.position){case"inBar":return t.rt=o.At(a,l),void(void 0!==t.Jt&&(t.Jt.rt=t.rt+p+h+.6*n));case"aboveBar":return t.rt=o.At(c,l)-p-e.Mh,void 0!==t.Jt&&(t.Jt.rt=t.rt-p-.6*n,e.Mh+=1.2*n),void(e.Mh+=f+h);case"belowBar":return t.rt=o.At(u,l)+p+e.xh,void 0!==t.Jt&&(t.Jt.rt=t.rt+p+h+.6*n,e.xh+=1.2*n),void(e.xh+=f+h)}i.position}class Ei{constructor(t,i){this.bt=!0,this.Sh=!0,this.yh=!0,this.kh=null,this.$t=new Vi,this.rh=t,this.Ui=i,this.Vt={st:[],nt:null}}wt(t){this.bt=!0,this.yh=!0,"data"===t&&(this.Sh=!0)}xt(t){if(!this.rh.Tt())return null;this.bt&&this.Ch();const i=this.Ui.W().layout;return this.$t.Dr(i.fontSize,i.fontFamily),this.$t.it(this.Vt),this.$t}Th(){if(this.yh){if(this.rh.Ph().length>0){const t=this.Ui.kt().Gs(),i=yi(t),s=1.5*Si(t)+2*i;this.kh={above:s,below:s}}else this.kh=null;this.yh=!1}return this.kh}Ch(){const t=this.rh.Bt(),i=this.Ui.kt(),s=this.rh.Ph();this.Sh&&(this.Vt.st=s.map(t=>({ut:t.time,et:0,rt:0,zs:0,wh:t.shape,A:t.color,bh:t.internalId,zr:t.id,Jt:void 0})),this.Sh=!1);const e=this.Ui.W().layout;this.Vt.nt=null;const n=i.Vs();if(null===n)return;const h=this.rh.Pt();if(null===h)return;if(0===this.Vt.st.length)return;let o=NaN;const r=yi(i.Gs()),l={Mh:r,xh:r};this.Vt.nt=Ot(this.Vt.st,n,!0);for(let a=this.Vt.nt.from;a<this.Vt.nt.to;a++){const n=s[a];n.time!==o&&(l.Mh=r,l.xh=r,o=n.time);const c=this.Vt.st[a];c.et=i.Et(n.time),void 0!==n.text&&n.text.length>0&&(c.Jt={gh:n.text,et:0,rt:0,Hi:0,Ot:0});const u=this.rh.Rh(n.time);null!==u&&ki(c,n,u,l,e.fontSize,r,t,i,h.Lt)}this.bt=!1}}class zi extends fi{constructor(t){super(t)}$r(){const t=this.Wr;t.Tt=!1;const i=this.Ps.W();if(!i.priceLineVisible||!this.Ps.Tt())return;const s=this.Ps.uh(0===i.priceLineSource);s.dh||(t.Tt=!0,t.rt=s.ki,t.A=this.Ps.Dh(s.A),t.ht=i.priceLineWidth,t.Wt=i.priceLineStyle)}}class Pi extends at{constructor(t){super(),this.Ht=t}Ei(t,i,s){t.Tt=!1,i.Tt=!1;const e=this.Ht;if(!e.Tt())return;const n=e.W(),h=n.lastValueVisible,o=""!==e.Ah(),r=0===n.seriesLastValueMode,l=e.uh(!1);if(l.dh)return;h&&(t.Jt=this.Bh(l,h,r),t.Tt=0!==t.Jt.length),(o||r)&&(i.Jt=this.Lh(l,h,o,r),i.Tt=i.Jt.length>0);const a=e.Dh(l.A),c=B(a);s.t=c.t,s.ki=l.ki,i.Nt=e.Yt().It(l.ki/e.Bt().Ot()),t.Nt=a,t.A=c.i,i.A=c.i}Lh(t,i,s,e){let n="";const h=this.Ht.Ah();return s&&0!==h.length&&(n+=`${h} `),i&&e&&(n+=this.Ht.Bt().Nh()?t.Ih:t.Oh),n.trim()}Bh(t,i,s){return i?s?this.Ht.Bt().Nh()?t.Oh:t.Ih:t.Jt:""}}class Wi{constructor(t,i){this.Eh=t,this.Vh=i}zh(t){return null!==t&&this.Eh===t.Eh&&this.Vh===t.Vh}Fh(){return new Wi(this.Eh,this.Vh)}Wh(){return this.Eh}jh(){return this.Vh}$h(){return this.Vh-this.Eh}Fi(){return this.Vh===this.Eh||Number.isNaN(this.Vh)||Number.isNaN(this.Eh)}ts(t){return null===t?this:new Wi(Math.min(this.Wh(),t.Wh()),Math.max(this.jh(),t.jh()))}Hh(t){if(!F(t))return;if(0===this.Vh-this.Eh)return;const i=.5*(this.Vh+this.Eh);let s=this.Vh-i,e=this.Eh-i;s*=t,e*=t,this.Vh=i+s,this.Eh=i+e}Uh(t){F(t)&&(this.Vh+=t,this.Eh+=t)}Yh(){return{minValue:this.Eh,maxValue:this.Vh}}static qh(t){return null===t?null:new Wi(t.minValue,t.maxValue)}}class Bi{constructor(t,i){this.Xh=t,this.Zh=i||null}Kh(){return this.Xh}Gh(){return this.Zh}Yh(){return null===this.Xh?null:{priceRange:this.Xh.Yh(),margins:this.Zh||void 0}}static qh(t){return null===t?null:new Bi(Wi.qh(t.priceRange),t.margins)}}class Ni extends fi{constructor(t,i){super(t),this.Jh=i}$r(){const t=this.Wr;t.Tt=!1;const i=this.Jh.W();if(!this.Ps.Tt()||!i.lineVisible)return;const s=this.Jh.Qh();if(null===s)return;let e;void 0!==i.index&&(e=this.Rs.kt().Et(i.index)),t.Tt=!0,t.rt=s,t.et=e,t.A=i.color,t.ht=i.lineWidth,t.Wt=i.lineStyle,t.zr=this.Jh.W().id}}class Ri extends at{constructor(t,i){super(),this.rh=t,this.Jh=i}Ei(t,i,s){t.Tt=!1,i.Tt=!1;const e=this.Jh.W(),n=e.axisLabelVisible,h=""!==e.title,o=this.rh;if(!n||!o.Tt())return;const r=this.Jh.Qh();if(null===r)return;h&&(i.Jt=e.title,i.Tt=!0),i.Nt=o.Yt().It(r/o.Bt().Ot()),t.Jt=this.tl(e.price),t.Tt=!0;const l=B(e.axisLabelColor||e.color);s.t=l.t;const a=e.axisLabelTextColor||l.i;t.A=a,i.A=a,s.ki=r}tl(t){const i=this.rh.Pt();return null===i?"":this.rh.Bt().Wi(t,i.Lt)}}class Fi{constructor(t,i){this.rh=t,this.cn=i,this.il=new Ni(t,this),this.Ar=new Ri(t,this),this.nl=new ui(this.Ar,t,t.Yt())}sl(t){R(this.cn,t),this.wt(),this.rh.Yt().el()}W(){return this.cn}rl(){return this.il}hl(){return this.nl}ll(){return this.Ar}wt(){this.il.wt(),this.Ar.wt()}Qh(){const t=this.rh,i=t.Bt();if(t.Yt().kt().Fi()||i.Fi())return null;const s=t.Pt();return null===s?null:i.At(this.cn.price,s.Lt)}}class Oi extends pt{constructor(t){super(),this.Ui=t}Yt(){return this.Ui}}const Yi={al:4,ol:1e-4};function $i(t,i){const s=100*(t-i)/i;return i<0?-s:s}function Ai(t,i){const s=$i(t.Wh(),i),e=$i(t.jh(),i);return new Wi(s,e)}function Ui(t,i){const s=100*(t-i)/i+100;return i<0?-s:s}function Ii(t,i){const s=Ui(t.Wh(),i),e=Ui(t.jh(),i);return new Wi(s,e)}function Xi(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const e=jt(s+i.ol)+i.al;return t<0?-e:e}function Ji(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const e=Math.pow(10,s-i.al)-i.ol;return t<0?-e:e}function Di(t,i){if(null===t)return null;const s=Xi(t.Wh(),i),e=Xi(t.jh(),i);return new Wi(s,e)}function ji(t,i){if(null===t)return null;const s=Ji(t.Wh(),i),e=Ji(t.jh(),i);return new Wi(s,e)}function Hi(t){if(null===t)return Yi;const i=Math.abs(t.jh()-t.Wh());if(i>=1||i<1e-15)return Yi;const s=Math.ceil(Math.abs(Math.log10(i))),e=Yi.al+s;return{al:e,ol:1/Math.pow(10,e)}}const Zi={Bar:(t,i,s,e)=>{var n;const h=i.upColor,o=i.downColor,r=C(t(s,e)),l=_(r.Lt[0])<=_(r.Lt[3]);return{ne:null!==(n=r.A)&&void 0!==n?n:l?h:o}},Candlestick:(t,i,s,e)=>{var n,h,o;const r=i.upColor,l=i.downColor,a=i.borderUpColor,c=i.borderDownColor,u=i.wickUpColor,d=i.wickDownColor,f=C(t(s,e)),p=_(f.Lt[0])<=_(f.Lt[3]);return{ne:null!==(n=f.A)&&void 0!==n?n:p?r:l,ir:null!==(h=f.Nt)&&void 0!==h?h:p?a:c,tr:null!==(o=f._l)&&void 0!==o?o:p?u:d}},Area:(t,i,s,e)=>{var n,h,o,r;const l=C(t(s,e));return{ne:null!==(n=l._t)&&void 0!==n?n:i.lineColor,_t:null!==(h=l._t)&&void 0!==h?h:i.lineColor,gs:null!==(o=l.gs)&&void 0!==o?o:i.topColor,ws:null!==(r=l.ws)&&void 0!==r?r:i.bottomColor}},BrokenArea:(t,i,s,e)=>{var n;return{ne:null!==(n=C(t(s,e)).A)&&void 0!==n?n:i.color,_t:i.strokeColor}},CloudArea:(t,i,s,e)=>{const n=C(t(s,e));return{ne:n.Lt[3]>=n.Lt[0]?i.positiveColor:i.negativeColor,er:i.negativeColor,sr:i.positiveColor,ul:i.higherLineColor,cl:i.lowerLineColor}},Baseline:(t,i,s,e)=>{var n,h,o,r,l,a;const c=C(t(s,e));return{ne:c.Lt[3]>=i.baseValue.price?i.topLineColor:i.bottomLineColor,ge:null!==(n=c.ge)&&void 0!==n?n:i.topLineColor,we:null!==(h=c.we)&&void 0!==h?h:i.bottomLineColor,fe:null!==(o=c.fe)&&void 0!==o?o:i.topFillColor1,pe:null!==(r=c.pe)&&void 0!==r?r:i.topFillColor2,ve:null!==(l=c.ve)&&void 0!==l?l:i.bottomFillColor1,me:null!==(a=c.me)&&void 0!==a?a:i.bottomFillColor2}},Line:(t,i,s,e)=>{var n,h;const o=C(t(s,e));return{ne:null!==(n=o.A)&&void 0!==n?n:i.color,_t:null!==(h=o.A)&&void 0!==h?h:i.color}},Histogram:(t,i,s,e)=>{var n;return{ne:null!==(n=C(t(s,e)).A)&&void 0!==n?n:i.color}}};class Gi{constructor(t){this.dl=(t,i)=>void 0!==i?i.Lt:this.rh.In().fl(t),this.rh=t,this.pl=Zi[t.vl()]}Ns(t,i){return this.pl(this.dl,this.rh.W(),t,i)}}var qi;!function(t){t[t.NearestLeft=-1]="NearestLeft",t[t.None=0]="None",t[t.NearestRight=1]="NearestRight"}(qi||(qi={}));const Ki=30;class Qi{constructor(){this.ml=[],this.bl=new Map,this.gl=new Map}wl(){return this.zs()>0?this.ml[this.ml.length-1]:null}Ml(){return this.zs()>0?this.xl(0):null}Nn(){return this.zs()>0?this.xl(this.ml.length-1):null}zs(){return this.ml.length}Fi(){return 0===this.zs()}fh(t){return null!==this.Sl(t,0)}fl(t){return this.yl(t)}yl(t,i=0){const s=this.Sl(t,i);return null===s?null:Object.assign(Object.assign({},this.kl(s)),{Xs:this.xl(s)})}Ys(){return this.ml}Cl(t,i,s){if(this.Fi())return null;let e=null;for(const n of s)e=ts(e,this.Tl(t,i,n));return e}it(t){this.gl.clear(),this.bl.clear(),this.ml=t}xl(t){return this.ml[t].Xs}kl(t){return this.ml[t]}Sl(t,i){const s=this.Pl(t);if(null===s&&0!==i)switch(i){case-1:return this.Rl(t);case 1:return this.Dl(t);default:throw new TypeError("Unknown search mode")}return s}Rl(t){let i=this.Al(t);return i>0&&(i-=1),i!==this.ml.length&&this.xl(i)<t?i:null}Dl(t){const i=this.Bl(t);return i!==this.ml.length&&t<this.xl(i)?i:null}Pl(t){const i=this.Al(t);return i===this.ml.length||t<this.ml[i].Xs?null:i}Al(t){return Bt(this.ml,t,(t,i)=>t.Xs<i)}Bl(t){return Nt(this.ml,t,(t,i)=>i.Xs>t)}Ll(t,i,s){let e=null;for(let n=t;n<i;n++){const t=this.ml[n].Lt[s];Number.isNaN(t)||(null===e?e={Ve:t,ze:t}:(t<e.Ve&&(e.Ve=t),t>e.ze&&(e.ze=t)))}return e}Tl(t,i,s){if(this.Fi())return null;let e=null;const n=C(this.Ml()),h=C(this.Nn()),o=Math.max(t,n),r=Math.min(i,h),l=Math.ceil(o/Ki)*Ki,a=Math.max(l,Math.floor(r/Ki)*Ki);{const t=this.Al(o),n=this.Bl(Math.min(r,l,i));e=ts(e,this.Ll(t,n,s))}let c=this.bl.get(s);void 0===c&&(c=new Map,this.bl.set(s,c));for(let u=Math.max(l+1,o);u<a;u+=Ki){const t=Math.floor(u/Ki);let i=c.get(t);if(void 0===i){const e=this.Al(t*Ki),n=this.Bl((t+1)*Ki-1);i=this.Ll(e,n,s),c.set(t,i)}e=ts(e,i)}{const t=this.Al(a),i=this.Bl(r);e=ts(e,this.Ll(t,i,s))}return e}}function ts(t,i){return null===t?i:null===i?t:{Ve:Math.min(t.Ve,i.Ve),ze:Math.max(t.ze,i.ze)}}class is extends Oi{constructor(t,i,s){super(t),this.Vt=new Qi,this.il=new zi(this),this.Nl=[],this.Il=new pi(this),this.Ol=null,this.El=null,this.Vl=[],this.zl=[],this.Fl=null,this.cn=i,this.Wl=s;const e=new Pi(this);this.hn=[e],this.nl=new ui(e,this,t),"Area"!==s&&"Line"!==s&&"Baseline"!==s||(this.Ol=new wi(this)),this.jl(),this.$l()}S(){null!==this.Fl&&clearTimeout(this.Fl)}Dh(t){return this.cn.priceLineColor||t}uh(t){const i={dh:!0},s=this.Bt();if(this.Yt().kt().Fi()||s.Fi()||this.Vt.Fi())return i;const e=this.Yt().kt().Vs(),n=this.Pt();if(null===e||null===n)return i;let h,o;if(t){const t=this.Vt.wl();if(null===t)return i;h=t,o=t.Xs}else{const t=this.Vt.yl(e.di(),-1);if(null===t)return i;if(h=this.Vt.fl(t.Xs),null===h)return i;o=t.Xs}const r=h.Lt[3],l=this.Is().Ns(o,{Lt:h}),a=s.At(r,n.Lt);return{dh:!1,ct:r,Jt:s.Wi(r,n.Lt),Ih:s.Hl(r),Oh:s.Ul(r,n.Lt),A:l.ne,ki:a,Xs:o}}Is(){return null!==this.El||(this.El=new Gi(this)),this.El}W(){return this.cn}sl(t){const i=t.priceScaleId;void 0!==i&&i!==this.cn.priceScaleId&&this.Yt().Yl(this,i),R(this.cn,t),void 0!==t.priceFormat&&(this.jl(),this.Yt().ql()),this.Yt().Xl(this),this.gn.wt("options")}it(t,i){this.Vt.it(t),this.Zl(),this.gn.wt("data"),this.dn.wt("data"),null!==this.Ol&&(i&&i.Kl?this.Ol.lh():0===t.length&&this.Ol.hh());const s=this.Yt().Lr(this);this.Yt().Gl(s),this.Yt().Xl(this),this.Yt().el()}Jl(t){this.Vl=t,this.Zl();const i=this.Yt().Lr(this);this.dn.wt("data"),this.Yt().Gl(i),this.Yt().Xl(this),this.Yt().el()}Ql(){return this.Vl}Ph(){return this.zl}ta(t){const i=new Fi(this,t);return this.Nl.push(i),this.Yt().Xl(this),i}ia(t){const i=this.Nl.indexOf(t);-1!==i&&this.Nl.splice(i,1),this.Yt().Xl(this)}na(t,i){const s=this.Bt();let e=s.Kh();s.sa()&&(e=ji(e,s.ea()));let n=1e-4;e&&(n=16/s.Ot()*(Math.abs(e.$h())/t));for(let h=0;h<this.Nl.length;h++){const s=this.Nl[h],{price:e,index:o}=this.Nl[h].W();if((void 0===i||void 0===o||i>=o)&&Math.abs(Math.abs(e-t)/t)<Math.abs(n))return s}return null}ra(){this.Nl.splice(0,this.Nl.length)}vl(){return this.Wl}Pt(){const t=this.ha();return null===t?null:{Lt:t.Lt[3],la:t.ut}}ha(){const t=this.Yt().kt().Vs();if(null===t)return null;const i=t.xs();return this.Vt.yl(i,1)}In(){return this.Vt}Rh(t){const i=this.Vt.fl(t);return null===i?null:"Bar"===this.Wl||"Candlestick"===this.Wl?{_e:i.Lt[0],ue:i.Lt[1],ce:i.Lt[2],de:i.Lt[3]}:i.Lt[3]}aa(t){const i=this.Ol;return null!==i&&i.Tt()?(null===this.Fl&&i.oh()&&(this.Fl=setTimeout(()=>{this.Fl=null,this.Yt().oa()},0)),i.ah(),[i]):[]}Pn(){const t=[];this._a()||t.push(this.Il),t.push(this.gn,this.il,this.dn);const i=this.Nl.map(t=>t.rl());return t.push(...i),t}Qi(t){return[this.nl,...this.Nl.map(t=>t.hl())]}Rn(t,i){if(i!==this.Xi&&!this._a())return[];const s=[...this.hn];for(const e of this.Nl)s.push(e.ll());return s}ua(t,i){if(void 0!==this.cn.autoscaleInfoProvider){const s=this.cn.autoscaleInfoProvider(()=>{const s=this.ca(t,i);return null===s?null:s.Yh()});return Bi.qh(s)}return this.ca(t,i)}da(){return this.cn.priceFormat.minMove}fa(){return this.pa}An(){var t;this.gn.wt(),this.dn.wt();for(const i of this.hn)i.wt();for(const i of this.Nl)i.wt();this.il.wt(),this.Il.wt(),null===(t=this.Ol)||void 0===t||t.wt()}Bt(){return C(super.Bt())}Ct(t){if("Line"!==this.Wl&&"Area"!==this.Wl&&"Baseline"!==this.Wl||!this.cn.crosshairMarkerVisible)return null;const i=this.Vt.fl(t);return null===i?null:{ct:i.Lt[3],ot:this.va(),Nt:this.ma(),Dt:this.ba(),Rt:this.ga(t)}}Ah(){return this.cn.title}Tt(){return this.cn.visible}Ie(t){this.gn.Ie(t)}_a(){return!vt(this.Bt().Xe())}ca(t,i){if(!O(t)||!O(i)||this.Vt.Fi())return null;const s="Line"===this.Wl||"Area"===this.Wl||"Baseline"===this.Wl||"Histogram"===this.Wl?[3]:[2,1],e=this.Vt.Cl(t,i,s);let n=null!==e?new Wi(e.Ve,e.ze):null;if("Histogram"===this.vl()){const t=this.cn.base,i=new Wi(t,t);n=null!==n?n.ts(i):i}return new Bi(n,this.dn.Th())}va(){switch(this.Wl){case"Line":case"Area":case"Baseline":return this.cn.crosshairMarkerRadius}return 0}ma(){switch(this.Wl){case"Line":case"Area":case"Baseline":{const t=this.cn.crosshairMarkerBorderColor;if(0!==t.length)return t}}return null}ba(){switch(this.Wl){case"Line":case"Area":case"Baseline":return this.cn.crosshairMarkerBorderWidth}return 0}ga(t){switch(this.Wl){case"Line":case"Area":case"Baseline":{const t=this.cn.crosshairMarkerBackgroundColor;if(0!==t.length)return t}}return this.Is().Ns(t).ne}jl(){switch(this.cn.priceFormat.type){case"custom":this.pa={format:this.cn.priceFormat.formatter};break;case"volume":this.pa=new St(this.cn.priceFormat.precision);break;case"percent":this.pa=new Mt(this.cn.priceFormat.precision);break;default:{const t=Math.pow(10,this.cn.priceFormat.precision);this.pa=new xt(t,this.cn.priceFormat.minMove*t)}}null!==this.Xi&&this.Xi.wa()}Zl(){const t=this.Yt().kt();if(!t.Ma()||this.Vt.Fi())return void(this.zl=[]);const i=C(this.Vt.Ml());this.zl=this.Vl.map((s,e)=>{const n=C(t.xa(s.time,!0)),h=n<i?1:-1;return{time:C(this.Vt.yl(n,h)).Xs,position:s.position,shape:s.shape,color:s.color,id:s.id,internalId:e,text:s.text,size:s.size}})}$l(){switch(this.dn=new Ei(this,this.Yt()),this.Wl){case"Bar":this.gn=new Xt(this,this.Yt());break;case"Candlestick":this.gn=new si(this,this.Yt());break;case"Line":this.gn=new ri(this,this.Yt());break;case"Area":this.gn=new At(this,this.Yt());break;case"CloudArea":this.gn=new ni(this,this.Yt());break;case"BrokenArea":this.gn=new ti(this,this.Yt());break;case"Baseline":this.gn=new qt(this,this.Yt());break;case"Histogram":this.gn=new oi(this,this.Yt());break;default:throw Error("Unknown chart style assigned: "+this.Wl)}}}class ss{constructor(t){this.cn=t}Sa(t,i,s){let e=t;if(0===this.cn.mode)return e;const n=s.pn(),h=n.Pt();if(null===h)return e;const o=n.At(t,h),r=s.ya().filter(t=>t instanceof is).reduce((t,e)=>{if(s.Nr(e)||!e.Tt())return t;const n=e.Bt(),h=e.In();if(n.Fi()||!h.fh(i))return t;const o=h.fl(i);if(null===o)return t;const r=_(e.Pt());return t.concat([n.At(o.Lt[3],r.Lt)])},[]);if(0===r.length)return e;r.sort((t,i)=>Math.abs(t-o)-Math.abs(i-o));const l=r[0];return e=n.vn(l,h),e}}class es extends Q{constructor(){super(...arguments),this.Vt=null}it(t){this.Vt=t}K({context:t,bitmapSize:i,horizontalPixelRatio:s,verticalPixelRatio:e}){if(null===this.Vt)return;const n=Math.max(1,Math.floor(s));var h,o;t.lineWidth=n,o=()=>{const h=C(this.Vt);if(h.ka){t.strokeStyle=h.Ca,x(t,h.Ta),t.beginPath();for(const e of h.Pa){const h=Math.round(e.Ra*s);t.moveTo(h,-n),t.lineTo(h,i.height+n)}t.stroke()}if(h.Da){t.strokeStyle=h.Aa,x(t,h.Ba),t.beginPath();for(const s of h.La){const h=Math.round(s.Ra*e);t.moveTo(-n,h),t.lineTo(i.width+n,h)}t.stroke()}},(h=t).save(),h.lineWidth%2&&h.translate(.5,.5),o(),h.restore()}}class ns{constructor(t){this.$t=new es,this.bt=!0,this.nn=t}wt(){this.bt=!0}xt(){if(this.bt){const t=this.nn.Yt().W().grid,i={Da:t.horzLines.visible,ka:t.vertLines.visible,Aa:t.horzLines.color,Ca:t.vertLines.color,Ba:t.horzLines.style,Ta:t.vertLines.style,La:this.nn.pn().Na(),Pa:this.nn.Yt().kt().Na()||[]};this.$t.it(i),this.bt=!1}return this.$t}}class hs{constructor(t){this.gn=new ns(t)}rl(){return this.gn}}class os{constructor(t,i){if(this.Ia=t,this.Oa=i,function(t){if(t<0)return!1;for(let i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.Ia))this.Ea=[2,2.5,2];else{this.Ea=[];for(let t=this.Ia;1!==t;){if(t%2==0)this.Ea.push(2),t/=2;else{if(t%5!=0)throw new Error("unexpected base");this.Ea.push(2,2.5),t/=5}if(this.Ea.length>100)throw new Error("something wrong with base")}}}Va(t,i,s){const e=0===this.Ia?0:1/this.Ia;let n=Math.pow(10,Math.max(0,Math.ceil(jt(t-i)))),h=0,o=this.Oa[0];for(;;){const t=Dt(n,e,1e-14)&&n>e+1e-14,i=Dt(n,s*o,1e-14),r=Dt(n,1,1e-14);if(!(t&&i&&r))break;n/=o,o=this.Oa[++h%this.Oa.length]}if(n<=e+1e-14&&(n=e),n=Math.max(1,n),this.Ea.length>0&&(r=n,Math.abs(r-1)<1e-14))for(h=0,o=this.Ea[0];Dt(n,s*o,1e-14)&&n>e+1e-14;)n/=o,o=this.Ea[++h%this.Ea.length];var r;return n}}class rs{constructor(t,i,s,e){this.za=[],this.Vi=t,this.Ia=i,this.Fa=s,this.Wa=e}Va(t,i){if(t<i)throw new Error("high < low");const s=this.Vi.Ot(),e=(t-i)*this.ja()/s,n=new os(this.Ia,[2,2.5,2]),h=new os(this.Ia,[2,2,2.5]),o=new os(this.Ia,[2.5,2,2]),r=[];return r.push(n.Va(t,i,e),h.Va(t,i,e),o.Va(t,i,e)),function(t){if(t.length<1)throw Error("array is empty");let i=t[0];for(let s=1;s<t.length;++s)t[s]<i&&(i=t[s]);return i}(r)}$a(){const t=this.Vi,i=t.Pt();if(null===i)return void(this.za=[]);const s=t.Ot(),e=this.Fa(s-1,i),n=this.Fa(0,i),h=this.Vi.W().entireTextOnly?this.Ha()/2:0,o=h,r=s-1-h,l=Math.max(e,n),a=Math.min(e,n);if(l===a)return void(this.za=[]);let c=this.Va(l,a),u=l%c;u+=u<0?c:0;const d=l>=a?1:-1;let f=null,p=0;for(let m=l-u;m>a;m-=c){const s=this.Wa(m,i,!0);null!==f&&Math.abs(s-f)<this.ja()||s<o||s>r||(p<this.za.length?(this.za[p].Ra=s,this.za[p].Ce=t.Ua(m)):this.za.push({Ra:s,Ce:t.Ua(m)}),p++,f=s,t.sa()&&(c=this.Va(m*d,a)))}this.za.length=p}Na(){return this.za}Ha(){return this.Vi.P()}ja(){return Math.ceil(2.5*this.Ha())}}function ls(t){return t.slice().sort((t,i)=>C(t.Ki())-C(i.Ki()))}var as;!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(as||(as={}));const cs=new Mt,us=new xt(100,1);class ds{constructor(t,i,s,e){this.Ya=0,this.qa=null,this.Xh=null,this.Xa=null,this.Za={Ka:!1,Ga:null},this.Ja=0,this.Qa=0,this.io=new N,this.no=new N,this.so=[],this.eo=null,this.ro=null,this.ho=null,this.lo=null,this.pa=us,this.ao=Hi(null),this.oo=t,this.cn=i,this._o=s,this.uo=e,this.co=new rs(this,100,this.do.bind(this),this.fo.bind(this))}Xe(){return this.oo}W(){return this.cn}sl(t){if(R(this.cn,t),this.wa(),void 0!==t.mode&&this.po({Hr:t.mode}),void 0!==t.scaleMargins){const i=y(t.scaleMargins.top),s=y(t.scaleMargins.bottom);if(i<0||i>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${i}`);if(s<0||s>1||i+s>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${s}`);if(i+s>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${i+s}`);this.vo(),this.ro=null}}mo(){return this.cn.autoScale}sa(){return 1===this.cn.mode}Nh(){return 2===this.cn.mode}bo(){return 3===this.cn.mode}Hr(){return{Wn:this.cn.autoScale,We:this.cn.invertScale,Hr:this.cn.mode}}po(t){const i=this.Hr();let s=null;void 0!==t.Wn&&(this.cn.autoScale=t.Wn),void 0!==t.Hr&&(this.cn.mode=t.Hr,2!==t.Hr&&3!==t.Hr||(this.cn.autoScale=!0),this.Za.Ka=!1),1===i.Hr&&t.Hr!==i.Hr&&(function(t,i){if(null===t)return!1;const s=Ji(t.Wh(),i),e=Ji(t.jh(),i);return isFinite(s)&&isFinite(e)}(this.Xh,this.ao)?(s=ji(this.Xh,this.ao),null!==s&&this.wo(s)):this.cn.autoScale=!0),1===t.Hr&&t.Hr!==i.Hr&&(s=Di(this.Xh,this.ao),null!==s&&this.wo(s));const e=i.Hr!==this.cn.mode;e&&(2===i.Hr||this.Nh())&&this.wa(),e&&(3===i.Hr||this.bo())&&this.wa(),void 0!==t.We&&i.We!==t.We&&(this.cn.invertScale=t.We,this.Mo()),this.no.m(i,this.Hr())}xo(){return this.no}P(){return this._o.fontSize}Ot(){return this.Ya}So(t){this.Ya!==t&&(this.Ya=t,this.vo(),this.ro=null)}yo(){if(this.qa)return this.qa;const t=this.Ot()-this.ko()-this.Co();return this.qa=t,t}Kh(){return this.To(),this.Xh}ea(){return this.ao}wo(t,i){const s=this.Xh;(i||null===s&&null!==t||null!==s&&!s.zh(t))&&(this.ro=null,this.Xh=t)}Fi(){return this.To(),0===this.Ya||!this.Xh||this.Xh.Fi()}Po(t){return this.We()?t:this.Ot()-1-t}At(t,i){return this.Nh()?t=$i(t,i):this.bo()&&(t=Ui(t,i)),this.fo(t,i)}Hs(t,i,s){this.To();const e=this.Co(),n=C(this.Kh()),h=n.Wh(),o=n.jh(),r=this.yo()-1,l=this.We(),a=r/(o-h),c=void 0===s?0:s.from,u=void 0===s?t.length:s.to,d=this.Ro();for(let f=c;f<u;f++){const s=t[f],n=s.ct;if(isNaN(n))continue;let o=n;null!==d&&(o=d(s.ct,i));const r=e+a*(o-h),c=l?r:this.Ya-1-r;s.rt=c}}$e(){this.To();const t=C(this.Kh());return{Oe:this.Ya,Ee:this.Co(),Ve:t.Wh(),ze:t.jh(),Do:t,Fe:this.yo()-1,We:this.We(),je:this.Ro()}}Ae(t,i,s){this.To();const e=this.Co(),n=C(this.Kh()),h=n.Wh(),o=n.jh(),r=this.yo()-1,l=this.We(),a=r/(o-h),c=void 0===s?0:s.from,u=void 0===s?t.length:s.to,d=this.Ro();for(let f=c;f<u;f++){const s=t[f],n=s.Be,o=s.Le;if(isNaN(n)||isNaN(o))continue;let r=n,c=o;null!==d&&(r=d(s.Be,i),c=d(s.Le,i));let u=e+a*(r-h),p=l?u:this.Ya-1-u;s.Te=p,u=e+a*(c-h),p=l?u:this.Ya-1-u,s.Re=p}}ae(t,i,s){this.To();const e=this.Co(),n=C(this.Kh()),h=n.Wh(),o=n.jh(),r=this.yo()-1,l=this.We(),a=r/(o-h),c=void 0===s?0:s.from,u=void 0===s?t.length:s.to,d=this.Ro();for(let f=c;f<u;f++){const s=t[f];let n=s._e,o=s.ue,r=s.ce,c=s.de;null!==d&&(n=d(s._e,i),o=d(s.ue,i),r=d(s.ce,i),c=d(s.de,i));let u=e+a*(n-h),p=l?u:this.Ya-1-u;s.he=p,u=e+a*(o-h),p=l?u:this.Ya-1-u,s.se=p,u=e+a*(r-h),p=l?u:this.Ya-1-u,s.ee=p,u=e+a*(c-h),p=l?u:this.Ya-1-u,s.le=p}}vn(t,i){const s=this.do(t,i);return this.Ao(s,i)}Ao(t,i){let s=t;return this.Nh()?(e=s,(n=i)<0&&(e=-e),s=e/100*n+n):this.bo()&&(s=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(s,i)),s;var e,n}ya(){return this.so}Bo(){if(this.eo)return this.eo;let t=[];for(let i=0;i<this.so.length;i++){const s=this.so[i];null===s.Ki()&&s.Gi(i+1),t.push(s)}return t=ls(t),this.eo=t,this.eo}Lo(t){-1===this.so.indexOf(t)&&(this.so.push(t),this.wa(),this.No())}Io(t){const i=this.so.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.so.splice(i,1),0===this.so.length&&(this.po({Wn:!0}),this.wo(null)),this.wa(),this.No()}Pt(){let t=null;for(const i of this.so){const s=i.Pt();null!==s&&(null===t||s.la<t.la)&&(t=s)}return null===t?null:t.Lt}We(){return this.cn.invertScale}Na(){const t=null===this.Pt();if(null!==this.ro&&(t||this.ro.Oo===t))return this.ro.Na;this.co.$a();const i=this.co.Na();return this.ro={Na:i,Oo:t},this.io.m(),i}Eo(){return this.io}Vo(t){this.Nh()||this.bo()||null===this.ho&&null===this.Xa&&(this.Fi()||(this.ho=this.Ya-t,this.Xa=C(this.Kh()).Fh()))}zo(t){if(this.Nh()||this.bo())return;if(null===this.ho)return;this.po({Wn:!1}),(t=this.Ya-t)<0&&(t=0);let i=(this.ho+.2*(this.Ya-1))/(t+.2*(this.Ya-1));const s=C(this.Xa).Fh();i=Math.max(i,.1),s.Hh(i),this.wo(s)}Fo(){this.Nh()||this.bo()||(this.ho=null,this.Xa=null)}Wo(t){this.mo()||null===this.lo&&null===this.Xa&&(this.Fi()||(this.lo=t,this.Xa=C(this.Kh()).Fh()))}jo(t){if(this.mo())return;if(null===this.lo)return;const i=C(this.Kh()).$h()/(this.yo()-1);let s=t-this.lo;this.We()&&(s*=-1);const e=s*i,n=C(this.Xa).Fh();n.Uh(e),this.wo(n,!0),this.ro=null}$o(){this.mo()||null!==this.lo&&(this.lo=null,this.Xa=null)}fa(){return this.pa||this.wa(),this.pa}Wi(t,i){switch(this.cn.mode){case 2:return this.fa().format($i(t,i));case 3:return this.fa().format(Ui(t,i));default:return this.tl(t)}}Ua(t){switch(this.cn.mode){case 2:case 3:return this.fa().format(t);default:return this.tl(t)}}Hl(t){return this.tl(t,C(this.Ho()).fa())}Ul(t,i){return t=$i(t,i),cs.format(t)}Uo(){return this.so}Yo(t){this.Za={Ga:t,Ka:!1}}An(){this.so.forEach(t=>t.An())}wa(){this.ro=null;const t=this.Ho();let i=100;null!==t&&(i=Math.round(1/t.da())),this.pa=us,this.Nh()?(this.pa=cs,i=100):this.bo()?(this.pa=new xt(100,1),i=100):null!==t&&(this.pa=t.fa()),this.co=new rs(this,i,this.do.bind(this),this.fo.bind(this)),this.co.$a()}No(){this.eo=null}Ho(){return this.so[0]||null}ko(){return this.We()?this.cn.scaleMargins.bottom*this.Ot()+this.Qa:this.cn.scaleMargins.top*this.Ot()+this.Ja}Co(){return this.We()?this.cn.scaleMargins.top*this.Ot()+this.Ja:this.cn.scaleMargins.bottom*this.Ot()+this.Qa}To(){this.Za.Ka||(this.Za.Ka=!0,this.qo())}vo(){this.qa=null}fo(t,i){if(this.To(),this.Fi())return 0;t=this.sa()&&t?Xi(t,this.ao):t;const s=C(this.Kh()),e=this.Co()+(this.yo()-1)*(t-s.Wh())/s.$h();return this.Po(e)}do(t,i){if(this.To(),this.Fi())return 0;const s=this.Po(t),e=C(this.Kh()),n=e.Wh()+e.$h()*((s-this.Co())/(this.yo()-1));return this.sa()?Ji(n,this.ao):n}Mo(){this.ro=null,this.co.$a()}qo(){const t=this.Za.Ga;if(null===t)return;let i=null;const s=this.Uo();let e=0,n=0;for(const r of s){if(!r.Tt())continue;const s=r.Pt();if(null===s)continue;const h=r.ua(t.xs(),t.di());let o=h&&h.Kh();if(null!==o){switch(this.cn.mode){case 1:o=Di(o,this.ao);break;case 2:o=Ai(o,s.Lt);break;case 3:o=Ii(o,s.Lt)}if(i=null===i?o:i.ts(C(o)),null!==h){const t=h.Gh();null!==t&&(e=Math.max(e,t.above),n=Math.max(e,t.below))}}}if(e===this.Ja&&n===this.Qa||(this.Ja=e,this.Qa=n,this.ro=null,this.vo()),null!==i){if(i.Wh()===i.jh()){const t=this.Ho(),s=5*(null===t||this.Nh()||this.bo()?1:t.da());this.sa()&&(i=ji(i,this.ao)),i=new Wi(i.Wh()-s,i.jh()+s),this.sa()&&(i=Di(i,this.ao))}if(this.sa()){const t=ji(i,this.ao),s=Hi(t);if(h=s,o=this.ao,h.al!==o.al||h.ol!==o.ol){const e=null!==this.Xa?ji(this.Xa,this.ao):null;this.ao=s,i=Di(t,s),null!==e&&(this.Xa=Di(e,s))}}this.wo(i)}else null===this.Xh&&(this.wo(new Wi(-.5,.5)),this.ao=Hi(null));var h,o;this.Za.Ka=!0}Ro(){return this.Nh()?$i:this.bo()?Ui:this.sa()?t=>Xi(t,this.ao):null}tl(t,i){return void 0===this.uo.priceFormatter?(void 0===i&&(i=this.fa()),i.format(t)):this.uo.priceFormatter(t)}}class fs{constructor(t,i){this.so=[],this.Xo=new Map,this.Ya=0,this.Zo=0,this.Ko=1e3,this.eo=null,this.Go=new N,this.Jo=t,this.Ui=i,this.Qo=new hs(this);const s=i.W();this.t_=this.i_("left",s.leftPriceScale),this.n_=this.i_("right",s.rightPriceScale),this.t_.xo().l(this.s_.bind(this,this.t_),this),this.n_.xo().l(this.s_.bind(this,this.n_),this),this.e_(s)}e_(t){if(t.leftPriceScale&&this.t_.sl(t.leftPriceScale),t.rightPriceScale&&this.n_.sl(t.rightPriceScale),t.localization&&(this.t_.wa(),this.n_.wa()),t.overlayPriceScales){const i=Array.from(this.Xo.values());for(const s of i){const i=C(s[0].Bt());i.sl(t.overlayPriceScales),t.localization&&i.wa()}}}r_(t){switch(t){case"left":return this.t_;case"right":return this.n_}return this.Xo.has(t)?y(this.Xo.get(t))[0].Bt():null}S(){this.Yt().h_().v(this),this.t_.xo().v(this),this.n_.xo().v(this),this.so.forEach(t=>{t.S&&t.S()}),this.Go.m()}l_(){return this.Ko}a_(t){this.Ko=t}Yt(){return this.Ui}Hi(){return this.Zo}Ot(){return this.Ya}o_(t){this.Zo=t,this.__()}So(t){this.Ya=t,this.t_.So(t),this.n_.So(t),this.so.forEach(i=>{if(this.Nr(i)){const s=i.Bt();null!==s&&s.So(t)}}),this.__()}ya(){return this.so}Nr(t){const i=t.Bt();return null===i||this.t_!==i&&this.n_!==i}Lo(t,i,s){const e=void 0!==s?s:this.c_().u_+1;this.d_(t,i,e)}Io(t){const i=this.so.indexOf(t);S(-1!==i,"removeDataSource: invalid data source"),this.so.splice(i,1);const s=C(t.Bt()).Xe();if(this.Xo.has(s)){const i=y(this.Xo.get(s)),e=i.indexOf(t);-1!==e&&(i.splice(e,1),0===i.length&&this.Xo.delete(s))}const e=t.Bt();e&&e.ya().indexOf(t)>=0&&e.Io(t),null!==e&&(e.No(),this.f_(e)),this.eo=null}Or(t){return t===this.t_?"left":t===this.n_?"right":"overlay"}p_(){return this.t_}v_(){return this.n_}m_(t,i){t.Vo(i)}b_(t,i){t.zo(i),this.__()}g_(t){t.Fo()}w_(t,i){t.Wo(i)}M_(t,i){t.jo(i),this.__()}x_(t){t.$o()}__(){this.so.forEach(t=>{t.An()})}pn(){let t=null;return this.Ui.W().rightPriceScale.visible&&0!==this.n_.ya().length?t=this.n_:this.Ui.W().leftPriceScale.visible&&0!==this.t_.ya().length?t=this.t_:0!==this.so.length&&(t=this.so[0].Bt()),null===t&&(t=this.n_),t}Ir(){let t=null;return this.Ui.W().rightPriceScale.visible?t=this.n_:this.Ui.W().leftPriceScale.visible&&(t=this.t_),t}f_(t){null!==t&&t.mo()&&this.S_(t)}y_(t){const i=this.Jo.Vs();t.po({Wn:!0}),null!==i&&t.Yo(i),this.__()}k_(){this.S_(this.t_),this.S_(this.n_)}C_(){this.f_(this.t_),this.f_(this.n_),this.so.forEach(t=>{this.Nr(t)&&this.f_(t.Bt())}),this.__(),this.Ui.el()}Bo(){return null===this.eo&&(this.eo=ls(this.so)),this.eo}T_(){return this.Go}P_(){return this.Qo}S_(t){const i=t.Uo();if(i&&i.length>0&&!this.Jo.Fi()){const i=this.Jo.Vs();null!==i&&t.Yo(i)}t.An()}c_(){const t=this.Bo();if(0===t.length)return{R_:0,u_:0};let i=0,s=0;for(let e=0;e<t.length;e++){const n=t[e].Ki();null!==n&&(n<i&&(i=n),n>s&&(s=n))}return{R_:i,u_:s}}d_(t,i,s){let e=this.r_(i);if(null===e&&(e=this.i_(i,this.Ui.W().overlayPriceScales)),this.so.push(t),!vt(i)){const s=this.Xo.get(i)||[];s.push(t),this.Xo.set(i,s)}void 0!==t.vl&&"BrokenArea"===t.vl()||e.Lo(t),t.Ji(e),t.Gi(s),this.f_(e),this.eo=null}s_(t,i,s){i.Hr!==s.Hr&&this.S_(t)}i_(t,i){const s=Object.assign({visible:!0,autoScale:!0},A(i)),e=new ds(t,s,this.Ui.W().layout,this.Ui.W().localization);return e.So(this.Ot()),e}}const ps=t=>t.getUTCFullYear();class ms{constructor(t="yyyy-MM-dd",i="default"){this.D_=t,this.A_=i}B_(t){return function(t,i,s){return i.replace(/yyyy/g,(e=t,wt(ps(e),4))).replace(/yy/g,(t=>wt(ps(t)%100,2))(t)).replace(/MMMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"long"}))(t,s)).replace(/MMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"}))(t,s)).replace(/MM/g,(t=>wt(t.getUTCMonth()+1,2))(t)).replace(/dd/g,(t=>wt(t.getUTCDate(),2))(t));var e}(t,this.D_,this.A_)}}class gs{constructor(t){this.L_=t||"%h:%m:%s"}B_(t){return this.L_.replace("%h",wt(t.getUTCHours(),2)).replace("%m",wt(t.getUTCMinutes(),2)).replace("%s",wt(t.getUTCSeconds(),2))}}const vs={N_:"yyyy-MM-dd",I_:"%h:%m:%s",O_:" ",E_:"default"};class bs{constructor(t={}){const i=Object.assign(Object.assign({},vs),t);this.V_=new ms(i.N_,i.E_),this.z_=new gs(i.I_),this.F_=i.O_}B_(t){return`${this.V_.B_(t)}${this.F_}${this.z_.B_(t)}`}}class ws{constructor(t,i=50){this.vr=0,this.mr=1,this.br=1,this.wr=new Map,this.gr=new Map,this.W_=t,this.Mr=i}B_(t){const i=t.ut,s=void 0===i.j_?new Date(1e3*i.H_).getTime():new Date(Date.UTC(i.j_.year,i.j_.month-1,i.j_.day)).getTime(),e=this.wr.get(s);if(void 0!==e)return e.U_;if(this.vr===this.Mr){const t=this.gr.get(this.br);this.gr.delete(this.br),this.wr.delete(y(t)),this.br++,this.vr--}const n=this.W_(t);return this.wr.set(s,{U_:n,Cr:this.mr}),this.gr.set(this.mr,s),this.vr++,this.mr++,n}}class xs{constructor(t,i){S(t<=i,"right should be >= left"),this.Y_=t,this.q_=i}xs(){return this.Y_}di(){return this.q_}X_(){return this.q_-this.Y_+1}fh(t){return this.Y_<=t&&t<=this.q_}zh(t){return this.Y_===t.xs()&&this.q_===t.di()}}function Ms(t,i){return null===t||null===i?t===i:t.zh(i)}class Ss{constructor(){this.Z_=new Map,this.wr=null}K_(t,i){this.G_(i),this.wr=null;for(let s=i;s<t.length;++s){const i=t[s];let e=this.Z_.get(i.J_);void 0===e&&(e=[],this.Z_.set(i.J_,e)),e.push({Xs:s,ut:i.ut,Q_:i.J_,tu:i.tu})}}iu(t,i){const s=Math.ceil(i/t);return null!==this.wr&&this.wr.nu===s||(this.wr={Na:this.su(s),nu:s}),this.wr.Na}G_(t){if(0===t)return void this.Z_.clear();const i=[];this.Z_.forEach((s,e)=>{t<=s[0].Xs?i.push(e):s.splice(Bt(s,t,i=>i.Xs<t),1/0)});for(const s of i)this.Z_.delete(s)}su(t){let i=[];for(const s of Array.from(this.Z_.keys()).sort((t,i)=>i-t)){if(!this.Z_.get(s))continue;const e=i;i=[];const n=e.length;let h=0;const o=y(this.Z_.get(s)),r=o.length;let l=1/0,a=-1/0;for(let s=0;s<r;s++){const r=o[s],c=r.Xs;for(;h<n;){const t=e[h],s=t.Xs;if(!(s<c)){l=s;break}h++,i.push(t),a=s,l=1/0}l-c>=t&&c-a>=t&&(i.push(r),a=c)}for(;h<n;h++)i.push(e[h])}return i}}class ys{constructor(t){this.eu=t}ru(){return null===this.eu?null:new xs(Math.floor(this.eu.xs()),Math.ceil(this.eu.di()))}hu(){return this.eu}static lu(){return new ys(null)}}var Cs,_s,Vs,Ts,Ls;!function(t){t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.DayOfMonth=2]="DayOfMonth",t[t.Time=3]="Time",t[t.TimeWithSeconds=4]="TimeWithSeconds"}(Cs||(Cs={}));class ks{constructor(t,i,s){this.Zo=0,this.au=null,this.ou=[],this.lo=null,this.ho=null,this._u=new Ss,this.uu=new Map,this.cu=ys.lu(),this.du=!0,this.fu=new N,this.pu=new N,this.vu=new N,this.mu=null,this.bu=null,this.gu=[],this.cn=i,this.uo=s,this.wu=i.rightOffset,this.Mu=i.barSpacing,this.Ui=t,this.xu()}W(){return this.cn}Su(t){R(this.uo,t),this.yu(),this.xu()}sl(t,i){var s;R(this.cn,t),this.cn.fixLeftEdge&&this.ku(),this.cn.fixRightEdge&&this.Cu(),void 0!==t.barSpacing&&this.Ui.Gn(t.barSpacing),void 0!==t.rightOffset&&this.Ui.Jn(t.rightOffset),void 0!==t.minBarSpacing&&this.Ui.Gn(null!==(s=t.barSpacing)&&void 0!==s?s:this.Mu),this.yu(),this.xu(),this.vu.m()}mn(t){var i,s;return null!==(s=null===(i=this.ou[t])||void 0===i?void 0:i.ut)&&void 0!==s?s:null}Yi(t){var i;return null!==(i=this.ou[t])&&void 0!==i?i:null}xa(t,i){if(this.ou.length<1)return null;if(t.H_>this.ou[this.ou.length-1].ut.H_)return i?this.ou.length-1:null;const s=Bt(this.ou,t.H_,(t,i)=>t.ut.H_<i);return t.H_<this.ou[s].ut.H_?i?s:null:s}Fi(){return 0===this.Zo||0===this.ou.length||null===this.au}Ma(){return this.ou.length>0}Vs(){return this.Tu(),this.cu.ru()}Pu(){return this.Tu(),this.cu.hu()}Ru(){const t=this.Vs();if(null===t)return null;const i={from:t.xs(),to:t.di()};return this.Du(i)}Du(t){const i=Math.round(t.from),s=Math.round(t.to),e=C(this.Au()),n=C(this.Bu());return{from:C(this.mn(Math.max(e,i))),to:C(this.mn(Math.min(n,s)))}}Lu(t){return{from:C(this.xa(t.from,!0)),to:C(this.xa(t.to,!0))}}Hi(){return this.Zo}o_(t){if(!isFinite(t)||t<=0)return;if(this.Zo===t)return;const i=this.Pu(),s=this.Zo;if(this.Zo=t,this.du=!0,this.cn.lockVisibleTimeRangeOnResize&&0!==s){const i=this.Mu*t/s;this.Mu=i}if(this.cn.fixLeftEdge&&null!==i&&i.xs()<=0){const i=s-t;this.wu-=Math.round(i/this.Mu)+1,this.du=!0}this.Nu(),this.Iu()}Et(t){if(this.Fi()||!O(t))return 0;const i=this.qe()+this.wu-t;return this.Zo-(i+.5)*this.Mu-1}$s(t,i){const s=this.qe(),e=void 0===i?0:i.from,n=void 0===i?t.length:i.to;for(let h=e;h<n;h++){const i=t[h].ut,e=s+this.wu-i,n=this.Zo-(e+.5)*this.Mu-1;t[h].et=n}}$e(){return{He:this.Zo,Ue:this.wu,Ye:this.Mu}}Ou(t,i,s){const e=this.qe(),n=void 0===s?0:s.from,h=void 0===s?t.length:s.to;for(let o=n;o<h;o++){const s=t[o].ut;let n=e+this.wu-s,h=this.Zo-(n+.5)*this.Mu-1;t[o].et=Math.round(h),void 0!==t[o].Xe&&i[t[o].Xe]?(n=e+this.wu-i[t[o].Xe],h=this.Zo-(n+.5)*this.Mu-1,t[o].De=Math.round(h)):t[o].De=this.Zo}}Eu(t){return Math.ceil(this.Vu(t))}Jn(t){this.du=!0,this.wu=t,this.Iu(),this.Ui.zu(),this.Ui.el()}Gs(){return this.Mu}Gn(t){this.Fu(t),this.Iu(),this.Ui.zu(),this.Ui.el()}Wu(){return this.wu}Na(){if(this.Fi())return null;if(null!==this.bu)return this.bu;const t=this.Mu,i=5*(this.Ui.W().layout.fontSize+4),s=Math.round(i/t),e=C(this.Vs()),n=Math.max(e.xs(),e.xs()-s),h=Math.max(e.di(),e.di()-s),o=this._u.iu(t,i),r=this.Au()+s,l=this.Bu()-s,a=this.ju(),c=this.cn.fixLeftEdge||a,u=this.cn.fixRightEdge||a;let d=0;for(const f of o){if(!(n<=f.Xs&&f.Xs<=h))continue;let t;d<this.gu.length?(t=this.gu[d],t.Ra=this.Et(f.Xs),t.Ce=this.$u(f),t.Q_=f.Q_):(t={Hu:!1,Ra:this.Et(f.Xs),Ce:this.$u(f),Q_:f.Q_},this.gu.push(t)),this.Mu>i/2&&!a?t.Hu=!1:t.Hu=c&&f.Xs<=r||u&&f.Xs>=l,d++}return this.gu.length=d,this.bu=this.gu,this.gu}Uu(){this.du=!0,this.Gn(this.cn.barSpacing),this.Jn(this.cn.rightOffset)}Yu(t){this.du=!0,this.au=t,this.Iu(),this.ku()}qu(t,i){const s=this.Vu(t),e=this.Gs(),n=e+i*(e/10);this.Gn(n),this.cn.rightBarStaysOnScroll||this.Jn(this.Wu()+(s-this.Vu(t)))}Vo(t){this.lo&&this.$o(),null===this.ho&&null===this.mu&&(this.Fi()||(this.ho=t,this.Xu()))}zo(t){if(null===this.mu)return;const i=Jt(this.Zo-t,0,this.Zo),s=Jt(this.Zo-C(this.ho),0,this.Zo);0!==i&&0!==s&&this.Gn(this.mu.Gs*i/s)}Fo(){null!==this.ho&&(this.ho=null,this.Zu())}Wo(t){null===this.lo&&null===this.mu&&(this.Fi()||(this.lo=t,this.Xu()))}jo(t){if(null===this.lo)return;const i=(this.lo-t)/this.Gs();this.wu=C(this.mu).Wu+i,this.du=!0,this.Iu()}$o(){null!==this.lo&&(this.lo=null,this.Zu())}Ku(){this.Gu(this.cn.rightOffset)}Gu(t,i=400){if(!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const s=this.wu,e=performance.now();this.Ui.Xn({Ju:t=>(t-e)/i>=1,Qu:n=>{const h=(n-e)/i;return h>=1?t:s+(t-s)*h}})}wt(t,i){this.du=!0,this.ou=t,this._u.K_(t,i),this.Iu()}tc(){return this.fu}ic(){return this.pu}nc(){return this.vu}qe(){return this.au||0}sc(t){const i=t.X_();this.Fu(this.Zo/i),this.wu=t.di()-this.qe(),this.Iu(),this.du=!0,this.Ui.zu(),this.Ui.el()}ec(){const t=this.Au(),i=this.Bu();null!==t&&null!==i&&this.sc(new xs(t,i+this.cn.rightOffset))}rc(t){const i=new xs(t.from,t.to);this.sc(i)}qi(t){return void 0!==this.uo.timeFormatter?this.uo.timeFormatter(t.tu):this.hc.B_(new Date(1e3*t.ut.H_))}ju(){const{handleScroll:t,handleScale:i}=this.Ui.W();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||i.axisDoubleClickReset.time||i.axisPressedMouseMove.time||i.mouseWheel||i.pinch)}Au(){return 0===this.ou.length?null:0}Bu(){return 0===this.ou.length?null:this.ou.length-1}lc(t){return(this.Zo-1-t)/this.Mu}Vu(t){const i=this.lc(t),s=this.qe()+this.wu-i;return Math.round(1e6*s)/1e6}Fu(t){const i=this.Mu;this.Mu=t,this.Nu(),i!==this.Mu&&(this.du=!0,this.ac())}Tu(){if(!this.du)return;if(this.du=!1,this.Fi())return void this.oc(ys.lu());const t=this.qe(),i=this.Zo/this.Mu,s=this.wu+t,e=new xs(s-i+1,s);this.oc(new ys(e))}Nu(){const t=this._c();if(this.Mu<t&&(this.Mu=t,this.du=!0),0!==this.Zo){const t=.5*this.Zo;this.Mu>t&&(this.Mu=t,this.du=!0)}}_c(){return this.cn.fixLeftEdge&&this.cn.fixRightEdge&&0!==this.ou.length?this.Zo/this.ou.length:this.cn.minBarSpacing}Iu(){const t=this.uc();this.wu>t&&(this.wu=t,this.du=!0);const i=this.cc();null!==i&&this.wu<i&&(this.wu=i,this.du=!0)}cc(){const t=this.Au(),i=this.au;return null===t||null===i?null:t-i-1+(this.cn.fixLeftEdge?this.Zo/this.Mu:Math.min(2,this.ou.length))}uc(){return this.cn.fixRightEdge?0:this.Zo/this.Mu-Math.min(2,this.ou.length)}Xu(){this.mu={Gs:this.Gs(),Wu:this.Wu()}}Zu(){this.mu=null}$u(t){let i=this.uu.get(t.Q_);return void 0===i&&(i=new ws(t=>this.dc(t)),this.uu.set(t.Q_,i)),i.B_(t)}dc(t){const i=function(t,i,s){switch(t){case 0:case 10:return i?s?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return i?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.Q_,this.cn.timeVisible,this.cn.secondsVisible);if(void 0!==this.cn.tickMarkFormatter){const s=this.cn.tickMarkFormatter(t.tu,i,this.uo.locale);if(null!==s)return s}return function(t,i,s){const e={};switch(i){case 0:e.year="numeric";break;case 1:e.month="short";break;case 2:e.day="numeric";break;case 3:e.hour12=!1,e.hour="2-digit",e.minute="2-digit";break;case 4:e.hour12=!1,e.hour="2-digit",e.minute="2-digit",e.second="2-digit"}const n=void 0===t.j_?new Date(1e3*t.H_):new Date(Date.UTC(t.j_.year,t.j_.month-1,t.j_.day));return new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.getUTCMilliseconds()).toLocaleString(s,e)}(t.ut,i,this.uo.locale)}oc(t){const i=this.cu;this.cu=t,Ms(i.ru(),this.cu.ru())||this.fu.m(),Ms(i.hu(),this.cu.hu())||this.pu.m(),this.ac()}ac(){this.bu=null}yu(){this.ac(),this.uu.clear()}xu(){const t=this.uo.dateFormat;this.cn.timeVisible?this.hc=new bs({N_:t,I_:this.cn.secondsVisible?"%h:%m:%s":"%h:%m",O_:"   ",E_:this.uo.locale}):this.hc=new ms(t,this.uo.locale)}ku(){if(!this.cn.fixLeftEdge)return;const t=this.Au();if(null===t)return;const i=this.Vs();if(null===i)return;const s=i.xs()-t;if(s<0){const t=this.wu-s-1;this.Jn(t)}this.Nu()}Cu(){this.Iu(),this.Nu()}}class Es extends H{constructor(t){super(),this.fc=new Map,this.Vt=t}K(t){}J(t){if(!this.Vt.Tt)return;const{context:i,mediaSize:s}=t;let e=0;for(const h of this.Vt.vc){if(0===h.Jt.length)continue;i.font=h.R;const t=this.mc(i,h.Jt);t>s.width?h.qu=s.width/t:h.qu=1,e+=h.bc*h.qu}let n=0;switch(this.Vt.gc){case"top":n=0;break;case"center":n=Math.max((s.height-e)/2,0);break;case"bottom":n=Math.max(s.height-e,0)}i.fillStyle=this.Vt.A;for(const h of this.Vt.vc){i.save();let t=0;switch(this.Vt.wc){case"left":i.textAlign="left",t=h.bc/2;break;case"center":i.textAlign="center",t=s.width/2;break;case"right":i.textAlign="right",t=s.width-1-h.bc/2}i.translate(t,n),i.textBaseline="top",i.font=h.R,i.scale(h.qu,h.qu),i.fillText(h.Jt,0,h.Mc),i.restore(),n+=h.bc*h.qu}}mc(t,i){const s=this.xc(t.font);let e=s.get(i);return void 0===e&&(e=t.measureText(i).width,s.set(i,e)),e}xc(t){let i=this.fc.get(t);return void 0===i&&(i=new Map,this.fc.set(t,i)),i}}class zs{constructor(t){this.bt=!0,this.jt={Tt:!1,A:"",vc:[],gc:"center",wc:"center"},this.$t=new Es(this.jt),this.Ht=t}wt(){this.bt=!0}xt(){return this.bt&&(this.St(),this.bt=!1),this.$t}St(){const t=this.Ht.W(),i=this.jt;i.Tt=t.visible,i.Tt&&(i.A=t.color,i.wc=t.horzAlign,i.gc=t.vertAlign,i.vc=[{Jt:t.text,R:J(t.fontSize,t.fontFamily,t.fontStyle),bc:1.2*t.fontSize,Mc:0,qu:0}])}}class Ps extends pt{constructor(t,i){super(),this.cn=i,this.gn=new zs(this)}Rn(){return[]}Pn(){return[this.gn]}W(){return this.cn}An(){this.gn.wt()}}!function(t){t[t.OnTouchEnd=0]="OnTouchEnd",t[t.OnNextTap=1]="OnNextTap"}(_s||(_s={}));class Ws{constructor(t,i){this.Sc=[],this.yc=[],this.Zo=0,this.kc=null,this.Cc=new N,this.Tc=new N,this.Pc=null,this.Rc=t,this.cn=i,this.Dc=new D(this),this.Jo=new ks(this,i.timeScale,this.cn.localization),this.gt=new gt(this,i.crosshair),this.Ac=new ss(i.crosshair),this.Bc=new Ps(this,i.watermark),this.Lc(),this.Sc[0].a_(2e3),this.Nc=this.Ic(0),this.Oc=this.Ic(1)}ql(){this.Ec(bt.es())}el(){this.Ec(bt.ss())}oa(){this.Ec(new bt(1))}Xl(t){const i=this.Vc(t);this.Ec(i)}zc(){return this.kc}Fc(t){const i=this.kc;this.kc=t,null!==i&&this.Xl(i.Wc),null!==t&&this.Xl(t.Wc)}W(){return this.cn}sl(t){R(this.cn,t),this.Sc.forEach(i=>i.e_(t)),void 0!==t.timeScale&&this.Jo.sl(t.timeScale),void 0!==t.localization&&this.Jo.Su(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.Cc.m(),this.Nc=this.Ic(0),this.Oc=this.Ic(1),this.ql()}jc(t,i){if("left"===t)return void this.sl({leftPriceScale:i});if("right"===t)return void this.sl({rightPriceScale:i});const s=this.$c(t);null!==s&&(s.Bt.sl(i),this.Cc.m())}$c(t){for(const i of this.Sc){const s=i.r_(t);if(null!==s)return{Ut:i,Bt:s}}return null}kt(){return this.Jo}Hc(){return this.Sc}Uc(){return this.Bc}Yc(){return this.gt}qc(){return this.Tc}Xc(t,i){t.So(i),this.zu()}o_(t){this.Zo=t,this.Jo.o_(this.Zo),this.Sc.forEach(i=>i.o_(t)),this.zu()}Lc(t){const i=new fs(this.Jo,this);void 0!==t?this.Sc.splice(t,0,i):this.Sc.push(i);const s=void 0===t?this.Sc.length-1:t,e=bt.es();return e.zn(s,{Fn:0,Wn:!0}),this.Ec(e),i}m_(t,i,s){t.m_(i,s)}b_(t,i,s){t.b_(i,s),this.Zc(),this.Ec(this.Kc(t,2))}g_(t,i){t.g_(i),this.Ec(this.Kc(t,2))}w_(t,i,s){i.mo()||t.w_(i,s)}M_(t,i,s){i.mo()||(t.M_(i,s),this.Zc(),this.Ec(this.Kc(t,2)))}x_(t,i){i.mo()||(t.x_(i),this.Ec(this.Kc(t,2)))}y_(t,i){t.y_(i),this.Ec(this.Kc(t,2))}Gc(t){this.Jo.Vo(t)}Jc(t,i){const s=this.kt();if(s.Fi()||0===i)return;const e=s.Hi();t=Math.max(1,Math.min(t,e)),s.qu(t,i),this.zu()}Qc(t){this.td(0),this.nd(t),this.sd()}ed(t){this.Jo.zo(t),this.zu()}rd(){this.Jo.Fo(),this.el()}td(t){this.Jo.Wo(t)}nd(t){this.Jo.jo(t),this.zu()}sd(){this.Jo.$o(),this.el()}Mt(){return this.yc}hd(t,i,s,e){this.gt.wn(t,i);let n=NaN,h=this.Jo.Eu(t);const o=this.Jo.Vs();null!==o&&(h=Math.min(Math.max(o.xs(),h),o.di()));const r=e.pn(),l=r.Pt();null!==l&&(n=r.vn(i,l)),n=this.Ac.Sa(n,h,e),this.gt.yn(h,n,e),this.oa(),this.Tc.m(this.gt.yt(),{x:t,y:i},s)}ld(){this.Yc().Cn(),this.oa(),this.Tc.m(null,null,null)}Zc(){const t=this.gt.Ut();if(null!==t){const i=this.gt.xn(),s=this.gt.Sn();this.hd(i,s,null,t)}this.gt.An()}ad(t,i,s){const e=this.Jo.mn(0);void 0!==i&&void 0!==s&&this.Jo.wt(i,s);const n=this.Jo.mn(0),h=this.Jo.qe(),o=this.Jo.Vs();if(null!==o&&null!==e&&null!==n){const i=o.fh(h),s=e.H_>n.H_,r=null!==t&&t>h&&!s,l=i&&this.Jo.W().shiftVisibleRangeOnNewBar;if(r&&!l){const i=t-h;this.Jo.Jn(this.Jo.Wu()-i)}}this.Jo.Yu(t)}Gl(t){null!==t&&t.C_()}Lr(t){const i=this.Sc.find(i=>i.Bo().includes(t));return void 0===i?null:i}zu(){this.Bc.An(),this.Sc.forEach(t=>t.C_())}S(){this.Sc.forEach(t=>t.S()),this.Sc.length=0,this.cn.localization.priceFormatter=void 0,this.cn.localization.timeFormatter=void 0}od(){return this.Dc}Er(){return this.Dc.W()}h_(){return this.Cc}_d(t,i){const s=this.Sc[0],e=this.ud(i,t,s);return this.yc.push(e),1===this.yc.length?this.ql():this.el(),e}dd(t){const i=this.Lr(t),s=this.yc.indexOf(t);S(-1!==s,"Series not found"),this.yc.splice(s,1),C(i).Io(t),t.S&&t.S()}Yl(t,i){const s=C(this.Lr(t));s.Io(t);const e=this.$c(i);if(null===e){const e=t.Ki();s.Lo(t,i,e)}else{const n=e.Ut===s?t.Ki():void 0;e.Ut.Lo(t,i,n)}}ec(){const t=bt.ss();t.Hn(),this.Ec(t)}fd(t){const i=bt.ss();i.qn(t),this.Ec(i)}Kn(){const t=bt.ss();t.Kn(),this.Ec(t)}Gn(t){const i=bt.ss();i.Gn(t),this.Ec(i)}Jn(t){const i=bt.ss();i.Jn(t),this.Ec(i)}Xn(t){const i=bt.ss();i.Xn(t),this.Ec(i)}Un(){const t=bt.ss();t.Un(),this.Ec(t)}pd(){return this.cn.rightPriceScale.visible?"right":"left"}vd(){return this.Oc}Y(){return this.Nc}It(t){const i=this.Oc,s=this.Nc;if(i===s)return i;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this.Pc||this.Pc.gs!==s||this.Pc.ws!==i)this.Pc={gs:s,ws:i,md:new Map};else{const i=this.Pc.md.get(t);if(void 0!==i)return i}const e=function(t,i,s){const[e,n,h,o]=W(t),[r,l,a,c]=W(i),u=[T(e+s*(r-e)),T(n+s*(l-n)),T(h+s*(a-h)),L(o+s*(c-o))];return`rgba(${u[0]}, ${u[1]}, ${u[2]}, ${u[3]})`}(s,i,t/100);return this.Pc.md.set(t,e),e}bd(t,i,s,e){this.gt.wn(t,NaN);let n=this.Jo.Eu(t),h=NaN;const o=this.Jo.Vs();null!==o&&(n=Math.min(Math.max(o.xs(),n),o.di()));const r=e.pn(),l=r.Pt();null!==l&&(h=r.vn(i,l)),h=this.Ac.Sa(h,n,e),this.gt.yn(n,h,e),this.oa(),s&&this.Tc.m(this.gt.yt(),{x:t,y:i},null)}Kc(t,i){const s=new bt(i);if(null!==t){const e=this.Sc.indexOf(t);s.zn(e,{Fn:i})}return s}Vc(t,i){return void 0===i&&(i=2),this.Kc(this.Lr(t),i)}Ec(t){this.Rc&&this.Rc(t),this.Sc.forEach(t=>t.P_().rl().wt())}ud(t,i,s){const e=new is(this,t,i),n=void 0!==t.priceScaleId?t.priceScaleId:this.pd();return s.Lo(e,n),vt(n)||e.sl(t),e}Ic(t){const i=this.cn.layout;return"gradient"===i.background.type?0===t?i.background.topColor:i.background.bottomColor:i.background.color}}function Bs(t){return!F(t)&&!Y(t)}function Ns(t){return F(t)}!function(t){t[t.Disabled=0]="Disabled",t[t.Continuous=1]="Continuous",t[t.OnDataUpdate=2]="OnDataUpdate"}(Vs||(Vs={})),function(t){t[t.LastBar=0]="LastBar",t[t.LastVisible=1]="LastVisible"}(Ts||(Ts={})),function(t){t.Solid="solid",t.VerticalGradient="gradient"}(Ls||(Ls={}));const Rs="undefined"!=typeof window;function Fs(){return!!Rs&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function Os(){return!!Rs&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function Ys(t){return t+t%2}function $s(t,i){return t.gd-i.gd}function As(t,i,s){const e=(t.gd-i.gd)/(t.ut-i.ut);return Math.sign(e)*Math.min(Math.abs(e),s)}class Us{constructor(t,i,s,e){this.wd=null,this.Md=null,this.xd=null,this.Sd=null,this.yd=null,this.kd=0,this.Cd=0,this.Td=t,this.Pd=i,this.Rd=s,this.rs=e}Dd(t,i){if(null!==this.wd){if(this.wd.ut===i)return void(this.wd.gd=t);if(Math.abs(this.wd.gd-t)<this.rs)return}this.Sd=this.xd,this.xd=this.Md,this.Md=this.wd,this.wd={ut:i,gd:t}}Zr(t,i){if(null===this.wd||null===this.Md)return;if(i-this.wd.ut>50)return;let s=0;const e=As(this.wd,this.Md,this.Pd),n=$s(this.wd,this.Md),h=[e],o=[n];if(s+=n,null!==this.xd){const t=As(this.Md,this.xd,this.Pd);if(Math.sign(t)===Math.sign(e)){const i=$s(this.Md,this.xd);if(h.push(t),o.push(i),s+=i,null!==this.Sd){const t=As(this.xd,this.Sd,this.Pd);if(Math.sign(t)===Math.sign(e)){const i=$s(this.xd,this.Sd);h.push(t),o.push(i),s+=i}}}}let r=0;for(let l=0;l<h.length;++l)r+=o[l]/s*h[l];Math.abs(r)<this.Td||(this.yd={gd:t,ut:i},this.Cd=r,this.kd=function(t,i){const s=Math.log(i);return Math.log(1*s/-t)/s}(Math.abs(r),this.Rd))}Qu(t){const i=C(this.yd),s=t-i.ut;return i.gd+this.Cd*(Math.pow(this.Rd,s)-1)/Math.log(this.Rd)}Ju(t){return null===this.yd||this.Ad(t)===this.kd}Ad(t){const i=t-C(this.yd).ut;return Math.min(i,this.kd)}}function Is(t,i){const s=C(t.ownerDocument).createElement("canvas");t.appendChild(s);const e=function(t,i){if("device-pixel-content-box"===i.type)return new f(t,i.transform,i.options);throw new Error("Unsupported binding target")}(s,{type:"device-pixel-content-box",options:{allowResizeObserver:!1},transform:(t,i)=>({width:Math.max(t.width,i.width),height:Math.max(t.height,i.height)})});return e.resizeCanvasElement(i),e}class Xs{constructor(t,i,s){this.Bd=0,this.Ld=null,this.Nd={et:Number.NEGATIVE_INFINITY,rt:Number.POSITIVE_INFINITY},this.Id=0,this.Od=null,this.Ed={et:Number.NEGATIVE_INFINITY,rt:Number.POSITIVE_INFINITY},this.Vd=null,this.zd=!1,this.Fd=null,this.Wd=null,this.jd=!1,this.$d=!1,this.Hd=!1,this.Ud=null,this.Yd=null,this.qd=null,this.Xd=null,this.Zd=null,this.Kd=null,this.Gd=null,this.Jd=0,this.Qd=!1,this.tf=!1,this.if=!1,this.nf=0,this.sf=null,this.ef=!Os(),this.rf=t=>{this.hf(t)},this.lf=t=>{if(this.af(t)){const i=this._f(t);if(++this.Id,this.Od&&this.Id>1){const{uf:s}=this.cf(js(t),this.Ed);s<30&&!this.Hd&&this.df(i,this.pf.ff),this.vf()}}else{const i=this._f(t);if(++this.Bd,this.Ld&&this.Bd>1){const{uf:s}=this.cf(js(t),this.Nd);s<5&&!this.$d&&this.mf(i,this.pf.bf),this.gf()}}},this.wf=t,this.pf=i,this.cn=s,this.Mf()}S(){null!==this.Ud&&(this.Ud(),this.Ud=null),null!==this.Yd&&(this.Yd(),this.Yd=null),null!==this.Xd&&(this.Xd(),this.Xd=null),null!==this.Zd&&(this.Zd(),this.Zd=null),null!==this.Kd&&(this.Kd(),this.Kd=null),null!==this.qd&&(this.qd(),this.qd=null),this.xf(),this.gf()}Sf(t){this.Xd&&this.Xd();const i=this.yf.bind(this);if(this.Xd=()=>{this.wf.removeEventListener("mousemove",i)},this.wf.addEventListener("mousemove",i),this.af(t))return;const s=this._f(t);this.mf(s,this.pf.kf),this.ef=!0}gf(){null!==this.Ld&&clearTimeout(this.Ld),this.Bd=0,this.Ld=null,this.Nd={et:Number.NEGATIVE_INFINITY,rt:Number.POSITIVE_INFINITY}}vf(){null!==this.Od&&clearTimeout(this.Od),this.Id=0,this.Od=null,this.Ed={et:Number.NEGATIVE_INFINITY,rt:Number.POSITIVE_INFINITY}}yf(t){if(this.if||null!==this.Wd)return;if(this.af(t))return;const i=this._f(t);this.mf(i,this.pf.Cf),this.ef=!0}Tf(t){const i=Zs(t.changedTouches,C(this.sf));if(null===i)return;if(this.nf=Hs(t),null!==this.Gd)return;if(this.tf)return;this.Qd=!0;const s=this.cf(js(i),C(this.Wd)),{Pf:e,Rf:n,uf:h}=s;if(this.jd||!(h<5)){if(!this.jd){const t=.5*e,i=n>=t&&!this.cn.Df(),s=t>n&&!this.cn.Af();i||s||(this.tf=!0),this.jd=!0,this.Hd=!0,this.xf(),this.vf()}if(!this.tf){const s=this._f(t,i);this.df(s,this.pf.Bf),Ds(t)}}}Lf(t){if(0!==t.button)return;const i=this.cf(js(t),C(this.Fd)),{uf:s}=i;if(s>=5&&(this.$d=!0,this.gf()),this.$d){const i=this._f(t);this.mf(i,this.pf.Nf)}}cf(t,i){const s=Math.abs(i.et-t.et),e=Math.abs(i.rt-t.rt);return{Pf:s,Rf:e,uf:s+e}}If(t){let i=Zs(t.changedTouches,C(this.sf));if(null===i&&0===t.touches.length&&(i=t.changedTouches[0]),null===i)return;this.sf=null,this.nf=Hs(t),this.xf(),this.Wd=null,this.Kd&&(this.Kd(),this.Kd=null);const s=this._f(t,i);if(this.df(s,this.pf.Of),++this.Id,this.Od&&this.Id>1){const{uf:t}=this.cf(js(i),this.Ed);t<30&&!this.Hd&&this.df(s,this.pf.ff),this.vf()}else this.Hd||(this.df(s,this.pf.Ef),this.pf.Ef&&Ds(t));0===this.Id&&Ds(t),0===t.touches.length&&this.zd&&(this.zd=!1,Ds(t))}hf(t){if(0!==t.button)return;const i=this._f(t);if(this.Fd=null,this.if=!1,this.Zd&&(this.Zd(),this.Zd=null),Fs()&&this.wf.ownerDocument.documentElement.removeEventListener("mouseleave",this.rf),!this.af(t))if(this.mf(i,this.pf.Vf),++this.Bd,this.Ld&&this.Bd>1){const{uf:s}=this.cf(js(t),this.Nd);s<5&&!this.$d&&this.mf(i,this.pf.bf),this.gf()}else this.$d||this.mf(i,this.pf.zf)}xf(){null!==this.Vd&&(clearTimeout(this.Vd),this.Vd=null)}Ff(t){if(null!==this.sf)return;const i=t.changedTouches[0];this.sf=i.identifier,this.nf=Hs(t);const s=this.wf.ownerDocument.documentElement;this.Hd=!1,this.jd=!1,this.tf=!1,this.Wd=js(i),this.Kd&&(this.Kd(),this.Kd=null);{const i=this.Tf.bind(this),e=this.If.bind(this);this.Kd=()=>{s.removeEventListener("touchmove",i),s.removeEventListener("touchend",e)},s.addEventListener("touchmove",i,{passive:!1}),s.addEventListener("touchend",e,{passive:!1}),this.xf(),this.Vd=setTimeout(this.Wf.bind(this,t),240)}const e=this._f(t,i);this.df(e,this.pf.jf),this.Od||(this.Id=0,this.Od=setTimeout(this.vf.bind(this),500),this.Ed=js(i))}$f(t){if(0!==t.button)return;const i=this.wf.ownerDocument.documentElement;Fs()&&i.addEventListener("mouseleave",this.rf),this.$d=!1,this.Fd=js(t),this.Zd&&(this.Zd(),this.Zd=null);{const t=this.Lf.bind(this),s=this.hf.bind(this);this.Zd=()=>{i.removeEventListener("mousemove",t),i.removeEventListener("mouseup",s)},i.addEventListener("mousemove",t),i.addEventListener("mouseup",s)}if(this.if=!0,this.af(t))return;const s=this._f(t);this.mf(s,this.pf.Hf),this.Ld||(this.Bd=0,this.Ld=setTimeout(this.gf.bind(this),500),this.Nd=js(t))}Mf(){this.wf.addEventListener("mouseenter",this.Sf.bind(this)),this.wf.addEventListener("touchcancel",this.xf.bind(this));{const t=this.wf.ownerDocument,i=t=>{this.pf.Uf&&(t.composed&&this.wf.contains(t.composedPath()[0])||t.target&&this.wf.contains(t.target)||this.pf.Uf())};this.Yd=()=>{t.removeEventListener("touchstart",i)},this.Ud=()=>{t.removeEventListener("mousedown",i)},t.addEventListener("mousedown",i),t.addEventListener("touchstart",i,{passive:!0})}Os()&&(this.qd=()=>{this.wf.removeEventListener("dblclick",this.lf)},this.wf.addEventListener("dblclick",this.lf)),this.wf.addEventListener("mouseleave",this.Yf.bind(this)),this.wf.addEventListener("touchstart",this.Ff.bind(this),{passive:!0}),function(t){Rs&&void 0!==window.chrome&&t.addEventListener("mousedown",t=>{if(1===t.button)return t.preventDefault(),!1})}(this.wf),this.wf.addEventListener("mousedown",this.$f.bind(this)),this.qf(),this.wf.addEventListener("touchmove",()=>{},{passive:!1})}qf(){void 0===this.pf.Xf&&void 0===this.pf.Zf&&void 0===this.pf.Kf||(this.wf.addEventListener("touchstart",t=>this.Gf(t.touches),{passive:!0}),this.wf.addEventListener("touchmove",t=>{if(2===t.touches.length&&null!==this.Gd&&void 0!==this.pf.Zf){const i=Js(t.touches[0],t.touches[1])/this.Jd;this.pf.Zf(this.Gd,i),Ds(t)}},{passive:!1}),this.wf.addEventListener("touchend",t=>{this.Gf(t.touches)}))}Gf(t){1===t.length&&(this.Qd=!1),2!==t.length||this.Qd||this.zd?this.Jf():this.Qf(t)}Qf(t){const i=this.wf.getBoundingClientRect()||{left:0,top:0};this.Gd={et:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,rt:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.Jd=Js(t[0],t[1]),void 0!==this.pf.Xf&&this.pf.Xf(),this.xf()}Jf(){null!==this.Gd&&(this.Gd=null,void 0!==this.pf.Kf&&this.pf.Kf())}Yf(t){if(this.Xd&&this.Xd(),this.af(t))return;if(!this.ef)return;const i=this._f(t);this.mf(i,this.pf.tp),this.ef=!Os()}Wf(t){const i=Zs(t.touches,C(this.sf));if(null===i)return;const s=this._f(t,i);this.df(s,this.pf.ip),this.Hd=!0,this.zd=!0}af(t){return t.sourceCapabilities&&void 0!==t.sourceCapabilities.firesTouchEvents?t.sourceCapabilities.firesTouchEvents:Hs(t)<this.nf+500}df(t,i){i&&i.call(this.pf,t)}mf(t,i){i&&i.call(this.pf,t)}_f(t,i){const s=i||t,e=this.wf.getBoundingClientRect()||{left:0,top:0};return{clientX:s.clientX,clientY:s.clientY,pageX:s.pageX,pageY:s.pageY,screenX:s.screenX,screenY:s.screenY,localX:s.clientX-e.left,localY:s.clientY-e.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,np:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,sp:t.type,ep:s.target,rp:t.view,hp:()=>{"touchstart"!==t.type&&Ds(t)}}}}function Js(t,i){const s=t.clientX-i.clientX,e=t.clientY-i.clientY;return Math.sqrt(s*s+e*e)}function Ds(t){t.cancelable&&t.preventDefault()}function js(t){return{et:t.pageX,rt:t.pageY}}function Hs(t){return t.timeStamp||performance.now()}function Zs(t,i){for(let s=0;s<t.length;++s)if(t[s].identifier===i)return t[s];return null}class Gs{constructor(t,i,s,e){this.Vi=null,this.lp=null,this.ap=!1,this.op=new ai(200),this.mh=null,this._p=0,this.up=!1,this.cp=()=>{this.up||this.nn.dp().Yt().el()},this.fp=()=>{this.up||this.nn.dp().Yt().el()},this.nn=t,this.cn=i,this._o=i.layout,this.Dc=s,this.pp="left"===e,this.vp=document.createElement("div"),this.vp.style.height="100%",this.vp.style.overflow="hidden",this.vp.style.width="25px",this.vp.style.left="0",this.vp.style.position="relative",this.mp=Is(this.vp,c({width:16,height:16})),this.mp.subscribeSuggestedBitmapSizeChanged(this.cp);const n=this.mp.canvasElement;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this.bp=Is(this.vp,c({width:16,height:16})),this.bp.subscribeSuggestedBitmapSizeChanged(this.fp);const h=this.bp.canvasElement;h.style.position="absolute",h.style.zIndex="2",h.style.left="0",h.style.top="0";const o={Hf:this.gp.bind(this),jf:this.gp.bind(this),Nf:this.wp.bind(this),Bf:this.wp.bind(this),Uf:this.Mp.bind(this),Vf:this.xp.bind(this),Of:this.xp.bind(this),bf:this.Sp.bind(this),ff:this.Sp.bind(this),kf:this.yp.bind(this),tp:this.kp.bind(this)};this.Cp=new Xs(this.bp.canvasElement,o,{Df:()=>!1,Af:()=>!0})}S(){this.Cp.S(),this.bp.unsubscribeSuggestedBitmapSizeChanged(this.fp),this.bp.dispose(),this.mp.unsubscribeSuggestedBitmapSizeChanged(this.cp),this.mp.dispose(),null!==this.Vi&&this.Vi.Eo().v(this),this.Vi=null}Tp(){return this.vp}P(){return this._o.fontSize}Pp(){const t=this.Dc.W();return this.mh!==t.R&&(this.op.Sr(),this.mh=t.R),t}Rp(){if(null===this.Vi)return 0;let t=0;const i=this.Pp(),s=C(this.mp.canvasElement.getContext("2d"));s.save();const e=this.Vi.Na();s.font=this.Dp(),e.length>0&&(t=Math.max(this.op.Si(s,e[0].Ce),this.op.Si(s,e[e.length-1].Ce)));const n=this.Ap();for(let r=n.length;r--;){const i=this.op.Si(s,n[r].Jt());i>t&&(t=i)}const h=this.Vi.Pt();if(null!==h&&null!==this.lp){const i=this.Vi.vn(1,h),e=this.Vi.vn(this.lp.height-2,h);t=Math.max(t,this.op.Si(s,this.Vi.Wi(Math.floor(Math.min(i,e))+.11111111111111,h)),this.op.Si(s,this.Vi.Wi(Math.ceil(Math.max(i,e))-.11111111111111,h)))}s.restore();const o=t||34;return Ys(Math.ceil(i.C+i.T+i.N+i.I+5+o))}Bp(t){null!==this.lp&&u(this.lp,t)||(this.lp=t,this.up=!0,this.mp.resizeCanvasElement(t),this.bp.resizeCanvasElement(t),this.up=!1,this.vp.style.width=`${t.width}px`,this.vp.style.height=`${t.height}px`)}Lp(){return C(this.lp).width}Ji(t){this.Vi!==t&&(null!==this.Vi&&this.Vi.Eo().v(this),this.Vi=t,t.Eo().l(this.io.bind(this),this))}Bt(){return this.Vi}Sr(){const t=this.nn.Np();this.nn.dp().Yt().y_(t,C(this.Bt()))}Ip(t){if(null===this.lp)return;if(1!==t){this.Op(),this.mp.applySuggestedBitmapSize();const t=w(this.mp);null!==t&&(t.useBitmapCoordinateSpace(t=>{this.Ep(t),this.Ge(t)}),this.Vp(t),this.zp(t))}this.bp.applySuggestedBitmapSize();const i=w(this.bp);null!==i&&(i.useBitmapCoordinateSpace(({context:t,bitmapSize:i})=>{t.clearRect(0,0,i.width,i.height)}),this.Fp(i))}Wp(){return this.mp.bitmapSize}jp(t,i,s){const e=this.Wp();e.width>0&&e.height>0&&t.drawImage(this.mp.canvasElement,i,s)}wt(){var t;null===(t=this.Vi)||void 0===t||t.Na()}gp(t){if(null===this.Vi||this.Vi.Fi()||!this.cn.handleScale.axisPressedMouseMove.price)return;const i=this.nn.dp().Yt(),s=this.nn.Np();this.ap=!0,i.m_(s,this.Vi,t.localY)}wp(t){if(null===this.Vi||!this.cn.handleScale.axisPressedMouseMove.price)return;const i=this.nn.dp().Yt(),s=this.nn.Np(),e=this.Vi;i.b_(s,e,t.localY)}Mp(){if(null===this.Vi||!this.cn.handleScale.axisPressedMouseMove.price)return;const t=this.nn.dp().Yt(),i=this.nn.Np(),s=this.Vi;this.ap&&(this.ap=!1,t.g_(i,s))}xp(t){if(null===this.Vi||!this.cn.handleScale.axisPressedMouseMove.price)return;const i=this.nn.dp().Yt(),s=this.nn.Np();this.ap=!1,i.g_(s,this.Vi)}Sp(t){this.cn.handleScale.axisDoubleClickReset.price&&this.Sr()}yp(t){null!==this.Vi&&(!this.nn.dp().Yt().W().handleScale.axisPressedMouseMove.price||this.Vi.Nh()||this.Vi.bo()||this.$p(1))}kp(t){this.$p(0)}Ap(){const t=[],i=null===this.Vi?void 0:this.Vi;return(s=>{for(let e=0;e<s.length;++e){const n=s[e].Rn(this.nn.Np(),i);for(let i=0;i<n.length;i++)t.push(n[i])}})(this.nn.Np().Bo()),t}Ep({context:t,bitmapSize:i}){const{width:s,height:e}=i,n=this.nn.Np().Yt(),h=n.Y(),o=n.vd();h===o?et(t,0,0,s,e,h):rt(t,0,0,s,e,h,o)}Ge({context:t,bitmapSize:i,horizontalPixelRatio:s}){if(null===this.lp||null===this.Vi||!this.Vi.W().borderVisible)return;t.fillStyle=this.Vi.W().borderColor;const e=Math.max(1,Math.floor(this.Pp().C*s));let n;n=this.pp?i.width-e:0,t.fillRect(n,0,e,i.height)}Vp(t){if(null===this.lp||null===this.Vi)return;const i=this.Vi.Na(),s=this.Vi.W(),e=this.Pp(),n=this.pp?this.lp.width-e.T:0;s.borderVisible&&s.ticksVisible&&t.useBitmapCoordinateSpace(({context:t,horizontalPixelRatio:h,verticalPixelRatio:o})=>{t.fillStyle=s.borderColor;const r=Math.max(1,Math.floor(o)),l=Math.floor(.5*o),a=Math.round(e.T*h);t.beginPath();for(const s of i)t.rect(Math.floor(n*h),Math.round(s.Ra*o)-l,a,r);t.fill()}),t.useMediaCoordinateSpace(({context:t})=>{var h;t.font=this.Dp(),t.fillStyle=null!==(h=s.textColor)&&void 0!==h?h:this._o.textColor,t.textAlign=this.pp?"right":"left",t.textBaseline="middle";const o=this.pp?Math.round(n-e.N):Math.round(n+e.T+e.N),r=i.map(i=>this.op.xi(t,i.Ce));for(let s=i.length;s--;){const e=i[s];t.fillText(e.Ce,o,e.Ra+r[s])}})}Op(){if(null===this.lp||null===this.Vi)return;let t=this.lp.height/2;const i=[],s=this.Vi.Bo().slice(),e=this.nn.Np(),n=this.Pp();this.Vi===e.Ir()&&this.nn.Np().Bo().forEach(t=>{e.Nr(t)&&s.push(t)});const h=this.Vi.ya()[0],o=this.Vi;s.forEach(s=>{const n=s.Rn(e,o);n.forEach(t=>{t.Li(null),t.Ni()&&i.push(t)}),h===s&&n.length>0&&(t=n[0].ki())}),i.forEach(t=>t.Li(t.ki())),this.Vi.W().alignLabels&&this.Hp(i,n,t)}Hp(t,i,s){if(null===this.lp)return;const e=t.filter(t=>t.ki()<=s),n=t.filter(t=>t.ki()>s);e.sort((t,i)=>i.ki()-t.ki()),e.length&&n.length&&n.push(e[0]),n.sort((t,i)=>t.ki()-i.ki());for(const h of t){const t=Math.floor(h.Ot(i)/2),s=h.ki();s>-t&&s<t&&h.Li(t),s>this.lp.height-t&&s<this.lp.height+t&&h.Li(this.lp.height-t)}for(let h=1;h<e.length;h++){const t=e[h],s=e[h-1],n=s.Ot(i,!1),o=t.ki(),r=s.Bi();o>r-n&&t.Li(r-n)}for(let h=1;h<n.length;h++){const t=n[h],s=n[h-1],e=s.Ot(i,!0),o=t.ki(),r=s.Bi();o<r+e&&t.Li(r+e)}}zp(t){if(null===this.lp)return;const i=this.Ap(),s=this.Pp(),e=this.pp?"right":"left";i.forEach(i=>{i.Ii()&&i.xt(C(this.Vi)).Z(t,s,this.op,e)})}Fp(t){if(null===this.lp||null===this.Vi)return;const i=this.nn.dp().Yt(),s=[],e=this.nn.Np(),n=i.Yc().Rn(e,this.Vi);n.length&&s.push(n);const h=this.Pp(),o=this.pp?"right":"left";s.forEach(i=>{i.forEach(i=>{i.xt(C(this.Vi)).Z(t,h,this.op,o)})})}$p(t){this.vp.style.cursor=1===t?"ns-resize":"default"}io(){const t=this.Rp();this._p<t&&this.nn.dp().Yt().ql(),this._p=t}Dp(){return J(this._o.fontSize,this._o.fontFamily)}}function qs(t,i,s,e){t.G&&t.G(i,s,e)}function Ks(t,i,s,e){t.Z(i,s,e)}function Qs(t,i){return t.Pn(i)}function te(t,i){return t.Qi(i)}function ie(t,i){return void 0!==t.aa?t.aa(i):[]}class se{constructor(t,i){this.lp=c({width:0,height:0}),this.Up=null,this.Yp=null,this.qp=null,this.Xp=!1,this.Zp=new N,this.Kp=0,this.Gp=!1,this.Jp=null,this.Qp=!1,this.tv=null,this.iv=null,this.up=!1,this.cp=()=>{this.up||null===this.nv||this.Ui().el()},this.fp=()=>{this.up||null===this.nv||this.Ui().el()},this.sv=t,this.nv=i,this.nv.T_().l(this.ev.bind(this),this,!0),this.rv=document.createElement("td"),this.rv.style.padding="0",this.rv.style.position="relative";const s=document.createElement("div");s.style.width="100%",s.style.height="100%",s.style.position="relative",s.style.overflow="hidden",this.hv=document.createElement("td"),this.hv.style.padding="0",this.lv=document.createElement("td"),this.lv.style.padding="0",this.rv.appendChild(s),this.mp=Is(s,c({width:16,height:16})),this.mp.subscribeSuggestedBitmapSizeChanged(this.cp);const e=this.mp.canvasElement;e.style.position="absolute",e.style.zIndex="1",e.style.left="0",e.style.top="0",this.bp=Is(s,c({width:16,height:16})),this.bp.subscribeSuggestedBitmapSizeChanged(this.fp);const n=this.bp.canvasElement;n.style.position="absolute",n.style.zIndex="2",n.style.left="0",n.style.top="0",this.av=document.createElement("tr"),this.av.appendChild(this.hv),this.av.appendChild(this.rv),this.av.appendChild(this.lv),this.ov(),this.Cp=new Xs(this.bp.canvasElement,this,{Df:()=>null===this.Jp&&!this.sv.W().handleScroll.vertTouchDrag,Af:()=>null===this.Jp&&!this.sv.W().handleScroll.horzTouchDrag})}S(){null!==this.Up&&this.Up.S(),null!==this.Yp&&this.Yp.S(),this.bp.unsubscribeSuggestedBitmapSizeChanged(this.fp),this.bp.dispose(),this.mp.unsubscribeSuggestedBitmapSizeChanged(this.cp),this.mp.dispose(),null!==this.nv&&this.nv.T_().v(this),this.Cp.S()}Np(){return C(this.nv)}_v(t){null!==this.nv&&this.nv.T_().v(this),this.nv=t,null!==this.nv&&this.nv.T_().l(se.prototype.ev.bind(this),this,!0),this.ov()}dp(){return this.sv}Tp(){return this.av}ov(){if(null!==this.nv&&(this.uv(),0!==this.Ui().Mt().length)){if(null!==this.Up){const t=this.nv.p_();this.Up.Ji(C(t))}if(null!==this.Yp){const t=this.nv.v_();this.Yp.Ji(C(t))}}}cv(){null!==this.Up&&this.Up.wt(),null!==this.Yp&&this.Yp.wt()}l_(){return null!==this.nv?this.nv.l_():0}a_(t){this.nv&&this.nv.a_(t)}kf(t){if(!this.nv)return;this.dv();const i=t.localX,s=t.localY;this.fv(i,s,t)}Hf(t){this.dv(),this.pv(),this.fv(t.localX,t.localY,t)}Cf(t){if(!this.nv)return;this.dv();const i=t.localX,s=t.localY;this.fv(i,s,t);const e=this.Vr(i,s);this.Ui().Fc(e&&{Wc:e.Wc,vv:e.vv})}zf(t){null!==this.nv&&(this.dv(),this.mv(t))}Nf(t){this.dv(),this.bv(t),this.fv(t.localX,t.localY,t)}Vf(t){null!==this.nv&&(this.dv(),this.Gp=!1,this.gv(t))}Ef(t){null!==this.nv&&this.mv(t)}ip(t){if(this.Gp=!0,null===this.Jp){const i={x:t.localX,y:t.localY};this.wv(i,i,t)}}tp(t){null!==this.nv&&(this.dv(),this.nv.Yt().Fc(null),this.Mv())}xv(){return this.Zp}Xf(){this.Kp=1,this.Ui().Un()}Zf(t,i){if(!this.sv.W().handleScale.pinch)return;const s=5*(i-this.Kp);this.Kp=i,this.Ui().Jc(t.et,s)}jf(t){if(this.Gp=!1,this.Qp=null!==this.Jp,this.pv(),null!==this.Jp){const i=this.Ui().Yc();this.tv={x:i.Zt(),y:i.Kt()},this.Jp={x:t.localX,y:t.localY}}}Bf(t){if(null===this.nv)return;const i=t.localX,s=t.localY;if(null===this.Jp)this.bv(t);else{this.Qp=!1;const e=C(this.tv),n=e.x+(i-this.Jp.x),h=e.y+(s-this.Jp.y);this.fv(n,h,t)}}Of(t){0===this.dp().W().trackingMode.exitMode&&(this.Qp=!0),this.Sv(),this.gv(t)}Vr(t,i){const s=this.nv;if(null===s)return null;const e=s.Bo();for(const n of e){const e=this.yv(n.Pn(s),t,i);if(null!==e)return{Wc:n,rp:e.rp,vv:e.vv}}return null}kv(t,i){C("left"===i?this.Up:this.Yp).Bp(c({width:t,height:this.lp.height}))}Cv(){return this.lp}Bp(t){u(this.lp,t)||(this.lp=t,this.up=!0,this.mp.resizeCanvasElement(t),this.bp.resizeCanvasElement(t),this.up=!1,this.rv.style.width=t.width+"px",this.rv.style.height=t.height+"px")}Tv(){const t=C(this.nv);t.f_(t.p_()),t.f_(t.v_());for(const i of t.ya())if(t.Nr(i)){const s=i.Bt();null!==s&&t.f_(s),i.An()}}Wp(){return this.mp.bitmapSize}jp(t,i,s){const e=this.Wp();e.width>0&&e.height>0&&t.drawImage(this.mp.canvasElement,i,s)}Ip(t){if(0===t)return;if(null===this.nv)return;if(t>1&&this.Tv(),null!==this.Up&&this.Up.Ip(t),null!==this.Yp&&this.Yp.Ip(t),1!==t){this.mp.applySuggestedBitmapSize();const t=w(this.mp);null!==t&&(t.useBitmapCoordinateSpace(t=>{this.Ep(t)}),this.nv&&(this.Pv(t),this.Rv(t),this.Dv(t,Qs),this.Dv(t,te)))}this.bp.applySuggestedBitmapSize();const i=w(this.bp);null!==i&&(i.useBitmapCoordinateSpace(({context:t,bitmapSize:i})=>{t.clearRect(0,0,i.width,i.height)}),this.Dv(i,ie),this.Av(i))}Bv(){return this.Up}Lv(){return this.Yp}Nv(t,i,s){if(this.nv)if(s){const s=t,e=i;this.Iv(s,e)}else this.nv.Yt().Fc(null),this.Mv()}Iv(t,i){this.Ui().bd(this.Ov(t),this.Ev(i),!1,C(this.nv))}ev(){null!==this.nv&&this.nv.T_().v(this),this.nv=null}mv(t){const i=t.localX,s=t.localY;this.Zp.M()&&this.Zp.m(this.Ui().kt().Eu(i),{x:i,y:s},t)}Ep({context:t,bitmapSize:i}){const{width:s,height:e}=i,n=this.Ui(),h=n.Y(),o=n.vd();h===o?et(t,0,0,s,e,o):rt(t,0,0,s,e,h,o)}Pv(t){const i=C(this.nv).P_().rl().xt();null!==i&&i.Z(t,!1)}Rv(t){const i=this.Ui().Uc();this.Vv(t,Qs,qs,i),this.Vv(t,Qs,Ks,i)}Av(t){this.Vv(t,Qs,Ks,this.Ui().Yc())}Dv(t,i){const s=C(this.nv).Bo();for(const e of s)this.Vv(t,i,qs,e);for(const e of s)this.Vv(t,i,Ks,e)}Vv(t,i,s,e){const n=C(this.nv),h=i(e,n),o=n.Yt().zc(),r=null!==o&&o.Wc===e,l=null!==o&&r&&void 0!==o.vv?o.vv.Fr:void 0;for(const a of h){const i=a.xt();null!==i&&s(i,t,r,l)}}yv(t,i,s){for(const e of t){const t=e.xt();if(null!==t&&t.Vr){const n=t.Vr(i,s);if(null!==n)return{rp:e,vv:n}}}return null}uv(){if(null===this.nv)return;const t=this.sv,i=this.nv.p_().W().visible,s=this.nv.v_().W().visible;i||null===this.Up||(this.hv.removeChild(this.Up.Tp()),this.Up.S(),this.Up=null),s||null===this.Yp||(this.lv.removeChild(this.Yp.Tp()),this.Yp.S(),this.Yp=null);const e=t.Yt().od();i&&null===this.Up&&(this.Up=new Gs(this,t.W(),e,"left"),this.hv.appendChild(this.Up.Tp())),s&&null===this.Yp&&(this.Yp=new Gs(this,t.W(),e,"right"),this.lv.appendChild(this.Yp.Tp()))}zv(t){return t.np&&this.Gp||null!==this.Jp}Ov(t){return Math.max(0,Math.min(t,this.lp.width-1))}Ev(t){return Math.max(0,Math.min(t,this.lp.height-1))}fv(t,i,s){this.Ui().hd(this.Ov(t),this.Ev(i),s,C(this.nv))}Mv(){this.Ui().ld()}Sv(){this.Qp&&(this.Jp=null,this.Mv())}wv(t,i,s){this.Jp=t,this.Qp=!1,this.fv(i.x,i.y,s);const e=this.Ui().Yc();this.tv={x:e.Zt(),y:e.Kt()}}Ui(){return this.sv.Yt()}gv(t){if(!this.Xp)return;const i=this.Ui(),s=this.Np();if(i.x_(s,s.pn()),this.qp=null,this.Xp=!1,i.sd(),null!==this.iv){const t=performance.now(),s=i.kt();this.iv.Zr(s.Wu(),t),this.iv.Ju(t)||i.Xn(this.iv)}}dv(){this.Jp=null}pv(){if(this.nv){if(this.Ui().Un(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)C(document.activeElement).blur();else{const t=document.getSelection();null!==t&&t.removeAllRanges()}!this.nv.pn().Fi()&&this.Ui().kt().Fi()}}bv(t){if(null===this.nv)return;const i=this.Ui(),s=i.kt();if(s.Fi())return;const e=this.sv.W(),n=e.handleScroll,h=e.kineticScroll;if((!n.pressedMouseMove||t.np)&&(!n.horzTouchDrag&&!n.vertTouchDrag||!t.np))return;const o=this.nv.pn(),r=performance.now();if(null!==this.qp||this.zv(t)||(this.qp={x:t.clientX,y:t.clientY,H_:r,Fv:t.localX,Wv:t.localY}),null!==this.qp&&!this.Xp&&(this.qp.x!==t.clientX||this.qp.y!==t.clientY)){if(t.np&&h.touch||!t.np&&h.mouse){const t=s.Gs();this.iv=new Us(.2/t,7/t,.997,15/t),this.iv.Dd(s.Wu(),this.qp.H_)}else this.iv=null;o.Fi()||i.w_(this.nv,o,t.localY),i.td(t.localX),this.Xp=!0}this.Xp&&(o.Fi()||i.M_(this.nv,o,t.localY),i.nd(t.localX),null!==this.iv&&this.iv.Dd(s.Wu(),r))}}class ee{constructor(t,i,s,e,n){this.bt=!0,this.lp=c({width:0,height:0}),this.cp=()=>this.Ip(3),this.pp="left"===t,this.Dc=s.od,this.cn=i,this.jv=e,this.$v=n,this.vp=document.createElement("div"),this.vp.style.width="25px",this.vp.style.height="100%",this.vp.style.overflow="hidden",this.mp=Is(this.vp,c({width:16,height:16})),this.mp.subscribeSuggestedBitmapSizeChanged(this.cp)}S(){this.mp.unsubscribeSuggestedBitmapSizeChanged(this.cp),this.mp.dispose()}Tp(){return this.vp}Cv(){return this.lp}Bp(t){u(this.lp,t)||(this.lp=t,this.mp.resizeCanvasElement(t),this.vp.style.width=`${t.width}px`,this.vp.style.height=`${t.height}px`,this.bt=!0)}Ip(t){if(t<3&&!this.bt)return;if(0===this.lp.width||0===this.lp.height)return;this.bt=!1,this.mp.applySuggestedBitmapSize();const i=w(this.mp);null!==i&&i.useBitmapCoordinateSpace(t=>{this.Ep(t),this.Ge(t)})}Wp(){return this.mp.bitmapSize}jp(t,i,s){const e=this.Wp();e.width>0&&e.height>0&&t.drawImage(this.mp.canvasElement,i,s)}Ge({context:t,bitmapSize:i,horizontalPixelRatio:s,verticalPixelRatio:e}){if(!this.jv())return;t.fillStyle=this.cn.timeScale.borderColor;const n=Math.floor(this.Dc.W().C*s),h=Math.floor(this.Dc.W().C*e),o=this.pp?i.width-n:0;t.fillRect(o,0,n,h)}Ep({context:t,bitmapSize:i}){et(t,0,0,i.width,i.height,this.$v())}}function ne(t,i){return t.Q_>i.Q_?t:i}class he{constructor(t){this.Hv=null,this.Uv=null,this.k=null,this.Yv=!1,this.lp=c({width:0,height:0}),this.qv=new N,this.op=new ai(5),this.up=!1,this.cp=()=>{this.up||this.sv.Yt().el()},this.fp=()=>{this.up||this.sv.Yt().el()},this.sv=t,this.cn=t.W().layout,this.Xv=document.createElement("tr"),this.Zv=document.createElement("td"),this.Zv.style.padding="0",this.Kv=document.createElement("td"),this.Kv.style.padding="0",this.vp=document.createElement("td"),this.vp.style.height="25px",this.vp.style.padding="0",this.Gv=document.createElement("div"),this.Gv.style.width="100%",this.Gv.style.height="100%",this.Gv.style.position="relative",this.Gv.style.overflow="hidden",this.vp.appendChild(this.Gv),this.mp=Is(this.Gv,c({width:16,height:16})),this.mp.subscribeSuggestedBitmapSizeChanged(this.cp);const i=this.mp.canvasElement;i.style.position="absolute",i.style.zIndex="1",i.style.left="0",i.style.top="0",this.bp=Is(this.Gv,c({width:16,height:16})),this.bp.subscribeSuggestedBitmapSizeChanged(this.fp);const s=this.bp.canvasElement;s.style.position="absolute",s.style.zIndex="2",s.style.left="0",s.style.top="0",this.Xv.appendChild(this.Zv),this.Xv.appendChild(this.vp),this.Xv.appendChild(this.Kv),this.Jv(),this.sv.Yt().h_().l(this.Jv.bind(this),this),this.Cp=new Xs(this.bp.canvasElement,this,{Df:()=>!0,Af:()=>!1})}S(){this.Cp.S(),null!==this.Hv&&this.Hv.S(),null!==this.Uv&&this.Uv.S(),this.bp.unsubscribeSuggestedBitmapSizeChanged(this.fp),this.bp.dispose(),this.mp.unsubscribeSuggestedBitmapSizeChanged(this.cp),this.mp.dispose()}Tp(){return this.Xv}Qv(){return this.Hv}tm(){return this.Uv}Hf(t){if(this.Yv)return;this.Yv=!0;const i=this.sv.Yt();!i.kt().Fi()&&this.sv.W().handleScale.axisPressedMouseMove.time&&i.Gc(t.localX)}jf(t){this.Hf(t)}Uf(){const t=this.sv.Yt();!t.kt().Fi()&&this.Yv&&(this.Yv=!1,this.sv.W().handleScale.axisPressedMouseMove.time&&t.rd())}Nf(t){const i=this.sv.Yt();!i.kt().Fi()&&this.sv.W().handleScale.axisPressedMouseMove.time&&i.ed(t.localX)}Bf(t){this.Nf(t)}Vf(){this.Yv=!1;const t=this.sv.Yt();t.kt().Fi()&&!this.sv.W().handleScale.axisPressedMouseMove.time||t.rd()}Of(){this.Vf()}bf(){this.sv.W().handleScale.axisDoubleClickReset.time&&this.sv.Yt().Kn()}ff(){this.bf()}kf(){this.sv.Yt().W().handleScale.axisPressedMouseMove.time&&this.$p(1)}tp(){this.$p(0)}Cv(){return this.lp}im(){return this.qv}nm(t,i,s){u(this.lp,t)||(this.lp=t,this.up=!0,this.mp.resizeCanvasElement(t),this.bp.resizeCanvasElement(t),this.up=!1,this.vp.style.width=`${t.width}px`,this.vp.style.height=`${t.height}px`,this.qv.m(t)),null!==this.Hv&&this.Hv.Bp(c({width:i,height:t.height})),null!==this.Uv&&this.Uv.Bp(c({width:s,height:t.height}))}sm(){const t=this.rm();return Math.ceil(t.C+t.T+t.P+t.O+t.L+t.hm)}wt(){this.sv.Yt().kt().Na()}Wp(){return this.mp.bitmapSize}jp(t,i,s){const e=this.Wp();e.width>0&&e.height>0&&t.drawImage(this.mp.canvasElement,i,s)}Ip(t){if(0===t)return;if(1!==t){this.mp.applySuggestedBitmapSize();const i=w(this.mp);null!==i&&(i.useBitmapCoordinateSpace(t=>{this.Ep(t),this.Ge(t)}),this.Vp(i)),null!==this.Hv&&this.Hv.Ip(t),null!==this.Uv&&this.Uv.Ip(t)}this.bp.applySuggestedBitmapSize();const i=w(this.bp);null!==i&&(i.useBitmapCoordinateSpace(({context:t,bitmapSize:i})=>{t.clearRect(0,0,i.width,i.height)}),this.lm([this.sv.Yt().Yc()],i))}Ep({context:t,bitmapSize:i}){et(t,0,0,i.width,i.height,this.sv.Yt().vd())}Ge({context:t,bitmapSize:i,verticalPixelRatio:s}){if(this.sv.W().timeScale.borderVisible){t.fillStyle=this.am();const e=Math.max(1,Math.floor(this.rm().C*s));t.fillRect(0,0,i.width,e)}}Vp(t){const i=this.sv.Yt().kt(),s=i.Na();if(!s||0===s.length)return;let e=s.reduce(ne,s[0]).Q_;e>30&&e<50&&(e=30);const n=this.rm(),h=i.W();h.borderVisible&&h.ticksVisible&&t.useBitmapCoordinateSpace(({context:t,horizontalPixelRatio:i,verticalPixelRatio:e})=>{t.strokeStyle=this.am(),t.fillStyle=this.am();const h=Math.max(1,Math.floor(i)),o=Math.floor(.5*i);t.beginPath();const r=Math.round(n.T*e);for(let n=s.length;n--;){const e=Math.round(s[n].Ra*i);t.rect(e-o,0,h,r)}t.fill()}),t.useMediaCoordinateSpace(({context:t})=>{const i=n.C+n.T+n.O+n.P/2;t.textAlign="center",t.textBaseline="middle",t.fillStyle=this.H(),t.font=this.Dp();for(const n of s)if(n.Q_<e){const s=n.Hu?this.om(t,n.Ra,n.Ce):n.Ra;t.fillText(n.Ce,s,i)}t.font=this._m();for(const n of s)if(n.Q_>=e){const s=n.Hu?this.om(t,n.Ra,n.Ce):n.Ra;t.fillText(n.Ce,s,i)}})}om(t,i,s){const e=this.op.Si(t,s),n=e/2,h=Math.floor(i-n)+.5;return h<0?i+=Math.abs(0-h):h+e>this.lp.width&&(i-=Math.abs(this.lp.width-(h+e))),i}lm(t,i){const s=this.rm();for(const e of t)for(const t of e.tn())t.xt().Z(i,s)}am(){return this.sv.W().timeScale.borderColor}H(){return this.cn.textColor}j(){return this.cn.fontSize}Dp(){return J(this.j(),this.cn.fontFamily)}_m(){return J(this.j(),this.cn.fontFamily,"bold")}rm(){null===this.k&&(this.k={C:1,V:NaN,O:NaN,L:NaN,$i:NaN,T:5,P:NaN,R:"",ji:new ai,hm:0});const t=this.k,i=this.Dp();if(t.R!==i){const s=this.j();t.P=s,t.R=i,t.O=3*s/12,t.L=3*s/12,t.$i=9*s/12,t.V=0,t.hm=4*s/12,t.ji.Sr()}return this.k}$p(t){this.vp.style.cursor=1===t?"ew-resize":"default"}Jv(){const t=this.sv.Yt(),i=t.W();i.leftPriceScale.visible||null===this.Hv||(this.Zv.removeChild(this.Hv.Tp()),this.Hv.S(),this.Hv=null),i.rightPriceScale.visible||null===this.Uv||(this.Kv.removeChild(this.Uv.Tp()),this.Uv.S(),this.Uv=null);const s={od:this.sv.Yt().od()},e=()=>i.leftPriceScale.borderVisible&&t.kt().W().borderVisible,n=()=>t.vd();i.leftPriceScale.visible&&null===this.Hv&&(this.Hv=new ee("left",i,s,e,n),this.Zv.appendChild(this.Hv.Tp())),i.rightPriceScale.visible&&null===this.Uv&&(this.Uv=new ee("right",i,s,e,n),this.Kv.appendChild(this.Uv.Tp()))}}const oe=!!Rs&&!!navigator.userAgentData&&navigator.userAgentData.brands.some(t=>t.brand.includes("Chromium"))&&!!Rs&&((null===(re=null===navigator||void 0===navigator?void 0:navigator.userAgentData)||void 0===re?void 0:re.platform)?"Windows"===navigator.userAgentData.platform:navigator.userAgent.toLowerCase().indexOf("win")>=0);var re;class le{constructor(t,i){var s;this.um=[],this.dm=0,this.Ya=0,this.Zo=0,this.fm=0,this.pm=0,this.vm=null,this.bm=!1,this.Zp=new N,this.Tc=new N,this.gm=null,this.wm=t,this.cn=i,this.Xv=document.createElement("div"),this.Xv.classList.add("tv-lightweight-charts"),this.Xv.style.overflow="hidden",this.Xv.style.width="100%",this.Xv.style.height="100%",(s=this.Xv).style.userSelect="none",s.style.webkitUserSelect="none",s.style.msUserSelect="none",s.style.MozUserSelect="none",s.style.webkitTapHighlightColor="transparent",this.Mm=document.createElement("table"),this.Mm.setAttribute("cellspacing","0"),this.Xv.appendChild(this.Mm),this.xm=this.Sm.bind(this),ae(this.cn)&&this.ym(!0),this.Ui=new Ws(this.Rc.bind(this),this.cn),this.Yt().qc().l(this.km.bind(this),this),this.Cm=new he(this),this.Mm.appendChild(this.Cm.Tp());const e=i.autoSize&&this.Tm();let n=this.cn.width,h=this.cn.height;if(e||0===n||0===h){const i=t.getBoundingClientRect();n=n||i.width,h=h||i.height}this.Pm(n,h),this.Rm(),t.appendChild(this.Xv),this.Dm(),this.Ui.kt().nc().l(this.Ui.ql.bind(this.Ui),this),this.Ui.h_().l(this.Ui.ql.bind(this.Ui),this)}Yt(){return this.Ui}W(){return this.cn}Am(){return this.um}Bm(){return this.Cm}S(){this.ym(!1),0!==this.dm&&window.cancelAnimationFrame(this.dm),this.Ui.qc().v(this),this.Ui.kt().nc().v(this),this.Ui.h_().v(this),this.Ui.S();for(const t of this.um)this.Mm.removeChild(t.Tp()),t.xv().v(this),t.S();this.um=[],C(this.Cm).S(),null!==this.Xv.parentElement&&this.Xv.parentElement.removeChild(this.Xv),this.Tc.S(),this.Zp.S(),this.Lm()}Pm(t,i,s=!1){if(this.Ya===i&&this.Zo===t)return;const e=function(t){const i=Math.floor(t.width),s=Math.floor(t.height);return c({width:i-i%2,height:s-s%2})}(c({width:t,height:i}));this.Ya=e.height,this.Zo=e.width;const n=this.Ya+"px",h=this.Zo+"px";C(this.Xv).style.height=n,C(this.Xv).style.width=h,this.Mm.style.height=n,this.Mm.style.width=h,s?this.Nm(bt.es(),performance.now()):this.Ui.ql()}Ip(t){void 0===t&&(t=bt.es());for(let i=0;i<this.um.length;i++)this.um[i].Ip(t.$n(i).Fn);this.cn.timeScale.visible&&this.Cm.Ip(t.jn())}sl(t){const i=ae(this.cn);this.Ui.sl(t);const s=ae(this.cn);s!==i&&this.ym(s),this.Dm(),this.Im(t)}xv(){return this.Zp}qc(){return this.Tc}Om(){null!==this.vm&&(this.Nm(this.vm,performance.now()),this.vm=null);const t=this.Em(null),i=document.createElement("canvas");i.width=t.width,i.height=t.height;const s=C(i.getContext("2d"));return this.Em(s),i}Vm(t){return("left"!==t||this.zm())&&("right"!==t||this.Fm())?0===this.um.length?0:C("left"===t?this.um[0].Bv():this.um[0].Lv()).Lp():0}Wm(){return this.cn.autoSize&&null!==this.gm}Im(t){(void 0!==t.autoSize||!this.gm||void 0===t.width&&void 0===t.height)&&(t.autoSize&&!this.gm&&this.Tm(),!1===t.autoSize&&null!==this.gm&&this.Lm(),t.autoSize||void 0===t.width&&void 0===t.height||this.Pm(t.width||this.Zo,t.height||this.Ya))}Em(t){let i=0,s=0;const e=this.um[0],n=(i,s)=>{let e=0;for(let n=0;n<this.um.length;n++){const h=this.um[n],o=C("left"===i?h.Bv():h.Lv()),r=o.Wp();null!==t&&o.jp(t,s,e),e+=r.height}};this.zm()&&(n("left",0),i+=C(e.Bv()).Wp().width);for(let o=0;o<this.um.length;o++){const e=this.um[o],n=e.Wp();null!==t&&e.jp(t,i,s),s+=n.height}i+=e.Wp().width,this.Fm()&&(n("right",i),i+=C(e.Lv()).Wp().width);const h=(i,s,e)=>{C("left"===i?this.Cm.Qv():this.Cm.tm()).jp(C(t),s,e)};if(this.cn.timeScale.visible){const i=this.Cm.Wp();if(null!==t){let n=0;this.zm()&&(h("left",n,s),n=C(e.Bv()).Wp().width),this.Cm.jp(t,n,s),n+=i.width,this.Fm()&&h("right",n,s)}s+=i.height}return c({width:i,height:s})}jm(){let t=0,i=0,s=0;for(const c of this.um)this.zm()&&(i=Math.max(i,C(c.Bv()).Rp())),this.Fm()&&(s=Math.max(s,C(c.Lv()).Rp())),t+=c.l_();i=Ys(i),s=Ys(s);const e=this.Zo,n=this.Ya,h=Math.max(e-i-s,0),o=this.cn.timeScale.visible;let r=o?this.Cm.sm():0;var l;r=(l=r)+l%2;const a=0+r,u=n<a?0:n-a,d=u/t;let f=0;for(let p=0;p<this.um.length;++p){const t=this.um[p];t._v(this.Ui.Hc()[p]);let e=0,n=0;n=p===this.um.length-1?u-f:Math.round(t.l_()*d),e=Math.max(n,2),f+=e,t.Bp(c({width:h,height:e})),this.zm()&&t.kv(i,"left"),this.Fm()&&t.kv(s,"right"),t.Np()&&this.Ui.Xc(t.Np(),e)}this.Cm.nm(c({width:o?h:0,height:r}),o?i:0,o?s:0),this.Ui.o_(h),this.fm!==i&&(this.fm=i),this.pm!==s&&(this.pm=s)}ym(t){t?this.Xv.addEventListener("wheel",this.xm,{passive:!1}):this.Xv.removeEventListener("wheel",this.xm)}$m(t){switch(t.deltaMode){case t.DOM_DELTA_PAGE:return 120;case t.DOM_DELTA_LINE:return 32}return oe?1/window.devicePixelRatio:1}Sm(t){if(!(0!==t.deltaX&&this.cn.handleScroll.mouseWheel||0!==t.deltaY&&this.cn.handleScale.mouseWheel))return;const i=this.$m(t),s=i*t.deltaX/100,e=-i*t.deltaY/100;if(t.cancelable&&t.preventDefault(),0!==e&&this.cn.handleScale.mouseWheel){const i=Math.sign(e)*Math.min(1,Math.abs(e)),s=t.clientX-this.Xv.getBoundingClientRect().left;this.Yt().Jc(s,i)}0!==s&&this.cn.handleScroll.mouseWheel&&this.Yt().Qc(-80*s)}Nm(t,i){var s;const e=t.jn();3===e&&this.Hm(),3!==e&&2!==e||(this.Um(t),this.Ym(t,i),this.Cm.wt(),this.um.forEach(t=>{t.cv()}),3===(null===(s=this.vm)||void 0===s?void 0:s.jn())&&(this.vm.ts(t),this.Hm(),this.Um(this.vm),this.Ym(this.vm,i),t=this.vm,this.vm=null)),this.Ip(t)}Ym(t,i){for(const s of t.Qn())this.ns(s,i)}Um(t){const i=this.Ui.Hc();for(let s=0;s<i.length;s++)t.$n(s).Wn&&i[s].k_()}ns(t,i){const s=this.Ui.kt();switch(t.Yn){case 0:s.ec();break;case 1:s.rc(t.Lt);break;case 2:s.Gn(t.Lt);break;case 3:s.Jn(t.Lt);break;case 4:s.Uu();break;case 5:t.Lt.Ju(i)||s.Jn(t.Lt.Qu(i))}}Rc(t){null!==this.vm?this.vm.ts(t):this.vm=t,this.bm||(this.bm=!0,this.dm=window.requestAnimationFrame(t=>{if(this.bm=!1,this.dm=0,null!==this.vm){const i=this.vm;this.vm=null,this.Nm(i,t);for(const s of i.Qn())if(5===s.Yn&&!s.Lt.Ju(t)){this.Yt().Xn(s.Lt);break}}}))}Hm(){this.Rm()}Rm(){const t=this.Ui.Hc(),i=t.length,s=this.um.length;for(let e=i;e<s;e++){const t=y(this.um.pop());this.Mm.removeChild(t.Tp()),t.xv().v(this),t.S()}for(let e=s;e<i;e++){const i=new se(this,t[e]);i.xv().l(this.qm.bind(this),this),this.um.push(i),this.Mm.insertBefore(i.Tp(),this.Cm.Tp())}for(let e=0;e<i;e++){const i=t[e],s=this.um[e];s.Np()!==i?s._v(i):s.ov()}this.Dm(),this.jm()}Xm(t,i,s){var e;const n=new Map;let h;if(null!==t&&this.Ui.Mt().forEach(i=>{const s=i.In().yl(t);null!==s&&n.set(i,s)}),null!==t){const i=null===(e=this.Ui.kt().Yi(t))||void 0===e?void 0:e.tu;void 0!==i&&(h=i)}const o=this.Yt().zc(),r=null!==o&&o.Wc instanceof is?o.Wc:void 0,l=null!==o&&void 0!==o.vv?o.vv.zr:void 0;return{ut:h,Xs:null!=t?t:void 0,Zm:null!=i?i:void 0,Km:r,Gm:n,Jm:l,Qm:null!=s?s:void 0}}qm(t,i,s){this.Zp.m(()=>this.Xm(t,i,s))}km(t,i,s){this.Tc.m(()=>this.Xm(t,i,s))}Dm(){const t=this.cn.timeScale.visible?"":"none";this.Cm.Tp().style.display=t}zm(){return this.um[0].Np().p_().W().visible}Fm(){return this.um[0].Np().v_().W().visible}Tm(){return"ResizeObserver"in window&&(this.gm=new ResizeObserver(t=>{const i=t.find(t=>t.target===this.wm);i&&this.Pm(i.contentRect.width,i.contentRect.height)}),this.gm.observe(this.wm,{box:"border-box"}),!0)}Lm(){null!==this.gm&&this.gm.disconnect()}}function ae(t){return Boolean(t.handleScroll.mouseWheel||t.handleScale.mouseWheel)}function ce(t,i,s,e){const n=s.value,h={Xs:i,ut:t,Lt:[n,n,n,n],tu:e};return void 0!==s.color&&(h.A=s.color),h}function ue(t){return void 0!==t.Lt}function de(t){return(i,s,e,n)=>{return void 0===(h=e).lowerValue&&void 0===h.open&&void 0===h.value?{ut:i,Xs:s,tu:n}:t(i,s,e,n);var h}}const fe={Candlestick:de(function(t,i,s,e){const n={Xs:i,ut:t,Lt:[s.open,s.high,s.low,s.close],tu:e};return void 0!==s.color&&(n.A=s.color),void 0!==s.borderColor&&(n.Nt=s.borderColor),void 0!==s.wickColor&&(n._l=s.wickColor),n}),Bar:de(function(t,i,s,e){const n={Xs:i,ut:t,Lt:[s.open,s.high,s.low,s.close],tu:e};return void 0!==s.color&&(n.A=s.color),n}),Area:de(function(t,i,s,e){const n=s.value,h={Xs:i,ut:t,Lt:[n,n,n,n],tu:e};return void 0!==s.lineColor&&(h._t=s.lineColor),void 0!==s.topColor&&(h.gs=s.topColor),void 0!==s.bottomColor&&(h.ws=s.bottomColor),h}),Baseline:de(function(t,i,s,e){const n=s.value,h={Xs:i,ut:t,Lt:[n,n,n,n],tu:e};return void 0!==s.topLineColor&&(h.ge=s.topLineColor),void 0!==s.bottomLineColor&&(h.we=s.bottomLineColor),void 0!==s.topFillColor1&&(h.fe=s.topFillColor1),void 0!==s.topFillColor2&&(h.pe=s.topFillColor2),void 0!==s.bottomFillColor1&&(h.ve=s.bottomFillColor1),void 0!==s.bottomFillColor2&&(h.me=s.bottomFillColor2),h}),CloudArea:de(function(t,i,s,e){return{Xs:i,ut:t,Lt:[s.higherValue,s.higherValue,s.lowerValue,s.lowerValue],tu:e}}),BrokenArea:de(function(t,i,s,e){const n={Xs:i,ut:t,Lt:[s.higherValue,s.higherValue,s.lowerValue,s.lowerValue],tu:e};return void 0!==s.color&&(n.A=s.color),void 0!==s.label&&(n.Ce=s.label),void 0!==s.extendRight&&(n.Pe=s.extendRight),void 0!==s.id&&(n.Xe=s.id),n}),Histogram:de(ce),Line:de(ce)};function pe(t){return fe[t]}function me(t){return 60*t*60*1e3}function ge(t){return 60*t*1e3}const ve=[{tb:1e3,Q_:10},{tb:ge(1),Q_:20},{tb:ge(5),Q_:21},{tb:ge(30),Q_:22},{tb:me(1),Q_:30},{tb:me(3),Q_:31},{tb:me(6),Q_:32},{tb:me(12),Q_:33}];function be(t,i){if(t.getUTCFullYear()!==i.getUTCFullYear())return 70;if(t.getUTCMonth()!==i.getUTCMonth())return 60;if(t.getUTCDate()!==i.getUTCDate())return 50;for(let s=ve.length-1;s>=0;--s)if(Math.floor(i.getTime()/ve[s].tb)!==Math.floor(t.getTime()/ve[s].tb))return ve[s].Q_;return 0}function we(t,i=0){if(0===t.length)return;let s=0===i?null:t[i-1].ut.H_,e=null!==s?new Date(1e3*s):null,n=0;for(let h=i;h<t.length;++h){const i=t[h],o=new Date(1e3*i.ut.H_);null!==e&&(i.J_=be(o,e)),n+=i.ut.H_-(s||i.ut.H_),s=i.ut.H_,e=o}if(0===i&&t.length>1){const i=Math.ceil(n/(t.length-1)),s=new Date(1e3*(t[0].ut.H_-i));t[0].J_=be(new Date(1e3*t[0].ut.H_),s)}}function xe(t){if(!Bs(t))throw new Error("time must be of type BusinessDay");const i=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{H_:Math.round(i.getTime()/1e3),j_:t}}function Me(t){if(!Ns(t))throw new Error("time must be of type isUTCTimestamp");return{H_:t}}function Se(t){return 0===t.length?null:Bs(t[0].time)?xe:Me}function ye(t){return Ns(t)?Me(t):Bs(t)?xe(t):xe(Ce(t))}function Ce(t){const i=new Date(t);if(isNaN(i.getTime()))throw new Error(`Invalid date string=${t}, expected format=yyyy-mm-dd`);return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function _e(t){Y(t.time)&&(t.time=Ce(t.time))}function Ve(t){return{Xs:0,ib:new Map,la:t}}function Te(t){if(void 0!==t&&0!==t.length)return{nb:t[0].ut.H_,sb:t[t.length-1].ut.H_}}function Le(t){let i;return t.forEach(t=>{void 0===i&&(i=t.tu)}),y(i)}function ke(t){void 0===t.tu&&(t.tu=t.time)}class Ee{constructor(){this.eb=new Map,this.rb=new Map,this.hb=new Map,this.lb=[]}S(){this.eb.clear(),this.rb.clear(),this.hb.clear(),this.lb=[]}ab(t,i){let s=0!==this.eb.size,e=!1;const n=this.rb.get(t);if(void 0!==n)if(1===this.rb.size)s=!1,e=!0,this.eb.clear();else for(const r of this.lb)r.pointData.ib.delete(t)&&(e=!0);let h=[];if(0!==i.length){const s=i;s.forEach(t=>ke(t)),i.forEach(_e);const n=C(Se(i)),o=pe(t.vl());h=s.map(i=>{const s=n(i.time);let h=this.eb.get(s.H_);void 0===h&&(h=Ve(s),this.eb.set(s.H_,h),e=!0);const r=o(s,h.Xs,i,i.tu);return h.ib.set(t,r),r})}s&&this.ob(),this._b(t,h);let o=-1;if(e){const t=[];this.eb.forEach(i=>{t.push({J_:0,ut:i.la,pointData:i,tu:Le(i.ib)})}),t.sort((t,i)=>t.ut.H_-i.ut.H_),o=this.ub(t)}return this.cb(t,o,function(t,i){const s=Te(t),e=Te(i);if(void 0!==s&&void 0!==e)return{Kl:s.sb>=e.sb&&s.nb>=e.nb}}(this.rb.get(t),n))}dd(t){return this.ab(t,[])}fb(t,i){const s=i;ke(s),_e(i);const e=C(Se([i]))(i.time),n=this.hb.get(t);if(void 0!==n&&e.H_<n.H_)throw new Error(`Cannot update oldest data, last time=${n.H_}, new time=${e.H_}`);let h=this.eb.get(e.H_);const o=void 0===h;void 0===h&&(h=Ve(e),this.eb.set(e.H_,h));const r=pe(t.vl())(e,h.Xs,i,s.tu);h.ib.set(t,r),this.pb(t,r);const l={Kl:ue(r)};if(!o)return this.cb(t,-1,l);const a={J_:0,ut:h.la,pointData:h,tu:Le(h.ib)},c=Bt(this.lb,a.ut.H_,(t,i)=>t.ut.H_<i);this.lb.splice(c,0,a);for(let u=c;u<this.lb.length;++u)ze(this.lb[u].pointData,u);return we(this.lb,c),this.cb(t,c,l)}pb(t,i){let s=this.rb.get(t);void 0===s&&(s=[],this.rb.set(t,s));const e=0!==s.length?s[s.length-1]:null;null===e||i.ut.H_>e.ut.H_?ue(i)&&s.push(i):ue(i)?s[s.length-1]=i:s.splice(-1,1),this.hb.set(t,i.ut)}_b(t,i){0!==i.length?(this.rb.set(t,i.filter(ue)),this.hb.set(t,i[i.length-1].ut)):(this.rb.delete(t),this.hb.delete(t))}ob(){for(const t of this.lb)0===t.pointData.ib.size&&this.eb.delete(t.ut.H_)}ub(t){let i=-1;for(let s=0;s<this.lb.length&&s<t.length;++s){const e=this.lb[s],n=t[s];if(e.ut.H_!==n.ut.H_){i=s;break}n.J_=e.J_,ze(n.pointData,s)}if(-1===i&&this.lb.length!==t.length&&(i=Math.min(this.lb.length,t.length)),-1===i)return-1;for(let s=i;s<t.length;++s)ze(t[s].pointData,s);return we(t,i),this.lb=t,i}vb(){if(0===this.rb.size)return null;let t=0;return this.rb.forEach(i=>{0!==i.length&&(t=Math.max(t,i[i.length-1].Xs))}),t}cb(t,i,s){const e={mb:new Map,kt:{qe:this.vb()}};if(-1!==i)this.rb.forEach((i,n)=>{e.mb.set(n,{Ur:i,bb:n===t?s:void 0})}),this.rb.has(t)||e.mb.set(t,{Ur:[],bb:s}),e.kt.gb=this.lb,e.kt.wb=i;else{const i=this.rb.get(t);e.mb.set(t,{Ur:i||[],bb:s})}return e}}function ze(t,i){t.Xs=i,t.ib.forEach(t=>{t.Xs=i})}function Pe(t){return{value:t.Lt[3],time:t.tu}}function We(t){const i=Pe(t);return void 0!==t.A&&(i.color=t.A),i}function Be(t){return{open:t.Lt[0],high:t.Lt[1],low:t.Lt[2],close:t.Lt[3],time:t.tu}}const Ne={Area:function(t){const i=Pe(t);return void 0!==t._t&&(i.lineColor=t._t),void 0!==t.gs&&(i.topColor=t.gs),void 0!==t.ws&&(i.bottomColor=t.ws),i},Line:We,Baseline:function(t){const i=Pe(t);return void 0!==t.ge&&(i.topLineColor=t.ge),void 0!==t.we&&(i.bottomLineColor=t.we),void 0!==t.fe&&(i.topFillColor1=t.fe),void 0!==t.pe&&(i.topFillColor2=t.pe),void 0!==t.ve&&(i.bottomFillColor1=t.ve),void 0!==t.me&&(i.bottomFillColor2=t.me),i},Histogram:We,Bar:function(t){const i=Be(t);return void 0!==t.A&&(i.color=t.A),i},Candlestick:function(t){const i=Be(t),{A:s,Nt:e,_l:n}=t;return void 0!==s&&(i.color=s),void 0!==e&&(i.borderColor=e),void 0!==n&&(i.wickColor=n),i},BrokenArea:function(t){return Pe(t)},CloudArea:function(t){return Pe(t)}};function Re(t){return Ne[t]}const Fe={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!1,scaleMargins:{bottom:.1,top:.2}},Oe={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:X,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},Ye={width:0,height:0,autoSize:!1,layout:{background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:12,fontFamily:X},crosshair:{vertLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},horzLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},overlayPriceScales:Object.assign({},Fe),leftPriceScale:Object.assign(Object.assign({},Fe),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},Fe),{visible:!0}),timeScale:{rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,ticksVisible:!1},watermark:Oe,localization:{locale:Rs?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0},mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}},$e={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},Ae={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},Ue={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Ie={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",invertFilledArea:!1,lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Xe={positiveColor:"rgba( 76, 175, 80, 0.1)",negativeColor:"rgba( 255, 82, 82, 0.1)",higherLineColor:"#4CAF50",higherLineStyle:0,higherLineWidth:3,higherLineType:0,lowerLineColor:"#FF5252",lowerLineStyle:0,lowerLineWidth:3,lowerLineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:""},Je={color:"rgba( 41, 98, 255, 0.01)",strokeColor:"",strokeWidth:0,infinite:!1},De={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},je={color:"#26a69a",base:0},He={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};class Ze{constructor(t,i){this.Mb=t,this.xb=i}applyOptions(t){this.Mb.Yt().jc(this.xb,t)}options(){return this.Vi().W()}width(){return vt(this.xb)?this.Mb.Vm(this.xb):0}Vi(){return C(this.Mb.Yt().$c(this.xb)).Bt}}const Ge={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:"",axisLabelColor:"",axisLabelTextColor:""};class qe{constructor(t){this.Jh=t}applyOptions(t){this.Jh.sl(t)}options(){return this.Jh.W()}Sb(){return this.Jh}}class Ke{constructor(t,i,s){this.Ps=t,this.yb=i,this.kb=s}priceFormatter(){return this.Ps.fa()}priceToCoordinate(t){const i=this.Ps.Pt();return null===i?null:this.Ps.Bt().At(t,i.Lt)}coordinateToPrice(t){const i=this.Ps.Pt();return null===i?null:this.Ps.Bt().vn(t,i.Lt)}barsInLogicalRange(t){if(null===t)return null;const i=new ys(new xs(t.from,t.to)).ru(),s=this.Ps.In();if(s.Fi())return null;const e=s.yl(i.xs(),1),n=s.yl(i.di(),-1),h=C(s.Ml()),o=C(s.Nn());if(null!==e&&null!==n&&e.Xs>n.Xs)return{barsBefore:t.from-h,barsAfter:o-t.to};const r={barsBefore:null===e||e.Xs===h?t.from-h:e.Xs-h,barsAfter:null===n||n.Xs===o?o-t.to:o-n.Xs};return null!==e&&null!==n&&(r.from=e.ut.j_||e.ut.H_,r.to=n.ut.j_||n.ut.H_),r}setData(t){this.Ps.vl(),this.yb.Cb(this.Ps,t)}update(t){this.Ps.vl(),this.yb.Tb(this.Ps,t)}dataByIndex(t,i){const s=this.Ps.In().yl(t,i);return null===s?null:Re(this.seriesType())(s)}setMarkers(t){const i=t.map(t=>Object.assign(Object.assign({},t),{originalTime:t.time,time:ye(t.time)}));this.Ps.Jl(i)}markers(){return this.Ps.Ql().map(t=>{const{originalTime:i,time:s}=t,e=function(t,i){var s={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&i.indexOf(e)<0&&(s[e]=t[e]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(e=Object.getOwnPropertySymbols(t);n<e.length;n++)i.indexOf(e[n])<0&&Object.prototype.propertyIsEnumerable.call(t,e[n])&&(s[e[n]]=t[e[n]])}return s}(t,["originalTime","time"]);return Object.assign({time:i},e)})}applyOptions(t){this.Ps.sl(t)}options(){return A(this.Ps.W())}priceScale(){return this.kb.priceScale(this.Ps.Bt().Xe())}createPriceLine(t){const i=R(A(Ge),t),s=this.Ps.ta(i);return new qe(s)}removePriceLine(t){this.Ps.ia(t.Sb())}removeAllPriceLines(){this.Ps.ra()}getPriceLine(t,i){const s=this.Ps.na(t,i);if(s)return new qe(s)}seriesType(){return this.Ps.vl()}setExtensionsBoundaries(t){return this.Ps.Ie(t)}}class Qe{constructor(t,i){this.Pb=new N,this.pu=new N,this.qv=new N,this.Ui=t,this.Jo=t.kt(),this.Cm=i,this.Jo.tc().l(this.Rb.bind(this)),this.Jo.ic().l(this.Db.bind(this)),this.Cm.im().l(this.Ab.bind(this))}S(){this.Jo.tc().v(this),this.Jo.ic().v(this),this.Cm.im().v(this),this.Pb.S(),this.pu.S(),this.qv.S()}scrollPosition(){return this.Jo.Wu()}scrollToPosition(t,i){i?this.Jo.Gu(t,1e3):this.Ui.Jn(t)}scrollToRealTime(){this.Jo.Ku()}getVisibleRange(){var t,i;const s=this.Jo.Ru();return null===s?null:{from:null!==(t=s.from.j_)&&void 0!==t?t:s.from.H_,to:null!==(i=s.to.j_)&&void 0!==i?i:s.to.H_}}setVisibleRange(t){const i={from:ye(t.from),to:ye(t.to)},s=this.Jo.Lu(i);this.Ui.fd(s)}getVisibleLogicalRange(){const t=this.Jo.Pu();return null===t?null:{from:t.xs(),to:t.di()}}setVisibleLogicalRange(t){S(t.from<=t.to,"The from index cannot be after the to index."),this.Ui.fd(t)}resetTimeScale(){this.Ui.Kn()}fitContent(){this.Ui.ec()}logicalToCoordinate(t){const i=this.Ui.kt();return i.Fi()?null:i.Et(t)}coordinateToLogical(t){return this.Jo.Fi()?null:this.Jo.Eu(t)}timeToCoordinate(t){const i=ye(t),s=this.Jo.xa(i,!1);return null===s?null:this.Jo.Et(s)}coordinateToTime(t){var i;const s=this.Ui.kt(),e=s.Eu(t),n=s.mn(e);return null===n?null:null!==(i=n.j_)&&void 0!==i?i:n.H_}width(){return this.Cm.Cv().width}height(){return this.Cm.Cv().height}subscribeVisibleTimeRangeChange(t){this.Pb.l(t)}unsubscribeVisibleTimeRangeChange(t){this.Pb.p(t)}subscribeVisibleLogicalRangeChange(t){this.pu.l(t)}unsubscribeVisibleLogicalRangeChange(t){this.pu.p(t)}subscribeSizeChange(t){this.qv.l(t)}unsubscribeSizeChange(t){this.qv.p(t)}applyOptions(t){this.Jo.sl(t)}options(){return A(this.Jo.W())}Rb(){this.Pb.M()&&this.Pb.m(this.getVisibleRange())}Db(){this.pu.M()&&this.pu.m(this.getVisibleLogicalRange())}Ab(t){this.qv.m(t.width,t.height)}}function tn(t){return function(t){if($(t.handleScale)){const i=t.handleScale;t.handleScale={axisDoubleClickReset:{time:i,price:i},axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(void 0!==t.handleScale){const{axisPressedMouseMove:i,axisDoubleClickReset:s}=t.handleScale;$(i)&&(t.handleScale.axisPressedMouseMove={time:i,price:i}),$(s)&&(t.handleScale.axisDoubleClickReset={time:s,price:s})}const i=t.handleScroll;$(i)&&(t.handleScroll={horzTouchDrag:i,vertTouchDrag:i,mouseWheel:i,pressedMouseMove:i})}(t),t}class sn{constructor(t,i){this.Bb=new Ee,this.Lb=new Map,this.Nb=new Map,this.Ib=new N,this.Ob=new N;const s=void 0===i?A(Ye):R(A(Ye),tn(i));this.Mb=new le(t,s),this.Mb.xv().l(t=>{this.Ib.M()&&this.Ib.m(this.Eb(t()))},this),this.Mb.qc().l(t=>{this.Ob.M()&&this.Ob.m(this.Eb(t()))},this);const e=this.Mb.Yt();this.Vb=new Qe(e,this.Mb.Bm())}remove(){this.Mb.xv().v(this),this.Mb.qc().v(this),this.Vb.S(),this.Mb.S(),this.Lb.clear(),this.Nb.clear(),this.Ib.S(),this.Ob.S(),this.Bb.S()}resize(t,i,s){this.autoSizeActive()||this.Mb.Pm(t,i,s)}addAreaSeries(t){return this.zb("Area",Ie,t)}addBaselineSeries(t){return this.zb("Baseline",De,t)}addCloudAreaSeries(t={}){return this.zb("CloudArea",Xe,t)}addBrokenAreaSeries(t={}){return this.zb("BrokenArea",Je,t)}addBarSeries(t){return this.zb("Bar",Ae,t)}addCandlestickSeries(t={}){return void 0!==(i=t).borderColor&&(i.borderUpColor=i.borderColor,i.borderDownColor=i.borderColor),void 0!==i.wickColor&&(i.wickUpColor=i.wickColor,i.wickDownColor=i.wickColor),this.zb("Candlestick",$e,t);var i}addHistogramSeries(t){return this.zb("Histogram",je,t)}addLineSeries(t){return this.zb("Line",Ue,t)}removeSeries(t){const i=y(this.Lb.get(t)),s=this.Bb.dd(i);this.Mb.Yt().dd(i),this.Fb(s),this.Lb.delete(t),this.Nb.delete(i)}Cb(t,i){this.Fb(this.Bb.ab(t,i))}Tb(t,i){this.Fb(this.Bb.fb(t,i))}subscribeClick(t){this.Ib.l(t)}unsubscribeClick(t){this.Ib.p(t)}subscribeCrosshairMove(t){this.Ob.l(t)}unsubscribeCrosshairMove(t){this.Ob.p(t)}clearCrosshairPosition(){this.Mb.Yt().ld()}priceScale(t){return void 0===t&&(t=this.Mb.Yt().pd()),new Ze(this.Mb,t)}timeScale(){return this.Vb}applyOptions(t){this.Mb.sl(tn(t))}options(){return this.Mb.W()}takeScreenshot(){return this.Mb.Om()}autoSizeActive(){return this.Mb.Wm()}fullUpdate(){return this.Mb.Yt().ql()}setCrosshair(t,i,s){this.Mb.Am()[0].Nv(t,i,s)}zb(t,i,s={}){!function(t){if(void 0===t||"custom"===t.type)return;const i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;let i=0;for(;i<8;i++){const s=Math.round(t);if(Math.abs(s-t)<1e-8)return i;t*=10}return i}(i.minMove))}(s.priceFormat);const e=R(A(He),A(i),s),n=this.Mb.Yt()._d(t,e),h=new Ke(n,this,this);return this.Lb.set(h,n),this.Nb.set(n,h),h}Fb(t){const i=this.Mb.Yt();i.ad(t.kt.qe,t.kt.gb,t.kt.wb),t.mb.forEach((t,i)=>i.it(t.Ur,t.bb)),i.zu()}Wb(t){return y(this.Nb.get(t))}Eb(t){const i=new Map;t.Gm.forEach((t,s)=>{const e=Re(s.vl())(t);var n;S(void 0!==(n=e).lowerValue||void 0!==n.open||void 0!==n.value),i.set(this.Wb(s),e)});const s=void 0===t.Km?void 0:this.Wb(t.Km);return{time:t.ut,logical:t.Xs,point:t.Zm,hoveredSeries:s,hoveredObjectId:t.Jm,seriesData:i,sourceEvent:t.Qm}}}function en(t,i){let s;if(Y(t)){const i=document.getElementById(t);S(null!==i,`Cannot find element in DOM with id=${t}`),s=i}else s=t;return new sn(s,i)}function nn(t){t.state.open=t.state.close,t.state.high=t.state.close,t.state.low=t.state.close}function hn(t){t.state.point={open:t.state.open,high:t.state.high,low:t.state.low,close:t.state.close}}function on(t){t.state.points.push(t.state.output),t.state.count++,t.state.count>t.length-1&&(t.state.points.shift(),t.state.count--)}function rn(t){void 0!==t.state.output&&(t.state.points.push(t.state.output),t.state.sum+=t.state.output,t.state.count++,t.state.count>t.length-1&&(t.state.sum-=t.state.points.shift(),t.state.count--))}const ln={avg_ohlc:{state:{open:null,high:null,low:null,close:null},next:nn,update(t,i){let s,e=0,n=!1,h=0,o=0,r=0;null===t.open&&(n=!0,s=0);for(const l in i.sources)i.sources[l].active&&null!==i.sources[l].open&&(n&&(s+=i.sources[l].open),h+=i.sources[l].high,o+=i.sources[l].low,r+=i.sources[l].close,e++);return e?(n&&(t.open=s/e),t.high=Math.max(t.open,h/e),t.low=Math.min(t.open,o/e),t.close=r/e,{time:i.localTimestamp,open:t.open,high:t.high,low:t.low,close:t.close}):{time:i.localTimestamp}}},heikinashi:{args:[{instruction:"renderer.localTimestamp",injected:!0}],state:{open:null,high:null,low:null,close:null},next:hn,update:(t,i,s)=>(t.high=s.high,t.low=s.low,t.open=s.open,t.close=(t.open+t.high+t.low+t.close)/4,void 0!==t.point?t.open=(t.point.open+t.point.close)/2:t.open=(t.open+t.close)/2,t.low=Math.min(t.open,t.low,t.close),t.high=Math.max(t.open,t.high,t.close),{time:i,open:t.open,high:t.high,low:t.low,close:t.close})},avg_heikinashi:{state:{open:null,high:null,low:null,close:null},next:hn,update(t,i){let s=0;t.open=0,t.high=0,t.low=0,t.close=0;for(const e in i.sources)i.sources[e].active&&null!==i.sources[e].open&&(t.open+=i.sources[e].open,t.high+=i.sources[e].high,t.low+=i.sources[e].low,t.close+=i.sources[e].close,s++);return s||(s=1),t.high/=s,t.low/=s,t.open/=s,t.close=(t.open+t.high+t.low+t.close/s)/4,void 0!==t.point?t.open=(t.point.open+t.point.close)/2:t.open=(t.open+t.close)/2,t.low=Math.min(t.open,t.low,t.close),t.high=Math.max(t.open,t.high,t.close),{time:i.localTimestamp,open:t.open,high:t.high,low:t.low,close:t.close}}},avg_ohlc_with_gaps:{state:{open:null,high:null,low:null,close:null},next:function(t){t.state.open=null,t.state.high=null,t.state.low=null},update(t,i){let s=0,e=0,n=0,h=0,o=0;for(const r in i.sources)i.sources[r].active&&null!==i.sources[r].open&&(e+=i.sources[r].open,n+=i.sources[r].high,h+=i.sources[r].low,o+=i.sources[r].close,s++);return s?(t.open=e/s,t.high=Math.max(null===t.high?-1/0:t.high,n/s),t.low=Math.min(null===t.low?1/0:t.low,h/s),t.close=o/s,{time:i.localTimestamp,open:t.open,high:t.high,low:t.low,close:t.close}):{time:i.localTimestamp}}},avg_close:{update(t,i){let s=0;t.close=0;for(const e in i.sources)i.sources[e].active&&null!==i.sources[e].open&&(t.close+=i.sources[e].close,s++);return s||(s=1),t.close/=s,t.close}},ohlc:{args:[{instruction:"renderer.localTimestamp",injected:!0}],next:nn,update:(t,i,s)=>(void 0===t.open&&(t.open=s,t.high=s,t.low=s),t.high=Math.max(t.high,s),t.low=Math.min(t.low,s),t.close=s,{time:i,open:t.open,high:t.high,low:t.low,close:t.close})},cum_ohlc:{args:[{instruction:"renderer.localTimestamp",injected:!0}],next:nn,update:(t,i,s)=>(void 0===t.open?(t.open=s,t.high=s,t.low=s):s=t.open+s,t.high=Math.max(t.high,s),t.low=Math.min(t.low,s),t.close=s,{time:i,open:t.open,high:t.high,low:t.low,close:t.close})},cum:{next:nn,update(t,i){if(!isNaN(i))return void 0===t.open&&(t.open=i),t.close=t.open+i,t.close}},pivot_high:{args:[{},{length:!0},{length:!0}],state:{points:[],count:0},next:on,update(t,i,s,e){t.output=i;let n=t.points[s];void 0===n&&(n=i);const h=s+e;for(let o=0;o<=h;o++){if((o<h-1?t.points[o]:i)>n)return null}return n}},pivot_low:{args:[{},{length:!0},{length:!0}],state:{points:[],count:0},next:on,update(t,i,s,e){t.output=i;let n=t.points[s];void 0===n&&(n=i);const h=s+e;for(let o=0;o<=h;o++){if((o<h-1?t.points[o]:i)<n)return null}return n}},highest:{args:[{},{length:!0}],state:{points:[],count:0},next:on,update:(t,i,s)=>(t.output=i,t.count>1?Math.max.apply(null,t.points):i)},lowest:{args:[{},{length:!0}],state:{points:[],count:0},next:on,update:(t,i,s)=>(t.output=i,t.count>1?Math.min.apply(null,t.points):i)},linreg:{args:[{},{length:!0}],state:{points:[],count:0},next:on,update(t,i,s){if(t.output=i,t.count<1)return null;let e=0,n=0,h=0,o=0,r=0,l=0;for(let c=0;c<=t.points.length;c++){const s=c===t.points.length?i:t.points[c];n=c+1,h+=n,o+=s,r+=n*n,l+=s*n,e++}const a=(e*l-h*o)/(e*r-h*h);return o/e-a*h/s+a+a*(e-1)}},avg:{update(t,i){let s=0,e=0;for(let n=0;n<i.length;n++)null!==i[n]&&(e+=i[n],s++);return e/s}},sum:{args:[{},{length:!0}],state:{count:0,sum:0,points:[]},next:rn,update:(t,i)=>(t.output=i,t.sum+i)},sma:{args:[{},{length:!0}],state:{count:0,sum:0,points:[]},next:rn,update(t,i){const s=(t.sum+i)/(t.count+1);return t.output=i,s}},cma:{args:[{},{length:!0}],state:{count:0,sum:0,points:[]},next:rn,update:(t,i)=>(t.output=(t.sum+i)/(t.count+1),t.output)},ema:{args:[{},{length:!0}],state:{count:0,sum:0,points:[]},next:rn,update(t,i,s){const e=2/(s+1);if(t.count){const s=t.points[t.points.length-1];t.output=(i-s)*e+s}else t.output=i;return t.output}},last:{args:[{},{length:!0}],state:{points:[],count:0},next:on,update:(t,i)=>(t.output=i,t.count?t.points[0]:i)},rma:{args:[{},{length:!0}],state:{count:0,sum:0,points:[]},next:rn,update(t,i,s){const e=1/s;if(t.count){const s=t.points[t.points.length-1];t.output=e*i+(1-e)*s}else t.output=i;return t.output}},merge_overlapping_intervals:{args:[{},{},{}],state:{count:0,sum:0,points:[]},update:(t,i,s,e)=>i.length?i.sort((t,i)=>t.range[0]-i.range[0]).reduce((t,i,s)=>{const e=t.length-1;return s&&t[e].range[1]>=i.range[0]?(t[e].bottom=(t[e].bottom*t[e].strength+i.range[0]*i.strength)/(t[e].strength+i.strength),t[e].top=(t[e].top*t[e].strength+i.range[1]*i.strength)/(t[e].strength+i.strength),t[e].range=[Math.min(i.range[0],t[e].range[0]),Math.max(i.range[1],t[e].range[1])],t[e].ids.push(i.id),t[e].strength+=i.strength,t):(i.bottom=Math.min(i.range[0],i.range[1]),i.top=Math.max(i.range[0],i.range[1]),t.push({...i,ids:[i.id]}),t)},[]).reduce((t,i)=>(i.strength<(s||1)||(i.range=[i.bottom,i.top],t.push(i)),t),[]):[]},stoch:{args:[!0,!0,!0,{length:!0}],state:{count:0,lows:[],highs:[]},next:function(t){t.state.lows.push(t.state.low),t.state.highs.push(t.state.high),t.state.count++,t.state.count>t.length-1&&(t.state.lows.shift(),t.state.highs.shift(),t.state.count--)},update(t,i,s,e){t.low=e;const n=t.count>0?Math.min(Math.min.apply(null,t.lows),e):e;t.high=s;const h=t.count>0?Math.max(Math.max.apply(null,t.highs),s):s;return t.output=100*(i-n)/(h-n||1),t.output}},na:t=>t||0,interpolate:{state:{paletteId:null,colorsRgb:null,ratio:null,output:null},update(e,n,...h){if(!e.paletteId||e.paletteId!==h.join("")){try{e.colorsRgb=h.map(i=>t(i,null,!0))}catch(o){throw new Error(`interpolate(): failed to parse color codes\n\t${h.join(", ")}`)}e.paletteId=h.join("")}return e.ratio!==n&&(e.output=i(s(n,...e.colorsRgb)),e.ratio=n),e.output}}};var an=(t=>(t[t.text=0]="text",t[t.number=1]="number",t[t.range=2]="range",t[t.list=3]="list",t[t.lineType=4]="lineType",t[t.lineStyle=5]="lineStyle",t[t.color=6]="color",t[t.checkbox=7]="checkbox",t[t.exchange=8]="exchange",t))(an||{});const cn="vars",un="fns",dn=["vbuy","vsell","cbuy","csell","lbuy","lsell"],fn={candlestick:"ohlc",bar:"ohlc",line:"number",histogram:"number",area:"number",cloudarea:"range",brokenarea:"range",baseline:"number"},pn=/^\/.+\/\w?$/,mn=Object.values(an);function gn(t,i){const{id:s,libraryId:h}=t,o=function(t,i,s,h){const o=[],r=[],l=[],a={},c=[],u={},d=[],f=[];let p=t.replace(/\/\/.*/g,"");p=function(t,i){const s=new RegExp("[\\s\\n]*(\\w[\\d\\w]+)[\\s\\n]*=[\\s\\n]*option\\(","g");let h=null,o=0;do{if(h=s.exec(t)){const o=h.index,r=e(t,o+h[0].length-1),l=xn(n(t.slice(o+h[0].length,r)).filter(t=>t.length));if(t=t.replace(t.slice(o,r+1),""),l.type?"exchange"===l.type&&(l.rebuild=!0):l.type="number",l.default||(l.default="text"===l.type?"":Math.max(l.min||0,0)),!mn.includes(l.type))throw new Error(`Unknown option type ${l.type}`);i[h[1]]=l,s.lastIndex-=h[0].length}}while(h&&++o<1e3);for(const e in i)t=t.replace(new RegExp("([^.]|^)\\b("+e+")\\b(?!:|=)","ig"),`$1options.${e}`);return t}(p,u),p=function(t,i){const s=new RegExp("source\\(","g");let h=null,o=0;do{if(h=s.exec(t)){const s=h.index,o=e(t,s+h[0].length-1),r=n(t.slice(s+h[0].length,o)).filter(t=>t.length);let l;-1===r[0].indexOf("=")&&(l=r.shift().replace(/\W/g,""));const a=xn(r);t=t.replace(t.slice(s,o+1),`#SOURCE${i.length}#`),i.push({prop:l,filters:a})}}while(h&&++o<1e3);return t}(p,c),p=function(t,i){return t=t.replace(/([^.])?\b(indicatorId)\b/gi,`$1'${i}'`),t=t.replace(/([^.])?\b(bar)\b/gi,"$1renderer"),t=t.replace(/([^.]|^)\b(vbuy|vsell|cbuy|csell|lbuy|lsell)\b/gi,"$1renderer.bar.$2"),t=t.replace(/([^.]|^)\b(time)\b([^:])/gi,"$1renderer.localTimestamp$3"),t=t.replace(/renderer\.indicators\[[\w\d_\-'"` ]+\]\.series\[([\w\d_\-'"`.\][ ]+)\]/g,"renderer.series[series[$1].id]"),t}(p,i),p=function(t,i){const s=/'([^']*)'|"([^"]*)"|`([^`]*)`/;let n=null,h=0;do{if(n=s.exec(t)){let s=i.indexOf(n[0]);-1===s&&(s=i.push(n[0])-1),t=t.slice(0,n.index)+"#STRING_"+s+"#"+t.slice(n.index+n[0].length)}}while(n&&++h<1e3);const o=/\(/g;let r;h=0;do{if(r=o.exec(t)){const i=e(t,r.index,/\(|{|\[/,/\)|}|\]/);if(-1!==i){const s=t.slice(r.index+1,i).replace(/\n/g," ");t=t.slice(0,r.index)+t.slice(r.index,r.index+1)+s.replace(/\n/g,"")+t.slice(i,i+1)+"\n"+t.slice(i+1,t.length),o.lastIndex=i}}}while(r&&++h<1e3);return t}(p,f),p=function(t,i){const s=/(?:^|\n)\s*((?:var )?[a-zA-Z0-9_]+)\(?(\d*)\)?\s*=\s*([^\n;,]*)?/;let e=null,n=0;const h=[];do{if(e=s.exec(t)){let s=e[1];const n=/^var/.test(s);if(-1!==h.indexOf(s)||n){n&&(s=s.replace(/var\s*/,""),t=t.replace(e[0],"\nvar "+s+"="+e[3]),h.push(s)),t=t.replace(new RegExp("([^.$]|^)\\b("+s+")\\b(?!:)(?!\\()(?!\\$)","ig"),`$1${s}$`);continue}const o=+e[2]||1;t=t.replace(new RegExp("([^.]|^)\\b("+s+")\\b(?!:)","ig"),`$1${cn}[${i.length}]`);const r={length:o};i.push(r),t=t.replace(new RegExp(`(${cn}\\[${i.length-1}\\])\\(${r.length}\\)\\s*=\\s*`),"$1=")}}while(e&&++n<1e3);return t=function(t,i){for(const s of i){const e=i.indexOf(s),n=new RegExp(`${cn}\\[${e}\\](?:\\[(\\d+)\\])?`,"g");let h=null,o=0;do{if(h=n.exec(t)){const i=h[1],o=h.index+h[0].length;if(void 0===i){const i="["===t[o];t=t.substring(0,o)+".state"+(i?"":"[0]")+t.substring(o)}else{const s=t.substring(0,h.index),o=`${cn}[${e}].state[Math.min(${cn}[${e}].state.length-1,${i})]`,r=t.substring(h.index+h[0].length);t=`${s}${o}${r}`,n.lastIndex=s.length+o.length}s.length=Math.max(s.length,(+i||0)+1)}}while(h&&++o<1e3);if(!s.length)throw new Error("Unexpected no length on var");1===s.length&&(t=t.replace(new RegExp(`${cn}\\[${e}\\]\\.state\\[\\d+\\]`,"g"),`${cn}[${e}].state`)),t=t.replace(new RegExp(`#${cn}\\[${e}\\]\\.state\\[\\d+\\]`,"g"),`${cn}[${e}].state`)}return t}(t,i),t}(p,r),p=function(t,i){const s=/\b([A-Z_]{3,}:[a-zA-Z0-9/_-]{1,})(:[\w]{3,})?\.?([a-z]{3,})?\b/g;let e=null,n=0;do{if(e=s.exec(t)){const n=e[1]+(e[2]?e[2]:""),h=e[3];i[n]||(i[n]=[]),h&&-1===i[n].indexOf(h)&&i[n].push(h);const o=`renderer.sources['${n}']${h?"."+h:""}`;s.lastIndex=e.index+o.length,t=t.slice(0,e.index)+o+t.slice(e.index+e[0].length)}}while(e&&++n<1e3);return t}(p,a);for(let e=0;e<f.length;e++)p=p.replace(new RegExp("#STRING_"+e+"#","g"),f[e].replace(/\$/g,"$$$"));return p=function(t,i,s,h,o){const r=new RegExp("([a-zA-Z0_9_]+)\\(","g");let l=null,a=0;do{if(l=r.exec(t)){const a=l[1];if("."===t[l.index-1]){r.lastIndex=l.index+l[0].length;continue}if(fn[a.replace(/^plot/,"")]){const i=wn(t,l,s,h,o);t=i.output,r.lastIndex=l.index+i.offset;continue}const c=ln[a];if(!c){r.lastIndex=l.index+l[0].length;continue}const u={name:a,args:[]},d=l.index,f=e(t,d+l[1].length),p=n(t.slice(d+l[1].length+1,f)).filter(t=>t.length);if("function"==typeof ln[a]){t=`${t.slice(0,d)}utils.${a}(${p.join(",")})${t.slice(f+1,t.length)}`;continue}let m=0,g=(c.args?c.args.length:0)+p.length;for(let t=0;t<g;t++){const i=c.args?c.args[t]:null,s={...i||{}};if(i){if(i.injected){m++,u.args.push(s);continue}c.args[t]&&g--}const e=p[t-m];void 0!==e&&(s.instruction=e),u.args.push(s)}const v=`utils.${a}.update`,b=`${v}(${un}[${i.length}].state,${u.args.map(t=>t.instruction).join(",")})`;t=`${t.slice(0,d)}${b}${t.slice(f+1,t.length)}`,i.push(u),r.lastIndex=l.index+v.length}}while(l&&++a<1e3);return t}(p,o,l,s,h),p=function(t,i,s,e,n){const h=new RegExp("\\$(\\w+[a-z_\\-0-9]+)\\b");let o=null,r=0;do{if(o=h.exec(t)){const h=o[1];try{const[o,r]=Mn(h,s,e,n);i.find(t=>t.indicatorId===o&&t.plotIndex===r)||i.push({indicatorId:o,serieId:h,plotIndex:r,plotType:"unknown"}),t=t.replace(new RegExp("\\$("+h+")\\b","ig"),`renderer.series['${h}']`)}catch(l){throw{message:`The serie "${h}" was not found in the current indicators`,status:"indicator-required",serieId:h}}}}while(o&&++r<1e3);return t}(p,d,l,i,h),p=function(t){const i=/\(|{|\[/g;let s,n=0;do{if(s=i.exec(t)){const n="("===s[0],h=e(t,s.index,/\(|{|\[/,/\)|}|\]/),o=t.slice(s.index+1,h).replace(/\n/g," ");/if|for|else/.test(t.slice(s.index-2,2))&&(t=t.slice(0,s.index)+t.slice(s.index,s.index+1)+o+t.slice(h,h+1)+(n?"\n":"")+t.slice(h+1,t.length)),i.lastIndex=h}}while(s&&++n<1e3);return t.trim().split(/\n/).join("\n").replace(/\n\n/g,"\n")}(p),{output:p,functions:o,variables:r,plots:l,markets:a,references:d,options:u,sources:c}}(t.script,s,h,i);for(const e of o.functions)vn(e);for(const e of o.variables)bn(e);return{output:o.output,functions:o.functions,variables:o.variables,references:o.references,markets:o.markets,sources:o.sources,options:o.options,plots:o.plots}}function vn(t){if(t.name,"object"!=typeof ln[t.name].state)t.state={};else{t.state={};for(const s in ln[t.name].state)try{t.state[s]=JSON.parse(JSON.stringify(ln[t.name].state[s]))}catch(i){t.state[s]=ln[t.name].state[s]}}}function bn(t){t.length>1?t.state=[0]:t.state=0}function wn(t,i,s,r,l){const a=i[1].replace(/^plot/,""),c=e(t,i.index+i[1].length),u=t.slice(i.index+i[1].length+1,c),d=i[1]+"("+u+")",f=n(u).filter(t=>t.length),p=xn(f),m=Object.keys(l).concat(s.map(t=>t.id));let g;"string"==typeof p.id&&p.id.length?(g=p.id,delete p.id):g=0===s.length?r:h(8),g=o(g,m,!1,"2");let v=`${`renderer.series['${g}']`} = `;const b=fn[a];let w="renderer.localTimestamp";p.offset&&(w+=`+renderer.timeframe*${p.offset}`);const x=/{/.test(f[0])&&/}/.test(f[0]),M=/^[\w_$]+\$/.test(f[0]);if(f.length){if(1===f.length&&(x||"line"!==a&&M))v+=f[0];else if("ohlc"===b)if(4===f.length)v+=`{ time: ${w}, open: ${f[0]}, high: ${f[1]}, low: ${f[2]}, close: ${f[3]} }`;else{if(1!==f.length)throw new Error(`Invalid input for function ${i[1]}, expected a ohlc object or 4 number`);/^[A-Z_]+:\w+/.test(f[0])?v+=`${f[0]}.close === null ? { time: ${w} } : { time: ${w}, open: ${f[0]}.open, high: ${f[0]}.high, low: ${f[0]}.low, close: ${f[0]}.close }`:v+=f[0]}else if("range"===b){if(2!==f.length)throw new Error(`Invalid input for function ${i[1]}, expected 2 arguments (lowerValue and higherValue)`);v+=`{ time: ${w}, lowerValue: ${f[0]}, higherValue: ${f[1]} }`}else if("number"===b){if(1!==f.length)throw new Error(`Invalid input for function ${i[1]}, expected 1 value (number)`);v+=`{ time: ${w}, value: ${f[0]} }`}}else v="";return t=t.replace(d,v),s.push({id:g,type:zn[a]||a,expectedInput:b,options:p}),{output:t,offset:v.length?i[0].length:0}}function xn(t,i=0){const s={};for(let n=i;n<t.length;n++)try{const[,i,h]=t[n].match(/^(\w+)\s*=([\S\s]*)/);if(!i||!h.length)continue;let o=h.trim();try{o=JSON.parse(o)}catch(e){o=o.replace(/^'(.*)'$|^"(.*)"$/,"$1$2")}s[i.trim()]=o,t.splice(n,1),n--}catch(e){continue}return s}function Mn(t,i,s,e){let n,h;const o=i.find(i=>i.id===t||i.id.replace(/\W/g,"")===t.replace(/\W/g,""));if(o&&(n=s,h=i.indexOf(o)),!n&&e[t]&&({indicatorId:n,plotIndex:h}=e[t]),n||-1===Object.values(e).map(t=>t.indicatorId).indexOf(t)||(n=t,h=0),n)return[n,h]}function Sn(t,i,s){let e=t.output;return t.sources.length&&(e=function(t,i,s){const e=r.state.panes.marketsListeners;let n=t.output;const h=["open","high","low","close"];for(let o=0;o<t.sources.length;o++){const r=[],l=`#SOURCE${o}#`,a=t.sources[o].prop,c=Object.keys(t.sources[o].filters).reduce((i,e)=>{const n=t.sources[o].filters[e],[h,r]=n.split(".");return i[e]="options"===h&&r?s[r]:n,pn.test(i[e])&&(i[e]=new RegExp(i[e].slice(1,-1))),i},{});for(const t in i)!1!==i[t]&&(c.type&&e[t].type!==c.type||c.exchange&&e[t].exchange!==c.exchange||c.quote&&e[t].quote!==c.quote||c.name&&(c.name instanceof RegExp&&!c.name.test(e[t].local)||"string"==typeof c.name&&e[t].local!==c.name)||r.push(t));n=r.length?a?-1!==h.indexOf(a)?n.replace(l,`(() => {\n              let count = 0;\n              let sum = 0;\n              ${r.map(t=>`if (renderer.sources['${t}'].${a}) {\n                count++;\n                sum += renderer.sources['${t}'].${a}\n              }`).join(";")}\n              return sum / count\n            })()`):n.replace(l,`(${r.map(t=>`renderer.sources['${t}'].${a}`).join("+")})`):n.replace(l,`{\n            timestamp: renderer.timestamp,\n            localTimestamp: renderer.localTimestamp,\n            sources: {\n              ${r.map(t=>`'${t}': renderer.sources['${t}']`).join(",")}\n            },\n          }`):n.replace(l,a?"0":"{\n          timestamp: renderer.timestamp,\n          localTimestamp: renderer.localTimestamp,\n          sources: {}\n        }")}return n}(t,i,s)),new Function("renderer",un,cn,"series","options","utils",'"use strict"; '+e)}function yn(t){const{functions:i,variables:s,plots:e}=JSON.parse(JSON.stringify(t.model));t.options.minLength=0;for(const o of i){o.length=0;for(let i=0;i<o.args.length;i++)if(void 0!==o.args[i].instruction&&""!==o.args[i].instruction)try{o.args[i].instruction=new Function("options",`'use strict'; return ${o.args[i].instruction}`)(t.options),o.args[i].length&&!isNaN(o.args[i].instruction)&&(o.length+=o.args[i].instruction)}catch(h){}t.options.minLength=Math.max(t.options.minLength,2*o.length)}const n=[];for(const o of e)n.push(Cn(t,o));return{canRender:t.options.minLength<=1,functions:i,variables:s,plotsOptions:n,minLength:t.options.minLength}}function Cn(t,i,s=null){const e={};for(const h in i.options)if(!s||s===h)try{e[h]=new Function("options",`'use strict'; return ${i.options[h]}`)(t.options)}catch(n){e[h]=i.options[h]}return s?e[s]:e}const _n={},Vn={},Tn={crosshair:{vertLine:{color:"rgba(255, 255, 255, .5)",width:1,style:2,visible:!0,labelVisible:!0},horzLine:{color:"rgba(255, 255, 255, .5)",width:1,style:2,visible:!0,labelVisible:!0},mode:0},watermark:{color:"rgba(255,255,255, 0.1)",visible:!1,text:"",horzAlign:"center",vertAlign:"center",fontFamily:"Spline Sans Mono",fontStyle:"600"},layout:{background:{type:Ls.Solid,color:"transparent"},textColor:"white",fontFamily:"Barlow Semi Condensed"},grid:{horzLines:{visible:!1},vertLines:{visible:!1}},timeScale:{barSpacing:4,minBarSpacing:0,rightOffset:12,lockVisibleTimeRangeOnResize:!1,borderVisible:!0,borderColor:"rgba(255, 255, 255, .2)",visible:!0,timeVisible:!0,secondsVisible:!0},rightPriceScale:{borderColor:"rgba(255, 255, 255, .2)",visible:!0,scaleMargins:{top:.1,bottom:.1}},leftPriceScale:{borderColor:"rgba(255, 255, 255, .2)",visible:!0,scaleMargins:{top:.1,bottom:.1}}},Ln={crosshairMarkerVisible:!1,lastValueVisible:!1,priceLineVisible:!1,baseLineVisible:!1,priceFormat:{type:"price",minMove:"0.01",precision:2}},kn={positiveColor:"rgba(76,175,80,0.1)",negativeColor:"rgba(255,82,82,0.1)",positiveLineColor:"#4CAF50",higherLineStyle:m.Simple,higherLineWidth:1,negativeLineColor:"#FF5252",lowerLineStyle:m.Simple,lowerLineWidth:1},En={...Tn,rightPriceScale:{mode:0},timeScale:{barSpacing:3,rightOffset:5,lockVisibleTimeRangeOnResize:!0,rightBarStaysOnScroll:!0,borderColor:"transparent",timeVisible:!0}},zn={cloudarea:"cloud-area",brokenarea:"broken-area"},Pn={line:{priceLineStyle:1,color:"white",lineWidth:1,lineStyle:0,lineType:0},area:{topColor:"rgba(21, 146, 230, 0.4)",bottomColor:"rgba(21, 146, 230, 0)",lineColor:"rgba(21, 146, 230, 1)",lineStyle:0,lineWidth:2},candlestick:{priceLineColor:null,borderVisible:!1,upColor:"#c3a87a",downColor:"#e53935",borderUpColor:"#c3a87a",borderDownColor:"#e53935",wickUpColor:"rgba(223, 195, 148, .8)",wickDownColor:"rgba(224, 91, 95, .8)"},baseline:{topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:1},"cloud-area":kn,"broken-area":{color:"rgba(76,175,80,0.1)"},bar:{thinBars:!1,upColor:"#a5d6a7",downColor:"#e57373",openVisible:!0},histogram:{color:"#c3a87a"}};function Wn(t){let i;if(t){i=14*(r.state.panes.panes[t].zoom||1)*("chart"===r.state.panes.panes[t].type?1:.75)}return i}function Bn(t){const i=getComputedStyle(document.documentElement),s=i.getPropertyValue("--theme-background-100"),e=r.state[t];return{layout:{textColor:(null==e?void 0:e.textColor)||i.getPropertyValue("--theme-color-100"),borderColor:s,fontSize:Wn(t)}}}function Nn(t){const i=r.state[t];return{watermark:{color:i.watermarkColor,visible:i.showWatermark}}}function Rn(t){const i=getComputedStyle(document.documentElement).getPropertyValue("--theme-color-o20");if(!t)return{timeScale:{borderColor:i},rightPriceScale:{borderColor:i},leftPriceScale:{borderColor:i}};const s=r.state[t];return{timeScale:{visible:s.showTimeScale,borderColor:s.borderColor||i,borderVisible:s.showBorder},rightPriceScale:{visible:s.showRightScale,borderColor:s.borderColor||i,borderVisible:s.showBorder},leftPriceScale:{visible:s.showLeftScale,borderColor:s.borderColor||i,borderVisible:s.showBorder}}}function Fn(t){const i=r.state[t];return{grid:{vertLines:{color:i.verticalGridlinesColor,visible:i.showVerticalGridlines},horzLines:{color:i.horizontalGridlinesColor,visible:i.showHorizontalGridlines}}}}function On(t,i){const s=r.state[t].barSpacing||3;return{timeScale:{barSpacing:s,rightOffset:Math.ceil(.05*i/s)}}}function Yn(t,i=""){return Object.values(t).reduce((t,s)=>(s.id!==i&&s.options&&s.options.priceScaleId&&!t[s.options.priceScaleId]&&(t[s.options.priceScaleId]=`${s.name} (${s.id.slice(0,8)}${s.id.length>8?"...":""})`),t),{[i]:"Own scale",left:"Left ←",right:"Right →"})}function $n(t,i){const s=Object.assign({},t);return l(s,Bn(i),function(){const t=getComputedStyle(document.documentElement).getPropertyValue("--theme-color-o50");return{crosshair:{vertLine:{color:t,labelVisible:!0},horzLine:{color:t,labelVisible:!0,labelBackgroundColor:getComputedStyle(document.documentElement).getPropertyValue("--theme-background-300")}}}}(),Rn(i))}function An(t){return l(Bn(t),$n(Tn),Nn(t),Fn(t))}function Un(t,i,s){if(!s&&void 0!==_n[t])return _n[t];if(i)for(const e of i)if(void 0!==Pn[e][t])return _n[t]=Pn[e][t],_n[t];return void 0!==Ln[t]?(_n[t]=Ln[t],Ln[t]):/length$/i.test(t)?(_n[t]=14,_n[t]):/color$/i.test(t)?(_n[t]=a(),_n[t]):/width$/i.test(t)?(_n[t]=1,_n[t]):null}function In(t,i,s,e){if(!s&&void 0!==Vn[t])return Vn[t];void 0===e&&(e=Un(t,i,s));let n,h="text";try{n=JSON.parse(e)}catch(o){n=e}return"boolean"==typeof n||/^(show|toggle|set|use)[A-Z]/.test(t)?h="checkbox":/color/i.test(t)||/^rgba?/.test(n)||/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(n)?h="color":"number"==typeof n&&(h="number"),Vn[t]=h,h}function Xn(t,i,s,e){let n;void 0!==r.state[t].indicators[i].options[s]&&(n=r.state[t].indicators[i].options[s]);const h=Un(s,e);return void 0!==n?n&&"object"==typeof n&&h&&"object"==typeof h?Object.assign({},h,n):n:void 0!==h?h:null}function Jn(t,i,s){s&&s.priceFormat&&(t.options.priceFormat={...t.options.priceFormat,...s.priceFormat});const e=Cn(t,i);return{...Ln,...Pn[i.type]||{},...t.options,...s&&s.scaleMargins?{scaleMargins:{top:s.scaleMargins.top,bottom:s.scaleMargins.bottom}}:{},...e}}export{an as A,dn as D,fn as S,en as Z,Un as a,Yn as b,Xn as c,Pn as d,Ln as e,Bn as f,In as g,Rn as h,Fn as i,An as j,$n as k,Tn as l,Nn as m,On as n,Wn as o,zn as p,gn as q,yn as r,Sn as s,Jn as t,ln as u,En as v};
