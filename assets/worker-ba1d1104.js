var __defProp=Object.defineProperty,__defNormalProp=(e,t,i)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,__publicField=(e,t,i)=>(__defNormalProp(e,"symbol"!=typeof t?t+"":t,i),i);(function(){"use strict";var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var eventemitter3={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,i="~";function s(){}function r(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function n(e,t,s,n,o){if("function"!=typeof s)throw new TypeError("The listener must be a function");var a=new r(s,n||e,o),u=i?i+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],a]:e._events[u].push(a):(e._events[u]=a,e._eventsCount++),e}function o(e,t){0===--e._eventsCount?e._events=new s:delete e._events[t]}function a(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(i=!1)),a.prototype.eventNames=function(){var e,s,r=[];if(0===this._eventsCount)return r;for(s in e=this._events)t.call(e,s)&&r.push(i?s.slice(1):s);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},a.prototype.listeners=function(e){var t=i?i+e:e,s=this._events[t];if(!s)return[];if(s.fn)return[s.fn];for(var r=0,n=s.length,o=new Array(n);r<n;r++)o[r]=s[r].fn;return o},a.prototype.listenerCount=function(e){var t=i?i+e:e,s=this._events[t];return s?s.fn?1:s.length:0},a.prototype.emit=function(e,t,s,r,n,o){var a=i?i+e:e;if(!this._events[a])return!1;var u,l,c=this._events[a],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,s),!0;case 4:return c.fn.call(c.context,t,s,r),!0;case 5:return c.fn.call(c.context,t,s,r,n),!0;case 6:return c.fn.call(c.context,t,s,r,n,o),!0}for(l=1,u=new Array(d-1);l<d;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var p,h=c.length;for(l=0;l<h;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),d){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,s);break;case 4:c[l].fn.call(c[l].context,t,s,r);break;default:if(!u)for(p=1,u=new Array(d-1);p<d;p++)u[p-1]=arguments[p];c[l].fn.apply(c[l].context,u)}}return!0},a.prototype.on=function(e,t,i){return n(this,e,t,i,!1)},a.prototype.once=function(e,t,i){return n(this,e,t,i,!0)},a.prototype.removeListener=function(e,t,s,r){var n=i?i+e:e;if(!this._events[n])return this;if(!t)return o(this,n),this;var a=this._events[n];if(a.fn)a.fn!==t||r&&!a.once||s&&a.context!==s||o(this,n);else{for(var u=0,l=[],c=a.length;u<c;u++)(a[u].fn!==t||r&&!a[u].once||s&&a[u].context!==s)&&l.push(a[u]);l.length?this._events[n]=1===l.length?l[0]:l:o(this,n)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&o(this,t)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,e.exports=a}(eventemitter3);var eventemitter3Exports=eventemitter3.exports;function randomString(e=16,t="abcdefghijklmnopqrstuvwxyz0123456789"){let i="";const s=t.length;for(let r=0;r<e;r++)i+=t.charAt(Math.floor(Math.random()*s));return i}function parseMarket(e){return e.match(/([^:]*):(.*)/).slice(1,3)}function getHms(e,t=!1,i=","){if(isNaN(e)||null===e)return null;const s=e<0?"-":"";e=Math.abs(e);const r=Math.floor(e/1e3/86400),n=Math.floor(e/1e3%86400/3600),o=Math.floor(e/1e3%3600/60),a=Math.floor(e/1e3%3600%60);let u="";return u+=t&&u.length||!(r>0)?"":(u.length?`${i} `:"")+s+r+"d",u+=t&&u.length||!(n>0)?"":(u.length?`${i} `:"")+s+n+"h",u+=t&&u.length||!(o>0)?"":(u.length?`${i} `:"")+s+o+"m",u+=t&&u.length||!(a>0)?"":(u.length?`${i} `:"")+s+a+"s",(!u.length||!t&&e<6e4&&e>1e3*a)&&(u+=(u.length?`${i} `:"")+s+(e-1e3*a)+"ms"),u.trim()}function sleep(e=1e3){return new Promise(t=>{setTimeout(()=>t(),e)})}function dispatchAsync(e){const t=randomString(8);return new Promise(i=>{const s=({data:t})=>{t.trackingId===e.trackingId&&(self.removeEventListener("message",s),i(t.data))};self.addEventListener("message",s),e.trackingId=t,self.postMessage(e)})}var settings={calculateSlippage:null,aggregationLength:null,preferQuoteCurrencySize:null,wsProxyUrl:null,buckets:{}};class Exchange extends eventemitter3Exports.EventEmitter{constructor(){super(),__publicField(this,"id"),__publicField(this,"pairs",[]),__publicField(this,"products",null),__publicField(this,"delayBetweenMessages"),__publicField(this,"maxConnectionsPerApi"),__publicField(this,"endpoints"),__publicField(this,"keepAliveIntervals",{}),__publicField(this,"apis",[]),__publicField(this,"connecting",{}),__publicField(this,"disconnecting",{}),__publicField(this,"scheduledOperations",{}),__publicField(this,"scheduledOperationsDelays",{}),__publicField(this,"clearReconnectionDelayTimeout",{}),__publicField(this,"count",0)}get requiresProducts(){return!this.products&&this.endpoints.PRODUCTS}isMatching(e){return!(!this.products||!this.products.length)&&-1!==this.products.indexOf(e)}getUrl(e){throw new Error("Not implemented")}async link(e,t){if(e=e.replace(/[^:]*:/,""),!this.isMatching(e))return Promise.reject(`${this.id} couldn't match with ${e}`);this.resolveApi(e,t)}async resolveApi(e,t){const i=await this.getUrl(e);let s;s=settings.wsProxyUrl&&t?settings.wsProxyUrl+i:i;let r=this.getActiveApiByUrl(s);if(r||(r=this.createWs(s,e)),r._originalUrl=i,-1===r._pending.indexOf(e)&&-1===r._connected.indexOf(e)){if(r._pending.push(e),r.readyState===WebSocket.OPEN){const e="subscribe-"+r._id;clearTimeout(this.scheduledOperations[e]),this.scheduledOperations[e]=setTimeout(()=>{delete this.scheduledOperations[e],this.subscribePendingPairs(r)},1e3)}return r}}createWs(e,t){const i=new WebSocket(e);return i._id=randomString(),i.binaryType="arraybuffer",i._connected=[],i._pending=[],this.apis.push(i),i.onmessage=e=>{this.count++,!0===this.onMessage(e,i)&&(i._timestamp=Date.now())},i.onopen=t=>{i._wasOpened=!0,void 0!==this.scheduledOperationsDelays[e]&&(this.clearReconnectionDelayTimeout[e]=setTimeout(()=>{delete this.clearReconnectionDelayTimeout[e],delete this.scheduledOperationsDelays[e],i._reconnecting=!1},1e4)),this.markLoadingAsCompleted(this.connecting,i._id,!0),this.subscribePendingPairs(i),this.onOpen(t,i._connected)},i.onclose=async t=>{this.clearReconnectionDelayTimeout[e]&&(clearTimeout(this.clearReconnectionDelayTimeout[e]),delete this.clearReconnectionDelayTimeout[e]),this.markLoadingAsCompleted(this.connecting,i._id,!1),this.onClose(t,i._connected),this.markLoadingAsCompleted(this.disconnecting,i._id,!0);[...i._pending,...i._connected].length?setTimeout(()=>{this.reconnectApi(i)},this.getTimeoutDelay(i.url)):this.removeWs(i)},i.onerror=e=>{i._errored=!0,this.onError(e)},this.connecting[i._id]={},this.connecting[i._id].promise=new Promise((e,t)=>{this.connecting[i._id].resolver=s=>{s?(this.onApiCreated(i),e(i)):t()}}),i}async subscribePendingPairs(e){const t=e._pending.slice();for(const i of t)await this.subscribe(e,i)}async unlink(e){e=e.replace(/[^:]*:/,"");const t=this.getActiveApiByPair(e);if(t){if(-1===t._connected.indexOf(e)){const i=t._pending.indexOf(e);return void(-1!==i&&t._pending.splice(i,1))}return await this.unsubscribe(t,e),t._connected.length||t._pending.length?void 0:this.removeWs(t)}}getActiveApiByPair(e){for(let t=0;t<this.apis.length;t++)if(-1!==this.apis[t]._connected.indexOf(e)||-1!==this.apis[t]._pending.indexOf(e))return this.apis[t]}getActiveApiByUrl(e){for(let t=0;t<this.apis.length;t++)if(this.apis[t].readyState<2&&this.apis[t]._originalUrl===e&&(!this.maxConnectionsPerApi||this.apis[t]._connected.length+this.apis[t]._pending.length<this.maxConnectionsPerApi))return this.apis[t]}removeWs(e){let t;if(e.readyState!==WebSocket.CLOSED){if(e._connected.length)throw new Error("Cannot unbind api that still has pairs linked to it");this.disconnecting[e._id]={},this.disconnecting[e._id].promise=new Promise((t,i)=>{e.readyState<WebSocket.CLOSING&&e.close(),this.disconnecting[e._id].resolver=e=>e?t():i()}),t=this.disconnecting[e._id].promise}else t=Promise.resolve();return t.then(()=>{this.onApiRemoved(e),this.apis.splice(this.apis.indexOf(e),1)})}reconnectApi(e){if(-1===this.apis.indexOf(e))return!1;const t=[...e._pending,...e._connected],i=t.length>0;return this.removeWs(e),this.reconnectPairs(t,e._errored),i}async reconnectPairs(e,t){const i=e.slice(0,e.length);for(const s of i)await this.unlink(this.id+":"+s);await new Promise(e=>setTimeout(e,500));for(const s of i)await this.link(this.id+":"+s,t)}setProducts(e){if(!e)return this.products=null,null;if(!this.validateProducts(e))return this.products=null,!1;if("object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"products"))for(const t in e)this[t]=e[t];else Array.isArray(e)&&(this.products=e);return!0}async getProducts(e){if(!this.endpoints.PRODUCTS)return this.products;const t=await dispatchAsync({op:"getExchangeProducts",data:{exchangeId:this.id,endpoints:this.endpoints.PRODUCTS,forceFetch:e}});return!1===this.setProducts(t.data)?this.getProducts(!0):t.data}onOpen(e,t){this.emit("open",e)}onApiCreated(e){}onApiRemoved(e){}onMessage(e,t){throw new Error("Not implemented")}onError(e){this.emit("error",e)}onClose(e,t){this.emit("close",e)}formatProducts(e){return e}validateProducts(e){return!0}async subscribe(e,t){return!!this.markPairAsConnected(e,t)&&(this.emit("subscribed",t,e.url),e.readyState===WebSocket.OPEN&&(this.delayBetweenMessages&&await sleep(this.delayBetweenMessages*this.apis.length),!0))}async unsubscribe(e,t){return!!this.markPairAsDisconnected(e,t)&&(this.emit("unsubscribed",t,e._id),e.readyState===WebSocket.OPEN&&(this.delayBetweenMessages&&await sleep(this.delayBetweenMessages*this.apis.length),e.readyState===WebSocket.OPEN))}emitTrades(e,t){if(t&&t.length)return this.emit("trades",t),!0}emitLiquidations(e,t){if(t&&t.length)return this.emit("liquidations",t),!0}startKeepAlive(e,t={event:"ping"},i=3e4){const s=e._id||e.url;this.keepAliveIntervals[s]&&this.stopKeepAlive(e),this.keepAliveIntervals[s]=setInterval(()=>{e.readyState===WebSocket.OPEN&&e.send("function"==typeof t?JSON.stringify(t()):"string"==typeof t?t:JSON.stringify(t))},i)}stopKeepAlive(e){const t=e._id||e.url;this.keepAliveIntervals[t]&&(clearInterval(this.keepAliveIntervals[t]),delete this.keepAliveIntervals[t])}markLoadingAsCompleted(e,t,i){e[t]&&(e[t].resolver(i),delete e[t])}getTimeoutDelay(e,t=1e3){const i=Math.max(t,this.scheduledOperationsDelays[e]||0);return this.scheduledOperationsDelays[e]=1.5*i,i}markPairAsConnected(e,t){const i=e._pending.indexOf(t);if(-1===i)return!1;e._pending.splice(i,1);return-1===e._connected.indexOf(t)&&(e._connected.push(t),!0)}markPairAsDisconnected(e,t){const i=e._pending.indexOf(t);if(-1!==i)return e._pending.splice(i,1),!1;const s=e._connected.indexOf(t);return-1!==s&&(e._connected.splice(s,1),!0)}getEstimatedTimeToConnect(e){if(!this.delayBetweenMessages)return e;const t=e*this.delayBetweenMessages,i=Math.ceil(e/this.maxConnectionsPerApi);return this.maxConnectionsPerApi&&e>this.maxConnectionsPerApi?t/Math.ceil(e/this.maxConnectionsPerApi)*i:t}reconnectAllClosedApis(){this.scheduledOperationsDelays={};let e=!1;for(const t of this.apis)t.readyState==WebSocket.CLOSED&&!e&&this.reconnectApi(t)&&(e=!0);return e}}class AGGR extends Exchange{constructor(){super(...arguments),__publicField(this,"id","AGGR"),__publicField(this,"endpoints",{}),__publicField(this,"products",["SENTIMENTTV","SENTIMENTMEX"])}async getUrl(){return"wss://sentiment.aggr.trade"}async subscribe(e,t){if(await super.subscribe(e,t))return e.send(JSON.stringify({op:"SUBSCRIBE",channel:t})),!0}async unsubscribe(e,t){if(await super.unsubscribe(e,t))return e.send(JSON.stringify({op:"UNSUBSCRIBE",channel:t})),!0}formatTrade(e,t){return{exchange:this.id,pair:t,timestamp:+e.timestamp,price:+e.price,size:+e.volume,side:e.side}}onMessage(e,t){const i=JSON.parse(e.data);return this.emitTrades(t.id,[this.formatTrade(i.data,i.channel)])}}class ASTER extends Exchange{constructor(){super(...arguments),__publicField(this,"id","ASTER"),__publicField(this,"endpoints",{PRODUCTS:["https://fapi.asterdex.com/fapi/v1/exchangeInfo"]})}async getUrl(){return"wss://fstream.asterdex.com/ws"}formatProducts(e){const t=[];if(e&&Array.isArray(e.symbols))for(const i of e.symbols)"PERPETUAL"===i.contractType&&"TRADING"===i.status&&t.push(i.symbol);return{products:t}}async subscribe(e,t){if(await super.subscribe(e,t))return e.send(JSON.stringify({method:"SUBSCRIBE",params:[`${t.toLowerCase()}@aggTrade`],id:Date.now()})),!0}async unsubscribe(e,t){if(await super.unsubscribe(e,t))return e.send(JSON.stringify({method:"UNSUBSCRIBE",params:[`${t.toLowerCase()}@aggTrade`],id:Date.now()})),!0}onMessage(e,t){const i=JSON.parse(e.data);if(i.stream&&i.data&&"aggTrade"===i.data.e){const e=this.formatResponse(i.data);return this.emitTrades(t.id,[e])}if("aggTrade"===i.e){const e=this.formatResponse(i);return this.emitTrades(t.id,[e])}}formatResponse(e){const t=e.m?"sell":"buy";return{exchange:this.id,pair:e.s,timestamp:+e.T,price:+e.p,size:+e.q,side:t}}}class BINANCE extends Exchange{constructor(){super(...arguments),__publicField(this,"id","BINANCE"),__publicField(this,"lastSubscriptionId",0),__publicField(this,"subscriptions",{}),__publicField(this,"endpoints",{PRODUCTS:"https://data-api.binance.vision/api/v3/exchangeInfo"}),__publicField(this,"maxConnectionsPerApi",100),__publicField(this,"delayBetweenMessages",250)}async getUrl(){return"wss://data-stream.binance.vision:9443/ws"}formatProducts(e){return e.symbols.filter(e=>"TRADING"===e.status&&-1===e.permissions.indexOf("LEVERAGED")).map(e=>e.symbol.toLowerCase())}async subscribe(e,t){if(!(await super.subscribe(e,t)))return;this.subscriptions[t]=++this.lastSubscriptionId;const i=[t+"@"+(-1===settings.aggregationLength?"trade":"aggTrade")];return e.send(JSON.stringify({method:"SUBSCRIBE",params:i,id:this.subscriptions[t]})),!0}async unsubscribe(e,t){if(!(await super.unsubscribe(e,t)))return;const i=[t+"@"+(-1===settings.aggregationLength?"trade":"aggTrade")];return e.send(JSON.stringify({method:"UNSUBSCRIBE",params:i,id:this.subscriptions[t]})),delete this.subscriptions[t],!0}onMessage(e,t){const i=JSON.parse(e.data);if(i.E)return this.emitTrades(t.id,[{exchange:this.id,pair:i.s.toLowerCase(),timestamp:i.T,price:+i.p,size:+i.q,count:i.l-i.f+1,side:i.m?"sell":"buy"}])}}class BINANCE_FUTURES extends Exchange{constructor(){super(...arguments),__publicField(this,"id","BINANCE_FUTURES"),__publicField(this,"lastSubscriptionId",0),__publicField(this,"subscriptions",{}),__publicField(this,"specs"),__publicField(this,"dapi"),__publicField(this,"maxConnectionsPerApi",100),__publicField(this,"delayBetweenMessages",100),__publicField(this,"endpoints",{PRODUCTS:["https://fapi.binance.com/fapi/v1/exchangeInfo","https://dapi.binance.com/dapi/v1/exchangeInfo"]})}async getUrl(e){return this.dapi[e]?"wss://dstream.binance.com/ws":"wss://fstream.binance.com/ws"}formatProducts(e){const t=[],i={},s={};for(const r of e){const n=["fapi","dapi"][e.indexOf(r)];for(const e of r.symbols){if(e.contractStatus&&"TRADING"!==e.contractStatus||e.status&&"TRADING"!==e.status)continue;const r=e.symbol.toLowerCase();"dapi"===n&&(s[r]=!0),e.contractSize&&(i[r]=e.contractSize),t.push(r)}}return{products:t,specs:i,dapi:s}}async subscribe(e,t){if(!(await super.subscribe(e,t)))return;this.subscriptions[t]=++this.lastSubscriptionId;const i=[t+"@"+(-1===settings.aggregationLength?"trade":"aggTrade"),t+"@forceOrder"];return e.send(JSON.stringify({method:"SUBSCRIBE",params:i,id:this.subscriptions[t]})),await sleep(250*this.apis.length),!0}async unsubscribe(e,t){if(!(await super.unsubscribe(e,t)))return;const i=[t+"@"+(-1===settings.aggregationLength?"trade":"aggTrade"),t+"@forceOrder"];return e.send(JSON.stringify({method:"UNSUBSCRIBE",params:i,id:this.subscriptions[t]})),delete this.subscriptions[t],!0}onMessage(e,t){const i=JSON.parse(e.data);if(i){if(i.T&&(!i.X||"MARKET"===i.X)){const e=i.s.toLowerCase(),s=+i.p;let r=+i.q;return"number"==typeof this.specs[e]&&(r=r*this.specs[e]/s),this.emitTrades(t.id,[{exchange:this.id,pair:e,timestamp:i.T,price:+s,size:r,side:i.m?"sell":"buy",count:i.l-i.f+1}])}if("forceOrder"===i.e){let e=+i.o.q;const s=i.o.s.toLowerCase();return"number"==typeof this.specs[s]&&(e=e*this.specs[s]/i.o.p),this.emitLiquidations(t.id,[{exchange:this.id,pair:s,timestamp:i.o.T,price:+i.o.p,size:e,side:"BUY"===i.o.S?"buy":"sell",liquidation:!0}])}}}}class BINANCE_US extends Exchange{constructor(){super(...arguments),__publicField(this,"id","BINANCE_US"),__publicField(this,"lastSubscriptionId",0),__publicField(this,"subscriptions",{}),__publicField(this,"endpoints",{PRODUCTS:"https://api.binance.us/api/v3/exchangeInfo"})}async getUrl(){return"wss://stream.binance.us:9443/ws"}formatProducts(e){return e.symbols.filter(e=>"TRADING"===e.status).map(e=>e.symbol.toLowerCase())}async subscribe(e,t){if(!(await super.subscribe(e,t)))return;this.subscriptions[t]=++this.lastSubscriptionId;const i=[t+"@trade"];return e.send(JSON.stringify({method:"SUBSCRIBE",params:i,id:this.subscriptions[t]})),await sleep(250),!0}async unsubscribe(e,t){if(!(await super.unsubscribe(e,t)))return;const i=[t+"@trade"];return e.send(JSON.stringify({method:"UNSUBSCRIBE",params:i,id:this.subscriptions[t]})),delete this.subscriptions[t],new Promise(e=>setTimeout(e,250))}onMessage(e,t){const i=JSON.parse(e.data);if(i.E)return this.emitTrades(t.id,[{exchange:this.id,pair:i.s.toLowerCase(),timestamp:i.E,price:+i.p,size:+i.q,side:i.m?"sell":"buy"}])}}class BITFINEX extends Exchange{constructor(){super(...arguments),__publicField(this,"id","BITFINEX"),__publicField(this,"maxConnectionsPerApi",24),__publicField(this,"channels",{}),__publicField(this,"prices",{}),__publicField(this,"endpoints",{PRODUCTS:"https://api.bitfinex.com/v1/symbols"})}async getUrl(){return"wss://api-pub.bitfinex.com/ws/2/"}formatProducts(e){return e.map(e=>e.toUpperCase())}async subscribe(e,t){if(await super.subscribe(e,t))return e.send(JSON.stringify({event:"subscribe",channel:"trades",symbol:"t"+t})),1===e._connected.length&&e.send(JSON.stringify({event:"subscribe",channel:"status",key:"liq:global"})),!0}async unsubscribe(e,t){if(!(await super.unsubscribe(e,t)))return;if(0===e._connected.length){const t=Object.keys(this.channels[e._id]).find(t=>"status"===this.channels[e._id][t].name);return t&&(e.send(JSON.stringify({event:"unsubscribe",chanId:t})),delete this.channels[e._id][t]),!0}const i=Object.keys(this.channels[e._id]).filter(i=>this.channels[e._id][i].pair===t);if(i.length)for(const s of i)e.send(JSON.stringify({event:"unsubscribe",chanId:s})),delete this.channels[e._id][s]}onMessage(e,t){const i=JSON.parse(e.data);if("subscribed"===i.event&&i.chanId)return void(this.channels[t._id][i.chanId]={name:i.channel,pair:i.pair});const s=i[0];if(!this.channels[t._id][s]||"hb"===i[1])return void("hb"!==i[1]&&i.event);const r=this.channels[t._id][s];if(r.hasSentInitialMessage)return"trades"===r.name&&"te"===i[1]?(this.prices[r.pair]=+i[2][3],this.emitTrades(t._id,[{exchange:this.id,pair:r.pair,timestamp:+new Date(i[2][1]),price:+i[2][3],size:Math.abs(i[2][2]),side:i[2][2]<0?"sell":"buy"}])):"status"===r.name&&i[1]?this.emitLiquidations(t._id,i[1].filter(e=>!e[8]&&!e[10]&&!e[11]&&-1!==t._connected.indexOf(e[4].substring(1))).map(e=>{const t=e[4].substring(1);return{exchange:this.id,pair:e[4].substring(1),timestamp:parseInt(e[2]),price:this.prices[t],size:Math.abs(e[5]),side:e[5]>1?"sell":"buy",liquidation:!0}})):void 0;r.hasSentInitialMessage=!0}onApiCreated(e){this.channels[e._id]={}}onApiRemoved(e){delete this.channels[e._id]}}const SPOT_PAIR_REGEX$1=/-SPOT$/;class BITGET extends Exchange{constructor(){super(...arguments),__publicField(this,"id","BITGET"),__publicField(this,"maxConnectionsPerApi",50),__publicField(this,"delayBetweenMessages",150),__publicField(this,"endpoints",{PRODUCTS:["https://api.bitget.com/api/v3/market/instruments?category=SPOT","https://api.bitget.com/api/v3/market/instruments?category=USDT-FUTURES","https://api.bitget.com/api/v3/market/instruments?category=COIN-FUTURES","https://api.bitget.com/api/v3/market/instruments?category=USDC-FUTURES"]}),__publicField(this,"types",{})}async getUrl(){return"wss://ws.bitget.com/v3/ws/public"}formatProducts(e){const t={},i=["spot","usdt-futures","coin-futures","usdc-futures"];for(let s=0;s<e.length;s++){const r=e[s],n=i[s];for(const e of r.data){t[this.formatRemoteToLocalPair(e.symbol,n)]=n}}return{products:Object.keys(t),types:t}}getLiquidationArgs(){return["usdt-futures","coin-futures","usdc-futures"].map(e=>({instType:e,topic:"liquidation"}))}formatRemoteToLocalPair(e,t){return"spot"===t?`${e}-SPOT`:"coin-futures"===t?e.replace(/_CM$/,""):e}formatLocalToRemotePair(e,t){return"spot"===t?e.replace(SPOT_PAIR_REGEX$1,""):"coin-futures"===t?`${e}_CM`:e}hasConnectedFuturesPairs(e){return e._connected.some(e=>this.types[e]&&"spot"!==this.types[e])}async subscribe(e,t){if(!(await super.subscribe(e,t)))return;const i=this.types[t].toLowerCase(),s="spot"===i,r=this.formatLocalToRemotePair(t,i);if(e.send(JSON.stringify({op:"subscribe",args:[{instType:i,topic:"publicTrade",symbol:r}]})),!s&&!e._liquidationSubscribed){const t={op:"subscribe",args:this.getLiquidationArgs()};e.send(JSON.stringify(t)),e._liquidationSubscribed=!0}return!0}async unsubscribe(e,t){if(!(await super.unsubscribe(e,t)))return;const i=this.types[t].toLowerCase(),s=this.formatLocalToRemotePair(t,i);return e.send(JSON.stringify({op:"unsubscribe",args:[{instType:i,topic:"publicTrade",symbol:s}]})),e._liquidationSubscribed&&!this.hasConnectedFuturesPairs(e)&&(e.send(JSON.stringify({op:"unsubscribe",args:this.getLiquidationArgs()})),e._liquidationSubscribed=!1),!0}formatTrade(e,t,i){const s=void 0!==e.p?e.p:void 0!==e.px?e.px:e.price;let r=void 0!==e.v?e.v:void 0!==e.sz?e.sz:e.size;const n=void 0!==e.S?e.S:e.side,o=void 0!==e.T?e.T:e.ts,a=+s;return"coin-futures"===i&&a>0&&(r=+r/a),{exchange:this.id,pair:t,timestamp:+o,price:a,size:+r,side:"string"==typeof n?n.toLowerCase():n}}formatLiquidation(e,t){const i=+e.price,s=i>0?+e.amount/i:+e.amount;return{exchange:this.id,pair:t,timestamp:+e.ts,price:i,size:s,side:"buy"===e.side?"sell":"buy",liquidation:!0}}onMessage(e,t){if("pong"===e.data)return;const i=JSON.parse(e.data);if(i.arg&&i.data&&i.data.length){if("publicTrade"===i.arg.topic){if("update"!==i.action)return;const e=i.arg.instType,s=i.arg.symbol,r=this.formatRemoteToLocalPair(s,e);return this.emitTrades(t.id,i.data.map(t=>this.formatTrade(t,r,e)))}if("liquidation"===i.arg.topic){const e=i.arg.instType,s=[];for(const r of i.data){const i=this.formatRemoteToLocalPair(r.symbol,e);-1!==t._connected.indexOf(i)&&s.push(this.formatLiquidation(r,i))}if(s.length)return this.emitLiquidations(t.id,s)}}}onApiCreated(e){e._liquidationSubscribed=!1,this.startKeepAlive(e,"ping",3e4)}onApiRemoved(e){this.stopKeepAlive(e)}}var common$1={};!function(e){var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var s=t.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(var r in s)i(s,r)&&(e[r]=s[r])}}return e},e.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var s={arraySet:function(e,t,i,s,r){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+s),r);else for(var n=0;n<s;n++)e[r+n]=t[i+n]},flattenChunks:function(e){var t,i,s,r,n,o;for(s=0,t=0,i=e.length;t<i;t++)s+=e[t].length;for(o=new Uint8Array(s),r=0,t=0,i=e.length;t<i;t++)n=e[t],o.set(n,r),r+=n.length;return o}},r={arraySet:function(e,t,i,s,r){for(var n=0;n<s;n++)e[r+n]=t[i+n]},flattenChunks:function(e){return[].concat.apply([],e)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,s)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,r))},e.setTyped(t)}(common$1);var deflate$4={},deflate$3={},trees$1={},utils$6=common$1,Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(e){for(var t=e.length;--t>=0;)e[t]=0}var STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],DIST_CODE_LEN=512,static_ltree=new Array(2*(L_CODES$1+2));zero$1(static_ltree);var static_dtree=new Array(2*D_CODES$1);zero$1(static_dtree);var _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);var _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);var base_length=new Array(LENGTH_CODES$1);zero$1(base_length);var base_dist=new Array(D_CODES$1),static_l_desc,static_d_desc,static_bl_desc;function StaticTreeDesc(e,t,i,s,r){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=s,this.max_length=r,this.has_stree=e&&e.length}function TreeDesc(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function d_code(e){return e<256?_dist_code[e]:_dist_code[256+(e>>>7)]}function put_short(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function send_bits(e,t,i){e.bi_valid>Buf_size-i?(e.bi_buf|=t<<e.bi_valid&65535,put_short(e,e.bi_buf),e.bi_buf=t>>Buf_size-e.bi_valid,e.bi_valid+=i-Buf_size):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function send_code(e,t,i){send_bits(e,i[2*t],i[2*t+1])}function bi_reverse(e,t){var i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1}function bi_flush(e){16===e.bi_valid?(put_short(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function gen_bitlen(e,t){var i,s,r,n,o,a,u=t.dyn_tree,l=t.max_code,c=t.stat_desc.static_tree,d=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,h=t.stat_desc.extra_base,f=t.stat_desc.max_length,_=0;for(n=0;n<=MAX_BITS$1;n++)e.bl_count[n]=0;for(u[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;i<HEAP_SIZE$1;i++)(n=u[2*u[2*(s=e.heap[i])+1]+1]+1)>f&&(n=f,_++),u[2*s+1]=n,s>l||(e.bl_count[n]++,o=0,s>=h&&(o=p[s-h]),a=u[2*s],e.opt_len+=a*(n+o),d&&(e.static_len+=a*(c[2*s+1]+o)));if(0!==_){do{for(n=f-1;0===e.bl_count[n];)n--;e.bl_count[n]--,e.bl_count[n+1]+=2,e.bl_count[f]--,_-=2}while(_>0);for(n=f;0!==n;n--)for(s=e.bl_count[n];0!==s;)(r=e.heap[--i])>l||(u[2*r+1]!==n&&(e.opt_len+=(n-u[2*r+1])*u[2*r],u[2*r+1]=n),s--)}}function gen_codes(e,t,i){var s,r,n=new Array(MAX_BITS$1+1),o=0;for(s=1;s<=MAX_BITS$1;s++)n[s]=o=o+i[s-1]<<1;for(r=0;r<=t;r++){var a=e[2*r+1];0!==a&&(e[2*r]=bi_reverse(n[a]++,a))}}function tr_static_init(){var e,t,i,s,r,n=new Array(MAX_BITS$1+1);for(i=0,s=0;s<LENGTH_CODES$1-1;s++)for(base_length[s]=i,e=0;e<1<<extra_lbits[s];e++)_length_code[i++]=s;for(_length_code[i-1]=s,r=0,s=0;s<16;s++)for(base_dist[s]=r,e=0;e<1<<extra_dbits[s];e++)_dist_code[r++]=s;for(r>>=7;s<D_CODES$1;s++)for(base_dist[s]=r<<7,e=0;e<1<<extra_dbits[s]-7;e++)_dist_code[256+r++]=s;for(t=0;t<=MAX_BITS$1;t++)n[t]=0;for(e=0;e<=143;)static_ltree[2*e+1]=8,e++,n[8]++;for(;e<=255;)static_ltree[2*e+1]=9,e++,n[9]++;for(;e<=279;)static_ltree[2*e+1]=7,e++,n[7]++;for(;e<=287;)static_ltree[2*e+1]=8,e++,n[8]++;for(gen_codes(static_ltree,L_CODES$1+1,n),e=0;e<D_CODES$1;e++)static_dtree[2*e+1]=5,static_dtree[2*e]=bi_reverse(e,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)}function init_block(e){var t;for(t=0;t<L_CODES$1;t++)e.dyn_ltree[2*t]=0;for(t=0;t<D_CODES$1;t++)e.dyn_dtree[2*t]=0;for(t=0;t<BL_CODES$1;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*END_BLOCK]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function bi_windup(e){e.bi_valid>8?put_short(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function copy_block(e,t,i,s){bi_windup(e),s&&(put_short(e,i),put_short(e,~i)),utils$6.arraySet(e.pending_buf,e.window,t,i,e.pending),e.pending+=i}function smaller(e,t,i,s){var r=2*t,n=2*i;return e[r]<e[n]||e[r]===e[n]&&s[t]<=s[i]}function pqdownheap(e,t,i){for(var s=e.heap[i],r=i<<1;r<=e.heap_len&&(r<e.heap_len&&smaller(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!smaller(t,s,e.heap[r],e.depth));)e.heap[i]=e.heap[r],i=r,r<<=1;e.heap[i]=s}function compress_block(e,t,i){var s,r,n,o,a=0;if(0!==e.last_lit)do{s=e.pending_buf[e.d_buf+2*a]<<8|e.pending_buf[e.d_buf+2*a+1],r=e.pending_buf[e.l_buf+a],a++,0===s?send_code(e,r,t):(send_code(e,(n=_length_code[r])+LITERALS$1+1,t),0!==(o=extra_lbits[n])&&send_bits(e,r-=base_length[n],o),send_code(e,n=d_code(--s),i),0!==(o=extra_dbits[n])&&send_bits(e,s-=base_dist[n],o))}while(a<e.last_lit);send_code(e,END_BLOCK,t)}function build_tree(e,t){var i,s,r,n=t.dyn_tree,o=t.stat_desc.static_tree,a=t.stat_desc.has_stree,u=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=HEAP_SIZE$1,i=0;i<u;i++)0!==n[2*i]?(e.heap[++e.heap_len]=l=i,e.depth[i]=0):n[2*i+1]=0;for(;e.heap_len<2;)n[2*(r=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[r]=0,e.opt_len--,a&&(e.static_len-=o[2*r+1]);for(t.max_code=l,i=e.heap_len>>1;i>=1;i--)pqdownheap(e,n,i);r=u;do{i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pqdownheap(e,n,1),s=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=s,n[2*r]=n[2*i]+n[2*s],e.depth[r]=(e.depth[i]>=e.depth[s]?e.depth[i]:e.depth[s])+1,n[2*i+1]=n[2*s+1]=r,e.heap[1]=r++,pqdownheap(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],gen_bitlen(e,t),gen_codes(n,l,e.bl_count)}function scan_tree(e,t,i){var s,r,n=-1,o=t[1],a=0,u=7,l=4;for(0===o&&(u=138,l=3),t[2*(i+1)+1]=65535,s=0;s<=i;s++)r=o,o=t[2*(s+1)+1],++a<u&&r===o||(a<l?e.bl_tree[2*r]+=a:0!==r?(r!==n&&e.bl_tree[2*r]++,e.bl_tree[2*REP_3_6]++):a<=10?e.bl_tree[2*REPZ_3_10]++:e.bl_tree[2*REPZ_11_138]++,a=0,n=r,0===o?(u=138,l=3):r===o?(u=6,l=3):(u=7,l=4))}function send_tree(e,t,i){var s,r,n=-1,o=t[1],a=0,u=7,l=4;for(0===o&&(u=138,l=3),s=0;s<=i;s++)if(r=o,o=t[2*(s+1)+1],!(++a<u&&r===o)){if(a<l)do{send_code(e,r,e.bl_tree)}while(0!==--a);else 0!==r?(r!==n&&(send_code(e,r,e.bl_tree),a--),send_code(e,REP_3_6,e.bl_tree),send_bits(e,a-3,2)):a<=10?(send_code(e,REPZ_3_10,e.bl_tree),send_bits(e,a-3,3)):(send_code(e,REPZ_11_138,e.bl_tree),send_bits(e,a-11,7));a=0,n=r,0===o?(u=138,l=3):r===o?(u=6,l=3):(u=7,l=4)}}function build_bl_tree(e){var t;for(scan_tree(e,e.dyn_ltree,e.l_desc.max_code),scan_tree(e,e.dyn_dtree,e.d_desc.max_code),build_tree(e,e.bl_desc),t=BL_CODES$1-1;t>=3&&0===e.bl_tree[2*bl_order[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function send_all_trees(e,t,i,s){var r;for(send_bits(e,t-257,5),send_bits(e,i-1,5),send_bits(e,s-4,4),r=0;r<s;r++)send_bits(e,e.bl_tree[2*bl_order[r]+1],3);send_tree(e,e.dyn_ltree,t-1),send_tree(e,e.dyn_dtree,i-1)}function detect_data_type(e){var t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return Z_BINARY;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return Z_TEXT;for(t=32;t<LITERALS$1;t++)if(0!==e.dyn_ltree[2*t])return Z_TEXT;return Z_BINARY}zero$1(base_dist);var static_init_done=!1;function _tr_init(e){static_init_done||(tr_static_init(),static_init_done=!0),e.l_desc=new TreeDesc(e.dyn_ltree,static_l_desc),e.d_desc=new TreeDesc(e.dyn_dtree,static_d_desc),e.bl_desc=new TreeDesc(e.bl_tree,static_bl_desc),e.bi_buf=0,e.bi_valid=0,init_block(e)}function _tr_stored_block(e,t,i,s){send_bits(e,(STORED_BLOCK<<1)+(s?1:0),3),copy_block(e,t,i,!0)}function _tr_align(e){send_bits(e,STATIC_TREES<<1,3),send_code(e,END_BLOCK,static_ltree),bi_flush(e)}function _tr_flush_block(e,t,i,s){var r,n,o=0;e.level>0?(e.strm.data_type===Z_UNKNOWN$1&&(e.strm.data_type=detect_data_type(e)),build_tree(e,e.l_desc),build_tree(e,e.d_desc),o=build_bl_tree(e),r=e.opt_len+3+7>>>3,(n=e.static_len+3+7>>>3)<=r&&(r=n)):r=n=i+5,i+4<=r&&-1!==t?_tr_stored_block(e,t,i,s):e.strategy===Z_FIXED$1||n===r?(send_bits(e,(STATIC_TREES<<1)+(s?1:0),3),compress_block(e,static_ltree,static_dtree)):(send_bits(e,(DYN_TREES<<1)+(s?1:0),3),send_all_trees(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),compress_block(e,e.dyn_ltree,e.dyn_dtree)),init_block(e),s&&bi_windup(e)}function _tr_tally(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(_length_code[i]+LITERALS$1+1)]++,e.dyn_dtree[2*d_code(t)]++),e.last_lit===e.lit_bufsize-1}function adler32$2(e,t,i,s){for(var r=65535&e,n=e>>>16&65535,o=0;0!==i;){i-=o=i>2e3?2e3:i;do{n=n+(r=r+t[s++]|0)|0}while(--o);r%=65521,n%=65521}return r|n<<16}trees$1._tr_init=_tr_init,trees$1._tr_stored_block=_tr_stored_block,trees$1._tr_flush_block=_tr_flush_block,trees$1._tr_tally=_tr_tally,trees$1._tr_align=_tr_align;var adler32_1=adler32$2;function makeTable(){for(var e,t=[],i=0;i<256;i++){e=i;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}var crcTable=makeTable();function crc32$2(e,t,i,s){var r=crcTable,n=s+i;e^=-1;for(var o=s;o<n;o++)e=e>>>8^r[255&(e^t[o])];return-1^e}var crc32_1=crc32$2,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},utils$5=common$1,trees=trees$1,adler32$1=adler32_1,crc32$1=crc32_1,msg$2=messages,Z_NO_FLUSH$1=0,Z_PARTIAL_FLUSH=1,Z_FULL_FLUSH=3,Z_FINISH$2=4,Z_BLOCK$1=5,Z_OK$2=0,Z_STREAM_END$2=1,Z_STREAM_ERROR$1=-2,Z_DATA_ERROR$1=-3,Z_BUF_ERROR$1=-5,Z_DEFAULT_COMPRESSION$1=-1,Z_FILTERED=1,Z_HUFFMAN_ONLY=2,Z_RLE=3,Z_FIXED=4,Z_DEFAULT_STRATEGY$1=0,Z_UNKNOWN=2,Z_DEFLATED$2=8,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,configuration_table;function err(e,t){return e.msg=msg$2[t],t}function rank(e){return(e<<1)-(e>4?9:0)}function zero(e){for(var t=e.length;--t>=0;)e[t]=0}function flush_pending(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(utils$5.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))}function flush_block_only(e,t){trees._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,flush_pending(e.strm)}function put_byte(e,t){e.pending_buf[e.pending++]=t}function putShortMSB(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function read_buf(e,t,i,s){var r=e.avail_in;return r>s&&(r=s),0===r?0:(e.avail_in-=r,utils$5.arraySet(t,e.input,e.next_in,r,i),1===e.state.wrap?e.adler=adler32$1(e.adler,t,r,i):2===e.state.wrap&&(e.adler=crc32$1(e.adler,t,r,i)),e.next_in+=r,e.total_in+=r,r)}function longest_match(e,t){var i,s,r=e.max_chain_length,n=e.strstart,o=e.prev_length,a=e.nice_match,u=e.strstart>e.w_size-MIN_LOOKAHEAD?e.strstart-(e.w_size-MIN_LOOKAHEAD):0,l=e.window,c=e.w_mask,d=e.prev,p=e.strstart+MAX_MATCH,h=l[n+o-1],f=l[n+o];e.prev_length>=e.good_match&&(r>>=2),a>e.lookahead&&(a=e.lookahead);do{if(l[(i=t)+o]===f&&l[i+o-1]===h&&l[i]===l[n]&&l[++i]===l[n+1]){n+=2,i++;do{}while(l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&n<p);if(s=MAX_MATCH-(p-n),n=p-MAX_MATCH,s>o){if(e.match_start=t,o=s,s>=a)break;h=l[n+o-1],f=l[n+o]}}}while((t=d[t&c])>u&&0!==--r);return o<=e.lookahead?o:e.lookahead}function fill_window(e){var t,i,s,r,n,o=e.w_size;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=o+(o-MIN_LOOKAHEAD)){utils$5.arraySet(e.window,e.window,o,o,0),e.match_start-=o,e.strstart-=o,e.block_start-=o,t=i=e.hash_size;do{s=e.head[--t],e.head[t]=s>=o?s-o:0}while(--i);t=i=o;do{s=e.prev[--t],e.prev[t]=s>=o?s-o:0}while(--i);r+=o}if(0===e.strm.avail_in)break;if(i=read_buf(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=i,e.lookahead+e.insert>=MIN_MATCH)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=(e.ins_h<<e.hash_shift^e.window[n+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[n+MIN_MATCH-1])&e.hash_mask,e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<MIN_MATCH)););}while(e.lookahead<MIN_LOOKAHEAD&&0!==e.strm.avail_in)}function deflate_stored(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(fill_window(e),0===e.lookahead&&t===Z_NO_FLUSH$1)return BS_NEED_MORE;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var s=e.block_start+i;if((0===e.strstart||e.strstart>=s)&&(e.lookahead=e.strstart-s,e.strstart=s,flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE;if(e.strstart-e.block_start>=e.w_size-MIN_LOOKAHEAD&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$2?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):(e.strstart>e.block_start&&(flush_block_only(e,!1),e.strm.avail_out),BS_NEED_MORE)}function deflate_fast(e,t){for(var i,s;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$1)return BS_NEED_MORE;if(0===e.lookahead)break}if(i=0,e.lookahead>=MIN_MATCH&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+MIN_MATCH-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,i)),e.match_length>=MIN_MATCH)if(s=trees._tr_tally(e,e.strstart-e.match_start,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=MIN_MATCH){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+MIN_MATCH-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else s=trees._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,t===Z_FINISH$2?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_slow(e,t){for(var i,s,r;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$1)return BS_NEED_MORE;if(0===e.lookahead)break}if(i=0,e.lookahead>=MIN_MATCH&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+MIN_MATCH-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=MIN_MATCH-1,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,i),e.match_length<=5&&(e.strategy===Z_FILTERED||e.match_length===MIN_MATCH&&e.strstart-e.match_start>4096)&&(e.match_length=MIN_MATCH-1)),e.prev_length>=MIN_MATCH&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-MIN_MATCH,s=trees._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-MIN_MATCH),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+MIN_MATCH-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=MIN_MATCH-1,e.strstart++,s&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}else if(e.match_available){if((s=trees._tr_tally(e,0,e.window[e.strstart-1]))&&flush_block_only(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return BS_NEED_MORE}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=trees._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,t===Z_FINISH$2?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_rle(e,t){for(var i,s,r,n,o=e.window;;){if(e.lookahead<=MAX_MATCH){if(fill_window(e),e.lookahead<=MAX_MATCH&&t===Z_NO_FLUSH$1)return BS_NEED_MORE;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=MIN_MATCH&&e.strstart>0&&(s=o[r=e.strstart-1])===o[++r]&&s===o[++r]&&s===o[++r]){n=e.strstart+MAX_MATCH;do{}while(s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&r<n);e.match_length=MAX_MATCH-(n-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=MIN_MATCH?(i=trees._tr_tally(e,1,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=trees._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$2?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_huff(e,t){for(var i;;){if(0===e.lookahead&&(fill_window(e),0===e.lookahead)){if(t===Z_NO_FLUSH$1)return BS_NEED_MORE;break}if(e.match_length=0,i=trees._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$2?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function Config(e,t,i,s,r){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=s,this.func=r}function lm_init(e){e.window_size=2*e.w_size,zero(e.head),e.max_lazy_match=configuration_table[e.level].max_lazy,e.good_match=configuration_table[e.level].good_length,e.nice_match=configuration_table[e.level].nice_length,e.max_chain_length=configuration_table[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=MIN_MATCH-1,e.match_available=0,e.ins_h=0}function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new utils$5.Buf16(2*HEAP_SIZE),this.dyn_dtree=new utils$5.Buf16(2*(2*D_CODES+1)),this.bl_tree=new utils$5.Buf16(2*(2*BL_CODES+1)),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new utils$5.Buf16(MAX_BITS+1),this.heap=new utils$5.Buf16(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new utils$5.Buf16(2*L_CODES+1),zero(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function deflateResetKeep(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=Z_UNKNOWN,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?INIT_STATE:BUSY_STATE,e.adler=2===t.wrap?0:1,t.last_flush=Z_NO_FLUSH$1,trees._tr_init(t),Z_OK$2):err(e,Z_STREAM_ERROR$1)}function deflateReset(e){var t=deflateResetKeep(e);return t===Z_OK$2&&lm_init(e.state),t}function deflateSetHeader(e,t){return e&&e.state?2!==e.state.wrap?Z_STREAM_ERROR$1:(e.state.gzhead=t,Z_OK$2):Z_STREAM_ERROR$1}function deflateInit2(e,t,i,s,r,n){if(!e)return Z_STREAM_ERROR$1;var o=1;if(t===Z_DEFAULT_COMPRESSION$1&&(t=6),s<0?(o=0,s=-s):s>15&&(o=2,s-=16),r<1||r>MAX_MEM_LEVEL||i!==Z_DEFLATED$2||s<8||s>15||t<0||t>9||n<0||n>Z_FIXED)return err(e,Z_STREAM_ERROR$1);8===s&&(s=9);var a=new DeflateState;return e.state=a,a.strm=e,a.wrap=o,a.gzhead=null,a.w_bits=s,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=r+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+MIN_MATCH-1)/MIN_MATCH),a.window=new utils$5.Buf8(2*a.w_size),a.head=new utils$5.Buf16(a.hash_size),a.prev=new utils$5.Buf16(a.w_size),a.lit_bufsize=1<<r+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new utils$5.Buf8(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=t,a.strategy=n,a.method=i,deflateReset(e)}function deflateInit(e,t){return deflateInit2(e,t,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1)}function deflate$2(e,t){var i,s,r,n;if(!e||!e.state||t>Z_BLOCK$1||t<0)return e?err(e,Z_STREAM_ERROR$1):Z_STREAM_ERROR$1;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===FINISH_STATE&&t!==Z_FINISH$2)return err(e,0===e.avail_out?Z_BUF_ERROR$1:Z_STREAM_ERROR$1);if(s.strm=e,i=s.last_flush,s.last_flush=t,s.status===INIT_STATE)if(2===s.wrap)e.adler=0,put_byte(s,31),put_byte(s,139),put_byte(s,8),s.gzhead?(put_byte(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),put_byte(s,255&s.gzhead.time),put_byte(s,s.gzhead.time>>8&255),put_byte(s,s.gzhead.time>>16&255),put_byte(s,s.gzhead.time>>24&255),put_byte(s,9===s.level?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0),put_byte(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(put_byte(s,255&s.gzhead.extra.length),put_byte(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=crc32$1(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=EXTRA_STATE):(put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,9===s.level?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0),put_byte(s,OS_CODE),s.status=BUSY_STATE);else{var o=Z_DEFLATED$2+(s.w_bits-8<<4)<<8;o|=(s.strategy>=Z_HUFFMAN_ONLY||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(o|=PRESET_DICT),o+=31-o%31,s.status=BUSY_STATE,putShortMSB(s,o),0!==s.strstart&&(putShortMSB(s,e.adler>>>16),putShortMSB(s,65535&e.adler)),e.adler=1}if(s.status===EXTRA_STATE)if(s.gzhead.extra){for(r=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>r&&(e.adler=crc32$1(e.adler,s.pending_buf,s.pending-r,r)),flush_pending(e),r=s.pending,s.pending!==s.pending_buf_size));)put_byte(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>r&&(e.adler=crc32$1(e.adler,s.pending_buf,s.pending-r,r)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=NAME_STATE)}else s.status=NAME_STATE;if(s.status===NAME_STATE)if(s.gzhead.name){r=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>r&&(e.adler=crc32$1(e.adler,s.pending_buf,s.pending-r,r)),flush_pending(e),r=s.pending,s.pending===s.pending_buf_size)){n=1;break}n=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,put_byte(s,n)}while(0!==n);s.gzhead.hcrc&&s.pending>r&&(e.adler=crc32$1(e.adler,s.pending_buf,s.pending-r,r)),0===n&&(s.gzindex=0,s.status=COMMENT_STATE)}else s.status=COMMENT_STATE;if(s.status===COMMENT_STATE)if(s.gzhead.comment){r=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>r&&(e.adler=crc32$1(e.adler,s.pending_buf,s.pending-r,r)),flush_pending(e),r=s.pending,s.pending===s.pending_buf_size)){n=1;break}n=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,put_byte(s,n)}while(0!==n);s.gzhead.hcrc&&s.pending>r&&(e.adler=crc32$1(e.adler,s.pending_buf,s.pending-r,r)),0===n&&(s.status=HCRC_STATE)}else s.status=HCRC_STATE;if(s.status===HCRC_STATE&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&flush_pending(e),s.pending+2<=s.pending_buf_size&&(put_byte(s,255&e.adler),put_byte(s,e.adler>>8&255),e.adler=0,s.status=BUSY_STATE)):s.status=BUSY_STATE),0!==s.pending){if(flush_pending(e),0===e.avail_out)return s.last_flush=-1,Z_OK$2}else if(0===e.avail_in&&rank(t)<=rank(i)&&t!==Z_FINISH$2)return err(e,Z_BUF_ERROR$1);if(s.status===FINISH_STATE&&0!==e.avail_in)return err(e,Z_BUF_ERROR$1);if(0!==e.avail_in||0!==s.lookahead||t!==Z_NO_FLUSH$1&&s.status!==FINISH_STATE){var a=s.strategy===Z_HUFFMAN_ONLY?deflate_huff(s,t):s.strategy===Z_RLE?deflate_rle(s,t):configuration_table[s.level].func(s,t);if(a!==BS_FINISH_STARTED&&a!==BS_FINISH_DONE||(s.status=FINISH_STATE),a===BS_NEED_MORE||a===BS_FINISH_STARTED)return 0===e.avail_out&&(s.last_flush=-1),Z_OK$2;if(a===BS_BLOCK_DONE&&(t===Z_PARTIAL_FLUSH?trees._tr_align(s):t!==Z_BLOCK$1&&(trees._tr_stored_block(s,0,0,!1),t===Z_FULL_FLUSH&&(zero(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),flush_pending(e),0===e.avail_out))return s.last_flush=-1,Z_OK$2}return t!==Z_FINISH$2?Z_OK$2:s.wrap<=0?Z_STREAM_END$2:(2===s.wrap?(put_byte(s,255&e.adler),put_byte(s,e.adler>>8&255),put_byte(s,e.adler>>16&255),put_byte(s,e.adler>>24&255),put_byte(s,255&e.total_in),put_byte(s,e.total_in>>8&255),put_byte(s,e.total_in>>16&255),put_byte(s,e.total_in>>24&255)):(putShortMSB(s,e.adler>>>16),putShortMSB(s,65535&e.adler)),flush_pending(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?Z_OK$2:Z_STREAM_END$2)}function deflateEnd(e){var t;return e&&e.state?(t=e.state.status)!==INIT_STATE&&t!==EXTRA_STATE&&t!==NAME_STATE&&t!==COMMENT_STATE&&t!==HCRC_STATE&&t!==BUSY_STATE&&t!==FINISH_STATE?err(e,Z_STREAM_ERROR$1):(e.state=null,t===BUSY_STATE?err(e,Z_DATA_ERROR$1):Z_OK$2):Z_STREAM_ERROR$1}function deflateSetDictionary(e,t){var i,s,r,n,o,a,u,l,c=t.length;if(!e||!e.state)return Z_STREAM_ERROR$1;if(2===(n=(i=e.state).wrap)||1===n&&i.status!==INIT_STATE||i.lookahead)return Z_STREAM_ERROR$1;for(1===n&&(e.adler=adler32$1(e.adler,t,c,0)),i.wrap=0,c>=i.w_size&&(0===n&&(zero(i.head),i.strstart=0,i.block_start=0,i.insert=0),l=new utils$5.Buf8(i.w_size),utils$5.arraySet(l,t,c-i.w_size,i.w_size,0),t=l,c=i.w_size),o=e.avail_in,a=e.next_in,u=e.input,e.avail_in=c,e.next_in=0,e.input=t,fill_window(i);i.lookahead>=MIN_MATCH;){s=i.strstart,r=i.lookahead-(MIN_MATCH-1);do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[s+MIN_MATCH-1])&i.hash_mask,i.prev[s&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=s,s++}while(--r);i.strstart=s,i.lookahead=MIN_MATCH-1,fill_window(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=MIN_MATCH-1,i.match_available=0,e.next_in=a,e.input=u,e.avail_in=o,i.wrap=n,Z_OK$2}configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],deflate$3.deflateInit=deflateInit,deflate$3.deflateInit2=deflateInit2,deflate$3.deflateReset=deflateReset,deflate$3.deflateResetKeep=deflateResetKeep,deflate$3.deflateSetHeader=deflateSetHeader,deflate$3.deflate=deflate$2,deflate$3.deflateEnd=deflateEnd,deflate$3.deflateSetDictionary=deflateSetDictionary,deflate$3.deflateInfo="pako deflate (from Nodeca project)";var strings$2={},utils$4=common$1,STR_APPLY_OK=!0,STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,[0])}catch(__){STR_APPLY_OK=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(__){STR_APPLY_UIA_OK=!1}for(var _utf8len=new utils$4.Buf8(256),q=0;q<256;q++)_utf8len[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1;function buf2binstring(e,t){if(t<65534&&(e.subarray&&STR_APPLY_UIA_OK||!e.subarray&&STR_APPLY_OK))return String.fromCharCode.apply(null,utils$4.shrinkBuf(e,t));for(var i="",s=0;s<t;s++)i+=String.fromCharCode(e[s]);return i}function ZStream$2(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}_utf8len[254]=_utf8len[254]=1,strings$2.string2buf=function(e){var t,i,s,r,n,o=e.length,a=0;for(r=0;r<o;r++)55296==(64512&(i=e.charCodeAt(r)))&&r+1<o&&56320==(64512&(s=e.charCodeAt(r+1)))&&(i=65536+(i-55296<<10)+(s-56320),r++),a+=i<128?1:i<2048?2:i<65536?3:4;for(t=new utils$4.Buf8(a),n=0,r=0;n<a;r++)55296==(64512&(i=e.charCodeAt(r)))&&r+1<o&&56320==(64512&(s=e.charCodeAt(r+1)))&&(i=65536+(i-55296<<10)+(s-56320),r++),i<128?t[n++]=i:i<2048?(t[n++]=192|i>>>6,t[n++]=128|63&i):i<65536?(t[n++]=224|i>>>12,t[n++]=128|i>>>6&63,t[n++]=128|63&i):(t[n++]=240|i>>>18,t[n++]=128|i>>>12&63,t[n++]=128|i>>>6&63,t[n++]=128|63&i);return t},strings$2.buf2binstring=function(e){return buf2binstring(e,e.length)},strings$2.binstring2buf=function(e){for(var t=new utils$4.Buf8(e.length),i=0,s=t.length;i<s;i++)t[i]=e.charCodeAt(i);return t},strings$2.buf2string=function(e,t){var i,s,r,n,o=t||e.length,a=new Array(2*o);for(s=0,i=0;i<o;)if((r=e[i++])<128)a[s++]=r;else if((n=_utf8len[r])>4)a[s++]=65533,i+=n-1;else{for(r&=2===n?31:3===n?15:7;n>1&&i<o;)r=r<<6|63&e[i++],n--;n>1?a[s++]=65533:r<65536?a[s++]=r:(r-=65536,a[s++]=55296|r>>10&1023,a[s++]=56320|1023&r)}return buf2binstring(a,s)},strings$2.utf8border=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+_utf8len[e[i]]>t?i:t};var zstream=ZStream$2,zlib_deflate=deflate$3,utils$3=common$1,strings$1=strings$2,msg$1=messages,ZStream$1=zstream,toString$1=Object.prototype.toString,Z_NO_FLUSH=0,Z_FINISH$1=4,Z_OK$1=0,Z_STREAM_END$1=1,Z_SYNC_FLUSH=2,Z_DEFAULT_COMPRESSION=-1,Z_DEFAULT_STRATEGY=0,Z_DEFLATED$1=8;function Deflate(e){if(!(this instanceof Deflate))return new Deflate(e);this.options=utils$3.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZStream$1,this.strm.avail_out=0;var i=zlib_deflate.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==Z_OK$1)throw new Error(msg$1[i]);if(t.header&&zlib_deflate.deflateSetHeader(this.strm,t.header),t.dictionary){var s;if(s="string"==typeof t.dictionary?strings$1.string2buf(t.dictionary):"[object ArrayBuffer]"===toString$1.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(i=zlib_deflate.deflateSetDictionary(this.strm,s))!==Z_OK$1)throw new Error(msg$1[i]);this._dict_set=!0}}function deflate$1(e,t){var i=new Deflate(t);if(i.push(e,!0),i.err)throw i.msg||msg$1[i.err];return i.result}function deflateRaw(e,t){return(t=t||{}).raw=!0,deflate$1(e,t)}function gzip(e,t){return(t=t||{}).gzip=!0,deflate$1(e,t)}Deflate.prototype.push=function(e,t){var i,s,r=this.strm,n=this.options.chunkSize;if(this.ended)return!1;s=t===~~t?t:!0===t?Z_FINISH$1:Z_NO_FLUSH,"string"==typeof e?r.input=strings$1.string2buf(e):"[object ArrayBuffer]"===toString$1.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new utils$3.Buf8(n),r.next_out=0,r.avail_out=n),(i=zlib_deflate.deflate(r,s))!==Z_STREAM_END$1&&i!==Z_OK$1)return this.onEnd(i),this.ended=!0,!1;0!==r.avail_out&&(0!==r.avail_in||s!==Z_FINISH$1&&s!==Z_SYNC_FLUSH)||("string"===this.options.to?this.onData(strings$1.buf2binstring(utils$3.shrinkBuf(r.output,r.next_out))):this.onData(utils$3.shrinkBuf(r.output,r.next_out)))}while((r.avail_in>0||0===r.avail_out)&&i!==Z_STREAM_END$1);return s===Z_FINISH$1?(i=zlib_deflate.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Z_OK$1):s!==Z_SYNC_FLUSH||(this.onEnd(Z_OK$1),r.avail_out=0,!0)},Deflate.prototype.onData=function(e){this.chunks.push(e)},Deflate.prototype.onEnd=function(e){e===Z_OK$1&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=utils$3.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},deflate$4.Deflate=Deflate,deflate$4.deflate=deflate$1,deflate$4.deflateRaw=deflateRaw,deflate$4.gzip=gzip;var inflate$4={},inflate$3={},BAD$1=30,TYPE$1=12,inffast=function(e,t){var i,s,r,n,o,a,u,l,c,d,p,h,f,_,m,b,g,y,v,w,E,S,T,O,A;i=e.state,s=e.next_in,O=e.input,r=s+(e.avail_in-5),n=e.next_out,A=e.output,o=n-(t-e.avail_out),a=n+(e.avail_out-257),u=i.dmax,l=i.wsize,c=i.whave,d=i.wnext,p=i.window,h=i.hold,f=i.bits,_=i.lencode,m=i.distcode,b=(1<<i.lenbits)-1,g=(1<<i.distbits)-1;e:do{f<15&&(h+=O[s++]<<f,f+=8,h+=O[s++]<<f,f+=8),y=_[h&b];t:for(;;){if(h>>>=v=y>>>24,f-=v,0===(v=y>>>16&255))A[n++]=65535&y;else{if(!(16&v)){if(64&v){if(32&v){i.mode=TYPE$1;break e}e.msg="invalid literal/length code",i.mode=BAD$1;break e}y=_[(65535&y)+(h&(1<<v)-1)];continue t}for(w=65535&y,(v&=15)&&(f<v&&(h+=O[s++]<<f,f+=8),w+=h&(1<<v)-1,h>>>=v,f-=v),f<15&&(h+=O[s++]<<f,f+=8,h+=O[s++]<<f,f+=8),y=m[h&g];;){if(h>>>=v=y>>>24,f-=v,16&(v=y>>>16&255)){if(E=65535&y,f<(v&=15)&&(h+=O[s++]<<f,(f+=8)<v&&(h+=O[s++]<<f,f+=8)),(E+=h&(1<<v)-1)>u){e.msg="invalid distance too far back",i.mode=BAD$1;break e}if(h>>>=v,f-=v,E>(v=n-o)){if((v=E-v)>c&&i.sane){e.msg="invalid distance too far back",i.mode=BAD$1;break e}if(S=0,T=p,0===d){if(S+=l-v,v<w){w-=v;do{A[n++]=p[S++]}while(--v);S=n-E,T=A}}else if(d<v){if(S+=l+d-v,(v-=d)<w){w-=v;do{A[n++]=p[S++]}while(--v);if(S=0,d<w){w-=v=d;do{A[n++]=p[S++]}while(--v);S=n-E,T=A}}}else if(S+=d-v,v<w){w-=v;do{A[n++]=p[S++]}while(--v);S=n-E,T=A}for(;w>2;)A[n++]=T[S++],A[n++]=T[S++],A[n++]=T[S++],w-=3;w&&(A[n++]=T[S++],w>1&&(A[n++]=T[S++]))}else{S=n-E;do{A[n++]=A[S++],A[n++]=A[S++],A[n++]=A[S++],w-=3}while(w>2);w&&(A[n++]=A[S++],w>1&&(A[n++]=A[S++]))}break}if(64&v){e.msg="invalid distance code",i.mode=BAD$1;break e}y=m[(65535&y)+(h&(1<<v)-1)]}}break}}while(s<r&&n<a);s-=w=f>>3,h&=(1<<(f-=w<<3))-1,e.next_in=s,e.next_out=n,e.avail_in=s<r?r-s+5:5-(s-r),e.avail_out=n<a?a-n+257:257-(n-a),i.hold=h,i.bits=f},utils$2=common$1,MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],inftrees=function(e,t,i,s,r,n,o,a){var u,l,c,d,p,h,f,_,m,b=a.bits,g=0,y=0,v=0,w=0,E=0,S=0,T=0,O=0,A=0,k=0,R=null,x=0,N=new utils$2.Buf16(MAXBITS+1),$=new utils$2.Buf16(MAXBITS+1),I=null,D=0;for(g=0;g<=MAXBITS;g++)N[g]=0;for(y=0;y<s;y++)N[t[i+y]]++;for(E=b,w=MAXBITS;w>=1&&0===N[w];w--);if(E>w&&(E=w),0===w)return r[n++]=20971520,r[n++]=20971520,a.bits=1,0;for(v=1;v<w&&0===N[v];v++);for(E<v&&(E=v),O=1,g=1;g<=MAXBITS;g++)if(O<<=1,(O-=N[g])<0)return-1;if(O>0&&(e===CODES$1||1!==w))return-1;for($[1]=0,g=1;g<MAXBITS;g++)$[g+1]=$[g]+N[g];for(y=0;y<s;y++)0!==t[i+y]&&(o[$[t[i+y]]++]=y);if(e===CODES$1?(R=I=o,h=19):e===LENS$1?(R=lbase,x-=257,I=lext,D-=257,h=256):(R=dbase,I=dext,h=-1),k=0,y=0,g=v,p=n,S=E,T=0,c=-1,d=(A=1<<E)-1,e===LENS$1&&A>ENOUGH_LENS$1||e===DISTS$1&&A>ENOUGH_DISTS$1)return 1;for(;;){f=g-T,o[y]<h?(_=0,m=o[y]):o[y]>h?(_=I[D+o[y]],m=R[x+o[y]]):(_=96,m=0),u=1<<g-T,v=l=1<<S;do{r[p+(k>>T)+(l-=u)]=f<<24|_<<16|m}while(0!==l);for(u=1<<g-1;k&u;)u>>=1;if(0!==u?(k&=u-1,k+=u):k=0,y++,0===--N[g]){if(g===w)break;g=t[i+o[y]]}if(g>E&&(k&d)!==c){for(0===T&&(T=E),p+=v,O=1<<(S=g-T);S+T<w&&!((O-=N[S+T])<=0);)S++,O<<=1;if(A+=1<<S,e===LENS$1&&A>ENOUGH_LENS$1||e===DISTS$1&&A>ENOUGH_DISTS$1)return 1;r[c=k&d]=E<<24|S<<16|p-n}}return 0!==k&&(r[p+k]=g-T<<24|64<<16),a.bits=E,0},utils$1=common$1,adler32=adler32_1,crc32=crc32_1,inflate_fast=inffast,inflate_table=inftrees,CODES=0,LENS=1,DISTS=2,Z_FINISH=4,Z_BLOCK=5,Z_TREES=6,Z_OK=0,Z_STREAM_END=1,Z_NEED_DICT=2,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR=-5,Z_DEFLATED=8,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD=30,MEM=31,SYNC=32,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS;function zswap32(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new utils$1.Buf16(320),this.work=new utils$1.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=HEAD,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new utils$1.Buf32(ENOUGH_LENS),t.distcode=t.distdyn=new utils$1.Buf32(ENOUGH_DISTS),t.sane=1,t.back=-1,Z_OK):Z_STREAM_ERROR}function inflateReset(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(e)):Z_STREAM_ERROR}function inflateReset2(e,t){var i,s;return e&&e.state?(s=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Z_STREAM_ERROR:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=i,s.wbits=t,inflateReset(e))):Z_STREAM_ERROR}function inflateInit2(e,t){var i,s;return e?(s=new InflateState,e.state=s,s.window=null,(i=inflateReset2(e,t))!==Z_OK&&(e.state=null),i):Z_STREAM_ERROR}function inflateInit(e){return inflateInit2(e,DEF_WBITS)}var virgin=!0,lenfix,distfix;function fixedtables(e){if(virgin){var t;for(lenfix=new utils$1.Buf32(512),distfix=new utils$1.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(inflate_table(LENS,e.lens,0,288,lenfix,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;inflate_table(DISTS,e.lens,0,32,distfix,0,e.work,{bits:5}),virgin=!1}e.lencode=lenfix,e.lenbits=9,e.distcode=distfix,e.distbits=5}function updatewindow(e,t,i,s){var r,n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new utils$1.Buf8(n.wsize)),s>=n.wsize?(utils$1.arraySet(n.window,t,i-n.wsize,n.wsize,0),n.wnext=0,n.whave=n.wsize):((r=n.wsize-n.wnext)>s&&(r=s),utils$1.arraySet(n.window,t,i-s,r,n.wnext),(s-=r)?(utils$1.arraySet(n.window,t,i-s,s,0),n.wnext=s,n.whave=n.wsize):(n.wnext+=r,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=r))),0}function inflate$2(e,t){var i,s,r,n,o,a,u,l,c,d,p,h,f,_,m,b,g,y,v,w,E,S,T,O,A=0,k=new utils$1.Buf8(4),R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return Z_STREAM_ERROR;(i=e.state).mode===TYPE&&(i.mode=TYPEDO),o=e.next_out,r=e.output,u=e.avail_out,n=e.next_in,s=e.input,a=e.avail_in,l=i.hold,c=i.bits,d=a,p=u,S=Z_OK;e:for(;;)switch(i.mode){case HEAD:if(0===i.wrap){i.mode=TYPEDO;break}for(;c<16;){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}if(2&i.wrap&&35615===l){i.check=0,k[0]=255&l,k[1]=l>>>8&255,i.check=crc32(i.check,k,2,0),l=0,c=0,i.mode=FLAGS;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",i.mode=BAD;break}if((15&l)!==Z_DEFLATED){e.msg="unknown compression method",i.mode=BAD;break}if(c-=4,E=8+(15&(l>>>=4)),0===i.wbits)i.wbits=E;else if(E>i.wbits){e.msg="invalid window size",i.mode=BAD;break}i.dmax=1<<E,e.adler=i.check=1,i.mode=512&l?DICTID:TYPE,l=0,c=0;break;case FLAGS:for(;c<16;){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}if(i.flags=l,(255&i.flags)!==Z_DEFLATED){e.msg="unknown compression method",i.mode=BAD;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=BAD;break}i.head&&(i.head.text=l>>8&1),512&i.flags&&(k[0]=255&l,k[1]=l>>>8&255,i.check=crc32(i.check,k,2,0)),l=0,c=0,i.mode=TIME;case TIME:for(;c<32;){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}i.head&&(i.head.time=l),512&i.flags&&(k[0]=255&l,k[1]=l>>>8&255,k[2]=l>>>16&255,k[3]=l>>>24&255,i.check=crc32(i.check,k,4,0)),l=0,c=0,i.mode=OS;case OS:for(;c<16;){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}i.head&&(i.head.xflags=255&l,i.head.os=l>>8),512&i.flags&&(k[0]=255&l,k[1]=l>>>8&255,i.check=crc32(i.check,k,2,0)),l=0,c=0,i.mode=EXLEN;case EXLEN:if(1024&i.flags){for(;c<16;){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}i.length=l,i.head&&(i.head.extra_len=l),512&i.flags&&(k[0]=255&l,k[1]=l>>>8&255,i.check=crc32(i.check,k,2,0)),l=0,c=0}else i.head&&(i.head.extra=null);i.mode=EXTRA;case EXTRA:if(1024&i.flags&&((h=i.length)>a&&(h=a),h&&(i.head&&(E=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),utils$1.arraySet(i.head.extra,s,n,h,E)),512&i.flags&&(i.check=crc32(i.check,s,h,n)),a-=h,n+=h,i.length-=h),i.length))break e;i.length=0,i.mode=NAME;case NAME:if(2048&i.flags){if(0===a)break e;h=0;do{E=s[n+h++],i.head&&E&&i.length<65536&&(i.head.name+=String.fromCharCode(E))}while(E&&h<a);if(512&i.flags&&(i.check=crc32(i.check,s,h,n)),a-=h,n+=h,E)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=COMMENT;case COMMENT:if(4096&i.flags){if(0===a)break e;h=0;do{E=s[n+h++],i.head&&E&&i.length<65536&&(i.head.comment+=String.fromCharCode(E))}while(E&&h<a);if(512&i.flags&&(i.check=crc32(i.check,s,h,n)),a-=h,n+=h,E)break e}else i.head&&(i.head.comment=null);i.mode=HCRC;case HCRC:if(512&i.flags){for(;c<16;){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}if(l!==(65535&i.check)){e.msg="header crc mismatch",i.mode=BAD;break}l=0,c=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=TYPE;break;case DICTID:for(;c<32;){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}e.adler=i.check=zswap32(l),l=0,c=0,i.mode=DICT;case DICT:if(0===i.havedict)return e.next_out=o,e.avail_out=u,e.next_in=n,e.avail_in=a,i.hold=l,i.bits=c,Z_NEED_DICT;e.adler=i.check=1,i.mode=TYPE;case TYPE:if(t===Z_BLOCK||t===Z_TREES)break e;case TYPEDO:if(i.last){l>>>=7&c,c-=7&c,i.mode=CHECK;break}for(;c<3;){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}switch(i.last=1&l,c-=1,3&(l>>>=1)){case 0:i.mode=STORED;break;case 1:if(fixedtables(i),i.mode=LEN_,t===Z_TREES){l>>>=2,c-=2;break e}break;case 2:i.mode=TABLE;break;case 3:e.msg="invalid block type",i.mode=BAD}l>>>=2,c-=2;break;case STORED:for(l>>>=7&c,c-=7&c;c<32;){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",i.mode=BAD;break}if(i.length=65535&l,l=0,c=0,i.mode=COPY_,t===Z_TREES)break e;case COPY_:i.mode=COPY;case COPY:if(h=i.length){if(h>a&&(h=a),h>u&&(h=u),0===h)break e;utils$1.arraySet(r,s,n,h,o),a-=h,n+=h,u-=h,o+=h,i.length-=h;break}i.mode=TYPE;break;case TABLE:for(;c<14;){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}if(i.nlen=257+(31&l),l>>>=5,c-=5,i.ndist=1+(31&l),l>>>=5,c-=5,i.ncode=4+(15&l),l>>>=4,c-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=BAD;break}i.have=0,i.mode=LENLENS;case LENLENS:for(;i.have<i.ncode;){for(;c<3;){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}i.lens[R[i.have++]]=7&l,l>>>=3,c-=3}for(;i.have<19;)i.lens[R[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,T={bits:i.lenbits},S=inflate_table(CODES,i.lens,0,19,i.lencode,0,i.work,T),i.lenbits=T.bits,S){e.msg="invalid code lengths set",i.mode=BAD;break}i.have=0,i.mode=CODELENS;case CODELENS:for(;i.have<i.nlen+i.ndist;){for(;b=(A=i.lencode[l&(1<<i.lenbits)-1])>>>16&255,g=65535&A,!((m=A>>>24)<=c);){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}if(g<16)l>>>=m,c-=m,i.lens[i.have++]=g;else{if(16===g){for(O=m+2;c<O;){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}if(l>>>=m,c-=m,0===i.have){e.msg="invalid bit length repeat",i.mode=BAD;break}E=i.lens[i.have-1],h=3+(3&l),l>>>=2,c-=2}else if(17===g){for(O=m+3;c<O;){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}c-=m,E=0,h=3+(7&(l>>>=m)),l>>>=3,c-=3}else{for(O=m+7;c<O;){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}c-=m,E=0,h=11+(127&(l>>>=m)),l>>>=7,c-=7}if(i.have+h>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=BAD;break}for(;h--;)i.lens[i.have++]=E}}if(i.mode===BAD)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=BAD;break}if(i.lenbits=9,T={bits:i.lenbits},S=inflate_table(LENS,i.lens,0,i.nlen,i.lencode,0,i.work,T),i.lenbits=T.bits,S){e.msg="invalid literal/lengths set",i.mode=BAD;break}if(i.distbits=6,i.distcode=i.distdyn,T={bits:i.distbits},S=inflate_table(DISTS,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,T),i.distbits=T.bits,S){e.msg="invalid distances set",i.mode=BAD;break}if(i.mode=LEN_,t===Z_TREES)break e;case LEN_:i.mode=LEN;case LEN:if(a>=6&&u>=258){e.next_out=o,e.avail_out=u,e.next_in=n,e.avail_in=a,i.hold=l,i.bits=c,inflate_fast(e,p),o=e.next_out,r=e.output,u=e.avail_out,n=e.next_in,s=e.input,a=e.avail_in,l=i.hold,c=i.bits,i.mode===TYPE&&(i.back=-1);break}for(i.back=0;b=(A=i.lencode[l&(1<<i.lenbits)-1])>>>16&255,g=65535&A,!((m=A>>>24)<=c);){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}if(b&&!(240&b)){for(y=m,v=b,w=g;b=(A=i.lencode[w+((l&(1<<y+v)-1)>>y)])>>>16&255,g=65535&A,!(y+(m=A>>>24)<=c);){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}l>>>=y,c-=y,i.back+=y}if(l>>>=m,c-=m,i.back+=m,i.length=g,0===b){i.mode=LIT;break}if(32&b){i.back=-1,i.mode=TYPE;break}if(64&b){e.msg="invalid literal/length code",i.mode=BAD;break}i.extra=15&b,i.mode=LENEXT;case LENEXT:if(i.extra){for(O=i.extra;c<O;){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}i.length+=l&(1<<i.extra)-1,l>>>=i.extra,c-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=DIST;case DIST:for(;b=(A=i.distcode[l&(1<<i.distbits)-1])>>>16&255,g=65535&A,!((m=A>>>24)<=c);){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}if(!(240&b)){for(y=m,v=b,w=g;b=(A=i.distcode[w+((l&(1<<y+v)-1)>>y)])>>>16&255,g=65535&A,!(y+(m=A>>>24)<=c);){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}l>>>=y,c-=y,i.back+=y}if(l>>>=m,c-=m,i.back+=m,64&b){e.msg="invalid distance code",i.mode=BAD;break}i.offset=g,i.extra=15&b,i.mode=DISTEXT;case DISTEXT:if(i.extra){for(O=i.extra;c<O;){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}i.offset+=l&(1<<i.extra)-1,l>>>=i.extra,c-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=BAD;break}i.mode=MATCH;case MATCH:if(0===u)break e;if(h=p-u,i.offset>h){if((h=i.offset-h)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=BAD;break}h>i.wnext?(h-=i.wnext,f=i.wsize-h):f=i.wnext-h,h>i.length&&(h=i.length),_=i.window}else _=r,f=o-i.offset,h=i.length;h>u&&(h=u),u-=h,i.length-=h;do{r[o++]=_[f++]}while(--h);0===i.length&&(i.mode=LEN);break;case LIT:if(0===u)break e;r[o++]=i.length,u--,i.mode=LEN;break;case CHECK:if(i.wrap){for(;c<32;){if(0===a)break e;a--,l|=s[n++]<<c,c+=8}if(p-=u,e.total_out+=p,i.total+=p,p&&(e.adler=i.check=i.flags?crc32(i.check,r,p,o-p):adler32(i.check,r,p,o-p)),p=u,(i.flags?l:zswap32(l))!==i.check){e.msg="incorrect data check",i.mode=BAD;break}l=0,c=0}i.mode=LENGTH;case LENGTH:if(i.wrap&&i.flags){for(;c<32;){if(0===a)break e;a--,l+=s[n++]<<c,c+=8}if(l!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=BAD;break}l=0,c=0}i.mode=DONE;case DONE:S=Z_STREAM_END;break e;case BAD:S=Z_DATA_ERROR;break e;case MEM:return Z_MEM_ERROR;default:return Z_STREAM_ERROR}return e.next_out=o,e.avail_out=u,e.next_in=n,e.avail_in=a,i.hold=l,i.bits=c,(i.wsize||p!==e.avail_out&&i.mode<BAD&&(i.mode<CHECK||t!==Z_FINISH))&&updatewindow(e,e.output,e.next_out,p-e.avail_out),d-=e.avail_in,p-=e.avail_out,e.total_in+=d,e.total_out+=p,i.total+=p,i.wrap&&p&&(e.adler=i.check=i.flags?crc32(i.check,r,p,e.next_out-p):adler32(i.check,r,p,e.next_out-p)),e.data_type=i.bits+(i.last?64:0)+(i.mode===TYPE?128:0)+(i.mode===LEN_||i.mode===COPY_?256:0),(0===d&&0===p||t===Z_FINISH)&&S===Z_OK&&(S=Z_BUF_ERROR),S}function inflateEnd(e){if(!e||!e.state)return Z_STREAM_ERROR;var t=e.state;return t.window&&(t.window=null),e.state=null,Z_OK}function inflateGetHeader(e,t){var i;return e&&e.state&&2&(i=e.state).wrap?(i.head=t,t.done=!1,Z_OK):Z_STREAM_ERROR}function inflateSetDictionary(e,t){var i,s=t.length;return e&&e.state?0!==(i=e.state).wrap&&i.mode!==DICT?Z_STREAM_ERROR:i.mode===DICT&&adler32(1,t,s,0)!==i.check?Z_DATA_ERROR:updatewindow(e,t,s,s)?(i.mode=MEM,Z_MEM_ERROR):(i.havedict=1,Z_OK):Z_STREAM_ERROR}inflate$3.inflateReset=inflateReset,inflate$3.inflateReset2=inflateReset2,inflate$3.inflateResetKeep=inflateResetKeep,inflate$3.inflateInit=inflateInit,inflate$3.inflateInit2=inflateInit2,inflate$3.inflate=inflate$2,inflate$3.inflateEnd=inflateEnd,inflate$3.inflateGetHeader=inflateGetHeader,inflate$3.inflateSetDictionary=inflateSetDictionary,inflate$3.inflateInfo="pako inflate (from Nodeca project)";var constants$1={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};function GZheader$1(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader$1,zlib_inflate=inflate$3,utils=common$1,strings=strings$2,c=constants$1,msg=messages,ZStream=zstream,GZheader=gzheader,toString=Object.prototype.toString;function Inflate(e){if(!(this instanceof Inflate))return new Inflate(e);this.options=utils.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZStream,this.strm.avail_out=0;var i=zlib_inflate.inflateInit2(this.strm,t.windowBits);if(i!==c.Z_OK)throw new Error(msg[i]);if(this.header=new GZheader,zlib_inflate.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=strings.string2buf(t.dictionary):"[object ArrayBuffer]"===toString.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=zlib_inflate.inflateSetDictionary(this.strm,t.dictionary))!==c.Z_OK))throw new Error(msg[i])}function inflate$1(e,t){var i=new Inflate(t);if(i.push(e,!0),i.err)throw i.msg||msg[i.err];return i.result}function inflateRaw(e,t){return(t=t||{}).raw=!0,inflate$1(e,t)}Inflate.prototype.push=function(e,t){var i,s,r,n,o,a=this.strm,u=this.options.chunkSize,l=this.options.dictionary,d=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?c.Z_FINISH:c.Z_NO_FLUSH,"string"==typeof e?a.input=strings.binstring2buf(e):"[object ArrayBuffer]"===toString.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new utils.Buf8(u),a.next_out=0,a.avail_out=u),(i=zlib_inflate.inflate(a,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&l&&(i=zlib_inflate.inflateSetDictionary(this.strm,l)),i===c.Z_BUF_ERROR&&!0===d&&(i=c.Z_OK,d=!1),i!==c.Z_STREAM_END&&i!==c.Z_OK)return this.onEnd(i),this.ended=!0,!1;a.next_out&&(0!==a.avail_out&&i!==c.Z_STREAM_END&&(0!==a.avail_in||s!==c.Z_FINISH&&s!==c.Z_SYNC_FLUSH)||("string"===this.options.to?(r=strings.utf8border(a.output,a.next_out),n=a.next_out-r,o=strings.buf2string(a.output,r),a.next_out=n,a.avail_out=u-n,n&&utils.arraySet(a.output,a.output,r,n,0),this.onData(o)):this.onData(utils.shrinkBuf(a.output,a.next_out)))),0===a.avail_in&&0===a.avail_out&&(d=!0)}while((a.avail_in>0||0===a.avail_out)&&i!==c.Z_STREAM_END);return i===c.Z_STREAM_END&&(s=c.Z_FINISH),s===c.Z_FINISH?(i=zlib_inflate.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===c.Z_OK):s!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),a.avail_out=0,!0)},Inflate.prototype.onData=function(e){this.chunks.push(e)},Inflate.prototype.onEnd=function(e){e===c.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=utils.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},inflate$4.Inflate=Inflate,inflate$4.inflate=inflate$1,inflate$4.inflateRaw=inflateRaw,inflate$4.ungzip=inflate$1;var assign=common$1.assign,deflate=deflate$4,inflate=inflate$4,constants=constants$1,pako={};assign(pako,deflate,inflate,constants);var pako_1=pako,pako$1=getDefaultExportFromCjs(pako_1);const WS_API_SPOT="wss://ws-manager-compress.bitmart.com/api?protocol=1.1",WS_API_FUTURES="wss://openapi-ws-v2.bitmart.com/api?protocol=1.1";class Bitmart extends Exchange{constructor(){super(...arguments),__publicField(this,"id","BITMART"),__publicField(this,"endpoints",{PRODUCTS:["https://api-cloud.bitmart.com/spot/v1/symbols","https://api-cloud-v2.bitmart.com/contract/public/details"]}),__publicField(this,"specs",{})}async getUrl(e){return this.specs[e]?WS_API_FUTURES:WS_API_SPOT}validateProducts(e){return!!e.specs}formatProducts(e){const t=[],i={};for(const s of e)for(const e of s.data.symbols)"string"==typeof e?t.push(e):(t.push(e.symbol),e.contract_size&&(i[e.symbol]=+e.contract_size));return{products:t,specs:i,types:{}}}async subscribe(e,t){if(!(await super.subscribe(e,t)))return;const i=!!this.specs[t]?{prefix:"futures",arg:"action"}:{prefix:"spot",arg:"op"};return e.send(JSON.stringify({[i.arg]:"subscribe",args:[`${i.prefix}/trade:${t}`]})),!0}async unsubscribe(e,t){if(!(await super.unsubscribe(e,t)))return;const i=!!this.specs[t]?{prefix:"futures",arg:"action"}:{prefix:"spot",arg:"op"};return e.send(JSON.stringify({[i.arg]:"unsubscribe",args:[`${i.prefix}/trade:${t}`]})),!0}formatTrade(e){return this.specs[e.symbol]?{exchange:this.id,pair:e.symbol,timestamp:+new Date(e.created_at),price:+e.deal_price,size:e.deal_vol*this.specs[e.symbol]/(this.specs[e.symbol]>1?e.deal_price:1),side:"boolean"==typeof e.m?e.m?"sell":"buy":e.way<=4?"buy":"sell",liquidation:1===e.type}:{exchange:this.id,pair:e.symbol,timestamp:1e3*e.s_t,price:+e.price,size:+e.size,side:e.side}}onMessage(e,t){let i=e.data;"string"!=typeof i&&(i=pako_1.inflateRaw(e.data,{to:"string"}));const s=JSON.parse(i);if(!s||!s.data)return;const r=s.data,n=[],o=[];for(let a=0;a<r.length;a++){const e=r[a];e.type?o.push(this.formatTrade(e)):n.push(this.formatTrade(e))}return n.length>0&&this.emitTrades(t.id,n),o.length>0&&this.emitLiquidations(t.id,o),!0}onApiCreated(e){e.url===WS_API_FUTURES&&this.startKeepAlive(e,{action:"ping"},15e3)}onApiRemoved(e){e.url===WS_API_FUTURES&&this.stopKeepAlive(e)}}class BITMEX extends Exchange{constructor(){super(...arguments),__publicField(this,"id","BITMEX"),__publicField(this,"xbtPrice",48e3),__publicField(this,"types"),__publicField(this,"multipliers"),__publicField(this,"underlyingToPositionMultipliers"),__publicField(this,"endpoints",{PRODUCTS:"https://www.bitmex.com/api/v1/instrument/active"})}async getUrl(){return"wss://www.bitmex.com/realtime"}formatProducts(e){const t=[],i={},s={},r={};for(const n of e)i[n.symbol]=n.isInverse?"inverse":n.isQuanto?"quanto":"linear",s[n.symbol]=n.multiplier,"linear"===i[n.symbol]&&(r[n.symbol]=n.underlyingToPositionMultiplier),t.push(n.symbol);return{products:t,types:i,multipliers:s,underlyingToPositionMultipliers:r}}validateProducts(e){return!!(e&&e.multipliers&&e.underlyingToPositionMultipliers&&e.types)}async subscribe(e,t){if(await super.subscribe(e,t))return e.send(JSON.stringify({op:"subscribe",args:["trade:"+t,"liquidation:"+t]})),!0}async unsubscribe(e,t){if(await super.unsubscribe(e,t))return e.send(JSON.stringify({op:"unsubscribe",args:["trade:"+t,"liquidation:"+t]})),!0}onApiCreated(e){e.send(JSON.stringify({op:"subscribe",args:["instrument:XBTUSD"]}))}onMessage(e,t){const i=JSON.parse(e.data);if(i&&i.data&&i.data.length){if("liquidation"===i.table&&"insert"===i.action)return this.emitLiquidations(t.id,i.data.map(e=>{let t;return t="quanto"===this.types[e.symbol]?this.multipliers[e.symbol]/1e8*e.leavesQty*this.xbtPrice:"inverse"===this.types[e.symbol]?e.leavesQty/e.price:1/this.underlyingToPositionMultipliers[e.symbol]*e.leavesQty,{exchange:this.id,pair:e.symbol,timestamp:Date.now(),price:e.price,size:t,side:"Buy"===e.side?"buy":"sell",liquidation:!0}}));if("trade"===i.table&&"insert"===i.action)return this.emitTrades(t.id,i.data.map(e=>({exchange:this.id,pair:e.symbol,timestamp:+new Date(e.timestamp),price:e.price,size:e.homeNotional,side:"Buy"===e.side?"buy":"sell"})));"instrument"===i.table&&i.data[0].lastPrice&&(this.xbtPrice=i.data[0].lastPrice)}}}class BITSTAMP extends Exchange{constructor(){super(...arguments),__publicField(this,"id","BITSTAMP"),__publicField(this,"endpoints",{PRODUCTS:"https://www.bitstamp.net/api/v2/trading-pairs-info/"})}async getUrl(){return"wss://ws.bitstamp.net/"}formatProducts(e){return e.map(e=>e.url_symbol)}async subscribe(e,t){if(await super.subscribe(e,t))return e.send(JSON.stringify({event:"bts:subscribe",data:{channel:"live_trades_"+t}})),!0}async unsubscribe(e,t){if(await super.unsubscribe(e,t))return e.send(JSON.stringify({event:"bts:unsubscribe",data:{channel:"live_trades_"+t}})),!0}onMessage(e,t){const i=JSON.parse(e.data);if(!i||!i.data||!i.data.amount)return;const s=i.data;return this.emitTrades(t.id,[{exchange:this.id,pair:i.channel.split("_").pop(),timestamp:+new Date(s.microtimestamp/1e3),price:s.price,size:s.amount,side:0===s.type?"buy":"sell"}])}}class BITUNIX extends Exchange{constructor(){super(...arguments),__publicField(this,"id","BITUNIX"),__publicField(this,"maxConnectionsPerApi",300),__publicField(this,"delayBetweenMessages",100),__publicField(this,"endpoints",{PRODUCTS:["https://fapi.bitunix.com/api/v1/futures/market/trading_pairs"]})}async getUrl(){return"wss://fapi.bitunix.com/public/"}formatProducts(e){const t=[];for(const i of e.data)t.push(i.symbol);return{products:t}}async subscribe(e,t){if(await super.subscribe(e,t))return e.ignoreWelcomeMessage||(e.ignoreWelcomeMessage={}),e.ignoreWelcomeMessage[t]=!0,e.send(JSON.stringify({op:"subscribe",args:[{symbol:t,ch:"trade"}]})),!0}async unsubscribe(e,t){if(await super.unsubscribe(e,t))return void 0!==e.ignoreWelcomeMessage[t]&&delete e.ignoreWelcomeMessage[t],e.send(JSON.stringify({op:"unsubscribe",args:[{symbol:t,ch:"trade"}]})),!0}formatTrade(e,t){return{exchange:this.id,pair:t,timestamp:+new Date(e.t),price:+e.p,size:+e.v,side:e.s}}onMessage(e,t){const i=JSON.parse(e.data);if(i&&"trade"===i.ch){if(!t.ignoreWelcomeMessage[i.symbol])return this.emitTrades(t.id,i.data.map(e=>this.formatTrade(e,i.symbol)));delete t.ignoreWelcomeMessage[i.symbol]}}onApiCreated(e){this.startKeepAlive(e,()=>({op:"ping",ping:Math.round(+new Date/1e3)}),2e4)}onApiRemoved(e){this.stopKeepAlive(e)}}const SPOT_PAIR_REGEX=/-SPOT$/,TRADE_TOPIC_REGEX=/^publicTrade\./,SPOT_WS="wss://stream.bybit.com/v5/public/spot",LINEAR_WS="wss://stream.bybit.com/v5/public/linear",INVERSE_WS="wss://stream.bybit.com/v5/public/inverse";class BYBIT extends Exchange{constructor(){super(...arguments),__publicField(this,"id","BYBIT"),__publicField(this,"types"),__publicField(this,"endpoints",{PRODUCTS:["https://api.bybit.com/v5/market/instruments-info?category=spot","https://api.bybit.com/v5/market/instruments-info?category=linear","https://api.bybit.com/v5/market/instruments-info?category=inverse"]})}async getUrl(e){return"spot"===this.types[e]?SPOT_WS:"linear"===this.types[e]?LINEAR_WS:INVERSE_WS}validateProducts(e){return!!e.types}formatProducts(e){const t=[],i={};for(const s of e){const r=["spot","linear","inverse"][e.indexOf(s)];for(const e of s.result.list){const s=`${e.symbol}${"spot"===r?"-SPOT":""}`;t.push(s),i[s]=r}}return{products:t,types:i}}async subscribe(e,t){if(!(await super.subscribe(e,t)))return;const i="spot"===this.types[t],s=i?t.replace(SPOT_PAIR_REGEX,""):t,r=[`publicTrade.${s}`];return i||r.push(`allLiquidation.${s}`),e.send(JSON.stringify({op:"subscribe",args:r})),!0}async unsubscribe(e,t){if(!(await super.unsubscribe(e,t)))return;const i="spot"===this.types[t],s=i?t.replace(SPOT_PAIR_REGEX,""):t,r=[`publicTrade.${s}`];return i||r.push(`allLiquidation.${s}`),e.send(JSON.stringify({op:"unsubscribe",args:r})),!0}formatTrade(e,t){let i=+e.v,s=e.s;return t||"inverse"!==this.types[e.s]?t&&(s+="-SPOT"):i/=e.p,{exchange:this.id,pair:s,timestamp:+e.T,price:+e.p,size:i,side:"Buy"===e.S?"buy":"sell"}}formatLiquidation(e){let t=+e.v;return"inverse"===this.types[e.s]&&(t/=e.p),{exchange:this.id,pair:e.s,timestamp:+e.T,size:t,price:+e.p,side:"Buy"===e.S?"sell":"buy",liquidation:!0}}onMessage(e,t){const i=JSON.parse(e.data);if(i.data&&i.topic&&i.data){if(TRADE_TOPIC_REGEX.test(i.topic)){const e=t.url===SPOT_WS;return this.emitTrades(t.id,i.data.map(t=>this.formatTrade(t,e)))}return this.emitLiquidations(t.id,i.data.map(e=>this.formatLiquidation(e)))}}onApiCreated(e){this.startKeepAlive(e,{op:"ping"},2e4)}onApiRemoved(e){this.stopKeepAlive(e)}}class COINBASE extends Exchange{constructor(){super(...arguments),__publicField(this,"id","COINBASE"),__publicField(this,"endpoints",{PRODUCTS:["https://api.coinbase.com/api/v3/brokerage/market/products?product_type=SPOT","https://api.coinbase.com/api/v3/brokerage/market/products?product_type=FUTURE&contract_expiry_type=PERPETUAL"]})}async getUrl(){return"wss://advanced-trade-ws.coinbase.com"}formatProducts(e){const t=[],[i,s]=e;if(i&&i.products&&i.products.length)for(const r of i.products)"online"===r.status&&(r.alias||t.push(r.product_id));if(s&&s.products&&s.products.length)for(const r of s.products)t.push(r.product_id);return{products:t}}async subscribe(e,t){if(await super.subscribe(e,t))return e.send(JSON.stringify({type:"subscribe",channel:"market_trades",product_ids:[t]})),await sleep(100*this.apis.length),!0}async unsubscribe(e,t){if(await super.unsubscribe(e,t))return e.send(JSON.stringify({type:"unsubscribe",channel:"market_trades",product_ids:[t]})),await sleep(100*this.apis.length),!0}onMessage(e,t){const i=JSON.parse(e.data);if(i&&"market_trades"===i.channel)return this.emitTrades(t.id,i.events.reduce((e,t)=>("update"===t.type&&e.push(...t.trades.map(e=>this.formatTrade(e,e.product_id))),e),[]))}formatTrade(e,t){return{exchange:this.id,pair:t,timestamp:+new Date(e.time),price:+e.price,size:+e.size,side:"BUY"===e.side?"sell":"buy"}}}class CryptoCom extends Exchange{constructor(){super(...arguments),__publicField(this,"id","CRYPTOCOM"),__publicField(this,"endpoints",{PRODUCTS:"https://api.crypto.com/exchange/v1/public/get-instruments"})}async getUrl(){return"wss://stream.crypto.com/v2/market"}formatProducts(e){return e.result.data.map(e=>e.symbol)}async subscribe(e,t){if(!(await super.subscribe(e,t)))return;const i={channels:[`trade.${t}`]};return e.send(JSON.stringify({method:"subscribe",params:i,id:Date.now()})),!0}async unsubscribe(e,t){if(!(await super.unsubscribe(e,t)))return;const i={channels:[`trade.${t}`]};return e.send(JSON.stringify({method:"unsubscribe",params:i,id:Date.now()})),!0}onMessage(e,t){const i=JSON.parse(e.data);if(i.result)return this.emitTrades(t.id,i.result.data.map(e=>this.formatResponse(e)));"public/heartbeat"===i.method&&t.send(JSON.stringify({id:i.id,method:"public/respond-heartbeat"}))}formatResponse(e){return{exchange:this.id,pair:e.i,timestamp:+new Date(e.t),price:+e.p,size:+e.q,side:e.s.toLowerCase()}}}class DERIBIT extends Exchange{constructor(){super(...arguments),__publicField(this,"id","DERIBIT"),__publicField(this,"types"),__publicField(this,"endpoints",{PRODUCTS:["https://www.deribit.com/api/v2/public/get_instruments?currency=BTC&kind=future","https://www.deribit.com/api/v2/public/get_instruments?currency=ETH&kind=future","https://www.deribit.com/api/v2/public/get_instruments?currency=USDC&kind=future"]})}async getUrl(){return"wss://www.deribit.com/ws/api/v2"}formatProducts(e){const t=[],i={};for(const s of e)for(const e of s.result)e.is_active&&(i[e.instrument_name]=e.future_type,t.push(e.instrument_name));return{products:t,types:i}}validateProducts(e){return!(!e||!e.types)}async subscribe(e,t){if(await super.subscribe(e,t))return e.send(JSON.stringify({method:"public/subscribe",params:{channels:["trades."+t+".100ms"]}})),!0}async unsubscribe(e,t){if(await super.unsubscribe(e,t))return e.send(JSON.stringify({method:"public/unsubscribe",params:{channels:["trades."+t+".raw"]}})),!0}onMessage(e,t){const i=JSON.parse(e.data);if(!(i&&i.params&&i.params.data&&i.params.data.length))return;const s=[],r=[];for(let n=0;n<i.params.data.length;n++){const e=i.params.data[n];let t=e.amount;"reversed"===this.types[e.instrument_name]&&(t/=e.price);const o={exchange:this.id,pair:e.instrument_name,timestamp:+e.timestamp,price:+e.price,size:t,side:e.direction};e.liquidation?(o.liquidation=!0,r.push(o)):s.push(o)}return s.length&&this.emitTrades(t.id,s),r.length&&this.emitLiquidations(t.id,r),!0}onApiCreated(e){this.startKeepAlive(e,{method:"public/ping"},45e3)}onApiRemoved(e){this.stopKeepAlive(e)}}class DYDX extends Exchange{constructor(){super(...arguments),__publicField(this,"id","DYDX"),__publicField(this,"endpoints",{PRODUCTS:"https://indexer.dydx.trade/v4/perpetualMarkets"})}async getUrl(){return"wss://indexer.dydx.trade/v4/ws"}formatProducts(e){return Object.keys(e.markets)}async subscribe(e,t){if(await super.subscribe(e,t))return e.send(JSON.stringify({type:"subscribe",channel:"v4_trades",id:t})),!0}async unsubscribe(e,t){if(await super.unsubscribe(e,t))return e.send(JSON.stringify({type:"unsubscribe",channel:"v4_trades",id:t})),!0}formatTrade(e,t){return{exchange:this.id,pair:t,timestamp:+new Date(e.createdAt),price:+e.price,size:+e.size,side:"BUY"===e.side?"buy":"sell"}}onMessage(e,t){const i=JSON.parse(e.data);if("channel_data"===i.type){const e=[],s=[];for(let t=0;t<i.contents.trades.length;t++){const r=this.formatTrade(i.contents.trades[t],i.id);i.contents.trades[t].liquidation?(r.liquidation=!0,s.push(r)):e.push(r)}return e.length&&this.emitTrades(t.id,e),s.length&&this.emitLiquidations(t.id,s),!0}}}class GATEIO extends Exchange{constructor(){super(...arguments),__publicField(this,"id","GATEIO"),__publicField(this,"endpoints",{PRODUCTS:["https://api.gateio.ws/api/v4/spot/currency_pairs","https://api.gateio.ws/api/v4/futures/usdt/contracts","https://api.gateio.ws/api/v4/futures/btc/contracts"]}),__publicField(this,"specs",{})}async getUrl(e){return"number"==typeof this.specs[e]?/USDT$/.test(e)?"wss://fx-ws.gateio.ws/v4/ws/usdt":"wss://fx-ws.gateio.ws/v4/ws/btc":"wss://api.gateio.ws/ws/v4/"}formatProducts(e){const t=[],i={};for(const s of e)for(const e of s)e.id?t.push(`${e.id}-SPOT`):(t.push(e.name),i[e.name]=e.quanto_multiplier?parseFloat(e.quanto_multiplier):1);return{products:t,specs:i}}async subscribe(e,t){if(await super.subscribe(e,t))return e.send(JSON.stringify({channel:("number"==typeof this.specs[t]?"futures":"spot")+".trades",event:"subscribe",payload:[t.replace("-SPOT","")]})),!0}async unsubscribe(e,t){if(await super.unsubscribe(e,t))return e.send(JSON.stringify({channel:("number"==typeof this.specs[t]?"futures":"spot")+".trades",event:"unsubscribe",payload:[t.replace("-SPOT","")]})),!0}formatSpotTrade(e){return{exchange:this.id,pair:e.currency_pair+"-SPOT",timestamp:+e.create_time_ms,price:+e.price,size:+e.amount,side:e.side}}formatFuturesTrade(e){return{exchange:this.id,pair:e.contract,timestamp:+e.create_time_ms,price:+e.price,size:this.specs[e.contract]>0?Math.abs(e.size)*this.specs[e.contract]:Math.abs(e.size)/e.price,side:e.size>0?"buy":"sell"}}formatLiquidation(e){return{...this.formatFuturesTrade(e),side:e.size>0?"sell":"buy",liquidation:!0}}onMessage(e,t){const i=JSON.parse(e.data);if(i&&i.event&&"update"===i.event&&i.result){if(i.result.length&&"futures.trades"===i.channel){const e=i.result.reduce((e,t)=>(t.is_internal?e.liquidations.push(this.formatLiquidation(t)):e.trades.push(this.formatFuturesTrade(t)),e),{trades:[],liquidations:[]});if(e.trades.length)return this.emitTrades(t.id,e.trades);if(e.liquidations.length)return this.emitLiquidations(t.id,e.liquidations)}if("spot.trades"===i.channel)return this.emitTrades(t.id,[this.formatSpotTrade(i.result)])}}onApiCreated(e){this.startKeepAlive(e,/fx-ws/.test(e.url)?{channel:"futures.ping"}:{channel:"spot.ping"},18e3)}onApiRemoved(e){this.stopKeepAlive(e)}}class HITBTC extends Exchange{constructor(){super(...arguments),__publicField(this,"id","HITBTC"),__publicField(this,"endpoints",{PRODUCTS:"https://api.hitbtc.com/api/2/public/symbol"})}async getUrl(){return"wss://api.hitbtc.com/api/2/ws"}formatProducts(e){return e.map(e=>e.id)}async subscribe(e,t){if(await super.subscribe(e,t))return e.send(JSON.stringify({method:"subscribeTrades",params:{symbol:t}})),!0}async unsubscribe(e,t){if(await super.unsubscribe(e,t))return e.send(JSON.stringify({method:"unsubscribeTrades",params:{symbol:t}})),!0}onMessage(e,t){const i=JSON.parse(e.data);if(i&&"updateTrades"===i.method&&i.params&&i.params.data&&i.params.data.length)return this.emitTrades(t.id,i.params.data.map(e=>({exchange:this.id,pair:i.params.symbol,timestamp:+new Date(e.timestamp),price:+e.price,size:+e.quantity,side:e.side})))}}class HUOBI extends Exchange{constructor(){super(...arguments),__publicField(this,"id","HUOBI"),__publicField(this,"liquidationOrdersSubscriptions",{}),__publicField(this,"endpoints",{PRODUCTS:["https://api.htx.com/v1/settings/common/symbols","https://api.hbdm.com/api/v1/contract_contract_info","https://api.hbdm.com/swap-api/v1/swap_contract_info","https://api.hbdm.com/linear-swap-api/v1/swap_contract_info"]}),__publicField(this,"contractTypesAliases",{this_week:"CW",next_week:"NW",quarter:"CQ",next_quarter:"NQ"}),__publicField(this,"types",{}),__publicField(this,"specs",{}),__publicField(this,"prices",{})}async getUrl(e){return"futures"===this.types[e]?"wss://www.hbdm.com/ws":"swap"===this.types[e]?"wss://api.hbdm.com/swap-ws":"linear"===this.types[e]?"wss://api.hbdm.com/linear-swap-ws":"wss://api.htx.com/ws"}formatProducts(e){const t=[],i={},s={};for(const r of e){const n=["spot","futures","swap","linear"][e.indexOf(r)];for(const e of r.data){let r;switch(n){case"spot":r=e.symbol;break;case"futures":r=e.symbol+"_"+this.contractTypesAliases[e.contract_type],i[r]=e.contract_size;break;case"swap":case"linear":r=e.contract_code,i[r]=e.contract_size}s[r]=n,t.push(r)}}return{products:t,specs:i,types:s}}async subscribe(e,t){if(await super.subscribe(e,t))return e.send(JSON.stringify({sub:`market.${t}.trade.detail`,id:t})),this.subscribeLiquidations(e,t),!0}async unsubscribe(e,t){if(await super.unsubscribe(e,t))return e.send(JSON.stringify({unsub:"market."+t+".trade.detail",id:t})),!0}onMessage(e,t){const i=JSON.parse(pako$1.inflate(e.data,{to:"string"}));if(i)if(i.ping)t.send(JSON.stringify({pong:i.ping}));else if(i.tick&&i.tick.data&&i.tick.data.length){const e=i.ch.replace(/market.(.*).trade.detail/,"$1");return this.emitTrades(t.id,i.tick.data.map(t=>this.formatTrade(t,e))),!0}}formatTrade(e,t){let i=+e.amount;return"number"==typeof this.specs[t]&&(i=i*this.specs[t]/("linear"===this.types[t]?1:e.price)),this.prices[t]=+e.price,{exchange:this.id,pair:t,timestamp:e.ts,price:+e.price,size:i,side:e.direction}}formatLiquidation(e,t){const i=this.prices[t]||e.price;return{exchange:this.id,pair:t,timestamp:+new Date,price:i,size:+e.amount,side:e.direction,liquidation:!0}}subscribeLiquidations(e,t,i=!1){if(e._marketDataApi&&e._marketDataApi.readyState===WebSocket.OPEN&&("futures"===this.types[t]||"swap"===this.types[t]||"linear"===this.types[t])){const s="futures"===this.types[t]?t.replace(/\d+/,"").replace(/(-|_).*/,""):t;e._marketDataApi.send(JSON.stringify({op:i?"unsub":"sub",topic:"public."+s+".liquidation_orders"}))}}onApiRemoved(e){e._marketDataApi&&e._marketDataApi.readyState===WebSocket.OPEN&&e._marketDataApi.close()}onApiCreated(e){this.liquidationOrdersSubscriptions[e.id]=[],this.openMarketDataApi(e)}openMarketDataApi(e){"wss://api.hbdm.com/swap-ws"===e.url?e._marketDataApi=new WebSocket("wss://api.hbdm.com/swap-notification"):"wss://api.hbdm.com/linear-swap-ws"===e.url&&(e._marketDataApi=new WebSocket("wss://api.hbdm.com/linear-swap-notification")),e._marketDataApi&&(e._marketDataApi.binaryType="arraybuffer",e._marketDataApi.onmessage=t=>{const i=JSON.parse(pako$1.inflate(t.data,{to:"string"}));if("ping"===i.op)e._marketDataApi.send(JSON.stringify({op:"pong",ts:i.ts}));else if(i.data){const t=i.topic.replace(/public.(.*).liquidation_orders/,"$1");this.emitLiquidations(e.id,i.data.map(e=>this.formatLiquidation(e,t)))}},e._marketDataApi.onopen=()=>{for(const t of e._connected)this.subscribeLiquidations(e,t)},e._marketDataApi.onerror=e=>{},e._marketDataApi.onclose=t=>{e._marketDataApi=null,setTimeout(()=>{e.readyState===WebSocket.OPEN&&this.openMarketDataApi(e)},1e3)})}}class HYPERLIQUID extends Exchange{constructor(){super(...arguments),__publicField(this,"id","HYPERLIQUID"),__publicField(this,"endpoints",{PRODUCTS:[{url:"https://api.hyperliquid.xyz/info",method:"POST",data:JSON.stringify({type:"meta"}),proxy:!1}]})}async getUrl(){return"wss://api.hyperliquid.xyz/ws"}formatProducts(e){const t=[],i=e;if(i&&i.universe&&i.universe.length)for(const s of i.universe)t.push(s.name);return{products:t}}async subscribe(e,t){if(await super.subscribe(e,t))return e.send(JSON.stringify({method:"subscribe",subscription:{type:"trades",coin:t}})),!0}async unsubscribe(e,t){if(await super.unsubscribe(e,t))return e.send(JSON.stringify({method:"unsubscribe",subscription:{type:"trades",coin:t}})),!0}onMessage(e,t){const i=JSON.parse(e.data);if(i&&"trades"===i.channel)return this.emitTrades(t.id,i.data.map(e=>this.formatResponse(e)))}formatResponse(e){return{exchange:this.id,pair:e.coin,timestamp:+new Date(e.time),price:+e.px,size:+e.sz,side:"B"===e.side?"buy":"sell"}}}class KRAKEN extends Exchange{constructor(){super(...arguments),__publicField(this,"id","KRAKEN"),__publicField(this,"specs"),__publicField(this,"isPFregex",/^PF_/),__publicField(this,"delayBetweenMessages",250),__publicField(this,"endpoints",{PRODUCTS:["https://api.kraken.com/0/public/AssetPairs","https://futures.kraken.com/derivatives/api/v3/instruments"]})}async getUrl(e){return void 0!==this.specs[e]?"wss://futures.kraken.com/ws/v1":"wss://ws.kraken.com/"}formatProducts(e){const t=[],i={};for(const s of e)if(s.instruments)for(const e of s.instruments){if(!e.tradeable)continue;const s=e.symbol.toUpperCase();i[s]=e.contractSize,t.push(s)}else if(s.result)for(const e in s.result)s.result[e].wsname&&t.push(s.result[e].wsname);return{products:t,specs:i}}async subscribe(e,t){if(!(await super.subscribe(e,t)))return;const i={event:"subscribe"};return void 0!==this.specs[t]?(i.product_ids=[t],i.feed="trade"):(i.pair=[t],i.subscription={name:"trade"}),e.send(JSON.stringify(i)),!0}async unsubscribe(e,t){if(!(await super.unsubscribe(e,t)))return;const i={event:"unsubscribe"};return void 0!==this.specs[t]?(i.product_ids=[t],i.feed="trade"):(i.pair=[t],i.subscription={name:"trade"}),e.send(JSON.stringify(i)),!0}onMessage(e,t){const i=JSON.parse(e.data);if(i&&"heartbeat"!==i.event)return"trade"===i.feed&&i.qty?this.emitTrades(t.id,[{exchange:this.id,pair:i.product_id,timestamp:i.time,price:i.price,size:this.isPFregex.test(i.product_id)?i.qty:i.qty/i.price,side:i.side}]):!(!i[1]||!i[1].length)&&this.emitTrades(t.id,i[1].map(e=>({exchange:this.id,pair:i[3],timestamp:1e3*e[2],price:+e[0],size:+e[1],side:"b"===e[3]?"buy":"sell"})))}onApiCreated(e){/futures/.test(e.url)&&this.startKeepAlive(e)}onApiRemoved(e){/futures/.test(e.url)&&this.stopKeepAlive(e)}}class KUCOIN extends Exchange{constructor(){super(...arguments),__publicField(this,"id","KUCOIN"),__publicField(this,"endpoints",{PRODUCTS:["https://api.kucoin.com/api/v1/symbols","https://api-futures.kucoin.com/api/v1/contracts/active"]}),__publicField(this,"multipliers",{})}getUrl(){return this.endpoints.WS?this.endpoints.WS:fetch("https://cors.aggr.trade/https://api.kucoin.com/api/v1/bullet-public",{method:"POST"}).then(e=>e.json()).then(e=>(this.endpoints.WS="wss://ws-api.kucoin.com/endpoint",e.data.instanceServers.length&&(this.endpoints.WS=e.data.instanceServers[0].endpoint),this.endpoints.WS+="?token="+e.data.token,this.endpoints.WS)).catch(e=>{})}formatProducts(e){const t=[],i={};for(const s of e){const r=["spot","futures"][e.indexOf(s)];for(const e of s.data){const s=e.symbolName||e.symbol;t.push(e.symbol),"futures"===r&&(i[s]=e.multiplier)}}return{products:t,multipliers:i}}async subscribe(e,t){if(!(await super.subscribe(e,t)))return;let i;return i=this.multipliers[t]?`/contractMarket/execution:${t}`:`/market/match:${t}`,e.send(JSON.stringify({type:"subscribe",topic:i})),!0}async unsubscribe(e,t){if(!(await super.unsubscribe(e,t)))return;let i;return i=this.multipliers[t]?`/contractMarket/execution:${t}`:`/market/match:${t}`,e.send(JSON.stringify({type:"unsubscribe",topic:i})),!0}formatTrade(e){let t,i;return this.multipliers[e.symbol]?(t=e.ts/1e6,i=this.multipliers[e.symbol]<0?e.size/e.price:e.size*this.multipliers[e.symbol]):(t=e.time/1e6,i=+e.size),{exchange:this.id,pair:e.symbol,price:+e.price,side:"buy"===e.side?"buy":"sell",timestamp:t,size:i}}onMessage(e,t){const i=JSON.parse(e.data);if(i&&i.data&&"message"===i.type)return this.emitTrades(t.id,[this.formatTrade(i.data)])}onApiCreated(e){this.startKeepAlive(e,{type:"ping"},18e3)}onApiRemoved(e){this.stopKeepAlive(e)}}function handleFuturesMessage(e,t,i){return"push.deal"===e.channel&&e.data&&Array.isArray(e.data)?e.data.map(s=>formatFuturesTrade(s,e.symbol,t,i)):"rs.sub.deal"===e.channel||"pong"===e.channel}function formatFuturesTrade(e,t,i,s){const r=i[t]||1,n=s[t]?+e.v*r/+e.p:+e.v*r;return{exchange:"MEXC",pair:t,timestamp:e.t,price:+e.p,size:n,side:1===e.T?"buy":"sell"}}var src={exports:{}},indexLight={exports:{}},indexMinimal={},minimal={},aspromise=asPromise$1;function asPromise$1(e,t){for(var i=new Array(arguments.length-1),s=0,r=2,n=!0;r<arguments.length;)i[s++]=arguments[r++];return new Promise(function(r,o){i[s]=function(e){if(n)if(n=!1,e)o(e);else{for(var t=new Array(arguments.length-1),i=0;i<t.length;)t[i++]=arguments[i];r.apply(null,t)}};try{e.apply(t||null,i)}catch(a){n&&(n=!1,o(a))}})}var base64$1={};!function(e){var t=e;t.length=function(e){var t=e.length;if(!t)return 0;for(var i=0;--t%4>1&&"="===e.charAt(t);)++i;return Math.ceil(3*e.length)/4-i};for(var i=new Array(64),s=new Array(123),r=0;r<64;)s[i[r]=r<26?r+65:r<52?r+71:r<62?r-4:r-59|43]=r++;t.encode=function(e,t,s){for(var r,n=null,o=[],a=0,u=0;t<s;){var l=e[t++];switch(u){case 0:o[a++]=i[l>>2],r=(3&l)<<4,u=1;break;case 1:o[a++]=i[r|l>>4],r=(15&l)<<2,u=2;break;case 2:o[a++]=i[r|l>>6],o[a++]=i[63&l],u=0}a>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,o)),a=0)}return u&&(o[a++]=i[r],o[a++]=61,1===u&&(o[a++]=61)),n?(a&&n.push(String.fromCharCode.apply(String,o.slice(0,a))),n.join("")):String.fromCharCode.apply(String,o.slice(0,a))};var n="invalid encoding";t.decode=function(e,t,i){for(var r,o=i,a=0,u=0;u<e.length;){var l=e.charCodeAt(u++);if(61===l&&a>1)break;if(void 0===(l=s[l]))throw Error(n);switch(a){case 0:r=l,a=1;break;case 1:t[i++]=r<<2|(48&l)>>4,r=l,a=2;break;case 2:t[i++]=(15&r)<<4|(60&l)>>2,r=l,a=3;break;case 3:t[i++]=(3&r)<<6|l,a=0}}if(1===a)throw Error(n);return i-o},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}(base64$1);var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(e,t,i){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:i||this}),this},EventEmitter.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var i=this._listeners[e],s=0;s<i.length;)i[s].fn===t?i.splice(s,1):++s;return this},EventEmitter.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var i=[],s=1;s<arguments.length;)i.push(arguments[s++]);for(s=0;s<t.length;)t[s].fn.apply(t[s++].ctx,i)}return this};var float=factory(factory);function factory(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),i=new Uint8Array(t.buffer),s=128===i[3];function r(e,s,r){t[0]=e,s[r]=i[0],s[r+1]=i[1],s[r+2]=i[2],s[r+3]=i[3]}function n(e,s,r){t[0]=e,s[r]=i[3],s[r+1]=i[2],s[r+2]=i[1],s[r+3]=i[0]}function o(e,s){return i[0]=e[s],i[1]=e[s+1],i[2]=e[s+2],i[3]=e[s+3],t[0]}function a(e,s){return i[3]=e[s],i[2]=e[s+1],i[1]=e[s+2],i[0]=e[s+3],t[0]}e.writeFloatLE=s?r:n,e.writeFloatBE=s?n:r,e.readFloatLE=s?o:a,e.readFloatBE=s?a:o}():function(){function t(e,t,i,s){var r=t<0?1:0;if(r&&(t=-t),0===t)e(1/t>0?0:2147483648,i,s);else if(isNaN(t))e(2143289344,i,s);else if(t>34028234663852886e22)e((r<<31|2139095040)>>>0,i,s);else if(t<11754943508222875e-54)e((r<<31|Math.round(t/1401298464324817e-60))>>>0,i,s);else{var n=Math.floor(Math.log(t)/Math.LN2);e((r<<31|n+127<<23|8388607&Math.round(t*Math.pow(2,-n)*8388608))>>>0,i,s)}}function i(e,t,i){var s=e(t,i),r=2*(s>>31)+1,n=s>>>23&255,o=8388607&s;return 255===n?o?NaN:r*(1/0):0===n?1401298464324817e-60*r*o:r*Math.pow(2,n-150)*(o+8388608)}e.writeFloatLE=t.bind(null,writeUintLE),e.writeFloatBE=t.bind(null,writeUintBE),e.readFloatLE=i.bind(null,readUintLE),e.readFloatBE=i.bind(null,readUintBE)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),i=new Uint8Array(t.buffer),s=128===i[7];function r(e,s,r){t[0]=e,s[r]=i[0],s[r+1]=i[1],s[r+2]=i[2],s[r+3]=i[3],s[r+4]=i[4],s[r+5]=i[5],s[r+6]=i[6],s[r+7]=i[7]}function n(e,s,r){t[0]=e,s[r]=i[7],s[r+1]=i[6],s[r+2]=i[5],s[r+3]=i[4],s[r+4]=i[3],s[r+5]=i[2],s[r+6]=i[1],s[r+7]=i[0]}function o(e,s){return i[0]=e[s],i[1]=e[s+1],i[2]=e[s+2],i[3]=e[s+3],i[4]=e[s+4],i[5]=e[s+5],i[6]=e[s+6],i[7]=e[s+7],t[0]}function a(e,s){return i[7]=e[s],i[6]=e[s+1],i[5]=e[s+2],i[4]=e[s+3],i[3]=e[s+4],i[2]=e[s+5],i[1]=e[s+6],i[0]=e[s+7],t[0]}e.writeDoubleLE=s?r:n,e.writeDoubleBE=s?n:r,e.readDoubleLE=s?o:a,e.readDoubleBE=s?a:o}():function(){function t(e,t,i,s,r,n){var o=s<0?1:0;if(o&&(s=-s),0===s)e(0,r,n+t),e(1/s>0?0:2147483648,r,n+i);else if(isNaN(s))e(0,r,n+t),e(2146959360,r,n+i);else if(s>17976931348623157e292)e(0,r,n+t),e((o<<31|2146435072)>>>0,r,n+i);else{var a;if(s<22250738585072014e-324)e((a=s/5e-324)>>>0,r,n+t),e((o<<31|a/4294967296)>>>0,r,n+i);else{var u=Math.floor(Math.log(s)/Math.LN2);1024===u&&(u=1023),e(4503599627370496*(a=s*Math.pow(2,-u))>>>0,r,n+t),e((o<<31|u+1023<<20|1048576*a&1048575)>>>0,r,n+i)}}}function i(e,t,i,s,r){var n=e(s,r+t),o=e(s,r+i),a=2*(o>>31)+1,u=o>>>20&2047,l=4294967296*(1048575&o)+n;return 2047===u?l?NaN:a*(1/0):0===u?5e-324*a*l:a*Math.pow(2,u-1075)*(l+4503599627370496)}e.writeDoubleLE=t.bind(null,writeUintLE,0,4),e.writeDoubleBE=t.bind(null,writeUintBE,4,0),e.readDoubleLE=i.bind(null,readUintLE,0,4),e.readDoubleBE=i.bind(null,readUintBE,4,0)}(),e}function writeUintLE(e,t,i){t[i]=255&e,t[i+1]=e>>>8&255,t[i+2]=e>>>16&255,t[i+3]=e>>>24}function writeUintBE(e,t,i){t[i]=e>>>24,t[i+1]=e>>>16&255,t[i+2]=e>>>8&255,t[i+3]=255&e}function readUintLE(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function readUintBE(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var inquire_1=inquire$1;function inquire$1(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}var utf8$2={},exports,utf82;exports=utf8$2,utf82=exports,utf82.length=function(e){for(var t=0,i=0,s=0;s<e.length;++s)(i=e.charCodeAt(s))<128?t+=1:i<2048?t+=2:55296==(64512&i)&&56320==(64512&e.charCodeAt(s+1))?(++s,t+=4):t+=3;return t},utf82.read=function(e,t,i){if(i-t<1)return"";for(var s,r=null,n=[],o=0;t<i;)(s=e[t++])<128?n[o++]=s:s>191&&s<224?n[o++]=(31&s)<<6|63&e[t++]:s>239&&s<365?(s=((7&s)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,n[o++]=55296+(s>>10),n[o++]=56320+(1023&s)):n[o++]=(15&s)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,n)),o=0);return r?(o&&r.push(String.fromCharCode.apply(String,n.slice(0,o))),r.join("")):String.fromCharCode.apply(String,n.slice(0,o))},utf82.write=function(e,t,i){for(var s,r,n=i,o=0;o<e.length;++o)(s=e.charCodeAt(o))<128?t[i++]=s:s<2048?(t[i++]=s>>6|192,t[i++]=63&s|128):55296==(64512&s)&&56320==(64512&(r=e.charCodeAt(o+1)))?(s=65536+((1023&s)<<10)+(1023&r),++o,t[i++]=s>>18|240,t[i++]=s>>12&63|128,t[i++]=s>>6&63|128,t[i++]=63&s|128):(t[i++]=s>>12|224,t[i++]=s>>6&63|128,t[i++]=63&s|128);return i-n};var pool_1=pool,longbits,hasRequiredLongbits,hasRequiredMinimal;function pool(e,t,i){var s=i||8192,r=s>>>1,n=null,o=s;return function(i){if(i<1||i>r)return e(i);o+i>s&&(n=e(s),o=0);var a=t.call(n,o,o+=i);return 7&o&&(o=1+(7|o)),a}}function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=t;var e=requireMinimal();function t(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=t.zero=new t(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var s=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(e){if(0===e)return i;var s=e<0;s&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return s&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new t(r,n)},t.from=function(s){if("number"==typeof s)return t.fromNumber(s);if(e.isString(s)){if(!e.Long)return t.fromNumber(parseInt(s,10));s=e.Long.fromString(s)}return s.low||s.high?new t(s.low>>>0,s.high>>>0):i},t.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,i=~this.hi>>>0;return t||(i=i+1>>>0),-(t+4294967296*i)}return this.lo+4294967296*this.hi},t.prototype.toLong=function(t){return e.Long?new e.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var r=String.prototype.charCodeAt;return t.fromHash=function(e){return e===s?i:new t((r.call(e,0)|r.call(e,1)<<8|r.call(e,2)<<16|r.call(e,3)<<24)>>>0,(r.call(e,4)|r.call(e,5)<<8|r.call(e,6)<<16|r.call(e,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},t.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},t.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return 0===i?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:i<128?9:10},longbits}function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(e){var t=e;function i(e,t,i){for(var s=Object.keys(t),r=0;r<s.length;++r)void 0!==e[s[r]]&&i||(e[s[r]]=t[s[r]]);return e}function s(e){function t(e,s){if(!(this instanceof t))return new t(e,s);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),s&&i(this,s)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}t.asPromise=aspromise,t.base64=base64$1,t.EventEmitter=eventemitter,t.float=float,t.inquire=inquire_1,t.utf8=utf8$2,t.pool=pool_1,t.LongBits=requireLongbits(),t.isNode=Boolean(void 0!==commonjsGlobal&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),t.global=t.isNode&&commonjsGlobal||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||commonjsGlobal,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"==typeof e},t.isset=t.isSet=function(e,t){var i=e[t];return!(null==i||!e.hasOwnProperty(t))&&("object"!=typeof i||(Array.isArray(i)?i.length:Object.keys(i).length)>0)},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(i){return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},t.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,i){var s=t.LongBits.fromHash(e);return t.Long?t.Long.fromBits(s.lo,s.hi,i):s.toNumber(Boolean(i))},t.merge=i,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=s,t.ProtocolError=s("ProtocolError"),t.oneOfGetter=function(e){for(var t={},i=0;i<e.length;++i)t[e[i]]=1;return function(){for(var e=Object.keys(this),i=e.length-1;i>-1;--i)if(1===t[e[i]]&&void 0!==this[e[i]]&&null!==this[e[i]])return e[i]}},t.oneOfSetter=function(e){return function(t){for(var i=0;i<e.length;++i)e[i]!==t&&delete this[e[i]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,i){return new e(t,i)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}}(minimal)),minimal}var writer=Writer$1,util$7=requireMinimal(),BufferWriter$1,LongBits$1=util$7.LongBits,base64=util$7.base64,utf8$1=util$7.utf8;function Op(e,t,i){this.fn=e,this.len=t,this.next=void 0,this.val=i}function noop(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function(){return util$7.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};function writeByte(e,t,i){t[i]=255&e}function writeVarint32(e,t,i){for(;e>127;)t[i++]=127&e|128,e>>>=7;t[i]=e}function VarintOp(e,t){this.len=e,this.next=void 0,this.val=t}function writeVarint64(e,t,i){for(;e.hi;)t[i++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[i++]=127&e.lo|128,e.lo=e.lo>>>7;t[i++]=e.lo}function writeFixed32(e,t,i){t[i]=255&e,t[i+1]=e>>>8&255,t[i+2]=e>>>16&255,t[i+3]=e>>>24}Writer$1.create=create$1(),Writer$1.alloc=function(e){return new util$7.Array(e)},util$7.Array!==Array&&(Writer$1.alloc=util$7.pool(Writer$1.alloc,util$7.Array.prototype.subarray)),Writer$1.prototype._push=function(e,t,i){return this.tail=this.tail.next=new Op(e,t,i),this.len+=t,this},VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer$1.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},Writer$1.prototype.int32=function(e){return e<0?this._push(writeVarint64,10,LongBits$1.fromNumber(e)):this.uint32(e)},Writer$1.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Writer$1.prototype.uint64=function(e){var t=LongBits$1.from(e);return this._push(writeVarint64,t.length(),t)},Writer$1.prototype.int64=Writer$1.prototype.uint64,Writer$1.prototype.sint64=function(e){var t=LongBits$1.from(e).zzEncode();return this._push(writeVarint64,t.length(),t)},Writer$1.prototype.bool=function(e){return this._push(writeByte,1,e?1:0)},Writer$1.prototype.fixed32=function(e){return this._push(writeFixed32,4,e>>>0)},Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32,Writer$1.prototype.fixed64=function(e){var t=LongBits$1.from(e);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)},Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64,Writer$1.prototype.float=function(e){return this._push(util$7.float.writeFloatLE,4,e)},Writer$1.prototype.double=function(e){return this._push(util$7.float.writeDoubleLE,8,e)};var writeBytes=util$7.Array.prototype.set?function(e,t,i){t.set(e,i)}:function(e,t,i){for(var s=0;s<e.length;++s)t[i+s]=e[s]};Writer$1.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(writeByte,1,0);if(util$7.isString(e)){var i=Writer$1.alloc(t=base64.length(e));base64.decode(e,i,0),e=i}return this.uint32(t)._push(writeBytes,t,e)},Writer$1.prototype.string=function(e){var t=utf8$1.length(e);return t?this.uint32(t)._push(utf8$1.write,t,e):this._push(writeByte,1,0)},Writer$1.prototype.fork=function(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer$1.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer$1.prototype.ldelim=function(){var e=this.head,t=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=e.next,this.tail=t,this.len+=i),this},Writer$1.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),i=0;e;)e.fn(e.val,t,i),i+=e.len,e=e.next;return t},Writer$1._configure=function(e){BufferWriter$1=e,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$6=requireMinimal();function BufferWriter(){Writer.call(this)}function writeStringBuffer(e,t,i){e.length<40?util$6.utf8.write(e,t,i):t.utf8Write?t.utf8Write(e,i):t.write(e,i)}BufferWriter._configure=function(){BufferWriter.alloc=util$6._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$6.Buffer&&util$6.Buffer.prototype instanceof Uint8Array&&"set"===util$6.Buffer.prototype.set.name?function(e,t,i){t.set(e,i)}:function(e,t,i){if(e.copy)e.copy(t,i,0,e.length);else for(var s=0;s<e.length;)t[i++]=e[s++]}},BufferWriter.prototype.bytes=function(e){util$6.isString(e)&&(e=util$6._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(BufferWriter.writeBytesBuffer,t,e),this},BufferWriter.prototype.string=function(e){var t=util$6.Buffer.byteLength(e);return this.uint32(t),t&&this._push(writeStringBuffer,t,e),this},BufferWriter._configure();var reader=Reader$1,util$5=requireMinimal(),BufferReader$1,LongBits=util$5.LongBits,utf8=util$5.utf8;function indexOutOfRange(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader$1(e){this.buf=e,this.pos=0,this.len=e.length}var create_array="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")},create=function(){return util$5.Buffer?function(e){return(Reader$1.create=function(e){return util$5.Buffer.isBuffer(e)?new BufferReader$1(e):create_array(e)})(e)}:create_array},value;function readLongVarint(){var e=new LongBits(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function readFixed32_end(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.create=create(),Reader$1.prototype._slice=util$5.Array.prototype.subarray||util$5.Array.prototype.slice,Reader$1.prototype.uint32=(value=4294967295,function(){if(value=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return value;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return value}),Reader$1.prototype.int32=function(){return 0|this.uint32()},Reader$1.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)},Reader$1.prototype.bool=function(){return 0!==this.uint32()},Reader$1.prototype.fixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.sfixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return 0|readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.float=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var e=util$5.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Reader$1.prototype.double=function(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var e=util$5.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Reader$1.prototype.bytes=function(){var e=this.uint32(),t=this.pos,i=this.pos+e;if(i>this.len)throw indexOutOfRange(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,i);if(t===i){var s=util$5.Buffer;return s?s.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,i)},Reader$1.prototype.string=function(){var e=this.bytes();return utf8.read(e,0,e.length)},Reader$1.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this},Reader$1.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Reader$1._configure=function(e){BufferReader$1=e,Reader$1.create=create(),BufferReader$1._configure();var t=util$5.Long?"toLong":"toNumber";util$5.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$4=requireMinimal();function BufferReader(e){Reader.call(this,e)}BufferReader._configure=function(){util$4.Buffer&&(BufferReader.prototype._slice=util$4.Buffer.prototype.slice)},BufferReader.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},BufferReader._configure();var rpc={},service$1=Service$1,util$3=requireMinimal();function Service$1(e,t,i){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");util$3.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(i)}(Service$1.prototype=Object.create(util$3.EventEmitter.prototype)).constructor=Service$1,Service$1.prototype.rpcCall=function e(t,i,s,r,n){if(!r)throw TypeError("request must be specified");var o=this;if(!n)return util$3.asPromise(e,o,t,i,s,r);if(o.rpcImpl)try{return o.rpcImpl(t,i[o.requestDelimited?"encodeDelimited":"encode"](r).finish(),function(e,i){if(e)return o.emit("error",e,t),n(e);if(null!==i){if(!(i instanceof s))try{i=s[o.responseDelimited?"decodeDelimited":"decode"](i)}catch(r){return o.emit("error",r,t),n(r)}return o.emit("data",i,t),n(null,i)}o.end(!0)})}catch(a){return o.emit("error",a,t),void setTimeout(function(){n(a)},0)}else setTimeout(function(){n(Error("already ended"))},0)},Service$1.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},function(e){e.Service=service$1}(rpc);var roots={};!function(e){var t=e;function i(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}t.build="minimal",t.Writer=writer,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=requireMinimal(),t.rpc=rpc,t.roots=roots,t.configure=i,i()}(indexMinimal);var types$1={},util$2={exports:{}},codegen_1=codegen;function codegen(e,t){"string"==typeof e&&(t=e,e=void 0);var i=[];function s(e){if("string"!=typeof e){var t=r();if(codegen.verbose,t="return "+t,e){for(var n=Object.keys(e),o=new Array(n.length+1),a=new Array(n.length),u=0;u<n.length;)o[u]=n[u],a[u]=e[n[u++]];return o[u]=t,Function.apply(null,o).apply(null,a)}return Function(t)()}for(var l=new Array(arguments.length-1),c=0;c<l.length;)l[c]=arguments[++c];if(c=0,e=e.replace(/%([%dfijs])/g,function(e,t){var i=l[c++];switch(t){case"d":case"f":return String(Number(i));case"i":return String(Math.floor(i));case"j":return JSON.stringify(i);case"s":return String(i)}return"%"}),c!==l.length)throw Error("parameter count mismatch");return i.push(e),s}function r(s){return"function "+(s||t||"")+"("+(e&&e.join(",")||"")+"){\n  "+i.join("\n  ")+"\n}"}return s.toString=r,s}codegen.verbose=!1;var fetch_1=fetch$1,asPromise=aspromise,inquire=inquire_1,fs=inquire("fs");function fetch$1(e,t,i){return"function"==typeof t?(i=t,t={}):t||(t={}),i?!t.xhr&&fs&&fs.readFile?fs.readFile(e,function(s,r){return s&&"undefined"!=typeof XMLHttpRequest?fetch$1.xhr(e,t,i):s?i(s):i(null,t.binary?r:r.toString("utf8"))}):fetch$1.xhr(e,t,i):asPromise(fetch$1,this,e,t)}fetch$1.xhr=function(e,t,i){var s=new XMLHttpRequest;s.onreadystatechange=function(){if(4===s.readyState){if(0!==s.status&&200!==s.status)return i(Error("status "+s.status));if(t.binary){var e=s.response;if(!e){e=[];for(var r=0;r<s.responseText.length;++r)e.push(255&s.responseText.charCodeAt(r))}return i(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return i(null,s.responseText)}},t.binary&&("overrideMimeType"in s&&s.overrideMimeType("text/plain; charset=x-user-defined"),s.responseType="arraybuffer"),s.open("GET",e),s.send()};var path={},namespace,hasRequiredNamespace,mapfield,hasRequiredMapfield,method,hasRequiredMethod,service,hasRequiredService;function requireNamespace(){if(hasRequiredNamespace)return namespace;hasRequiredNamespace=1,namespace=u;var e=requireObject();((u.prototype=Object.create(e.prototype)).constructor=u).className="Namespace";var t,i,s,r=requireField(),n=requireUtil(),o=requireOneof();function a(e,t){if(e&&e.length){for(var i={},s=0;s<e.length;++s)i[e[s].name]=e[s].toJSON(t);return i}}function u(t,i){e.call(this,t,i),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function l(e){e._nestedArray=null,e._lookupCache={};for(var t=e;t=t.parent;)t._lookupCache={};return e}return u.fromJSON=function(e,t){return new u(e,t.options).addJSON(t.nested)},u.arrayToJSON=a,u.isReservedId=function(e,t){if(e)for(var i=0;i<e.length;++i)if("string"!=typeof e[i]&&e[i][0]<=t&&e[i][1]>t)return!0;return!1},u.isReservedName=function(e,t){if(e)for(var i=0;i<e.length;++i)if(e[i]===t)return!0;return!1},Object.defineProperty(u.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=n.toArray(this.nested))}}),u.prototype.toJSON=function(e){return n.toObject(["options",this.options,"nested",a(this.nestedArray,e)])},u.prototype.addJSON=function(e){if(e)for(var n,o=Object.keys(e),a=0;a<o.length;++a)n=e[o[a]],this.add((void 0!==n.fields?t.fromJSON:void 0!==n.values?s.fromJSON:void 0!==n.methods?i.fromJSON:void 0!==n.id?r.fromJSON:u.fromJSON)(o[a],n));return this},u.prototype.get=function(e){return this.nested&&this.nested[e]||null},u.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof s)return this.nested[e].values;throw Error("no such enum: "+e)},u.prototype.add=function(e){if(!(e instanceof r&&void 0!==e.extend||e instanceof t||e instanceof o||e instanceof s||e instanceof i||e instanceof u))throw TypeError("object must be a valid nested object");if(this.nested){var n=this.get(e.name);if(n){if(!(n instanceof u&&e instanceof u)||n instanceof t||n instanceof i)throw Error("duplicate name '"+e.name+"' in "+this);for(var a=n.nestedArray,c=0;c<a.length;++c)e.add(a[c]);this.remove(n),this.nested||(this.nested={}),e.setOptions(n.options,!0)}}else this.nested={};this.nested[e.name]=e,this instanceof t||this instanceof i||this instanceof s||this instanceof r||e._edition||(e._edition=e._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(var d=this;d=d.parent;)d._needsRecursiveFeatureResolution=!0,d._needsRecursiveResolve=!0;return e.onAdd(this),l(this)},u.prototype.remove=function(t){if(!(t instanceof e))throw TypeError("object must be a ReflectionObject");if(t.parent!==this)throw Error(t+" is not a member of "+this);return delete this.nested[t.name],Object.keys(this.nested).length||(this.nested=void 0),t.onRemove(this),l(this)},u.prototype.define=function(e,t){if(n.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var i=this;e.length>0;){var s=e.shift();if(i.nested&&i.nested[s]){if(!((i=i.nested[s])instanceof u))throw Error("path conflicts with non-namespace objects")}else i.add(i=new u(s))}return t&&i.addJSON(t),i},u.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);var e=this.nestedArray,t=0;for(this.resolve();t<e.length;)e[t]instanceof u?e[t++].resolveAll():e[t++].resolve();return this._needsRecursiveResolve=!1,this},u.prototype._resolveFeaturesRecursive=function(t){return this._needsRecursiveFeatureResolution?(this._needsRecursiveFeatureResolution=!1,t=this._edition||t,e.prototype._resolveFeaturesRecursive.call(this,t),this.nestedArray.forEach(e=>{e._resolveFeaturesRecursive(t)}),this):this},u.prototype.lookup=function(e,t,i){if("boolean"==typeof t?(i=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),n.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;var s=e.join(".");if(""===e[0])return this.root.lookup(e.slice(1),t);var r=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+s];if(r&&(!t||t.indexOf(r.constructor)>-1))return r;if((r=this._lookupImpl(e,s))&&(!t||t.indexOf(r.constructor)>-1))return r;if(i)return null;for(var o=this;o.parent;){if((r=o.parent._lookupImpl(e,s))&&(!t||t.indexOf(r.constructor)>-1))return r;o=o.parent}return null},u.prototype._lookupImpl=function(e,t){if(Object.prototype.hasOwnProperty.call(this._lookupCache,t))return this._lookupCache[t];var i=this.get(e[0]),s=null;if(i)1===e.length?s=i:i instanceof u&&(e=e.slice(1),s=i._lookupImpl(e,e.join(".")));else for(var r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof u&&(i=this._nestedArray[r]._lookupImpl(e,t))&&(s=i);return this._lookupCache[t]=s,s},u.prototype.lookupType=function(e){var i=this.lookup(e,[t]);if(!i)throw Error("no such type: "+e);return i},u.prototype.lookupEnum=function(e){var t=this.lookup(e,[s]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},u.prototype.lookupTypeOrEnum=function(e){var i=this.lookup(e,[t,s]);if(!i)throw Error("no such Type or Enum '"+e+"' in "+this);return i},u.prototype.lookupService=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},u._configure=function(e,r,n){t=e,i=r,s=n},namespace}function requireMapfield(){if(hasRequiredMapfield)return mapfield;hasRequiredMapfield=1,mapfield=s;var e=requireField();((s.prototype=Object.create(e.prototype)).constructor=s).className="MapField";var t=requireTypes(),i=requireUtil();function s(t,s,r,n,o,a){if(e.call(this,t,s,n,void 0,void 0,o,a),!i.isString(r))throw TypeError("keyType must be a string");this.keyType=r,this.resolvedKeyType=null,this.map=!0}return s.fromJSON=function(e,t){return new s(e,t.id,t.keyType,t.type,t.options,t.comment)},s.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return i.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},s.prototype.resolve=function(){if(this.resolved)return this;if(void 0===t.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return e.prototype.resolve.call(this)},s.d=function(e,t,r){return"function"==typeof r?r=i.decorateType(r).name:r&&"object"==typeof r&&(r=i.decorateEnum(r).name),function(n,o){i.decorateType(n.constructor).add(new s(o,e,t,r))}},mapfield}function requireMethod(){if(hasRequiredMethod)return method;hasRequiredMethod=1,method=i;var e=requireObject();((i.prototype=Object.create(e.prototype)).constructor=i).className="Method";var t=requireUtil();function i(i,s,r,n,o,a,u,l,c){if(t.isObject(o)?(u=o,o=a=void 0):t.isObject(a)&&(u=a,a=void 0),void 0!==s&&!t.isString(s))throw TypeError("type must be a string");if(!t.isString(r))throw TypeError("requestType must be a string");if(!t.isString(n))throw TypeError("responseType must be a string");e.call(this,i,u),this.type=s||"rpc",this.requestType=r,this.requestStream=!!o||void 0,this.responseType=n,this.responseStream=!!a||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=l,this.parsedOptions=c}return i.fromJSON=function(e,t){return new i(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},i.prototype.toJSON=function(e){var i=!!e&&Boolean(e.keepComments);return t.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",i?this.comment:void 0,"parsedOptions",this.parsedOptions])},i.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),e.prototype.resolve.call(this))},method}function requireService(){if(hasRequiredService)return service;hasRequiredService=1,service=r;var e=requireNamespace();((r.prototype=Object.create(e.prototype)).constructor=r).className="Service";var t=requireMethod(),i=requireUtil(),s=rpc;function r(t,i){e.call(this,t,i),this.methods={},this._methodsArray=null}function n(e){return e._methodsArray=null,e}return r.fromJSON=function(e,i){var s=new r(e,i.options);if(i.methods)for(var n=Object.keys(i.methods),o=0;o<n.length;++o)s.add(t.fromJSON(n[o],i.methods[n[o]]));return i.nested&&s.addJSON(i.nested),i.edition&&(s._edition=i.edition),s.comment=i.comment,s._defaultEdition="proto3",s},r.prototype.toJSON=function(t){var s=e.prototype.toJSON.call(this,t),r=!!t&&Boolean(t.keepComments);return i.toObject(["edition",this._editionToJSON(),"options",s&&s.options||void 0,"methods",e.arrayToJSON(this.methodsArray,t)||{},"nested",s&&s.nested||void 0,"comment",r?this.comment:void 0])},Object.defineProperty(r.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=i.toArray(this.methods))}}),r.prototype.get=function(t){return this.methods[t]||e.prototype.get.call(this,t)},r.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;e.prototype.resolve.call(this);for(var t=this.methodsArray,i=0;i<t.length;++i)t[i].resolve();return this},r.prototype._resolveFeaturesRecursive=function(t){return this._needsRecursiveFeatureResolution?(t=this._edition||t,e.prototype._resolveFeaturesRecursive.call(this,t),this.methodsArray.forEach(e=>{e._resolveFeaturesRecursive(t)}),this):this},r.prototype.add=function(i){if(this.get(i.name))throw Error("duplicate name '"+i.name+"' in "+this);return i instanceof t?(this.methods[i.name]=i,i.parent=this,n(this)):e.prototype.add.call(this,i)},r.prototype.remove=function(i){if(i instanceof t){if(this.methods[i.name]!==i)throw Error(i+" is not a member of "+this);return delete this.methods[i.name],i.parent=null,n(this)}return e.prototype.remove.call(this,i)},r.prototype.create=function(e,t,r){for(var n,o=new s.Service(e,t,r),a=0;a<this.methodsArray.length;++a){var u=i.lcFirst((n=this._methodsArray[a]).resolve().name).replace(/[^$\w_]/g,"");o[u]=i.codegen(["r","c"],i.isReserved(u)?u+"_":u)("return this.rpcCall(m,q,s,r,c)")({m:n,q:n.resolvedRequestType.ctor,s:n.resolvedResponseType.ctor})}return o},service}!function(e){var t=e,i=t.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},s=t.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),s=i(e),r="";s&&(r=t.shift()+"/");for(var n=0;n<t.length;)".."===t[n]?n>0&&".."!==t[n-1]?t.splice(--n,2):s?t.splice(n,1):++n:"."===t[n]?t.splice(n,1):++n;return r+t.join("/")};t.resolve=function(e,t,r){return r||(t=s(t)),i(t)?t:(r||(e=s(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?s(e+"/"+t):t)}}(path);var message=Message,util$1=requireMinimal(),decoder_1,hasRequiredDecoder,verifier_1,hasRequiredVerifier;function Message(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)this[t[i]]=e[t[i]]}function requireDecoder(){if(hasRequiredDecoder)return decoder_1;hasRequiredDecoder=1,decoder_1=function(r){for(var n=i.codegen(["r","l","e"],r.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(r.fieldsArray.filter(function(e){return e.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),o=0;o<r.fieldsArray.length;++o){var a=r._fieldsArray[o].resolve(),u=a.resolvedType instanceof e?"int32":a.type,l="m"+i.safeProp(a.name);n("case %i: {",a.id),a.map?(n("if(%s===util.emptyObject)",l)("%s={}",l)("var c2 = r.uint32()+r.pos"),void 0!==t.defaults[a.keyType]?n("k=%j",t.defaults[a.keyType]):n("k=null"),void 0!==t.defaults[u]?n("value=%j",t.defaults[u]):n("value=null"),n("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",a.keyType)("case 2:"),void 0===t.basic[u]?n("value=types[%i].decode(r,r.uint32())",o):n("value=r.%s()",u),n("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),void 0!==t.long[a.keyType]?n('%s[typeof k==="object"?util.longToHash(k):k]=value',l):n("%s[k]=value",l)):a.repeated?(n("if(!(%s&&%s.length))",l,l)("%s=[]",l),void 0!==t.packed[u]&&n("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",l,u)("}else"),void 0===t.basic[u]?n(a.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",l,o):n("%s.push(r.%s())",l,u)):void 0===t.basic[u]?n(a.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",l,o):n("%s=r.%s()",l,u),n("break")("}")}for(n("default:")("r.skipType(t&7)")("break")("}")("}"),o=0;o<r._fieldsArray.length;++o){var c=r._fieldsArray[o];c.required&&n("if(!m.hasOwnProperty(%j))",c.name)("throw util.ProtocolError(%j,{instance:m})",s(c))}return n("return m")};var e=require_enum(),t=requireTypes(),i=requireUtil();function s(e){return"missing required '"+e.name+"'"}return decoder_1}function requireVerifier(){if(hasRequiredVerifier)return verifier_1;hasRequiredVerifier=1,verifier_1=function(e){var n=t.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),o=e.oneofsArray,a={};o.length&&n("var p={}");for(var u=0;u<e.fieldsArray.length;++u){var l=e._fieldsArray[u].resolve(),c="m"+t.safeProp(l.name);if(l.optional&&n("if(%s!=null&&m.hasOwnProperty(%j)){",c,l.name),l.map)n("if(!util.isObject(%s))",c)("return%j",i(l,"object"))("var k=Object.keys(%s)",c)("for(var i=0;i<k.length;++i){"),r(n,l,"k[i]"),s(n,l,u,c+"[k[i]]")("}");else if(l.repeated)n("if(!Array.isArray(%s))",c)("return%j",i(l,"array"))("for(var i=0;i<%s.length;++i){",c),s(n,l,u,c+"[i]")("}");else{if(l.partOf){var d=t.safeProp(l.partOf.name);1===a[l.partOf.name]&&n("if(p%s===1)",d)("return%j",l.partOf.name+": multiple values"),a[l.partOf.name]=1,n("p%s=1",d)}s(n,l,u,c)}l.optional&&n("}")}return n("return null")};var e=require_enum(),t=requireUtil();function i(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function s(t,s,r,n){if(s.resolvedType)if(s.resolvedType instanceof e){t("switch(%s){",n)("default:")("return%j",i(s,"enum value"));for(var o=Object.keys(s.resolvedType.values),a=0;a<o.length;++a)t("case %i:",s.resolvedType.values[o[a]]);t("break")("}")}else t("{")("var e=types[%i].verify(%s);",r,n)("if(e)")("return%j+e",s.name+".")("}");else switch(s.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":t("if(!util.isInteger(%s))",n)("return%j",i(s,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":t("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",n,n,n,n)("return%j",i(s,"integer|Long"));break;case"float":case"double":t('if(typeof %s!=="number")',n)("return%j",i(s,"number"));break;case"bool":t('if(typeof %s!=="boolean")',n)("return%j",i(s,"boolean"));break;case"string":t("if(!util.isString(%s))",n)("return%j",i(s,"string"));break;case"bytes":t('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',n,n,n)("return%j",i(s,"buffer"))}return t}function r(e,t,s){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",s)("return%j",i(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",s)("return%j",i(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",s)("return%j",i(t,"boolean key"))}return e}return verifier_1}Message.create=function(e){return this.$type.create(e)},Message.encode=function(e,t){return this.$type.encode(e,t)},Message.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},Message.decode=function(e){return this.$type.decode(e)},Message.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},Message.verify=function(e){return this.$type.verify(e)},Message.fromObject=function(e){return this.$type.fromObject(e)},Message.toObject=function(e,t){return this.$type.toObject(e,t)},Message.prototype.toJSON=function(){return this.$type.toObject(this,util$1.toJSONOptions)};var converter={},hasRequiredConverter;function requireConverter(){return hasRequiredConverter||(hasRequiredConverter=1,function(e){var t=e,i=require_enum(),s=requireUtil();function r(e,t,s,r){var n=!1;if(t.resolvedType)if(t.resolvedType instanceof i){e("switch(d%s){",r);for(var o=t.resolvedType.values,a=Object.keys(o),u=0;u<a.length;++u)o[a[u]]!==t.typeDefault||n||(e("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),t.repeated||e("break"),n=!0),e("case%j:",a[u])("case %i:",o[a[u]])("m%s=%j",r,o[a[u]])("break");e("}")}else e('if(typeof d%s!=="object")',r)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,s,r);else{var l=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":e('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":e("m%s=String(d%s)",r,r);break;case"bool":e("m%s=Boolean(d%s)",r,r)}}return e}function n(e,t,s,r){if(t.resolvedType)t.resolvedType instanceof i?e("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,s,r,r,s,r,r):e("d%s=types[%i].toObject(m%s,o)",r,s,r);else{var n=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":n=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,n?"true":"",r);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:e("d%s=m%s",r,r)}}return e}t.fromObject=function(e){var t=e.fieldsArray,n=s.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return n("return new this.ctor");n("var m=new this.ctor");for(var o=0;o<t.length;++o){var a=t[o].resolve(),u=s.safeProp(a.name);a.map?(n("if(d%s){",u)('if(typeof d%s!=="object")',u)("throw TypeError(%j)",a.fullName+": object expected")("m%s={}",u)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",u),r(n,a,o,u+"[ks[i]]")("}")("}")):a.repeated?(n("if(d%s){",u)("if(!Array.isArray(d%s))",u)("throw TypeError(%j)",a.fullName+": array expected")("m%s=[]",u)("for(var i=0;i<d%s.length;++i){",u),r(n,a,o,u+"[i]")("}")("}")):(a.resolvedType instanceof i||n("if(d%s!=null){",u),r(n,a,o,u),a.resolvedType instanceof i||n("}"))}return n("return m")},t.toObject=function(e){var t=e.fieldsArray.slice().sort(s.compareFieldsById);if(!t.length)return s.codegen()("return {}");for(var r=s.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),o=[],a=[],u=[],l=0;l<t.length;++l)t[l].partOf||(t[l].resolve().repeated?o:t[l].map?a:u).push(t[l]);if(o.length){for(r("if(o.arrays||o.defaults){"),l=0;l<o.length;++l)r("d%s=[]",s.safeProp(o[l].name));r("}")}if(a.length){for(r("if(o.objects||o.defaults){"),l=0;l<a.length;++l)r("d%s={}",s.safeProp(a[l].name));r("}")}if(u.length){for(r("if(o.defaults){"),l=0;l<u.length;++l){var c=u[l],d=s.safeProp(c.name);if(c.resolvedType instanceof i)r("d%s=o.enums===String?%j:%j",d,c.resolvedType.valuesById[c.typeDefault],c.typeDefault);else if(c.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",c.typeDefault.low,c.typeDefault.high,c.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",d)("}else")("d%s=o.longs===String?%j:%i",d,c.typeDefault.toString(),c.typeDefault.toNumber());else if(c.bytes){var p="["+Array.prototype.slice.call(c.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",d,String.fromCharCode.apply(String,c.typeDefault))("else{")("d%s=%s",d,p)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",d,d)("}")}else r("d%s=%j",d,c.typeDefault)}r("}")}var h=!1;for(l=0;l<t.length;++l){c=t[l];var f=e._fieldsArray.indexOf(c);d=s.safeProp(c.name);c.map?(h||(h=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",d,d)("d%s={}",d)("for(var j=0;j<ks2.length;++j){"),n(r,c,f,d+"[ks2[j]]")("}")):c.repeated?(r("if(m%s&&m%s.length){",d,d)("d%s=[]",d)("for(var j=0;j<m%s.length;++j){",d),n(r,c,f,d+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",d,c.name),n(r,c,f,d),c.partOf&&r("if(o.oneofs)")("d%s=%j",s.safeProp(c.partOf.name),c.name)),r("}")}return r("return d")}}(converter)),converter}var wrappers={},type,hasRequiredType,root,hasRequiredRoot,hasRequiredUtil,hasRequiredTypes,field,hasRequiredField,oneof,hasRequiredOneof,object,hasRequiredObject,_enum,hasRequired_enum,encoder_1,hasRequiredEncoder;function requireType(){if(hasRequiredType)return type;hasRequiredType=1,type=_;var e=requireNamespace();((_.prototype=Object.create(e.prototype)).constructor=_).className="Type";var t=require_enum(),i=requireOneof(),s=requireField(),r=requireMapfield(),n=requireService(),o=message,a=reader,u=writer,l=requireUtil(),c=requireEncoder(),d=requireDecoder(),p=requireVerifier(),h=requireConverter(),f=wrappers;function _(t,i){e.call(this,t,i),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function m(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}return Object.defineProperties(_.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var i=this.fields[e[t]],s=i.id;if(this._fieldsById[s])throw Error("duplicate id "+s+" in "+this);this._fieldsById[s]=i}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=l.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=l.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=_.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof o||((e.prototype=new o).constructor=e,l.merge(e.prototype,t)),e.$type=e.prototype.$type=this,l.merge(e,o,!0),this._ctor=e;for(var i=0;i<this.fieldsArray.length;++i)this._fieldsArray[i].resolve();var s={};for(i=0;i<this.oneofsArray.length;++i)s[this._oneofsArray[i].resolve().name]={get:l.oneOfGetter(this._oneofsArray[i].oneof),set:l.oneOfSetter(this._oneofsArray[i].oneof)};i&&Object.defineProperties(e.prototype,s)}}}),_.generateConstructor=function(e){for(var t,i=l.codegen(["p"],e.name),s=0;s<e.fieldsArray.length;++s)(t=e._fieldsArray[s]).map?i("this%s={}",l.safeProp(t.name)):t.repeated&&i("this%s=[]",l.safeProp(t.name));return i("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},_.fromJSON=function(o,a){var u=new _(o,a.options);u.extensions=a.extensions,u.reserved=a.reserved;for(var l=Object.keys(a.fields),c=0;c<l.length;++c)u.add((void 0!==a.fields[l[c]].keyType?r.fromJSON:s.fromJSON)(l[c],a.fields[l[c]]));if(a.oneofs)for(l=Object.keys(a.oneofs),c=0;c<l.length;++c)u.add(i.fromJSON(l[c],a.oneofs[l[c]]));if(a.nested)for(l=Object.keys(a.nested),c=0;c<l.length;++c){var d=a.nested[l[c]];u.add((void 0!==d.id?s.fromJSON:void 0!==d.fields?_.fromJSON:void 0!==d.values?t.fromJSON:void 0!==d.methods?n.fromJSON:e.fromJSON)(l[c],d))}return a.extensions&&a.extensions.length&&(u.extensions=a.extensions),a.reserved&&a.reserved.length&&(u.reserved=a.reserved),a.group&&(u.group=!0),a.comment&&(u.comment=a.comment),a.edition&&(u._edition=a.edition),u._defaultEdition="proto3",u},_.prototype.toJSON=function(t){var i=e.prototype.toJSON.call(this,t),s=!!t&&Boolean(t.keepComments);return l.toObject(["edition",this._editionToJSON(),"options",i&&i.options||void 0,"oneofs",e.arrayToJSON(this.oneofsArray,t),"fields",e.arrayToJSON(this.fieldsArray.filter(function(e){return!e.declaringField}),t)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",i&&i.nested||void 0,"comment",s?this.comment:void 0])},_.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;e.prototype.resolveAll.call(this);var t=this.oneofsArray;for(s=0;s<t.length;)t[s++].resolve();for(var i=this.fieldsArray,s=0;s<i.length;)i[s++].resolve();return this},_.prototype._resolveFeaturesRecursive=function(t){return this._needsRecursiveFeatureResolution?(t=this._edition||t,e.prototype._resolveFeaturesRecursive.call(this,t),this.oneofsArray.forEach(e=>{e._resolveFeatures(t)}),this.fieldsArray.forEach(e=>{e._resolveFeatures(t)}),this):this},_.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},_.prototype.add=function(t){if(this.get(t.name))throw Error("duplicate name '"+t.name+"' in "+this);if(t instanceof s&&void 0===t.extend){if(this._fieldsById?this._fieldsById[t.id]:this.fieldsById[t.id])throw Error("duplicate id "+t.id+" in "+this);if(this.isReservedId(t.id))throw Error("id "+t.id+" is reserved in "+this);if(this.isReservedName(t.name))throw Error("name '"+t.name+"' is reserved in "+this);return t.parent&&t.parent.remove(t),this.fields[t.name]=t,t.message=this,t.onAdd(this),m(this)}return t instanceof i?(this.oneofs||(this.oneofs={}),this.oneofs[t.name]=t,t.onAdd(this),m(this)):e.prototype.add.call(this,t)},_.prototype.remove=function(t){if(t instanceof s&&void 0===t.extend){if(!this.fields||this.fields[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.fields[t.name],t.parent=null,t.onRemove(this),m(this)}if(t instanceof i){if(!this.oneofs||this.oneofs[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.oneofs[t.name],t.parent=null,t.onRemove(this),m(this)}return e.prototype.remove.call(this,t)},_.prototype.isReservedId=function(t){return e.isReservedId(this.reserved,t)},_.prototype.isReservedName=function(t){return e.isReservedName(this.reserved,t)},_.prototype.create=function(e){return new this.ctor(e)},_.prototype.setup=function(){for(var e=this.fullName,t=[],i=0;i<this.fieldsArray.length;++i)t.push(this._fieldsArray[i].resolve().resolvedType);this.encode=c(this)({Writer:u,types:t,util:l}),this.decode=d(this)({Reader:a,types:t,util:l}),this.verify=p(this)({types:t,util:l}),this.fromObject=h.fromObject(this)({types:t,util:l}),this.toObject=h.toObject(this)({types:t,util:l});var s=f[e];if(s){var r=Object.create(this);r.fromObject=this.fromObject,this.fromObject=s.fromObject.bind(r),r.toObject=this.toObject,this.toObject=s.toObject.bind(r)}return this},_.prototype.encode=function(e,t){return this.setup().encode(e,t)},_.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},_.prototype.decode=function(e,t){return this.setup().decode(e,t)},_.prototype.decodeDelimited=function(e){return e instanceof a||(e=a.create(e)),this.decode(e,e.uint32())},_.prototype.verify=function(e){return this.setup().verify(e)},_.prototype.fromObject=function(e){return this.setup().fromObject(e)},_.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},_.d=function(e){return function(t){l.decorateType(t,e)}},type}function requireRoot(){if(hasRequiredRoot)return root;hasRequiredRoot=1,root=u;var e=requireNamespace();((u.prototype=Object.create(e.prototype)).constructor=u).className="Root";var t,i,s,r=requireField(),n=require_enum(),o=requireOneof(),a=requireUtil();function u(t){e.call(this,"",t),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}function l(){}u.fromJSON=function(e,t){return t||(t=new u),e.options&&t.setOptions(e.options),t.addJSON(e.nested).resolveAll()},u.prototype.resolvePath=a.path.resolve,u.prototype.fetch=a.fetch,u.prototype.load=function e(t,r,n){"function"==typeof r&&(n=r,r=void 0);var o=this;if(!n)return a.asPromise(e,o,t,r);var u=n===l;function c(e,t){if(n){if(u)throw e;t&&t.resolveAll();var i=n;n=null,i(e,t)}}function d(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var i=e.substring(t);if(i in s)return i}return null}function p(e,t){try{if(a.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),a.isString(t)){i.filename=e;var s,n=i(t,o,r),l=0;if(n.imports)for(;l<n.imports.length;++l)(s=d(n.imports[l])||o.resolvePath(e,n.imports[l]))&&h(s);if(n.weakImports)for(l=0;l<n.weakImports.length;++l)(s=d(n.weakImports[l])||o.resolvePath(e,n.weakImports[l]))&&h(s,!0)}else o.setOptions(t.options).addJSON(t.nested)}catch(p){c(p)}u||f||c(null,o)}function h(e,t){if(e=d(e)||e,!(o.files.indexOf(e)>-1))if(o.files.push(e),e in s)u?p(e,s[e]):(++f,setTimeout(function(){--f,p(e,s[e])}));else if(u){var i;try{i=a.fs.readFileSync(e).toString("utf8")}catch(r){return void(t||c(r))}p(e,i)}else++f,o.fetch(e,function(i,s){--f,n&&(i?t?f||c(null,o):c(i):p(e,s))})}var f=0;a.isString(t)&&(t=[t]);for(var _,m=0;m<t.length;++m)(_=o.resolvePath("",t[m]))&&h(_);return u?(o.resolveAll(),o):(f||c(null,o),o)},u.prototype.loadSync=function(e,t){if(!a.isNode)throw Error("not supported");return this.load(e,t,l)},u.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return e.prototype.resolveAll.call(this)};var c=/^[A-Z]/;function d(e,t){var i=t.parent.lookup(t.extend);if(i){var s=new r(t.fullName,t.id,t.type,t.rule,void 0,t.options);return i.get(s.name)||(s.declaringField=t,t.extensionField=s,i.add(s)),!0}return!1}return u.prototype._handleAdd=function(e){if(e instanceof r)void 0===e.extend||e.extensionField||d(0,e)||this.deferred.push(e);else if(e instanceof n)c.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof o)){if(e instanceof t)for(var i=0;i<this.deferred.length;)d(0,this.deferred[i])?this.deferred.splice(i,1):++i;for(var s=0;s<e.nestedArray.length;++s)this._handleAdd(e._nestedArray[s]);c.test(e.name)&&(e.parent[e.name]=e)}(e instanceof t||e instanceof n||e instanceof r)&&(this._fullyQualifiedObjects[e.fullName]=e)},u.prototype._handleRemove=function(t){if(t instanceof r){if(void 0!==t.extend)if(t.extensionField)t.extensionField.parent.remove(t.extensionField),t.extensionField=null;else{var i=this.deferred.indexOf(t);i>-1&&this.deferred.splice(i,1)}}else if(t instanceof n)c.test(t.name)&&delete t.parent[t.name];else if(t instanceof e){for(var s=0;s<t.nestedArray.length;++s)this._handleRemove(t._nestedArray[s]);c.test(t.name)&&delete t.parent[t.name]}delete this._fullyQualifiedObjects[t.fullName]},u._configure=function(e,r,n){t=e,i=r,s=n},root}function requireUtil(){if(hasRequiredUtil)return util$2.exports;hasRequiredUtil=1;var e,t,i=util$2.exports=requireMinimal(),s=roots;i.codegen=codegen_1,i.fetch=fetch_1,i.path=path,i.fs=i.inquire("fs"),i.toArray=function(e){if(e){for(var t=Object.keys(e),i=new Array(t.length),s=0;s<t.length;)i[s]=e[t[s++]];return i}return[]},i.toObject=function(e){for(var t={},i=0;i<e.length;){var s=e[i++],r=e[i++];void 0!==r&&(t[s]=r)}return t};var r=/\\/g,n=/"/g;i.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},i.safeProp=function(e){return!/^[$\w_]+$/.test(e)||i.isReserved(e)?'["'+e.replace(r,"\\\\").replace(n,'\\"')+'"]':"."+e},i.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var o=/_([a-z])/g;i.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(o,function(e,t){return t.toUpperCase()})},i.compareFieldsById=function(e,t){return e.id-t.id},i.decorateType=function(t,s){if(t.$type)return s&&t.$type.name!==s&&(i.decorateRoot.remove(t.$type),t.$type.name=s,i.decorateRoot.add(t.$type)),t.$type;e||(e=requireType());var r=new e(s||t.name);return i.decorateRoot.add(r),r.ctor=t,Object.defineProperty(t,"$type",{value:r,enumerable:!1}),Object.defineProperty(t.prototype,"$type",{value:r,enumerable:!1}),r};var a=0;return i.decorateEnum=function(e){if(e.$type)return e.$type;t||(t=require_enum());var s=new t("Enum"+a++,e);return i.decorateRoot.add(s),Object.defineProperty(e,"$type",{value:s,enumerable:!1}),s},i.setProperty=function(e,t,i,s){if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return function e(t,i,r){var n=i.shift();if("__proto__"===n||"prototype"===n)return t;if(i.length>0)t[n]=e(t[n]||{},i,r);else{var o=t[n];if(o&&s)return t;o&&(r=[].concat(o).concat(r)),t[n]=r}return t}(e,t=t.split("."),i)},Object.defineProperty(i,"decorateRoot",{get:function(){return s.decorated||(s.decorated=new(requireRoot()))}}),util$2.exports}function requireTypes(){return hasRequiredTypes||(hasRequiredTypes=1,function(e){var t=e,i=requireUtil(),s=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function r(e,t){var i=0,r={};for(t|=0;i<e.length;)r[s[i+t]]=e[i++];return r}t.basic=r([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),t.defaults=r([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),t.long=r([0,0,0,1,1],7),t.mapKey=r([0,0,0,5,5,0,0,0,1,1,0,2],2),t.packed=r([1,5,0,0,0,5,5,0,0,0,1,1,0])}(types$1)),types$1}function requireField(){if(hasRequiredField)return field;hasRequiredField=1,field=o;var e=requireObject();((o.prototype=Object.create(e.prototype)).constructor=o).className="Field";var t,i=require_enum(),s=requireTypes(),r=requireUtil(),n=/^required|optional|repeated$/;function o(t,i,o,a,u,l,c){if(r.isObject(a)?(c=u,l=a,a=u=void 0):r.isObject(u)&&(c=l,l=u,u=void 0),e.call(this,t,l),!r.isInteger(i)||i<0)throw TypeError("id must be a non-negative integer");if(!r.isString(o))throw TypeError("type must be a string");if(void 0!==a&&!n.test(a=a.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==u&&!r.isString(u))throw TypeError("extend must be a string");"proto3_optional"===a&&(a="optional"),this.rule=a&&"optional"!==a?a:void 0,this.type=o,this.id=i,this.extend=u||void 0,this.repeated="repeated"===a,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!r.Long&&void 0!==s.long[o],this.bytes="bytes"===o,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=c}return o.fromJSON=function(e,t){var i=new o(e,t.id,t.type,t.rule,t.extend,t.options,t.comment);return t.edition&&(i._edition=t.edition),i._defaultEdition="proto3",i},Object.defineProperty(o.prototype,"required",{get:function(){return"LEGACY_REQUIRED"===this._features.field_presence}}),Object.defineProperty(o.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty(o.prototype,"delimited",{get:function(){return this.resolvedType instanceof t&&"DELIMITED"===this._features.message_encoding}}),Object.defineProperty(o.prototype,"packed",{get:function(){return"PACKED"===this._features.repeated_field_encoding}}),Object.defineProperty(o.prototype,"hasPresence",{get:function(){return!this.repeated&&!this.map&&(this.partOf||this.declaringField||this.extensionField||"IMPLICIT"!==this._features.field_presence)}}),o.prototype.setOption=function(t,i,s){return e.prototype.setOption.call(this,t,i,s)},o.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return r.toObject(["edition",this._editionToJSON(),"rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},o.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=s.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof t?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof i&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof i||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=r.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var n;r.base64.test(this.typeDefault)?r.base64.decode(this.typeDefault,n=r.newBuffer(r.base64.length(this.typeDefault)),0):r.utf8.write(this.typeDefault,n=r.newBuffer(r.utf8.length(this.typeDefault)),0),this.typeDefault=n}return this.map?this.defaultValue=r.emptyObject:this.repeated?this.defaultValue=r.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof t&&(this.parent.ctor.prototype[this.name]=this.defaultValue),e.prototype.resolve.call(this)},o.prototype._inferLegacyProtoFeatures=function(e){if("proto2"!==e&&"proto3"!==e)return{};var i={};if("required"===this.rule&&(i.field_presence="LEGACY_REQUIRED"),this.parent&&void 0===s.defaults[this.type]){var r=this.parent.get(this.type.split(".").pop());r&&r instanceof t&&r.group&&(i.message_encoding="DELIMITED")}return!0===this.getOption("packed")?i.repeated_field_encoding="PACKED":!1===this.getOption("packed")&&(i.repeated_field_encoding="EXPANDED"),i},o.prototype._resolveFeatures=function(t){return e.prototype._resolveFeatures.call(this,this._edition||t)},o.d=function(e,t,i,s){return"function"==typeof t?t=r.decorateType(t).name:t&&"object"==typeof t&&(t=r.decorateEnum(t).name),function(n,a){r.decorateType(n.constructor).add(new o(a,e,t,i,{default:s}))}},o._configure=function(e){t=e},field}function requireOneof(){if(hasRequiredOneof)return oneof;hasRequiredOneof=1,oneof=s;var e=requireObject();((s.prototype=Object.create(e.prototype)).constructor=s).className="OneOf";var t=requireField(),i=requireUtil();function s(t,i,s,r){if(Array.isArray(i)||(s=i,i=void 0),e.call(this,t,s),void 0!==i&&!Array.isArray(i))throw TypeError("fieldNames must be an Array");this.oneof=i||[],this.fieldsArray=[],this.comment=r}function r(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}return s.fromJSON=function(e,t){return new s(e,t.oneof,t.options,t.comment)},s.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return i.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},s.prototype.add=function(e){if(!(e instanceof t))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,r(this),this},s.prototype.remove=function(e){if(!(e instanceof t))throw TypeError("field must be a Field");var i=this.fieldsArray.indexOf(e);if(i<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(i,1),(i=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(i,1),e.partOf=null,this},s.prototype.onAdd=function(t){e.prototype.onAdd.call(this,t);for(var i=0;i<this.oneof.length;++i){var s=t.get(this.oneof[i]);s&&!s.partOf&&(s.partOf=this,this.fieldsArray.push(s))}r(this)},s.prototype.onRemove=function(t){for(var i,s=0;s<this.fieldsArray.length;++s)(i=this.fieldsArray[s]).parent&&i.parent.remove(i);e.prototype.onRemove.call(this,t)},Object.defineProperty(s.prototype,"isProto3Optional",{get:function(){if(null==this.fieldsArray||1!==this.fieldsArray.length)return!1;var e=this.fieldsArray[0];return null!=e.options&&!0===e.options.proto3_optional}}),s.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,r){i.decorateType(t.constructor).add(new s(r,e)),Object.defineProperty(t,r,{get:i.oneOfGetter(e),set:i.oneOfSetter(e)})}},oneof}function requireObject(){if(hasRequiredObject)return object;hasRequiredObject=1,object=o,o.className="ReflectionObject";const e=requireOneof();var t,i=requireUtil(),s={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},r={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},n={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function o(e,t){if(!i.isString(e))throw TypeError("name must be a string");if(t&&!i.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}return Object.defineProperties(o.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),o.prototype.toJSON=function(){throw Error()},o.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var i=e.root;i instanceof t&&i._handleAdd(this)},o.prototype.onRemove=function(e){var i=e.root;i instanceof t&&i._handleRemove(this),this.parent=null,this.resolved=!1},o.prototype.resolve=function(){return this.resolved||this.root instanceof t&&(this.resolved=!0),this},o.prototype._resolveFeaturesRecursive=function(e){return this._resolveFeatures(this._edition||e)},o.prototype._resolveFeatures=function(t){if(!this._featuresResolved){var i={};if(!t)throw new Error("Unknown edition for "+this.fullName);var o=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(t));if(this._edition){if("proto2"===t)i=Object.assign({},r);else if("proto3"===t)i=Object.assign({},n);else{if("2023"!==t)throw new Error("Unknown edition: "+t);i=Object.assign({},s)}return this._features=Object.assign(i,o||{}),void(this._featuresResolved=!0)}if(this.partOf instanceof e){var a=Object.assign({},this.partOf._features);this._features=Object.assign(a,o||{})}else if(this.declaringField);else{if(!this.parent)throw new Error("Unable to find a parent for "+this.fullName);var u=Object.assign({},this.parent._features);this._features=Object.assign(u,o||{})}this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}},o.prototype._inferLegacyProtoFeatures=function(){return{}},o.prototype.getOption=function(e){if(this.options)return this.options[e]},o.prototype.setOption=function(e,t,s){return this.options||(this.options={}),/^features\./.test(e)?i.setProperty(this.options,e,t,s):s&&void 0!==this.options[e]||(this.getOption(e)!==t&&(this.resolved=!1),this.options[e]=t),this},o.prototype.setParsedOption=function(e,t,s){this.parsedOptions||(this.parsedOptions=[]);var r=this.parsedOptions;if(s){var n=r.find(function(t){return Object.prototype.hasOwnProperty.call(t,e)});if(n){var o=n[e];i.setProperty(o,s,t)}else(n={})[e]=i.setProperty({},s,t),r.push(n)}else{var a={};a[e]=t,r.push(a)}return this},o.prototype.setOptions=function(e,t){if(e)for(var i=Object.keys(e),s=0;s<i.length;++s)this.setOption(i[s],e[i[s]],t);return this},o.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},o.prototype._editionToJSON=function(){if(this._edition&&"proto3"!==this._edition)return this._edition},o._configure=function(e){t=e},object}function require_enum(){if(hasRequired_enum)return _enum;hasRequired_enum=1,_enum=s;var e=requireObject();((s.prototype=Object.create(e.prototype)).constructor=s).className="Enum";var t=requireNamespace(),i=requireUtil();function s(t,i,s,r,n,o){if(e.call(this,t,s),i&&"object"!=typeof i)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=n||{},this.valuesOptions=o,this._valuesFeatures={},this.reserved=void 0,i)for(var a=Object.keys(i),u=0;u<a.length;++u)"number"==typeof i[a[u]]&&(this.valuesById[this.values[a[u]]=i[a[u]]]=a[u])}return s.prototype._resolveFeatures=function(t){return t=this._edition||t,e.prototype._resolveFeatures.call(this,t),Object.keys(this.values).forEach(e=>{var t=Object.assign({},this._features);this._valuesFeatures[e]=Object.assign(t,this.valuesOptions&&this.valuesOptions[e]&&this.valuesOptions[e].features)}),this},s.fromJSON=function(e,t){var i=new s(e,t.values,t.options,t.comment,t.comments);return i.reserved=t.reserved,t.edition&&(i._edition=t.edition),i._defaultEdition="proto3",i},s.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return i.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},s.prototype.add=function(e,t,s,r){if(!i.isString(e))throw TypeError("name must be a string");if(!i.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return r&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[e]=r||null),this.comments[e]=s||null,this},s.prototype.remove=function(e){if(!i.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this},s.prototype.isReservedId=function(e){return t.isReservedId(this.reserved,e)},s.prototype.isReservedName=function(e){return t.isReservedName(this.reserved,e)},_enum}function requireEncoder(){if(hasRequiredEncoder)return encoder_1;hasRequiredEncoder=1,encoder_1=function(r){for(var n,o=i.codegen(["m","w"],r.name+"$encode")("if(!w)")("w=Writer.create()"),a=r.fieldsArray.slice().sort(i.compareFieldsById),u=0;u<a.length;++u){var l=a[u].resolve(),c=r._fieldsArray.indexOf(l),d=l.resolvedType instanceof e?"int32":l.type,p=t.basic[d];n="m"+i.safeProp(l.name),l.map?(o("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",n,l.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",n)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(l.id<<3|2)>>>0,8|t.mapKey[l.keyType],l.keyType),void 0===p?o("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",c,n):o(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|p,d,n),o("}")("}")):l.repeated?(o("if(%s!=null&&%s.length){",n,n),l.packed&&void 0!==t.packed[d]?o("w.uint32(%i).fork()",(l.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",n)("w.%s(%s[i])",d,n)("w.ldelim()"):(o("for(var i=0;i<%s.length;++i)",n),void 0===p?s(o,l,c,n+"[i]"):o("w.uint32(%i).%s(%s[i])",(l.id<<3|p)>>>0,d,n)),o("}")):(l.optional&&o("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",n,l.name),void 0===p?s(o,l,c,n):o("w.uint32(%i).%s(%s)",(l.id<<3|p)>>>0,d,n))}return o("return w")};var e=require_enum(),t=requireTypes(),i=requireUtil();function s(e,t,i,s){return t.delimited?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",i,s,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",i,s,(t.id<<3|2)>>>0)}return encoder_1}!function(e){var t=message;e[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),i=this.lookup(t);if(i){var s="."===e["@type"].charAt(0)?e["@type"].slice(1):e["@type"];return-1===s.indexOf("/")&&(s="/"+s),this.create({type_url:s,value:i.encode(i.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,i){var s="",r="";if(i&&i.json&&e.type_url&&e.value){r=e.type_url.substring(e.type_url.lastIndexOf("/")+1),s=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);var n=this.lookup(r);n&&(e=n.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof t){var o=e.$type.toObject(e,i);return""===s&&(s="type.googleapis.com/"),r=s+("."===e.$type.fullName[0]?e.$type.fullName.slice(1):e.$type.fullName),o["@type"]=r,o}return this.toObject(e,i)}}}(wrappers);var protobuf$2=indexLight.exports=indexMinimal;function load(e,t,i){return"function"==typeof t?(i=t,t=new protobuf$2.Root):t||(t=new protobuf$2.Root),t.load(e,i)}function loadSync(e,t){return t||(t=new protobuf$2.Root),t.loadSync(e)}protobuf$2.build="light",protobuf$2.load=load,protobuf$2.loadSync=loadSync,protobuf$2.encoder=requireEncoder(),protobuf$2.decoder=requireDecoder(),protobuf$2.verifier=requireVerifier(),protobuf$2.converter=requireConverter(),protobuf$2.ReflectionObject=requireObject(),protobuf$2.Namespace=requireNamespace(),protobuf$2.Root=requireRoot(),protobuf$2.Enum=require_enum(),protobuf$2.Type=requireType(),protobuf$2.Field=requireField(),protobuf$2.OneOf=requireOneof(),protobuf$2.MapField=requireMapfield(),protobuf$2.Service=requireService(),protobuf$2.Method=requireMethod(),protobuf$2.Message=message,protobuf$2.wrappers=wrappers,protobuf$2.types=requireTypes(),protobuf$2.util=requireUtil(),protobuf$2.ReflectionObject._configure(protobuf$2.Root),protobuf$2.Namespace._configure(protobuf$2.Type,protobuf$2.Service,protobuf$2.Enum),protobuf$2.Root._configure(protobuf$2.Type),protobuf$2.Field._configure(protobuf$2.Type);var indexLightExports=indexLight.exports,tokenize_1=tokenize$1,delimRe=/[\s{}=;:[\],'"()<>]/g,stringDoubleRe=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,stringSingleRe=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,setCommentRe=/^ *[*/]+ */,setCommentAltRe=/^\s*\*?\/*/,setCommentSplitRe=/\n/g,whitespaceRe=/\s/,unescapeRe=/\\(.?)/g,unescapeMap={0:"\0",r:"\r",n:"\n",t:"\t"};function unescape(e){return e.replace(unescapeRe,function(e,t){switch(t){case"\\":case"":return t;default:return unescapeMap[t]||""}})}function tokenize$1(e,t){e=e.toString();var i=0,s=e.length,r=1,n=0,o={},a=[],u=null;function l(e){return Error("illegal "+e+" (line "+r+")")}function c(t){return e.charAt(t)}function d(i,s,a){var u,l={type:e.charAt(i++),lineEmpty:!1,leading:a},c=i-(t?2:3);do{if(--c<0||"\n"===(u=e.charAt(c))){l.lineEmpty=!0;break}}while(" "===u||"\t"===u);for(var d=e.substring(i,s).split(setCommentSplitRe),p=0;p<d.length;++p)d[p]=d[p].replace(t?setCommentAltRe:setCommentRe,"").trim();l.text=d.join("\n").trim(),o[r]=l,n=r}function p(t){var i=h(t),s=e.substring(t,i);return/^\s*\/\//.test(s)}function h(e){for(var t=e;t<s&&"\n"!==c(t);)t++;return t}function f(){if(a.length>0)return a.shift();if(u)return function(){var t="'"===u?stringSingleRe:stringDoubleRe;t.lastIndex=i-1;var s=t.exec(e);if(!s)throw l("string");return i=t.lastIndex,_(u),u=null,unescape(s[1])}();var n,o,f,m,b,g=0===i;do{if(i===s)return null;for(n=!1;whitespaceRe.test(f=c(i));)if("\n"===f&&(g=!0,++r),++i===s)return null;if("/"===c(i)){if(++i===s)throw l("comment");if("/"===c(i))if(t){if(m=i,b=!1,p(i-1)){b=!0;do{if((i=h(i))===s)break;if(i++,!g)break}while(p(i))}else i=Math.min(s,h(i)+1);b&&(d(m,i,g),g=!0),r++,n=!0}else{for(b="/"===c(m=i+1);"\n"!==c(++i);)if(i===s)return null;++i,b&&(d(m,i-1,g),g=!0),++r,n=!0}else{if("*"!==(f=c(i)))return"/";m=i+1,b=t||"*"===c(m);do{if("\n"===f&&++r,++i===s)throw l("comment");o=f,f=c(i)}while("*"!==o||"/"!==f);++i,b&&(d(m,i-2,g),g=!0),n=!0}}}while(n);var y=i;if(delimRe.lastIndex=0,!delimRe.test(c(y++)))for(;y<s&&!delimRe.test(c(y));)++y;var v=e.substring(i,i=y);return'"'!==v&&"'"!==v||(u=v),v}function _(e){a.push(e)}function m(){if(!a.length){var e=f();if(null===e)return null;_(e)}return a[0]}return Object.defineProperty({next:f,peek:m,push:_,skip:function(e,t){var i=m();if(i===e)return f(),!0;if(!t)throw l("token '"+i+"', '"+e+"' expected");return!1},cmnt:function(e){var i,s=null;return void 0===e?(i=o[r-1],delete o[r-1],i&&(t||"*"===i.type||i.lineEmpty)&&(s=i.leading?i.text:null)):(n<e&&m(),i=o[e],delete o[e],!i||i.lineEmpty||!t&&"/"!==i.type||(s=i.leading?null:i.text)),s}},"line",{get:function(){return r}})}tokenize$1.unescape=unescape;var parse_1=parse;parse.filename=null,parse.defaults={keepCase:!1};var tokenize=tokenize_1,Root=requireRoot(),Type=requireType(),Field=requireField(),MapField=requireMapfield(),OneOf=requireOneof(),Enum=require_enum(),Service=requireService(),Method=requireMethod(),ReflectionObject=requireObject(),types=requireTypes(),util=requireUtil(),base10Re=/^[1-9][0-9]*$/,base10NegRe=/^-?[1-9][0-9]*$/,base16Re=/^0[x][0-9a-fA-F]+$/,base16NegRe=/^-?0[x][0-9a-fA-F]+$/,base8Re=/^0[0-7]+$/,base8NegRe=/^-?0[0-7]+$/,numberRe=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,nameRe=/^[a-zA-Z_][a-zA-Z_0-9]*$/,typeRefRe=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function parse(e,t,i){t instanceof Root||(i=t,t=new Root),i||(i=parse.defaults);var s,r,n,o,a=i.preferTrailingComment||!1,u=tokenize(e,i.alternateCommentMode||!1),l=u.next,c=u.push,d=u.peek,p=u.skip,h=u.cmnt,f=!0,_="proto2",m=t,b=[],g={},y=i.keepCase?function(e){return e}:util.camelCase;function v(e,t,i){var s=parse.filename;return i||(parse.filename=null),Error("illegal "+(t||"token")+" '"+e+"' ("+(s?s+", ":"")+"line "+u.line+")")}function w(){var e,t=[];do{if('"'!==(e=l())&&"'"!==e)throw v(e);t.push(l()),p(e),e=d()}while('"'===e||"'"===e);return t.join("")}function E(e){var t=l();switch(t){case"'":case'"':return c(t),w();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return function(e,t){var i=1;"-"===e.charAt(0)&&(i=-1,e=e.substring(1));switch(e){case"inf":case"INF":case"Inf":return i*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(base10Re.test(e))return i*parseInt(e,10);if(base16Re.test(e))return i*parseInt(e,16);if(base8Re.test(e))return i*parseInt(e,8);if(numberRe.test(e))return i*parseFloat(e);throw v(e,"number",t)}(t,!0)}catch(i){if(e&&typeRefRe.test(t))return t;throw v(t,"value")}}function S(e,t){var i,s;do{if(!t||'"'!==(i=d())&&"'"!==i)try{e.push([s=T(l()),p("to",!0)?T(l()):s])}catch(o){if(!(t&&typeRefRe.test(i)&&_>=2023))throw o;e.push(i)}else{var r=w();if(e.push(r),_>=2023)throw v(r,"id")}}while(p(",",!0));var n={options:void 0,setOption:function(e,t){void 0===this.options&&(this.options={}),this.options[e]=t}};N(n,function(e){if("option"!==e)throw v(e);M(n,e),p(";")},function(){F(n)})}function T(e,t){switch(e){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!t&&"-"===e.charAt(0))throw v(e,"id");if(base10NegRe.test(e))return parseInt(e,10);if(base16NegRe.test(e))return parseInt(e,16);if(base8NegRe.test(e))return parseInt(e,8);throw v(e,"id")}function O(){if(void 0!==s)throw v("package");if(s=l(),!typeRefRe.test(s))throw v(s,"name");m=m.define(s),p(";")}function A(){var e,t=d();switch(t){case"weak":e=n||(n=[]),l();break;case"public":l();default:e=r||(r=[])}t=w(),p(";"),e.push(t)}function k(){if(p("="),(_=w())<2023)throw v(_,"syntax");p(";")}function R(){p("="),_=w();if(!["2023"].includes(_))throw v(_,"edition");p(";")}function x(e,t){switch(t){case"option":return M(e,t),p(";"),!0;case"message":return $(e,t),!0;case"enum":return D(e,t),!0;case"service":return function(e,t){if(!nameRe.test(t=l()))throw v(t,"service name");var i=new Service(t);N(i,function(e){if(!x(i,e)){if("rpc"!==e)throw v(e);!function(e,t){var i=h(),s=t;if(!nameRe.test(t=l()))throw v(t,"name");var r,n,o,a,u=t;p("("),p("stream",!0)&&(n=!0);if(!typeRefRe.test(t=l()))throw v(t);r=t,p(")"),p("returns"),p("("),p("stream",!0)&&(a=!0);if(!typeRefRe.test(t=l()))throw v(t);o=t,p(")");var c=new Method(u,s,r,o,n,a);c.comment=i,N(c,function(e){if("option"!==e)throw v(e);M(c,e),p(";")}),e.add(c)}(i,e)}}),e.add(i),e===m&&b.push(i)}(e,t),!0;case"extend":return function(e,t){if(!typeRefRe.test(t=l()))throw v(t,"reference");var i=t;N(null,function(t){switch(t){case"required":case"repeated":I(e,t,i);break;case"optional":I(e,"proto3"===_?"proto3_optional":"optional",i);break;default:if("proto2"===_||!typeRefRe.test(t))throw v(t);c(t),I(e,"optional",i)}})}(e,t),!0}return!1}function N(e,t,i){var s=u.line;if(e&&("string"!=typeof e.comment&&(e.comment=h()),e.filename=parse.filename),p("{",!0)){for(var r;"}"!==(r=l());)t(r);p(";",!0)}else i&&i(),p(";"),e&&("string"!=typeof e.comment||a)&&(e.comment=h(s)||e.comment)}function $(e,t){if(!nameRe.test(t=l()))throw v(t,"type name");var i=new Type(t);N(i,function(e){if(!x(i,e))switch(e){case"map":!function(e){p("<");var t=l();if(void 0===types.mapKey[t])throw v(t,"type");p(",");var i=l();if(!typeRefRe.test(i))throw v(i,"type");p(">");var s=l();if(!nameRe.test(s))throw v(s,"name");p("=");var r=new MapField(y(s),T(l()),t,i);N(r,function(e){if("option"!==e)throw v(e);M(r,e),p(";")},function(){F(r)}),e.add(r)}(i);break;case"required":if("proto2"!==_)throw v(e);case"repeated":I(i,e);break;case"optional":if("proto3"===_)I(i,"proto3_optional");else{if("proto2"!==_)throw v(e);I(i,"optional")}break;case"oneof":!function(e,t){if(!nameRe.test(t=l()))throw v(t,"name");var i=new OneOf(y(t));N(i,function(e){"option"===e?(M(i,e),p(";")):(c(e),I(i,"optional"))}),e.add(i)}(i,e);break;case"extensions":S(i.extensions||(i.extensions=[]));break;case"reserved":S(i.reserved||(i.reserved=[]),!0);break;default:if("proto2"===_||!typeRefRe.test(e))throw v(e);c(e),I(i,"optional")}}),e.add(i),e===m&&b.push(i)}function I(e,t,i){var s=l();if("group"!==s){for(;s.endsWith(".")||d().startsWith(".");)s+=l();if(!typeRefRe.test(s))throw v(s,"type");var r=l();if(!nameRe.test(r))throw v(r,"name");r=y(r),p("=");var n=new Field(r,T(l()),s,t,i);if(N(n,function(e){if("option"!==e)throw v(e);M(n,e),p(";")},function(){F(n)}),"proto3_optional"===t){var o=new OneOf("_"+r);n.setOption("proto3_optional",!0),o.add(n),e.add(o)}else e.add(n);e===m&&b.push(n)}else!function(e,t){if(_>=2023)throw v("group");var i=l();if(!nameRe.test(i))throw v(i,"name");var s=util.lcFirst(i);i===s&&(i=util.ucFirst(i));p("=");var r=T(l()),n=new Type(i);n.group=!0;var o=new Field(s,r,i,t);o.filename=parse.filename,N(n,function(e){switch(e){case"option":M(n,e),p(";");break;case"required":case"repeated":I(n,e);break;case"optional":I(n,"proto3"===_?"proto3_optional":"optional");break;case"message":$(n,e);break;case"enum":D(n,e);break;case"reserved":S(n.reserved||(n.reserved=[]),!0);break;default:throw v(e)}}),e.add(n).add(o)}(e,t)}function D(e,t){if(!nameRe.test(t=l()))throw v(t,"name");var i=new Enum(t);N(i,function(e){switch(e){case"option":M(i,e),p(";");break;case"reserved":S(i.reserved||(i.reserved=[]),!0),void 0===i.reserved&&(i.reserved=[]);break;default:!function(e,t){if(!nameRe.test(t))throw v(t,"name");p("=");var i=T(l(),!0),s={options:void 0,getOption:function(e){return this.options[e]}};s.setOption=function(e,t){ReflectionObject.prototype.setOption.call(s,e,t)},s.setParsedOption=function(){},N(s,function(e){if("option"!==e)throw v(e);M(s,e),p(";")},function(){F(s)}),e.add(t,i,s.comment,s.parsedOptions||s.options)}(i,e)}}),e.add(i),e===m&&b.push(i)}function M(e,t){var i,s,r=!0;for("option"===t&&(t=l());"="!==t;){if("("===t){var n=l();p(")"),t="("+n+")"}if(r){if(r=!1,t.includes(".")&&!t.includes("(")){var o=t.split(".");i=o[0]+".",t=o[1];continue}i=t}else s=s?s+=t:t;t=l()}var a=B(e,s?i.concat(s):i);s=s&&"."===s[0]?s.slice(1):s,function(e,t,i,s){e.setParsedOption&&e.setParsedOption(t,i,s)}(e,i=i&&"."===i[i.length-1]?i.slice(0,-1):i,a,s)}function B(e,t){if(p("{",!0)){for(var i={};!p("}",!0);){if(!nameRe.test(o=l()))throw v(o,"name");if(null===o)throw v(o,"end of input");var s,r=o;if(p(":",!0),"{"===d())s=B(e,t+"."+o);else if("["===d()){var n;if(s=[],p("[",!0)){do{n=E(!0),s.push(n)}while(p(",",!0));p("]"),void 0!==n&&C(e,t+"."+o,n)}}else s=E(!0),C(e,t+"."+o,s);var a=i[r];a&&(s=[].concat(a).concat(s)),i[r]=s,p(",",!0),p(";",!0)}return i}var u=E(!0);return C(e,t,u),u}function C(e,t,i){m===e&&/^features\./.test(t)?g[t]=i:e.setOption&&e.setOption(t,i)}function F(e){if(p("[",!0)){do{M(e,"option")}while(p(",",!0));p("]")}return e}for(;null!==(o=l());)switch(o){case"package":if(!f)throw v(o);O();break;case"import":if(!f)throw v(o);A();break;case"syntax":if(!f)throw v(o);k();break;case"edition":if(!f)throw v(o);R();break;case"option":M(m,o),p(";",!0);break;default:if(x(m,o)){f=!1;continue}throw v(o)}return b.forEach(e=>{e._edition=_,Object.keys(g).forEach(t=>{void 0===e.getOption(t)&&e.setOption(t,g[t],!0)})}),parse.filename=null,{package:s,imports:r,weakImports:n,root:t}}var common_1=common,commonRe=/\/|\./,timeType;function common(e,t){commonRe.test(e)||(e="google/protobuf/"+e+".proto",t={nested:{google:{nested:{protobuf:{nested:t}}}}}),common[e]=t}common("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),common("duration",{Duration:timeType={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),common("timestamp",{Timestamp:timeType}),common("empty",{Empty:{fields:{}}}),common("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),common("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),common("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),common.get=function(e){return common[e]||null};var protobuf$1=src.exports=indexLightExports;protobuf$1.build="full",protobuf$1.tokenize=tokenize_1,protobuf$1.parse=parse_1,protobuf$1.common=common_1,protobuf$1.Root._configure(protobuf$1.Type,protobuf$1.parse,protobuf$1.common);var srcExports=src.exports,protobufjs=srcExports,protobuf=getDefaultExportFromCjs(protobufjs);const protoSchema='\nsyntax = "proto3";\n\nmessage PublicAggreDealsV3ApiItem {\n  string price = 1;\n  string quantity = 2;\n  int32 tradeType = 3;\n  int64 time = 4;\n}\n\nmessage PublicAggreDealsV3Api {\n  repeated PublicAggreDealsV3ApiItem deals = 1;\n  string eventType = 2;\n}\n\nmessage PublicAggreDepthV3ApiItem {\n  string price = 1;\n  string quantity = 2;\n}\n\nmessage PublicAggreDepthsV3Api {\n  repeated PublicAggreDepthV3ApiItem asks = 1;\n  repeated PublicAggreDepthV3ApiItem bids = 2;\n  string eventType = 3;\n  string fromVersion = 4;\n  string toVersion = 5;\n}\n\nmessage PushDataV3ApiWrapper {\n  string channel = 1;\n  optional string symbol = 3;\n  optional string symbolId = 4;\n  optional int64 createTime = 5;\n  optional int64 sendTime = 6;\n  PublicAggreDealsV3Api publicAggreDeals = 314;\n  PublicAggreDepthsV3Api publicAggreDepths = 318;\n}\n';let PushDataV3ApiWrapper=null;function initProtobuf(){if(PushDataV3ApiWrapper)return PushDataV3ApiWrapper;try{const e=protobuf.parse(protoSchema,{keepCase:!1}).root;PushDataV3ApiWrapper=e.lookupType("PushDataV3ApiWrapper")}catch(e){throw e}return PushDataV3ApiWrapper}function decodeMexcProtobuf(e){try{const t=initProtobuf();if(!t)return null;const i=new Uint8Array(e),s=t.decode(i);return t.verify(s)?null:s}catch(t){return null}}function extractTradesFromProtobuf(e,t){if(!e.publicAggreDeals||!e.publicAggreDeals.deals)return[];const i=e.publicAggreDeals.deals,s=e.symbol||t;return i.map(e=>{const t=parseFloat(e.price),i=parseFloat(e.quantity);return{exchange:"MEXC",pair:s,timestamp:parseInt(e.time,10),price:t,size:i,side:1===e.tradeType?"buy":"sell"}})}function handleSpotJsonMessage(e){return!(void 0===e.id||!e.msg)}class Mexc extends Exchange{constructor(){super(...arguments),__publicField(this,"id","MEXC"),__publicField(this,"maxConnectionsPerApi",50),__publicField(this,"contractSizes",{}),__publicField(this,"inversed",{}),__publicField(this,"endpoints",{PRODUCTS:["https://api.mexc.com/api/v3/exchangeInfo","https://contract.mexc.com/api/v1/contract/detail"]}),__publicField(this,"delayBetweenMessages",150)}async getUrl(e){return e.includes("_")?"wss://contract.mexc.com/edge":"wss://wbs-api.mexc.com/ws"}formatProducts(e){const t=[],i={},s={};if(e[0]&&e[0].symbols)for(const r of e[0].symbols)t.push(r.symbol);if(e[1]&&e[1].data)for(const r of e[1].data)t.push(r.symbol),i[r.symbol]=r.contractSize,s[r.symbol]=r.quoteCoin!==r.settleCoin;return{products:t,contractSizes:i,inversed:s}}async subscribe(e,t){if(!(await super.subscribe(e,t)))return;if(t.includes("_"))e.send(JSON.stringify({method:"sub.deal",param:{symbol:t}}));else{const i=t.replace(/_/g,"");e.send(JSON.stringify({method:"SUBSCRIPTION",params:[`spot@public.aggre.deals.v3.api.pb@10ms@${i}`]}))}return await new Promise(e=>setTimeout(e,150*this.apis.length)),!0}async unsubscribe(e,t){if(!(await super.unsubscribe(e,t)))return;if(t.includes("_"))e.send(JSON.stringify({method:"unsub.deal",param:{symbol:t}}));else{const i=t.replace(/_/g,"");e.send(JSON.stringify({method:"UNSUBSCRIPTION",params:[`spot@public.aggre.deals.v3.api.pb@10ms@${i}`]}))}return await new Promise(e=>setTimeout(e,150*this.apis.length)),!0}onMessage(e,t){if(e.data instanceof ArrayBuffer)return this.handleProtobufMessage(e.data,t);try{const i=JSON.parse(e.data),s=handleFuturesMessage(i,this.contractSizes,this.inversed);if(s)return!Array.isArray(s)||this.emitTrades(t._id,s);if(handleSpotJsonMessage(i))return!0}catch(i){}}onApiCreated(e){const t=e.url.includes("contract.mexc.com");this.startKeepAlive(e,{method:t?"ping":"PING"},15e3)}handleProtobufMessage(e,t){try{const i=decodeMexcProtobuf(e);if(!i)return!0;const s=extractTradesFromProtobuf(i,i.symbol);if(s.length>0)return this.emitTrades(t._id,s)}catch(i){return!0}}onApiRemoved(e){this.stopKeepAlive(e)}}class OKEX extends Exchange{constructor(){super(...arguments),__publicField(this,"id","OKEX"),__publicField(this,"specs"),__publicField(this,"inversed"),__publicField(this,"types"),__publicField(this,"endpoints",{PRODUCTS:["https://www.okx.com/api/v5/public/instruments?instType=SPOT","https://www.okx.com/api/v5/public/instruments?instType=FUTURES","https://www.okx.com/api/v5/public/instruments?instType=SWAP"]})}async getUrl(){return"wss://ws.okx.com:8443/ws/v5/public"}validateProducts(e){return!!e.types}formatProducts(e){const t=[],i={},s={},r={},n={};for(const o of e)for(const e of o.data){const o=e.instType,a=e.instId;"FUTURES"===o?(i[a]=+e.ctVal,s[a]=e.alias,"inverse"===e.ctType&&(r[a]=!0)):"SWAP"===o&&(i[a]=+e.ctVal,"inverse"===e.ctType&&(r[a]=!0)),n[a]=o,t.push(a)}return{products:t,specs:i,aliases:s,inversed:r,types:n}}async subscribe(e,t){if(await super.subscribe(e,t))return e.send(JSON.stringify({op:"subscribe",args:[{channel:"trades",instId:t}]})),"SPOT"!==this.types[t]&&e.send(JSON.stringify({op:"subscribe",args:[{channel:"liquidation-orders",instType:this.types[t]}]})),!0}async unsubscribe(e,t){if(await super.unsubscribe(e,t))return e.send(JSON.stringify({op:"unsubscribe",args:[{channel:"trades",instId:t}]})),"SPOT"!==this.types[t]&&e.send(JSON.stringify({op:"subscribe",args:[{channel:"liquidation-orders",instType:this.types[t]}]})),!0}formatTrade(e){let t;return t=void 0!==this.specs[e.instId]?e.sz*this.specs[e.instId]/(this.inversed[e.instId]?e.px:1):e.sz,{exchange:this.id,pair:e.instId,timestamp:+e.ts,price:+e.px,size:+t,side:e.side}}formatLiquidation(e,t){const i=e.sz*this.specs[t]/(this.inversed[t]?e.bkPx:1);return{exchange:this.id,pair:t,timestamp:+e.ts,price:+e.bkPx,size:i,side:e.side,liquidation:!0}}onMessage(e,t){const i=JSON.parse(e.data);if(i&&i.data)return"liquidation-orders"===i.arg.channel?this.emitLiquidations(t.id,i.data.reduce((e,i)=>-1===t._connected.indexOf(i.instId)?e:e.concat(i.details.map(e=>this.formatLiquidation(e,i.instId))),[])):this.emitTrades(t.id,i.data.map(e=>this.formatTrade(e)))}}class PHEMEX extends Exchange{constructor(){super(...arguments),__publicField(this,"id","PHEMEX"),__publicField(this,"isInverse",{}),__publicField(this,"isV1",{}),__publicField(this,"priceScales",{}),__publicField(this,"valueScales",{}),__publicField(this,"endpoints",{PRODUCTS:"https://api.phemex.com/public/products"})}async getUrl(){return"wss://ws.phemex.com"}formatProducts(e){const t={},i={},s={},r={},n=[],o=e.data.products.concat(e.data.perpProductsV2),a=e.data.currencies.reduce((e,t)=>(e[t.currency]=t,e),{});for(const u of o){if("Delisted"===u.status)continue;const e="Perpetual"===u.type||"PerpetualV2"===u.type;n.push(u.symbol),u.priceScale&&(i[u.symbol]=u.priceScale),e&&u.settleCurrency!==u.quoteCurrency&&(r[u.symbol]=!0),"PerpetualV2"!==u.type&&(s[u.symbol]=!0),"Spot"===u.type&&(t[u.symbol]=a[u.quoteCurrency].valueScale)}return{valueScales:t,priceScales:i,isInverse:r,isV1:s,products:n}}async subscribe(e,t){if(await super.subscribe(e,t))return e.send(JSON.stringify({id:1234,method:(this.isV1[t]?"trade":"trade_p")+".subscribe",params:[t]})),!0}async unsubscribe(e,t){if(await super.unsubscribe(e,t))return e.send(JSON.stringify({id:1234,method:(this.isV1[t]?"trade":"trade_p")+".unsubscribe",params:[t]})),!0}formatTradeV1(e,t){const[i,s,r,n]=e,o=r/Math.pow(10,this.priceScales[t]),a=(this.valueScales[t]?n/Math.pow(10,this.valueScales[t]):n)/(this.isInverse[t]?o:1);return{exchange:this.id,pair:t,timestamp:i/1e6,price:o,size:a,side:"Buy"===s?"buy":"sell"}}formatTrade(e,t){const[i,s,r,n]=e;return{exchange:this.id,pair:t,timestamp:i/1e6,price:+r,size:+n,side:"Buy"===s?"buy":"sell"}}onMessage(e,t){const i=JSON.parse(e.data);if("incremental"===i.type){if(i.trades&&i.trades.length)return this.emitTrades(t.id,i.trades.map(e=>this.formatTradeV1(e,i.symbol)));if(i.trades_p&&i.trades_p.length)return this.emitTrades(t.id,i.trades_p.map(e=>this.formatTrade(e,i.symbol)))}}onApiCreated(e){this.startKeepAlive(e,{method:"server.ping",id:9e3,params:[]},5e3)}onApiRemoved(e){this.stopKeepAlive(e)}}class POLONIEX extends Exchange{constructor(){super(...arguments),__publicField(this,"id","POLONIEX"),__publicField(this,"endpoints",{PRODUCTS:"https://api.poloniex.com/markets"})}async getUrl(){return"wss://ws.poloniex.com/ws/public"}formatProducts(e){return e.map(e=>e.symbol)}async subscribe(e,t){if(await super.subscribe(e,t))return e.send(JSON.stringify({event:"subscribe",channel:["trades"],symbols:[t]})),!0}async unsubscribe(e,t){if(await super.unsubscribe(e,t))return e.send(JSON.stringify({event:"unsubscribe",channel:["trades"],symbols:[t]})),!0}formatTrade(e){return{exchange:this.id,pair:e.symbol,timestamp:e.createTime,price:+e.price,size:e.amount/e.price,side:e.takerSide}}onMessage(e,t){const i=JSON.parse(e.data);if(i&&i.data)return this.emitTrades(t.id,i.data.map(e=>this.formatTrade(e)))}onApiCreated(e){this.startKeepAlive(e,{event:"ping"},3e4)}onApiRemoved(e){this.stopKeepAlive(e)}}class WHITEBIT extends Exchange{constructor(){super(...arguments),__publicField(this,"id","WHITEBIT"),__publicField(this,"endpoints",{PRODUCTS:["https://whitebit.com/api/v4/public/markets"]})}async getUrl(){return"wss://api.whitebit.com/ws"}formatProducts(e){const t=[...e.map(e=>e.name)];return[...new Set(t)]}async subscribe(e,t){if(await super.subscribe(e,t))return e.send(JSON.stringify({id:8,method:"trades_subscribe",params:[t]})),!0}async unsubscribe(e,t){if(await super.unsubscribe(e,t))return e.send(JSON.stringify({id:9,method:"trades_unsubscribe",params:[t]})),!0}formatTrade(e,t){return{exchange:this.id,pair:e,timestamp:parseInt((1e3*t.time).toString()),price:+parseFloat(t.price),size:parseFloat(t.amount),side:t.type}}onMessage(e,t){const i=JSON.parse(e.data);if(!i||"trades_update"!==i.method)return;const s=i.params[0],r=i.params[1];return this.emitTrades(t.id,r.map(e=>this.formatTrade(s,e)))}onApiCreated(e){this.startKeepAlive(e,{id:0,method:"ping",params:[]},3e4)}onApiRemoved(e){this.stopKeepAlive(e)}}const exchanges=[new AGGR,new ASTER,new BITMEX,new BINANCE_FUTURES,new BINANCE_US,new KRAKEN,new HUOBI,new BINANCE,new BITFINEX,new BITSTAMP,new COINBASE,new HITBTC,new OKEX,new POLONIEX,new DERIBIT,new BYBIT,new PHEMEX,new DYDX,new Mexc,new KUCOIN,new BITGET,new BITUNIX,new GATEIO,new CryptoCom,new Bitmart,new HYPERLIQUID,new WHITEBIT];function getExchangeById(e){for(const t of exchanges)if(t.id.toLowerCase()===e.toLowerCase())return t}class Aggregator{constructor(e){__publicField(this,"ctx"),__publicField(this,"connections",{}),__publicField(this,"activeBuckets",[]),__publicField(this,"buckets",{}),__publicField(this,"connectionsCount",0),__publicField(this,"connectionChange",0),__publicField(this,"tickersDelay",10),__publicField(this,"baseAggregationTimeout",50),__publicField(this,"onGoingAggregations",{}),__publicField(this,"aggregationTimeouts",{}),__publicField(this,"pendingTrades",[]),__publicField(this,"tickers",{}),__publicField(this,"_connectionChangeNoticeTimeout"),this.bindExchanges(),this.startTickersInterval(),this.ctx=e,this.ctx.postMessage({op:"hello"})}bindExchanges(){for(const e of exchanges)e.on("subscribed",this.onSubscribed.bind(this,e.id)),e.on("unsubscribed",this.onUnsubscribed.bind(this,e.id)),e.on("error",this.onError.bind(this,e.id))}bindTradesEvent(){for(const e of exchanges)e.off("trades"),e.off("liquidations"),settings.aggregationLength>0?(e.on("trades",this.aggregateTrades.bind(this)),e.on("liquidations",this.aggregateLiquidations.bind(this))):(e.on("trades",this.emitTrades.bind(this)),e.on("liquidations",this.emitLiquidations.bind(this)));settings.aggregationLength>0?this.startAggrInterval():(this.clearInterval("aggr"),this.timeoutExpiredAggregations(),this.emitPendingTrades())}updateBuckets(e){const t=[],i=[];e.length;for(const s in e){-1===t.indexOf(s)&&t.push(s),this.buckets[s]||(this.buckets[s]=this.createBucket());for(const t of e[s])-1===i.indexOf(t)&&i.push(t),this.connections[t]&&(this.connections[t].bucket||(this.connections[t].bucket=this.createBucket()))}for(const s in this.connections)this.connections[s].bucket&&-1===i.indexOf(s)&&(this.connections[s].bucket=null);for(const s in this.buckets)-1===t.indexOf(s)&&delete this.buckets[s];t.length,t.length&&!this.activeBuckets.length?this.startStatsInterval():this.activeBuckets.length&&!t.length&&this._statsInterval&&(this.clearInterval("stats"),this._statsInterval=null),this.activeBuckets=t,settings.buckets=e}emitTrades(e){for(let t=0;t<e.length;t++){const i=e[t],s=i.exchange+":"+i.pair;this.connections[s]&&i.size&&i.price&&(settings.calculateSlippage&&(i.originalPrice=this.tickers[s].price||i.price),i.count=i.count||1,this.processTrade(i))}this.ctx.postMessage({op:"trades",data:e})}aggregateTrades(e){const t=Date.now();for(let i=0;i<e.length;i++){const s=e[i],r=s.exchange+":"+s.pair;if(this.connections[r]&&s.size&&s.price){if(this.onGoingAggregations[r]){const e=this.onGoingAggregations[r];if(e.timestamp+settings.aggregationLength>s.timestamp&&e.side===s.side){e.size+=s.size,e.price=s.price,e.value+=s.price*s.size,e.count+=s.count||1;continue}this.pendingTrades.push(this.processTrade(e))}s.originalPrice=this.tickers[r].price||s.price,s.value=s.price*s.size,s.count=s.count||1,this.aggregationTimeouts[r]=t+this.baseAggregationTimeout,this.onGoingAggregations[r]=s}}}emitLiquidations(e){for(let t=0;t<e.length;t++){const i=e[t],s=i.exchange+":"+i.pair;this.connections[s]&&this.processLiquidation(i)}this.ctx.postMessage({op:"trades",data:e})}aggregateLiquidations(e){const t=Date.now();for(let i=0;i<e.length;i++){const s=e[i],r=s.exchange+":"+s.pair,n="liq_"+r;if(this.connections[r]){if(this.onGoingAggregations[n]){const e=this.onGoingAggregations[n];if(settings.aggregationLength>0&&e.timestamp+settings.aggregationLength>s.timestamp&&e.side===s.side){e.size+=s.size,e.value+=s.price*s.size,e.count++;continue}this.pendingTrades.push(this.processLiquidation(e))}s.count=1,s.value=s.price*s.size,this.aggregationTimeouts[n]=t+this.baseAggregationTimeout,this.onGoingAggregations[n]=s}}}isAggregatedTrade(e){return!!e.value}processTrade(e){const t=e.exchange+":"+e.pair;return settings.calculateSlippage&&("price"===settings.calculateSlippage?(e.slippage=Math.round(10*(e.price-e.originalPrice+Number.EPSILON))/10,Math.abs(e.slippage)/e.price<25e-6&&(e.slippage=0)):"bps"===settings.calculateSlippage&&(e.slippage=Math.round((e.price-e.originalPrice)/e.originalPrice*1e4))),e.avgPrice=this.isAggregatedTrade(e)?e.value/e.size:e.price,e.amount=(settings.preferQuoteCurrencySize?e.avgPrice:1)*e.size,this.tickers[t].updated=!0,this.tickers[t].volume+=e.amount,this.tickers[t].volumeDelta+=e.amount*("buy"===e.side?1:-1),this.tickers[t].price=e.price,null===this.tickers[t].initialPrice&&this.emitInitialPrice(t,e.price),this.connections[t].bucket&&(this.connections[t].bucket["c"+e.side]+=e.count,this.connections[t].bucket["v"+e.side]+=e.amount),e}processLiquidation(e){const t=e.exchange+":"+e.pair;return e.amount=(settings.preferQuoteCurrencySize?e.price:1)*e.size,e.avgPrice=this.isAggregatedTrade(e)?e.value/e.size:e.price,this.connections[t].bucket&&(this.connections[t].bucket["l"+e.side]+=e.amount),e}timeoutExpiredAggregations(){const e=Date.now(),t=Object.keys(this.onGoingAggregations);for(let i=0;i<t.length;i++){const s=this.onGoingAggregations[t[i]];e>this.aggregationTimeouts[t[i]]&&(s.liquidation?this.pendingTrades.push(this.processLiquidation(s)):this.pendingTrades.push(this.processTrade(s)),delete this.onGoingAggregations[t[i]])}}emitInitialPrice(e,t){this.tickers[e].initialPrice=t,this.ctx.postMessage({op:"price",data:{market:e,price:t}})}emitPendingTrades(){settings.aggregationLength>0&&this.timeoutExpiredAggregations(),this.pendingTrades.length&&(this.ctx.postMessage({op:"trades",data:this.pendingTrades}),this.pendingTrades.splice(0,this.pendingTrades.length))}emitStats(){const e=Date.now();for(const t in settings.buckets){for(const e of settings.buckets[t])this.connections[e]&&(this.buckets[t].vbuy+=this.connections[e].bucket.vbuy,this.buckets[t].vsell+=this.connections[e].bucket.vsell,this.buckets[t].cbuy+=this.connections[e].bucket.cbuy,this.buckets[t].csell+=this.connections[e].bucket.csell,this.buckets[t].lbuy+=this.connections[e].bucket.lbuy,this.buckets[t].lsell+=this.connections[e].bucket.lsell);this.buckets[t].timestamp=e,this.ctx.postMessage({op:"bucket-"+t,data:this.buckets[t]}),this.clearBucket(this.buckets[t])}for(const t in this.connections)this.connections[t].bucket&&this.clearBucket(this.connections[t].bucket)}emitTickers(){if(this.connectionsCount){const e={};for(const t in this.tickers)this.tickers[t].updated&&(e[t]={price:this.tickers[t].price,volume:this.tickers[t].volume,volumeDelta:this.tickers[t].volumeDelta},this.tickers[t].updated=!1,this.tickers[t].volume=0,this.tickers[t].volumeDelta=0);this.ctx.postMessage({op:"tickers",data:e})}this._tickersInterval=self.setTimeout(()=>this.emitTickers(),this.tickersDelay)}onSubscribed(e,t,i){const s=e+":"+t;if(!this.connections[s]){this.connections[s]={exchange:e,pair:t,hit:0,timestamp:null},this.tickers[s]={volume:0,volumeDelta:0,initialPrice:null,price:null},this.connectionsCount=Object.keys(this.connections).length;for(const e in settings.buckets)if(-1!==settings.buckets[e].indexOf(s)){this.connections[s].bucket=this.createBucket();break}this.ctx.postMessage({op:"connection",data:{pair:t,url:i,exchangeId:e}}),this.noticeConnectionChange(1),this.refreshTickersDelay()}}onUnsubscribed(e,t){const i=e+":"+t;this.onGoingAggregations[i]&&delete this.onGoingAggregations[i],this.connections[i]&&(delete this.connections[i],delete this.tickers[i],this.connectionsCount=Object.keys(this.connections).length,this.ctx.postMessage({op:"disconnection",data:{pair:t,exchangeId:e}}),this.noticeConnectionChange(-1),this.refreshTickersDelay())}noticeConnectionChange(e){this.connectionChange+=e,this._connectionChangeNoticeTimeout&&clearTimeout(this._connectionChangeNoticeTimeout),this._connectionChangeNoticeTimeout=setTimeout(()=>{this._connectionChangeNoticeTimeout=null,this.connectionChange&&this.ctx.postMessage({op:"notice",data:{id:"connections",type:"success",title:this.connectionsCount+" connections ("+(this.connectionChange>0?"+":"")+this.connectionChange+")"}}),this.connectionChange=0},3e3)}createBucket(){return{timestamp:null,vbuy:0,vsell:0,cbuy:0,csell:0,lbuy:0,lsell:0}}clearBucket(e){e.cbuy=e.csell=e.vbuy=e.vsell=e.lbuy=e.lsell=0}onError(e,t){let i;"string"==typeof t?i=t:t.message&&(i=t.message),i&&this.ctx.postMessage({op:"notice",data:{id:e+"-error",type:"error",title:`${e} disconnected unexpectedly (${i})`}});const s=t&&t.target;this.ctx.postMessage({op:"error",data:{exchangeId:e,wasOpened:s?s._wasOpened:null,originalUrl:s?s._originalUrl:null,wasErrored:s?s._wasErrored:null,url:s?s.url:null}})}async connect(e,t){const i=e.reduce((e,t)=>{const[i,s]=parseMarket(t);return i&&s?(e[i]||(e[i]=[]),-1===e[i].indexOf(t)&&e[i].push(t),e):{}},{}),s=[];for(const r in i){const e=getExchangeById(r);if(e){e.requiresProducts&&await e.getProducts();const t=e.getEstimatedTimeToConnect(i[r].length);t>2e4&&this.ctx.postMessage({op:"notice",data:{id:r+"-connection-delay",type:"warning",timeout:t,title:`Connecting to ${i[r].length} markets on ${r}\nThis will take about ${getHms(t,void 0," and ")}`}}),s.push((async()=>{for(const s of i[r])try{await e.link(s)}catch(t){}})())}}await Promise.all(s),t&&this.ctx.postMessage({op:"connect",trackingId:t})}async disconnect(e,t){const i=e.reduce((e,t)=>{const[i,s]=parseMarket(t);return i&&s?(e[i]||(e[i]=[]),-1===e[i].indexOf(t)&&e[i].push(t),e):{}},{}),s=[];for(const r in i){const e=getExchangeById(r);e&&s.push((async()=>{for(const t of i[r])await e.unlink(t)})())}await Promise.all(s),t&&this.ctx.postMessage({op:"connect",trackingId:t})}startTickersInterval(){this._tickersInterval||this.emitTickers()}startAggrInterval(){this._aggrInterval&&this.clearInterval("aggr"),this._aggrInterval=self.setInterval(this.emitPendingTrades.bind(this),Math.max(settings.aggregationLength,50))}startStatsInterval(){this._statsInterval||(this._statsInterval=self.setInterval(this.emitStats.bind(this),500))}clearInterval(e){this["_"+e+"Interval"]&&(clearInterval(this["_"+e+"Interval"]),this["_"+e+"Interval"]=null)}async fetchExchangeProducts({exchangeId:e,forceFetch:t},i){const s=await getExchangeById(e).getProducts(t);this.ctx.postMessage({op:"fetchExchangeProducts",data:s,trackingId:i})}formatExchangeProducts({exchangeId:e,response:t},i){let s=null;try{s=getExchangeById(e).formatProducts(t)}catch(r){this.ctx.postMessage({op:"notice",data:{id:e+"-products",type:"error",title:`Failed to format ${e}'s products`}})}this.ctx.postMessage({op:"formatExchangeProducts",data:s,trackingId:i})}configureAggregator({key:e,value:t}){if(void 0!==settings[e]&&settings[e]!==t&&(settings[e]=t,"aggregationLength"===e)){const e=(this.baseAggregationTimeout||1)*(t||1)<0;if(this.baseAggregationTimeout=t,this.bindTradesEvent(),e){const e=-1===t?"raw":"aggregated",i=[];exchanges.forEach(e=>{"BINANCE"!==e.id&&"BINANCE_FUTURES"!==e.id||!e.apis.length||(i.push(e.id),e.apis.forEach(e=>e.close()))}),i.length&&this.ctx.postMessage({op:"notice",data:{title:`Switching to  ${e} trade data${i.map(e=>`<div class="d-flex mt4"><i class="icon-${e} -center mr4"></i> ${e}</div>`).join("")}`,html:!0}})}}}refreshTickersDelay(){const e=Object.keys(this.connections).length;return this.tickersDelay=100*Math.log(200*Math.exp(e/20+1)),this.tickersDelay}getAllTickers(e,t){this.ctx.postMessage({op:"getAllTickers",trackingId:t,data:this.tickers})}clearReconnectionTimeout(){for(const e of exchanges)e.reconnectAllClosedApis()&&this.ctx.postMessage({op:"notice",data:{title:`Reconnecting ${e.id}`}})}}addEventListener("message",e=>{const t=e.data;"function"==typeof aggregator[t.op]&&aggregator[t.op](t.data,t.trackingId)});const aggregator=new Aggregator(self)})();
