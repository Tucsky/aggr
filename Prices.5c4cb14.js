var e=Object.defineProperty,t=(t,s,r)=>(((t,s,r)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r})(t,"symbol"!=typeof s?s+"":s,r),r);import{C as s,t as r,V as o,n as i,ag as a,p as n,ak as l,j as h,U as c,a2 as u,W as d,_ as p}from"./index.5c4cb14.js";import{P as m,a as g}from"./PaneHeader.5c4cb14.js";var v=Object.defineProperty,k=Object.getOwnPropertyDescriptor;let f=class extends o{constructor(){super(...arguments),t(this,"paneId")}get sortType(){return this.$store.state[this.paneId].sortType}get sortOrder(){return this.$store.state[this.paneId].sortOrder}selectSortType(e){e===this.sortType&&this.$store.commit(this.paneId+"/TOGGLE_SORT_ASC"),this.$store.commit(this.paneId+"/SET_SORT_TYPE",e)}};f=((e,t,s,r)=>{for(var o,i=r>1?void 0:r?k(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(i=(r?o(t,s,i):o(i))||i);return r&&i&&v(t,s,i),i})([s({name:"PricesSortDropdown",components:{DropdownButton:r},props:{paneId:{type:String,required:!0},buttonClass:{type:String,default:"-text -arrow"}}})],f);const T=i(f,(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("dropdown-button",{attrs:{options:["none","price","volume","delta","change"]},on:{input:function(t){return e.selectSortType(t)}},model:{value:e.sortType,callback:function(t){e.sortType=t},expression:"sortType"}})}),[],!1,null,null,null,null).exports;var _=Object.defineProperty,P=Object.getOwnPropertyDescriptor,y=(e,t,s,r)=>{for(var o,i=r>1?void 0:r?P(t,s):t,a=e.length-1;a>=0;a--)(o=e[a])&&(i=(r?o(t,s,i):o(i))||i);return r&&i&&_(t,s,i),i};let b=class extends(a(m)){constructor(){super(...arguments),t(this,"mode","vertical"),t(this,"pauseSort",!1),t(this,"showCryptosLogos",!1),t(this,"filteredMarkets",[]),t(this,"VITE_APP_BASE_PATH","/aggr/"),t(this,"sortFunction"),t(this,"markets"),t(this,"lastResetTimestamp"),t(this,"lastPeriodTickers"),t(this,"periodMs"),t(this,"resetTimeout")}onMarketChange(e,t){for(const s of t)-1===e.indexOf(s)&&this.removeMarketFromList(s);for(const s of e)if(-1===t.indexOf(s)){const[e,t]=n(s);this.addMarketToList({id:s,exchange:e,pair:t})}this.showCryptosLogos=this.hasMultipleLocals()}onPeriodChange(e){e>0?this.periodReset():this.clearPeriodReset()}onVolumeThresholdChange(e){this.toggleSort(!0),e?this.filterMarkets():this.filteredMarkets=this.markets}onShortSymbolsChange(e){for(const t of this.markets){if(e){const e=l(t.exchange,t.pair);if(e){t.local=this.getSymbol(e);continue}}t.local=t.pair}}onSortOrderChange(){this.cacheSortFunction()}onSortTypeChange(){this.cacheSortFunction()}get exchanges(){return this.$store.state.exchanges}get disableAnimations(){return this.$store.state.settings.disableAnimations}get showPairs(){return this.$store.state[this.paneId].showPairs}get showChange(){return this.$store.state[this.paneId].showChange}get showPrice(){return this.$store.state[this.paneId].showPrice}get showVolume(){return this.$store.state[this.paneId].showVolume}get showVolumeDelta(){return this.$store.state[this.paneId].showVolumeDelta}get animateSort(){return this.$store.state[this.paneId].animateSort}get sortType(){return this.$store.state[this.paneId].sortType}get sortOrder(){return this.$store.state[this.paneId].sortOrder}get period(){return this.$store.state[this.paneId].period}get shortSymbols(){return this.$store.state[this.paneId].shortSymbols}get avgPeriods(){return this.$store.state[this.paneId].avgPeriods}get volumeThreshold(){return this.$store.state[this.paneId].volumeThreshold}get transitionGroupName(){return this.animateSort?"flip-list":null}created(){this.cacheSortFunction(),this.refreshMarkets()}mounted(){h.on("tickers",this.updateMarkets),this.filterMarkets(!0)}beforeDestroy(){h.off("tickers",this.updateMarkets),this.resetTimeout&&clearTimeout(this.resetTimeout)}refreshMarkets(){this.markets=[],this.lastPeriodTickers={};const e=[];for(const t of this.pane.markets){const[s,r]=n(t),o=this.addMarketToList({id:t,pair:r,exchange:s});-1===e.indexOf(o.local)&&e.push(o.local)}this.showCryptosLogos=this.hasMultipleLocals(),this.filterMarkets()}updateMarkets(e){const t=this.showChange,s=this.avgPeriods,r=this.getPeriodWeight(s);for(const o of this.markets){const i=e[o.id];if(!i)continue;const a=this.lastPeriodTickers[o.id];if(a.price||(a.price=i.price),o.price=c(i.price,o.id),o.volume+=i.volume,o.volumeDelta+=i.volumeDelta,s?(o.avgVolume=o.volume*r+a.volume*(1-r),o.avgVolumeDelta=Math.round((o.volumeDelta*r+a.volumeDelta*(1-r))/o.avgVolume*100)):(o.avgVolume=o.volume,o.avgVolumeDelta=Math.round(o.volumeDelta/o.volume*100)),t&&i.price){const e=i.price-this.lastPeriodTickers[o.id].price;o.change=e/this.lastPeriodTickers[o.id].price*100,o.avgChange=s?o.change*r+a.change*(1-r):o.change,o.status=o.avgChange>0?"-up":"-down"}else null===i.price?o.status="-pending":o.price>i.price?o.status="-down":o.price<i.price?o.status="-up":o.status="-neutral"}this.pauseSort||null===this.sortFunction||(this.filteredMarkets=this.filteredMarkets.sort(this.sortFunction))}removeMarketFromList(e){this.lastPeriodTickers[e]&&delete this.lastPeriodTickers[e];const t=this.markets.indexOf(this.markets.find((t=>t.id===e)));-1!==t&&this.markets.splice(t,1)}addMarketToList(e){this.lastPeriodTickers[e.id]={price:0,change:0,volume:0,volumeDelta:0};const t=l(e.exchange,e.pair);if(t)return this.markets.push({...e,local:this.getSymbol(t),base:t.base.replace(/^1000+/,"").toLowerCase(),status:"-pending",price:null,change:0,avgChange:0,volume:0,avgVolume:0,volumeDelta:0,avgVolumeDelta:0}),t}cacheSortFunction(){const e="horizontal"===this.mode?this.sortOrder>0?-1:1:this.sortOrder,t=this.sortType;t&&"none"!==t?("price"===t?this.sortFunction=1===e?(e,t)=>e.price-t.price:(e,t)=>t.price-e.price:"change"===t?this.sortFunction=1===e?(e,t)=>e.avgChange-t.avgChange:(e,t)=>t.avgChange-e.avgChange:"volume"===t?this.sortFunction=1===e?(e,t)=>e.avgVolume-t.avgVolume:(e,t)=>t.avgVolume-e.avgVolume:"delta"===t&&(this.sortFunction=1===e?(e,t)=>e.avgVolumeDelta-t.avgVolumeDelta:(e,t)=>t.avgVolumeDelta-e.avgVolumeDelta),this.filteredMarkets=this.filteredMarkets.sort(this.sortFunction)):this.sortFunction=null}formatAmount(e){return u(e,0)}onResize(e,t){this.mode=e>3*t?"horizontal":"vertical"}getTimeToNextReset(){const e=Date.now(),t=1e3*this.period*60;return Math.ceil((e+1e4)/t)*t-e}scheduleNextPeriodReset(){this.resetTimeout&&clearTimeout(this.resetTimeout),this.resetTimeout=setTimeout(this.periodReset.bind(this),this.getTimeToNextReset())}periodReset(){if(this.period){if(this.periodMs=1e3*this.period*60,this.lastResetTimestamp=this.resetTimeout?Date.now():null,this.markets)for(const e of this.markets)this.lastPeriodTickers[e.id].price=+e.price,this.lastPeriodTickers[e.id].change=+e.change,this.lastPeriodTickers[e.id].volume=+e.volume,this.lastPeriodTickers[e.id].volumeDelta=+e.volumeDelta,e.volume=0,e.volumeDelta=0;this.scheduleNextPeriodReset()}}clearPeriodReset(){for(const e in this.lastPeriodTickers)this.lastPeriodTickers[e].price=this.lastPeriodTickers[e].volume=this.lastPeriodTickers[e].volumeDelta=0;this.resetTimeout&&(clearTimeout(this.resetTimeout),this.resetTimeout=null)}filterMarkets(e){const t=this.volumeThreshold;this.pauseSort||(t?(this.filteredMarkets=this.markets.filter((e=>e.avgVolume>=t)),this.sortFunction&&(this.filteredMarkets=this.filteredMarkets.sort(this.sortFunction))):this.filteredMarkets=this.markets),e&&setTimeout((()=>{this.filterMarkets(!0)}),1e4*Math.random())}getPeriodWeight(e){return e&&this.lastResetTimestamp?(Date.now()-this.lastResetTimestamp)/this.periodMs:1}toggleSort(e){this.pauseSort=!e}getSymbol(e){return this.shortSymbols?e.base.replace(/^1000+/,"").slice(0,8):e.pair}hasMultipleLocals(){if(!this.markets.length)return!1;const e=this.markets[0].base;for(const t of this.markets)if(e!==t.base)return!0;return!1}};y([d("pane.markets")],b.prototype,"onMarketChange",1),y([d("period",{immediate:!0})],b.prototype,"onPeriodChange",1),y([d("volumeThreshold")],b.prototype,"onVolumeThresholdChange",1),y([d("shortSymbols")],b.prototype,"onShortSymbolsChange",1),y([d("sortOrder")],b.prototype,"onSortOrderChange",1),y([d("sortType")],b.prototype,"onSortTypeChange",1),b=y([s({components:{PaneHeader:g,PricesSortDropdown:T},name:"Prices"})],b);const S=i(b,(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"pane-prices",on:{mouseenter:function(t){return e.toggleSort(!1)},mouseleave:function(t){return e.toggleSort(!0)}}},[t("pane-header",{attrs:{paneId:e.paneId,settings:()=>p((()=>import("./PricesDialog.5c4cb14.js")),["PricesDialog.5c4cb14.js","index.5c4cb14.js","index.5c4cb14.css","paneDialogMixin.5c4cb14.js","ToggableGroup.5c4cb14.js","ToggableGroup.5c4cb14.css","PaneHeader.5c4cb14.js","IndicatorDropdown.5c4cb14.css"])}},[t("hr"),t("prices-sort-dropdown",{staticClass:"pane-overlay -text",attrs:{"pane-id":e.paneId}})],1),t("div",{staticClass:"markets-bar__wrapper hide-scrollbar"},[t(e.animateSort?"transition-group":"div",{tag:"component",staticClass:"markets-bar hide-scrollbar pane",class:["horizontal"===e.mode&&"-horizontal"],attrs:{name:e.transitionGroupName,tag:"div"}},e._l(e.filteredMarkets,(function(s){return t("div",{directives:[{name:"draggable-market",rawName:"v-draggable-market"}],key:s.id,staticClass:"market",class:s.status,attrs:{title:s.id,"data-market":s.id}},[t("div",{staticClass:"market__exchange",class:s.exchange,style:e.showCryptosLogos&&{backgroundImage:`url(${e.VITE_APP_BASE_PATH}img/logos/${s.base}.svg)`}}),e.showPairs?t("div",{staticClass:"market__pair"},[e._v(" "+e._s(s.local)+" ")]):e._e(),e.showPrice?t("div",{staticClass:"market__price"},[e._v(e._s(s.price))]):e._e(),e.showChange?t("div",{staticClass:"market__change"},[e._v(" "+e._s((s.avgChange>=0?"+":"")+s.avgChange.toFixed(2))+"% ")]):e._e(),e.showVolume?t("div",{staticClass:"market__volume"},[e._v(" "+e._s(e.formatAmount(s.avgVolume))+" ")]):e._e(),e.showVolumeDelta?t("div",{staticClass:"market__volume"},[e._v(" "+e._s(s.avgVolumeDelta)+"% ")]):e._e()])})),0)],1)],1)}),[],!1,null,"5bee51ad",null,null).exports,C=Object.freeze(Object.defineProperty({__proto__:null,default:S},Symbol.toStringTag,{value:"Module"}));export{T as P,C as a};
