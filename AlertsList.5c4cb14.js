var t=Object.defineProperty,e=(e,s,r)=>(((e,s,r)=>{s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r})(e,"symbol"!=typeof s?s+"":s,r),r);import{C as s,T as r,B as i,V as a,j as l,w as n,H as o,U as c,R as d,d as g,aa as p,n as h}from"./index.5c4cb14.js";var m=Object.defineProperty,u=Object.getOwnPropertyDescriptor;let f=class extends a{constructor(){super(...arguments),e(this,"dropdownAlert",null),e(this,"alertDropdownTrigger",null),e(this,"indexes",[]),e(this,"sections",[]),e(this,"isLoading",!1),e(this,"market"),e(this,"query")}get queryFilter(){return new RegExp(this.query,"i")}get alertsClick(){return this.$store.state.settings.alertsClick}get filteredIndexes(){return this.query?this.indexes.filter(t=>this.queryFilter.test(t.market)):this.indexes}async created(){if(await this.getAlerts(),1===this.filteredIndexes.length){const t=`alerts-${this.filteredIndexes[0].market}`;-1===this.$store.state.settings.sections.indexOf(t)&&this.$store.commit("settings/TOGGLE_SECTION",t)}l.on("alert",this.onAlert)}beforeDestroy(){l.off("alert",this.onAlert)}async getAlerts(){this.isLoading=!0;const t=await n.getAllAlerts();for(let e=0;e<t.length;e++)this.$set(this.indexes,e,t[e]);await o(100),this.isLoading=!1}formatPrice(t,e){return c(t,e)}togglePresetDropdown(t,e){this.alertDropdownTrigger?this.alertDropdownTrigger=null:(this.alertDropdownTrigger=t.currentTarget,this.dropdownAlert=e)}async removeAlert(t){this.isLoading=!0,await d.removeAlert(t),this.isLoading=!1}async createAlert(t){this.isLoading=!0,await d.createAlert(t),this.isLoading=!1}async checkStatus(t){this.isLoading=!0;const e=await d.toggleAlert(t.market,t.price,void 0,void 0,!0);if(this.isLoading=!1,e.alert)g.confirm({message:`Alert ${t.market} @<code>${t.price}</code> is still pending`,html:!0,ok:"Ok",cancel:null});else{const e=await g.confirm({title:"Not found",message:"Alert already triggered or expired",html:!0,ok:"Recreate",actions:[{label:"Remove",callback:()=>2}]});e?2===e?this.removeAlert(t):this.createAlert(t):await d.deactivateAlert(t)}}onAlert({price:t,market:e,type:s,newPrice:r,message:i}){let a=this.indexes.find(t=>t.market===e);if(!a){if(s!==p.CREATED)return;this.$set(this.indexes,this.indexes.length,{market:e,alerts:[]}),a=this.indexes[this.indexes.length-1],-1===this.sections.indexOf(`alerts-${this.sections}`)&&this.sections.push(`alerts-${this.sections}`)}const l=a.alerts.findIndex(e=>e.price===t);-1!==l?s===p.DELETED?(a.alerts.splice(l,1),a.alerts.length||this.indexes.splice(this.indexes.indexOf(a),1)):s===p.UPDATED?this.$set(a.alerts[l],"price",r):s===p.TRIGGERED?this.$set(a.alerts[l],"triggered",!0):s===p.ACTIVATED?(this.$set(a.alerts[l],"active",!0),void 0!==i&&this.$set(a.alerts[l],"message",i)):s===p.DEACTIVATED&&this.$set(a.alerts[l],"active",!1):s===p.CREATED&&this.$set(a.alerts,a.alerts.length,{price:t,market:e})}async clearAlerts(t,e){if(!(await g.confirm({message:`Remove all ${t.market} alerts`,ok:`Yes (${t.alerts.length})`})))return;e&&(e.loading=!0);const s=[...t.alerts];for(const r of s)await d.removeAlert(r);await n.saveAlerts({market:t.market,alerts:[]}),e&&(e.loading=!1)}};f=((t,e,s,r)=>{for(var i,a=r>1?void 0:r?u(e,s):e,l=t.length-1;l>=0;l--)(i=t[l])&&(a=(r?i(e,s,a):i(a))||a);return r&&a&&m(e,s,a),a})([s({components:{ToggableSection:r,Btn:i},name:"Alerts",props:{query:{type:String,default:""},persistSections:{type:Boolean,default:!1},withOptions:{type:Boolean,default:!1}}})],f);const v=h(f,function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"alerts-list hide-scrollbar",class:[t.withOptions&&"alerts-list--with-options"]},[t.withOptions?e("div",{staticClass:"alert-list__header dropdown-item"},[e("label",{staticClass:"checkbox-control -small w-100",on:{click:function(t){t.stopPropagation()},mousedown:function(t){t.preventDefault()}}},[e("input",{staticClass:"form-control",attrs:{type:"checkbox"},domProps:{checked:t.alertsClick},on:{change:function(e){return t.$store.commit("settings/TOGGLE_ALERTS_CLICK")}}}),e("span",[t._v("1 click")]),e("i",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"icon-info text-muted ml8",attrs:{title:"Place alerts faster ⚡️"}}),e("div",{staticClass:"mlauto"})])]):t._e(),t.filteredIndexes.length||t.isLoading?t._e():e("div",{staticClass:"alerts-list__empty px8 text-danger"},[e("i",{staticClass:"icon-cross -small"}),t._v(" no alerts "),t.query?[t._v(' matching "'+t._s(t.query)+'" ')]:t._e()],2),t._l(t.filteredIndexes,function(s,r){return e("ToggableSection",{key:s.market,staticClass:"alerts-list__section",attrs:{model:t.sections,id:t.persistSections&&`alerts-${s.market}`,"auto-close":"",small:""},scopedSlots:t._u([{key:"title",fn:function(){return[e("div",{directives:[{name:"draggable-market",rawName:"v-draggable-market"}],staticClass:"toggable-section__title",attrs:{"data-market":s.market}},[t._v(" "+t._s(s.market)+" "),s.alerts.length>1?e("span",{staticClass:"badge -invert ml8"},[t._v(t._s(s.alerts.length))]):t._e()])]},proxy:!0},{key:"control",fn:function(){return[e("Btn",{ref:"clearBtns",refInFor:!0,staticClass:"-text mr16",on:{click:function(e){return t.clearAlerts(s,t.$refs.clearBtns[r])}}},[e("i",{staticClass:"icon-trash"})])]},proxy:!0}],null,!0)},[s.alerts.length?e("table",{staticClass:"table alerts-list__table"},[e("tbody",t._l(s.alerts,function(s){return e("tr",{key:s.id,staticClass:"alerts-list-item",class:[s.triggered&&"alerts-list-item--triggered"]},[e("td",{staticClass:"table-input alerts-list-item__price"},[s.message?e("span",{directives:[{name:"tippy",rawName:"v-tippy",value:{followCursor:!0,distance:24},expression:"{ followCursor: true, distance: 24 }"}],attrs:{title:s.message}},[t._v(" "+t._s(t.formatPrice(s.price,s.market))+" ")]):e("span",[t._v(" "+t._s(t.formatPrice(s.price,s.market))+" ")])]),e("td",{staticClass:"alerts-list-item__status table-input text-nowrap text-right",class:[s.triggered&&"text-success"]},[s.triggered?[e("i",{staticClass:"icon-check"}),t._v(" Triggered ")]:s.active?[t._v("Active")]:[t._v("Inactive")]],2),s.triggered?e("td",{staticClass:"table-action -hover",on:{click:function(e){return e.stopPropagation(),t.removeAlert(s)}}},[e("button",{staticClass:"btn -text -small"},[e("i",{staticClass:"icon-cross"})])]):e("td",{staticClass:"table-action -hover",on:{click:function(e){return e.stopPropagation(),t.togglePresetDropdown(e,s)}}},[e("button",{staticClass:"btn -text -small"},[e("i",{staticClass:"icon-more"})])])])}),0)]):e("p",{staticClass:"text-danger pl8"},[t._v("No alerts")])])}),e("dropdown",{model:{value:t.alertDropdownTrigger,callback:function(e){t.alertDropdownTrigger=e},expression:"alertDropdownTrigger"}},[t.dropdownAlert&&!t.dropdownAlert.triggered?[e("Btn",{staticClass:"dropdown-item -cases",attrs:{type:"button",loading:t.isLoading},on:{click:function(e){e.stopPropagation(),t.checkStatus(t.dropdownAlert).then(()=>t.alertDropdownTrigger=null)}}},[e("i",{staticClass:"icon-search"}),e("span",[t._v("Check status")])]),e("div",{staticClass:"dropdown-divider"})]:t._e(),e("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(e){return t.removeAlert(t.dropdownAlert)}}},[e("i",{staticClass:"icon-cross"}),e("span",[t._v("Remove")])])],2)],2)},[],!1,null,"8b47237c",null,null).exports;export{v as A};
