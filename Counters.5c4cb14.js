var t=Object.defineProperty,s=(s,e,n)=>(((s,e,n)=>{e in s?t(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n})(s,"symbol"!=typeof e?e+"":e,n),n);import{ag as e,j as n,l as i,m as a,r,o as u,a7 as l,g as o,a2 as h,C as c,n as p,_}from"./index.5c4cb14.js";import{P as d,a as y}from"./PaneHeader.5c4cb14.js";var b=Object.defineProperty,m=Object.getOwnPropertyDescriptor;let C=class extends(e(d)){constructor(){super(...arguments),s(this,"steps",[]),s(this,"_populateCountersInterval"),s(this,"_activeChunk"),s(this,"_counters"),s(this,"_feed",null)}get liquidationsOnly(){return this.$store.state[this.paneId].liquidationsOnly}get countersSteps(){return this.$store.state[this.paneId].steps}get countersCount(){return this.$store.state[this.paneId].count}get countersGranularity(){return this.$store.state[this.paneId].granularity}get activeSteps(){return this.steps.filter((t=>t.hasData))}created(){this._onStoreMutation=this.$store.subscribe((t=>{switch(t.type){case"settings/SET_BUY_COLOR":case"settings/SET_SELL_COLOR":this.generateColors();break;case"panes/SET_PANE_MARKETS":t.payload.id===this.paneId&&this.createCounters();break;case this.paneId+"/REPLACE_COUNTERS":case this.paneId+"/TOGGLE_LIQUIDATIONS_ONLY":case this.paneId+"/TOGGLE_COUNT":this.createCounters()}})),this._populateCountersInterval=setInterval(this.populateCounters.bind(this),this.countersGranularity)}mounted(){this.createCounters(),this.generateColors()}beforeDestroy(){this._feed&&n.off(this._feed,this.onVolume),clearInterval(this._populateCountersInterval)}onVolume(t){const s={buy:t.vbuy,sell:t.vsell};if(this.liquidationsOnly?(s.buy=t.lbuy,s.sell=t.lsell):this.countersCount&&(s.buy=t.cbuy,s.sell=t.csell),s.buy||s.sell){this._activeChunk.timestamp||(this._activeChunk.timestamp=t.timestamp),this._activeChunk.buy+=s.buy,this._activeChunk.sell+=s.sell;for(let t=0;t<this.steps.length;t++)this.steps[t].buy+=s.buy,this.steps[t].sell+=s.sell}}clearCounters(){this._feed&&n.off(this._feed,this.onVolume),this._counters?(this._counters.splice(0,this._counters.length),this._activeChunk.timestamp=null,this._activeChunk.buy=this._activeChunk.sell=0,this.steps.splice(0,this.steps.length)):(this._counters=[],this._activeChunk={timestamp:null,buy:0,sell:0},this.steps=[])}generateColors(){const t=getComputedStyle(document.documentElement),s=i(t.getPropertyValue("--theme-buy-base"),a()),e=i(t.getPropertyValue("--theme-sell-base"),a()),n=this.$el;for(let i=0;i<this.steps.length;i++){const t=i*(.25/this.steps.length);n.style.setProperty(`--buy-color-${i+1}`,r(u(s,-t,t))),n.style.setProperty(`--sell-color-${i+1}`,r(u(e,-t,t)))}}createCounters(){this.clearCounters();for(const t of this.countersSteps){const s={duration:t,chunks:[]};this._counters.push(s);const e=0===this._counters.indexOf(s);this.steps.push({duration:l(s.duration),buy:0,sell:0,hasData:e})}this._feed="bucket-"+o(this.pane.markets),this._feed.length&&n.on(this._feed,this.onVolume)}populateCounters(){const t=Date.now();this._activeChunk.timestamp&&(this._counters[0].chunks.push({timestamp:this._activeChunk.timestamp,buy:this._activeChunk.buy,sell:this._activeChunk.sell}),this._activeChunk.timestamp=null,this._activeChunk.buy=0,this._activeChunk.sell=0);let s,e,n=[];for(let i=0;i<this._counters.length;i++){n.length&&(Array.prototype.push.apply(this._counters[i].chunks,n.splice(0,n.length)),this.steps[i].hasData||(this.steps[i].hasData=!0)),s=0,e=0;let a=0;for(let n=0;n<this._counters[i].chunks.length;n++)if(s+=this._counters[i].chunks[n].buy,e+=this._counters[i].chunks[n].sell,this._counters[i].chunks[n].timestamp>=t-this._counters[i].duration){a=n;break}a&&(n=this._counters[i].chunks.splice(0,a+1),this.steps[i].buy-=s,this.steps[i].sell-=e)}}formatAmount(t){return h(t)}};C=((t,s,e,n)=>{for(var i,a=n>1?void 0:n?m(s,e):s,r=t.length-1;r>=0;r--)(i=t[r])&&(a=(n?i(s,e,a):i(a))||a);return n&&a&&b(s,e,a),a})([c({components:{PaneHeader:y},name:"Counters"})],C);const v=p(C,(function(){var t=this,s=t._self._c;return t._self._setupProxy,s("div",{staticClass:"pane-counters"},[s("pane-header",{attrs:{paneId:t.paneId,settings:()=>_((()=>import("./CountersDialog.5c4cb14.js")),["CountersDialog.5c4cb14.js","index.5c4cb14.js","index.5c4cb14.css","paneDialogMixin.5c4cb14.js"])}}),s("div",{staticClass:"counters hide-scrollbar"},t._l(t.activeSteps,(function(e,n){return s("div",{key:n,staticClass:"counter",attrs:{duration:e.duration}},[s("div",{staticClass:"counter__side -buy",style:{width:e.buy/(e.buy+e.sell)*100+"%"}},[t.countersCount?s("span",[t._v(t._s(e.buy))]):s("span",[t._v(t._s(t.formatAmount(e.buy)))])]),s("div",{staticClass:"counter__side -sell",style:{width:e.sell/(e.buy+e.sell)*100+"%"}},[t.countersCount?s("span",[t._v(t._s(e.sell))]):s("span",[t._v(t._s(t.formatAmount(e.sell)))])])])})),0)],1)}),[],!1,null,null,null,null).exports;export{v as default};
